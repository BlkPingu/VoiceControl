13:07:03  Started MoneyMoney [App Store] version 2.3.35 (375) on macOS 10.15.6 (x86).
          Application file: /Applications/MoneyMoney.app
          Database file: /Users/Tobias/Library/Containers/com.moneymoney-app.retail/Data/Library/Application Support/MoneyMoney/Database/MoneyMoney.sqlite
          Database created on 16.05.2020.
          Bank server settings from 04.11.2020.
13:07:11  1> Starting Web Banking session for account Verrechnungskonto.
          1> Web Banking Engine: Using bundled extension onvista.lua version 1.24.
          1> Protocol version: Web Scraping
          1> Server address: https://webtrading.onvista-bank.de
          1> Sending: GET https://webtrading.onvista-bank.de/login
          1> Received: <!doctype html> <html class="no-js" xmlns:ng="http://angularjs.org" id="ng-app" ng-app="app-login" ng-strict-di="true">      <head>             <meta charset="utf-8">         <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">         <title>                                                 Webtrading onvista bank                                     </title>         <meta name="description" content="OnVista Web Trading">         <meta name="viewport" content="width=device-width, initial-scale=1">                        <link rel="shortcut icon" href="/favicon.ico">             <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/assets/favicons/apple-touch-icon-57x57.png" />             <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/favicons/apple-touch-icon-114x114.png" />             <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/favicons/apple-touch-icon-72x72.png" />             <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/favicons/apple-touch-icon-144x144.png" />             <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/assets/favicons/apple-touch-icon-60x60.png" />             <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/assets/favicons/apple-touch-icon-120x120.png" />             <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/assets/favicons/apple-touch-icon-76x76.png" />             <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/favicons/apple-touch-icon-152x152.png" />             <link rel="icon" type="image/png" href="/assets/favicons/favicon-196x196.png" sizes="196x196" />             <link rel="icon" type="image/png" href="/assets/favicons/favicon-96x96.png" sizes="96x96" />             <link rel="icon" type="image/png" href="/assets/favicons/favicon-32x32.png" sizes="32x32" />             <link rel="icon" type="image/png" href="/assets/favicons/favicon-16x16.png" sizes="16x16" />             <link rel="icon" type="image/png" href="/assets/favicons/favicon-128.png" sizes="128x128" />             <meta name="application-name" content="&nbsp;" />             <meta name="msapplication-TileColor" content="#FFFFFF" />             <meta name="msapplication-TileImage" content="/assets/favicons/mstile-144x144.png" />             <meta name="msapplication-square70x70logo" content="/assets/favicons/mstile-70x70.png" />             <meta name="msapplication-square150x150logo" content="/assets/favicons/mstile-150x150.png" />             <meta name="msapplication-wide310x150logo" content="/assets/favicons/mstile-310x150.png" />             <meta name="msapplication-square310x310logo" content="/assets/favicons/mstile-310x310.png" />                                                                    <link rel="stylesheet" href="/css/feature.css?0" />                                                      <link rel="stylesheet" href="/css/styles.css?0" />                                                                       <link rel="stylesheet" href="/css/print.css?0" media="print" />                                                                                            <base href="/">          <script>             window.BRS_APP_VERSION = 1604491631;             window.BRS_CONFIG = {"API_URL":"https:\/\/api.onvista-bank.de\/services\/api\/","API_KEY":"JKEIMG1J1NIJ5619","DEBUG":false,"ENABLE_PROFILER":false,"USE_SERVICE_QUEUE":false,"POSTIDENT_URL":"https:\/\/postident.deutschepost.de\/identportal\/"};             window.BRS_CONFIG.API_URL = "/services/api/";                             window.BRS_CONFIG.PARTNER_MODE = false;                                         window.BRS_CONFIG.IS_MOBILE = false;                     </script>          </head>      <body brs-browser-detect class="             ">                 <div ng-controller="AppController" ng-init="init()">              <!--[if lt IE 9]>             <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>             <![endif]-->              <!-- start header -->             <header class="header-webtrading">                 <div ng-include="topNavbarEmptyUrl"></div>                 <div ng-include="middleNavbarEmptyUrl"></div>             </header>             <!-- end header-->             <main>                 <div class="container content" ng-controller="BrsAppController">                     <!-- To load the pages -->                     <div ng-view></div>                      <brs-ui-alert alert-list="alerts">                     </brs-ui-alert>                      <!-- start progress bar with backdrop window-size-->                     <brs-ui-progressbar brs-ui-progressbar-show="mainLoading"></brs-ui-progressbar>                     <!-- end progress bar with backdrop window-size -->                 </div>             </main>         </div>                                                    <script src="/js/vendors.js?0"></script>                                                              <script src="/js/libraries.js?0"></script>                                   <script src="/js/login.js?0"></script>                                          <script src="/js/onvista.js?0"></script>                                   </body> </html>
          1> Loading JavaScript library.
          1> Sending: GET https://webtrading.onvista-bank.de/js/onvista.js?0
13:07:12  1> Received: "use strict";var m=angular.module("about",["brs-ui-modal","brs-ui-modal-scroller"]);m.controller("AboutController",["$scope","brsUiModal","brsAppVersion",function(o,l,t){o.openAboutsModal=function(){var o=l.open(l.getConfig("draggable","lg",{templateUrl:t.getUrl("/app/about/templates/about-modal.html"),controller:"ModalAboutController"}))}}]);m.controller("ModalAboutController",["$scope","$modalInstance",function(o,l){o.cancel=function(){l.dismiss("cancel")}}]); "use strict";var m=angular.module("about",[]);m.run(["$rootScope",function(o){}]); "use strict";var m=angular.module("auth-login",["brs-api-client","auth-user","secure-matrix","navigation","brs-ui-spinner","brs-route-params","trading-cfd"]);m.value("logoutMessages",{1:"Ihre Authentifizierung Cookie ist nicht mehr gÃŒltig.",2:"Ihre Sitzung ist abgelaufen."});m.value("authLoginUrl",{logout:"https://www.onvista-bank.de/logout.html"});m.service("authLoginPerformLogin",["$rootScope","authUser","brsApiClient","$q","$log","$window","$location","brsGetQueryRedirect","brsGetQueryBuilder","$rootElement","authOAuth","tradingCfdGetUrl","activationModal",function(l,u,c,g,d,h,f,p,m,w,b,e,n){d=d.getInstance("authLoginPerformLogin");var P;return function(e,n,t,o,r){var i=g.defer(),a=w.attr("ng-app"),s=p();if(P){return P}else{P=i.promise}l.mainLoading+=1;c.get("Session_Auth","login",{login:e,password:n,fakePassword:t,mgrUserID:o,token:r}).then(function(e){if(e.user===null){e.user={};d.error("LOGIN FAILED");l.$broadcast("auth:login:failed")}else{u.setData(e.user);u.setOtpInfo(e.otpInfo);if(f.path()!="/login-cfd"){if(f.path()!="/login-public"&&f.path()!="/otp"&&f.path()!="/otp-registration"&&f.path()!="/loginpcc"){d.info("authUser.otpInfo",u.otpInfo);if(!u.isPcc()&&u.hasPassedOtpRegistration()&&u.useStrongAuth()&&u.hasToPassOtp()){f.path("/otp").search(s)}else if(!u.isPcc()&&!u.hasPassedOtpRegistration()){f.path("/otp-registration").search(s)}else if(b.isOAuth()){b.openAuthorizationModal()}else{h.location.replace("/"+m(s))}}else{if(!u.isPcc()&&u.hasPassedOtpRegistration()&&u.useStrongAuth()&&u.hasToPassOtp()){f.path("/otp").search(s)}else if(!u.isPcc()&&!u.hasPassedOtpRegistration()){f.path("/otp-registration").search(s)}else if(b.isOAuth()){b.openAuthorizationModal()}else{h.parent.location.replace("/"+m(s))}}}else{if(!u.isPcc()&&u.hasPassedOtpRegistration()&&u.useStrongAuth()&&u.hasToPassOtp()){s.comingFrom="login-cfd";f.path("/otp").search(s)}else{f.path("/login-cfd")}}}i.resolve(u.d)}).catch(function(e){l.$broadcast("auth:login:failed");if(e.message=="Response queue error : Auftragseingabe fehlgeschlagen. Bitte versuchen Sie es in einigen Minuten erneut."){e.message="Die Anmeldung zum Webtrading konnte nicht durchgefÃŒhrt werden. Bitte versuchen Sie es in einigen Minuten erneut."}i.reject(e)}).finally(function(){l.mainLoading-=1;P=false});return i.promise}}]);m.service("authLoginPerformLogout",["$rootScope","authUser","brsApiClient","$window","$log","authLoginUrl","$cookieStore",function(n,t,e,o,r,i,a){r=r.getInstance("authLoginPerformLogout");return function(){return e.get("Session_Auth","logout").then(function(e){a.remove("forceDesktop");n.$broadcast("auth:logout",t);t.reset();n.displayUserConnected=false;r.info("Logged out successfully");o.parent.location.replace(i.logout)}).catch(function(e){r.info("catch");n.$broadcast("auth:logout:failed");n.displayUserConnected=false;o.parent.location.replace(i.logout)})}}]);m.service("authLoginPccChangeUser",["$rootScope","brsApiClient","$q","$window","brsGetQueryRedirect","brsGetQueryBuilder","brsAppAlerts",function(o,r,i,a,s,l,u){var c;return function(e){var n=i.defer(),t=s();if(c){return c}else{c=n.promise}o.mainLoading+=1;r.get("Session_Auth","pccChangeCustomer",{login:e}).then(function(e){if(e.success){o.mainLoading+=1;a.location.replace("/"+l(t))}else{n.reject()}}).catch(function(e){u.danger(e.message,"pcc"+e.code);n.reject()}).finally(function(){c=false;o.mainLoading-=1});return n.promise}}]);m.controller("LoginPageController",["$rootScope","authUser","$scope","SecureMatrixFactory","authLoginPerformLogin","BrsUiAlert","$window","$location","authLoginPerformLogout","brsGetQueryRedirect","$log","$timeout","brsGetQueryBuilder","brsAppVersion","authOAuth","brsAppConfig","authLoginUrl",function(e,n,t,o,r,i,a,s,l,u,c,g,d,h,f,p,m){c=c.getInstance("LoginPageController");t.loginFormTemplateUrl=h.getUrl("/app/auth-login/templates/login-form.html");t.authUser=n;t.alerts=new i;t.secureMatrixTemplateUrl=h.getUrl("/app/secure-matrix/templates/secure-matrix.html");t.url={landingPage:p.isPartnerMode()?"https://www.finanzen-broker.net":"https://www.onvista-bank.de/top-konditionen.html"};var w=u();t.getParams=w;e.$on("auth:login:refresh",function(){if(t.authUser.isLogged()&&f.isOAuth()){f.openAuthorizationModal()}else if(t.authUser.isLogged()&&(s.path()!="/login-public"&&s.path()!="/otp"&&s.path()!="/otp-registration"&&s.path()!="/loginpcc")){a.location.replace("/"+d(w))}else{s.path("/login-public").search(w)}});e.$on("auth:login:refresh:failed",function(){t.alerts.danger("Es scheint, dass Ihr Computer derzeit keine Verbindung zum Internet hat. Bitte ÃŒberprÃŒfen Sie Ihre Internetverbindung und versuchen Sie den Aufruf erneut.")});t.loginCredentials={customerLogin:"",logPcc:"",password:[""],hiddenPassword:[],pwdReadonly:true};t.loading=false;t.keypadError=false;t.initKeypad=function(e){t.newPwdSecureMatrix=new o;if(!e){var n=t.newPwdSecureMatrix.initMatrix("login_pad_new",t.loginCredentials.hiddenPassword,t.loginCredentials.password,"password");n.then(function(){t.newPwdSecureMatrix.visible=true;t.displayToggleKeyboardLinks=true;t.resetPwd(false)}).catch(function(e){t.alerts.info("Die virtuelle Sicherheitstastatur konnte leider nicht geladen werden. Bitte geben Sie Ihr Passwort ÃŒber die normale Tastatur ein.");t.newPwdSecureMatrix.visible=false;t.newPwdSecureMatrix.enterPasswordMessage="Ihr Passwort";t.displayToggleKeyboardLinks=false;t.keypadError=true;t.resetPwd(true)})}};t.initKeypad(p.isMobile());t.resetPwd=function(e){t.loginCredentials.password[0]=t.loginCredentials.password[0].slice(0,-t.loginCredentials.password[0].length);while(t.loginCredentials.hiddenPassword.length>0){t.loginCredentials.hiddenPassword.pop()}if(e){t.loginCredentials.pwdReadonly=false;if(angular.isDefined($("#password"))){g(function(){var e=$("#password");if(e){e.focus()}})}}else{t.loginCredentials.pwdReadonly=true}};t.performLogin=function(){t.alerts.clean();t.loading=true;r(t.loginCredentials.customerLogin,t.loginCredentials.password[0],t.loginCredentials.hiddenPassword.join("|"),t.loginCredentials.logPcc,t.newPwdSecureMatrix.token).catch(function(e){if(!e.message){e.message="PersÃ¶nlicher User oder Passwort falsch. Bitte ÃŒberprÃŒfen Sie Ihre Eingaben und geben Sie die Werte erneut ein."}if(e.code==110001){e.message="PersÃ¶nlicher User oder Passwort falsch. Bitte ÃŒberprÃŒfen Sie Ihre Eingaben und geben Sie die Werte erneut ein."}t.alerts.danger(e.message,"loginFailed");t.resetPwd(!t.loginCredentials.pwdReadonly);t.loginCredentials.customerLogin="";t.loginCredentials.logPcc="";t.loading=false})};t.goToTrading=function(){if(t.authUser.isLogged()&&(s.path()!="/login-public"&&s.path()!="/otp"&&s.path()!="/otp-registration")){a.location.replace("/"+d(w))}else if(t.authUser.isLogged()&&s.path()=="/login-public"){a.parent.location.replace("/"+d(w))}};t.logout=function(){l().catch(function(){c.warn("Couldn't logout (maybe not access to the web anymore), so logout locally.");n.reset();e.$broadcast("auth:logout",n);e.displayUserConnected=false;a.parent.location.replace(m.logout)})}}]);m.controller("LoginPccPageController",["$rootScope","authUser","$scope","SecureMatrixFactory","authLoginPerformLogin","BrsUiAlert","$window","$location","brsGetQueryRedirect",function(e,n,t,o,r,i,a,s,l){t.authUser=n;t.alerts=new i;var u=l();e.$on("auth:login:refresh",function(){if(t.authUser.isLogged()&&(s.path()!="/login-public"||s.path()!="/loginpcc")){a.location.replace("/"+brsGetQueryBuilder(u))}});e.$on("auth:login:refresh:failed",function(){t.alerts.danger("Es scheint, dass Ihr Computer derzeit keine Verbindung zum Internet hat. Bitte ÃŒberprÃŒfen Sie Ihre Internetverbindung und versuchen Sie den Aufruf erneut.")});t.loginCredentials={customerLogin:"",logPcc:"",password:[""],hiddenPassword:[],pwdReadonly:true};t.loading=false;t.keypadError=false;t.performLogin=function(){t.alerts.clean();t.loading=true;r(t.loginCredentials.customerLogin,t.loginCredentials.password[0],t.loginCredentials.hiddenPassword.join("|"),t.loginCredentials.logPcc).catch(function(e){if(!e.message){e.message="PersÃ¶nlicher User oder Passwort falsch. Bitte ÃŒberprÃŒfen Sie Ihre Eingaben und geben Sie die Werte erneut ein."}if(e.code==110001){e.message="PersÃ¶nlicher User oder Passwort falsch. Bitte ÃŒberprÃŒfen Sie Ihre Eingaben und geben Sie die Werte erneut ein."}t.alerts.danger(e.message,"loginFailed");t.loginCredentials.customerLogin="";t.loginCredentials.logPcc="";t.loading=false})}}]);m.controller("LoginCfdPageController",["$rootScope","authUser","$scope","authLoginPerformLogin","BrsUiAlert","$window","$location","brsGetQueryRedirect","tradingCfdGetUrl","authLoginUrl","authLoginPerformLogout",function(e,n,t,o,r,i,a,s,l,u,c){t.authUser=n;t.alerts=new r;t.loading=false;t.isChrome=e.browser==="chrome";t.hideLoginForm=t.authUser.isLogged();u.logout="/login-cfd";e.$on("auth:login:refresh",function(){if(t.authUser.isLogged()&&t.authUser.isActivated()){d()}});e.$on("auth:login:refresh:failed",function(){t.alerts.danger("Es scheint, dass Ihr Computer derzeit keine Verbindung zum Internet hat. Bitte ÃŒberprÃŒfen Sie Ihre Internetverbindung und versuchen Sie den Aufruf erneut.")});t.loginCredentials={customerLogin:"",logPcc:"",password:[""],hiddenPassword:[],pwdReadonly:true};t.performLogin=function(){t.alerts.clean();t.loading=true;o(t.loginCredentials.customerLogin,t.loginCredentials.password[0],t.loginCredentials.hiddenPassword.join("|"),t.loginCredentials.logPcc).then(function(){if(!(!n.isPcc()&&n.hasPassedOtpRegistration()&&n.useStrongAuth()&&n.hasToPassOtp())){d()}}).catch(function(e){t.loading=false;if(!e.message){e.message="PersÃ¶nlicher User oder Passwort falsch. Bitte ÃŒberprÃŒfen Sie Ihre Eingaben und geben Sie die Werte erneut ein."}if(e.code==110001){e.message="PersÃ¶nlicher User oder Passwort falsch. Bitte ÃŒberprÃŒfen Sie Ihre Eingaben und geben Sie die Werte erneut ein."}t.alerts.danger(e.message,"loginFailed");t.loginCredentials.customerLogin="";t.loginCredentials.logPcc=""})};t.goToHandel=function(){d()};t.logout=function(){t.loading=true;c().catch(function(){g()})};var g=function(){$log.warn("Couldn't logout (maybe not access to the web anymore), so logout locally.");t.loading=false;n.reset();e.$broadcast("auth:logout",n);e.displayUserConnected=false;i.parent.location.replace(u.logout)};var d=function(){t.hideLoginForm=true;t.loading=true;l().then(function(e){c().catch(function(){g()}).finally(function(){i.parent.location.replace(e)})}).catch(function(e){t.alerts.clean();t.loading=false;if(e.code===10105){t.alerts.danger("Der Zugang zum CFD-Handel ist nur fÃŒr User mit CFD-Konto mÃ¶glich.")}else{t.alerts.danger(e.message)}})}}]);m.run(["$rootScope","$log","authUser","authUserRefresh","$location","authLoginPerformLogout","brsAppConfig","authLoginUrl",function(e,t,n,o,r,i,a,s){if(a.isPartnerMode()){s.logout="https://www.finanzen-broker.net/logout.aspx"}t=t.getInstance("auth-login:run");e.$on("app:start",function(e,n){t.info("Application start auth-login");o().catch(function(e){t.warn("authUserRefresh have failed from auth-login")}).finally(function(){})});e.$on("strongAuthTokenAltered",function(){t.info("The strong authentication cookie seems to be altered or deleted.");i().catch(function(){t.warn("Couldn't logout (maybe not access to the web anymore), so logout locally.");n.reset();e.$broadcast("auth:logout",n);e.displayUserConnected=false;$window.parent.location.replace(s)})});e.$on("sessionAlteredOrLogoutElsewhere",function(){t.info("The session seems to be altered or you have been logged out from an other page.");i().catch(function(){t.warn("Couldn't logout (maybe not access to the web anymore), so logout locally.");n.reset();e.$broadcast("auth:logout",n);e.displayUserConnected=false;$window.parent.location.replace(s)})})}]); var m=angular.module("auth-user",["brs-api-client","auth-login","bank-activation","customer-details","brs-route-params","brs-ui-grid"]);m.service("authUserRefresh",["brsApiClient","authUser","$rootScope","$log","authLoginPerformLogout","$location","activationModal","changePasswordModal","brsGetQueryRedirect","$window","brsGetQueryBuilder","$rootElement",function(t,a,i,o,r,c,u,h,d,f,p,g){o=o.getInstance("authUserRefresh");return function(){var e=d(),s=g.attr("ng-app");i.mainLoading+=1;var n=["/login","/login-public","/loginpcc","/oauth-registration","/login-cfd"];return t.get("Session_Auth","refresh").then(function(t){if(t.user&&angular.isDefined(t.user.login)&&t.user.login!=null){a.setData(t.user);a.setOtpInfo(t.otpInfo);if(!a.isPcc()&&a.hasPassedOtpRegistration()&&a.useStrongAuth()&&a.hasToPassOtp()){c.path("/otp").search(e)}else if(!a.isPcc()&&!a.hasPassedOtpRegistration()){c.path("/otp-registration").search(e)}else if(c.path()=="/login-cfd"){i.displayUserConnected=true;i.$broadcast("auth:login:refresh",a)}else{if(n.indexOf(c.path())==-1){i.displayUserConnected=true;if(!a.isPcc()&&!a.isActivated()){u()}else if(a.isActivated()&&a.passwordMustBeChanged()){h()}}i.$broadcast("auth:login:refresh",a)}}else{if(n.indexOf(c.path())==-1){if(a.isLogged()){r()}else{switch(s){case"app-login-public":c.path("/login-public").search(e);break;case"app":f.location.replace("/login"+p(d()));break;case"app-login":case"app-loginpcc":c.path("/login").search(e);break;case"app-login-cfd":c.path("/login-cfd");break}}i.displayUserConnected=false}}}).catch(function(t){i.$broadcast("auth:login:refresh:failed",a);o.warn("have failed");if(n.indexOf(c.path())==-1){r();i.displayUserConnected=false}}).finally(function(){i.mainLoading-=1})}}]);m.provider("authUser",function(){this.$get=["brsApiClient","$log","$rootScope",function(t,e,s){if(this.authUser){return this.authUser}function n(){}n.prototype={d:{},otpInfo:{},reset:function(){this.setData({});this.setOtpInfo({})},setData:function(t){this.d=t},setOtpInfo:function(t){this.otpInfo=t},isLogged:function(){return!!this.d.login},hasPassedOtpRegistration:function(){return!!this.otpInfo.hasPassedOtpRegistration},useStrongAuth:function(){return!!this.otpInfo.useStrongAuth},hasToPassOtp:function(){return!!this.otpInfo.hasToPassOtp},getOtpCodeLength:function(){return this.otpInfo.otpCodeLength},isPcc:function(){return!!this.d.managerId},canAffect:function(){return!!this.d.canAffect},canForce:function(){return!!this.d.canForce},canCashAdjust:function(){return!!this.d.canCashAdjust},isActivated:function(){return!!this.d.accountActivated},setActivated:function(){this.d.accountActivated=true},passwordMustBeChanged:function(){return!!this.d.passwordMustBeChanged},setPasswordMustBeChanged:function(){this.d.passwordMustBeChanged=false},getStreamingParams:function(){return this.d.streaming},hasToPassKyc:function(){return!!this.d.hasToPassKyc},setHasToPassKyc:function(t){this.d.hasToPassKyc=t}};window.authUser=this.authUser=new n;return this.authUser}]}); "use strict";var m=angular.module("auth-otp",["brs-api-client","auth-user","auth-login","brs-ui-spinner","brs-ui-modal-scroller","brs-validation","brs-route-params"]);m.controller("AuthOtpController",["$scope","BrsUiAlert","authUser","$location","authLoginPerformLogout","$log","authOtpRequestCode","authOtpVerifyCode","$window","brsGetQueryRedirect","brsGetQueryBuilder","authOAuth","$timeout",function(o,e,t,n,a,i,r,l,s,u,c,d,f){i=i.getInstance("AuthOtpController");o.loadingRequest=false;o.loadingVerify=false;o.displayFormCode=false;o.alerts=new e;o.strongAuthCode="";o.otpCodeLength=t.getOtpCodeLength();var g=u();if(t&&t.isLogged()&&!t.hasToPassOtp()||t.isPcc()){s.parent.location.replace("/"+c(g))}o.requestCode=function(){i.info("Ask for OTP code.");o.alerts.clean();o.displayFormCode=false;o.loadingRequest=true;r().then(function(e){o.loadingRequest=false;o.displayFormCode=true;if(angular.isDefined(e.otpToken)){o.alerts.info(e.otpToken);var t=e.otpToken.split(" ");o.strongAuthCode=parseInt(t[t.length-1],10)}f(function(){o.$broadcast("focusOn","otpCode")})}).catch(function(e){o.loadingRequest=false;o.alerts.danger(e.message)}).finally(function(){o.loadingRequest=false})};o.verifyCode=function(){i.info("Verify the OTP code.");o.loadingVerify=true;l(o.strongAuthCode).then(function(e){if(e){if(g.comingFrom=="login-cfd"){delete g.comingFrom;s.parent.location.replace("/login-cfd"+c(g))}else{if(d.isOAuth()){d.openAuthorizationModal()}else{s.parent.location.replace("/"+c(g))}}}}).catch(function(e){o.alerts.danger(e.message);o.loadingVerify=false})};o.logout=function(){a().catch(function(){i.warn("Couldn't logout (maybe not access to the web anymore), so logout locally.");t.reset();$rootScope.$broadcast("auth:logout",t);$rootScope.displayUserConnected=false;s.parent.location.replace("https://www.onvista-bank.de/logout.html")})}}]);m.controller("AuthOtpRegistrationController",["$scope","BrsUiAlert","authUser","$location","authLoginPerformLogout","$log","authOtpRegistrationRequestCode","authOtpRegistrationVerifyCode","$window","brsGetQueryRedirect","brsGetQueryBuilder",function(o,e,t,n,a,i,r,l,s,u,c){i=i.getInstance("AuthOtpController");o.alerts=new e;o.otpCodeLength=t.getOtpCodeLength();o.noMobile=false;o.useOtpStrongAuth=false;o.validationStep=false;o.mobileNumber="";o.landLineNumber="";o.confirmationCode="";o.loadingRequest=false;var d=u();if(t&&t.isLogged()&&t.hasPassedOtpRegistration()||t.isPcc()){s.parent.location.replace("/"+c(d))}o.goLandLine=function(){i.info("No mobile phone, use land line phone number.");o.noMobile=true;o.landLineNumber="";o.mobileNumber=""};o.back=function(e){o.alerts.clean();if(e==1){i.info("Go back to mobile phone number.");o.noMobile=false;o.landLineNumber="";o.mobileNumber=""}else if(e==2){i.info("Go back to change the phone number or resend confirmation code.");o.validationStep=false}};o.submitOtpPhoneNumber=function(){i.info("Submit the OTP phone number.");o.alerts.clean();o.loadingRequest=true;o.otpRegistrationData={useOtpStrongAuth:o.useOtpStrongAuth};if(o.useOtpStrongAuth){o.otpRegistrationData.noMobile=o.noMobile;if(!o.noMobile&&angular.isDefined(o.mobileNumber)&&o.mobileNumber&&o.mobileNumber!=""){o.otpRegistrationData.mobile=o.mobileNumber}else if(o.noMobile&&angular.isDefined(o.landLineNumber)&&o.landLineNumber&&o.landLineNumber!=""){o.otpRegistrationData.landline=o.landLineNumber}o.loadingRequest=false;o.validationStep=true;r(o.otpRegistrationData).then(function(e){o.loadingRequest=false;o.validationStep=true;if(angular.isDefined(e.otpToken)){o.alerts.info(e.otpToken);var t=e.otpToken.split(" ");o.confirmationCode=parseInt(t[t.length-1],10)}}).catch(function(e){o.alerts.danger(e.message)})}else{r(o.otpRegistrationData).then(function(e){s.parent.location.replace("/"+c(d))}).catch(function(e){o.alerts.danger(e.message);o.loadingRequest=false})}};o.verifyConfirmationCode=function(){i.info("Verify the subscription confirmation code.");o.alerts.clean();o.loadingRequest=true;o.otpRegistrationData.otpRegistrationToken=o.confirmationCode;o.otpRegistrationData.useOtpStrongAuth=o.useOtpStrongAuth;l(o.otpRegistrationData).then(function(e){if(e){s.parent.location.replace("/"+c(d))}}).catch(function(e){o.alerts.danger(e.message);o.loadingRequest=true})}}]); "use strict";var m=angular.module("auth-otp");m.service("authOtpRequestCode",["brsApiClient","$q",function(r,i){var o;return function(e){var t=i.defer();if(o){return o}else{o=t.promise}var n={};if(e){n.otpPhone=e}r.get("Session_Otp","generateOtp",n).then(function(e){t.resolve(e)}).catch(function(e){t.reject(e)}).finally(function(){o=false});return t.promise}}]); "use strict";var m=angular.module("auth-otp");m.service("authOtpVerifyCode",["brsApiClient","$q",function(i,o){var c;return function(e,t){var n=o.defer();if(c){return c}else{c=n.promise}var r={otpToken:e};if(t){r.otpPhone=t}i.get("Session_Otp","checkOtp",r).then(function(e){n.resolve(e.success)}).catch(function(e){n.reject(e)}).finally(function(){c=false});return n.promise}}]); "use strict";var m=angular.module("auth-otp");m.service("authOtpRegistrationRequestCode",["brsApiClient","$q",function(n,r){var i;return function(e){var t=r.defer();if(i){return i}else{i=t.promise}n.get("Session_Otp","generateRegistrationOtp",e).then(function(e){t.resolve(e)}).catch(function(e){t.reject(e)}).finally(function(){i=false});return t.promise}}]); "use strict";var m=angular.module("auth-otp");m.service("authOtpRegistrationVerifyCode",["brsApiClient","$q",function(r,n){var i;return function(e){var t=n.defer();if(i){return i}else{i=t.promise}r.get("Session_Otp","checkRegistrationOtp",e).then(function(e){t.resolve(e.success)}).catch(function(e){t.reject(e)}).finally(function(){i=false});return t.promise}}]); "use strict";var m=angular.module("auth-oauth",["auth-user"]);m.service("authOAuth",["brsUiModal","brsAppVersion","$routeParams","authUser","$location",function(e,r,n,t,a){this.isOAuth=function(){return a.path()=="/oauth-registration"||n.clientId&&n.redirectUrl&&n.scope};this.openAuthorizationModal=function(){var t={clientId:n.clientId,redirectUrl:n.redirectUrl,scope:n.scope};return e.open(e.getConfig("draggable","lg",{templateUrl:r.getUrl("/app/auth-oauth/templates/modal-authorization.html"),controller:["$scope","$modalInstance","$q","$window","params","authOAuthisClientValid","authOAuthAuthorize","customerDetailsGetPersonalData",i],resolve:{params:function(){return t}}})).result};function i(n,a,i,r,o,c,t,l){n.loading=true;n.cancel=function(){r.location.href=o.redirectUrl+"?&error=consent_required&error_description=The+user+denied+access+to+your+application";a.dismiss("cancel")};n.authorize=function(){n.loading=true;t(o.clientId,o.redirectUrl,o.scope).then(function(t){var e=t.code;r.location.href=o.redirectUrl+"?code="+e}).finally(function(){n.loading=false})};var e=function(){var t=c(o.clientId,o.redirectUrl).then(function(t){if(!t){a.dismiss("cancel")}}).catch(function(){a.dismiss("cancel")});var e=l(false).then(function(t){n.salutation=t.salutation;n.name=t.name});var r=[t,e];i.all(r).finally(function(){n.loading=false})};e()}}]); "use strict";var m=angular.module("auth-oauth");m.service("authOAuthAuthorize",["brsApiClient",function(i){return function(e,t,n){var r={clientId:e,"redirectUrl ":t,scope:n};return i.get("Session_OAuth","postAuthorize",r)}}]);m.service("authOAuthisClientValid",["brsApiClient",function(r){return function(e,t){var n={clientId:e,redirectUrl:t};return r.get("Session_OAuth","getIsClientValid",n).then(function(e){return e.isValid})}}]);m.service("authOAuthHasValidAccessToken",["brsApiClient",function(r){return function(e,t){var n={};return r.get("Session_OAuth","hasValidAccessToken",n).then(function(e){return e.hasValidAccessToken})}}]);m.service("authOAuthRevokeToken",["brsApiClient",function(r){return function(e,t){var n={};return r.get("Session_OAuth","getRevokeToken",n).then(function(e){return e.succces})}}]); "use strict";var m=angular.module("bank-accounts");m.service("bankAccountsGetClearingOrCfdAccountsOverview",["brsApiClient","$q",function(r,t){var c;return function(e){var n=t.defer();if(!e){n.reject({message:"invalid account key"});return n.promise}if(c){return c}else{c=n.promise}r.get("Bank_Overview","getClearingOrCfdAccountsOverview",{accountKey:e}).then(function(e){delete e["_meta"];n.resolve(e)}).catch(function(e){n.reject(e)}).finally(function(){c=false});return n.promise}}]); "use strict";var m=angular.module("bank-accounts");m.service("bankAccountsGetDepotOverview",["brsApiClient","$q",function(n,r){var i;return function(e){var t=r.defer();if(!e){t.reject({message:"invalid account key"});return t.promise}if(i){return i}else{i=t.promise}n.get("Bank_Overview","getDepotOverview",{accountKey:e}).then(function(e){delete e["_meta"];t.resolve(e)}).catch(function(e){t.reject(e)}).finally(function(){i=false});return t.promise}}]); "use strict";var m=angular.module("bank-accounts");m.service("bankAccountsGetExternalAccount",["brsApiClient","$q","bankAccountsList","bankAccountsCurrentAccount",function(n,c,r,o){var u;return function(e){var t=c.defer();if(!e){if(angular.isDefined(o.accountKey)){e=o.accountKey}else{t.reject({message:"KÃ¶nnen nicht abgerufen werden das Konto."});return t.promise}}angular.forEach(r,function(n){if(n.accountKey==e&&n.isCFDAccount){t.reject({message:"CFD Konto nicht ÃŒber externe Konto."});return t.promise}});if(u){return u}else{u=t.promise}n.get("Bank_Account","getExternalAccount",{accountKey:e}).then(function(n){t.resolve(n.externalAccount)}).catch(function(n){t.reject(n)}).finally(function(){u=false});return t.promise}}]); "use strict";var m=angular.module("bank-accounts");m.service("bankAccountsGetMovements",["brsApiClient","$q","bankAccountsCurrentAccountMovements",function(t,c,r){var o;return function(e){var n=c.defer();if(!e){n.reject({message:"invalid account key"});return n.promise}if(o){return o}else{o=n.promise}t.get("Bank_Account","getMovements",{accountKey:e}).then(function(e){while(r.length>0){r.pop()}angular.extend(r,e.movements);n.resolve(r)}).catch(function(e){n.reject(e)}).finally(function(){o=false});return n.promise}}]);m.service("bankAccountsGetTradingMovements",["brsApiClient","bankAccountsCurrentAccount",function(n,t){return function(){var e={accountKey:t.accountKey};return n.get("Bank_Account","getTradingMovements",e)}}]); "use strict";var m=angular.module("bank-accounts");m.controller("BankAccountsMenuBlockController",["$rootScope","$scope","bankAccountsGetAccountsList","bankAccountsList","bankAccountsCurrentAccount","bankAccountsChangeCurrentAccount","bankAccountsCurrentAccountOverview","authUser","bankAccountsGetDepotOverview","bankAccountsGetClearingOrCfdAccountsOverview","bankAccountsGetExternalAccount","bankAccountsExternalAccount","brsAppAlerts",function(n,t,c,e,o,r,u,a,i,s,l,A,f){t.loading=0;t.authUser=a;t.accountsList=e;t.currentAccount=o;t.accountOverview=u;t.init=function(){t.loading+=1;c().catch(function(n){f.danger(n.message)}).finally(function(){t.loading-=1})};if(a.isLogged()&&!a.hasToPassOtp()){t.init()}t.changeCurrentAccount=function(n){r(n);t.accountsListDd.isopen=false};t.refreshAccountOverview=function(){if(angular.isUndefined(t.currentAccount)||angular.isUndefined(t.currentAccount.accountKey)||!t.currentAccount.accountKey||t.currentAccount.accountKey==""){t.init()}else{t.loading+=1;s(t.currentAccount.accountKey).then(function(n){angular.extend(u,n);angular.extend(t.accountOverview,n)}).finally(function(){t.loading-=1});t.loading+=1;i(t.currentAccount.accountKey).then(function(n){angular.extend(u,n);angular.extend(t.accountOverview,n)}).finally(function(){t.loading-=1})}};n.$on("accounts:changeCurrent",function(n,c){t.currentAccount=c});n.$on("auth:login:refresh",function(n,c){t.init()});n.$on("trading-order:on-trade",function(n,c){t.refreshAccountOverview()});n.$on("trading-order:on-cancel",function(n,c){t.refreshAccountOverview()});n.$on("trading-order-strategy:on-trade",function(n,c){t.refreshAccountOverview()});n.$on("trading-order-strategy:on-cancel",function(n,c){t.refreshAccountOverview()})}]); "use strict";var m=angular.module("bank-accounts");m.controller("BankAccountsOverviewBlockController",["$rootScope","$scope","$log","bankAccountsGetAccountsList","bankAccountsList","bankAccountsCurrentAccount","bankAccountsGetClearingOrCfdAccountsOverview","bankAccountsGetDepotOverview","bankAccountsCurrentAccountOverview","bankAccountsGetMovements","BrsUiAlert","$filter","$moment","BrsUiPagination","brsApiClient","authUser",function(e,t,a,n,o,r,c,i,s,u,m,f,g,l,v,h){a=a.getInstance("BankAccountsOverviewBlockController");t.isBlockLoading=false;t.showContent=false;t.currentOverviewAccount={cashAccountNum:false};t.alerts=new m;t.searchAlerts=new m;t.pagination=new l;t.datePickerConfig={showOn:"button",dateFormat:"dd.mm.yy",maxDate:0};t.searchParams={rangeType:1,fromDateRange:"",toDateRange:"",fromDateRangeIsInvalid:false,toDateRangeIsInvalid:false};t.loadingMovements=false;t.movementsList=[];t.movementsListTemp=[];t.today=g().format("YYYY-MM-DD 00:00:00");t.maxHistoric=90;t.maxHistoricMoment=g().subtract(t.maxHistoric,"days");t.maxHistoricMomentTest=g().subtract(t.maxHistoric+1,"days");t.fromDateRangeConfig=angular.copy(t.datePickerConfig);t.fromDateRangeConfig.minDate=t.maxHistoricMoment.toDate();t.daysRanges=[];for(var d=10;d<=t.maxHistoric;d+=10){t.daysRanges.push({range:g().subtract(d,"days").format("YYYY-MM-DD 00:00:00"),label:"letzte "+d+" Tage"})}t.searchParams.fromDateRange=t.daysRanges[0].range;t.searchParams.toDateRange=t.today;t.authUser=h;t.isDeactivated=false;t.isRefreshed=false;function D(){t.isBlockLoading+=1;t.alerts.clean();t.searchAlerts.clean();t.showContent=false;t.overviewAccountsList=[];t.overviewAccountsCurrencies=[];n().then(function(e){t.accountsList=o;t.currentAccount=r;t.isBlockLoading+=1;c(t.currentAccount.accountKey).then(function(e){angular.extend(s,e);t.accountOverview=s;t.overviewAccountsList=[{cashAccountNum:t.accountOverview.clearingOrCfdAccounts.inEUR.cashAccountNum,currency:"EUR"}];t.currentOverviewAccount.cashAccountNum=t.accountOverview.clearingOrCfdAccounts.inEUR.cashAccountNum;t.overviewAccountsCurrencies[t.accountOverview.clearingOrCfdAccounts.inEUR.cashAccountNum]="EUR";t.clearingAccountTest();t.showContent=true;t.isBlockLoading-=1;t.searchMovements()}).catch(function(e){t.showContent=true;t.alerts.danger(e.message)})}).catch(function(e){t.showContent=false}).finally(function(){t.isBlockLoading-=1})}t.init=function(){t.isBlockLoading+=1;v.get("Common_Utils","getAdminConfigValue",{configKey:"DEACTIVATE_MODULE_KONTOUBERSICHT",configNamespace:"BANK"}).then(function(e){t.isDeactivated=false;if(e.configValue){t.isDeactivated=true;t.isRefreshed=false}return v.get("Common_Utils","getAdminConfigValue",{configKey:"DEACTIVATE_MODULES_AUTOLOAD",configNamespace:"BANK"})}).then(function(e){t.isRefreshed=!t.isDeactivated&&(t.isRefreshed||!e.configValue);if(t.isRefreshed&&t.authUser.isLogged()){D()}}).catch(function(e){t.alerts.danger(e.message)}).finally(function(){t.isBlockLoading-=1})};t.refresh=function(){a.info("Refresh accounts overview");t.isRefreshed=true;t.init()};t.initToDateRange=function(){var e=t.maxHistoricMoment;t.datePickerConfig.maxDate=0;if(!g(t.searchParams.fromDateRange).isBefore(t.maxHistoricMomentTest)){e=g(t.searchParams.fromDateRange)}if(t.searchParams.fromDateRange&&t.searchParams.fromDateRange!=""){t.datePickerConfig.minDate=e.toDate()}};t.init();t.changeCurrentOverviewAccount=function(){c(t.currentAccount.accountKey).then(function(e){angular.extend(s,e)});i(t.currentAccount.accountKey).then(function(e){angular.extend(s,e)});if(t.searchParams.fromDateRange&&t.searchParams.toDateRange){t.searchMovements()}};t.clearingAccountTest=function(){if(t.accountOverview&&t.accountOverview.clearingOrCfdAccounts.inCHF&&t.accountOverview.clearingOrCfdAccounts.inCHF.balance>0){t.overviewAccountsList.push({cashAccountNum:t.accountOverview.clearingOrCfdAccounts.inCHF.cashAccountNum,currency:"CHF"});t.overviewAccountsCurrencies[t.accountOverview.clearingOrCfdAccounts.inCHF.cashAccountNum]="CHF"}};t.fromDateChange=function(){if(!moment(t.searchParams.fromDateRange,"YYYY-MM-DD 00:00:00",true).isValid()){t.searchParams.fromDateRangeIsInvalid=true}else{t.searchParams.fromDateRangeIsInvalid=false;t.searchAlerts.removeAlertsByUniquName("invalid")}if(!t.searchParams.fromDateRangeIsInvalid&&g(t.searchParams.fromDateRange).isBefore(t.maxHistoricMomentTest)){t.searchAlerts.warning("Der Zeitraum wurde angepasst, da die Buchungen maximal 90 Tage rÃŒckwirkend angezeigt werden kÃ¶nnen.","invalid");t.searchParams.fromDateRange=t.maxHistoricMoment.format("YYYY-MM-DD 00:00:00")}t.initToDateRange();t.searchParams.toDateRange="";$("#toDateRange").val("");$("#toDateRange").datepicker("option","minDate",t.datePickerConfig.minDate);$("#toDateRange").datepicker("option","maxDate",t.datePickerConfig.maxDate)};t.toDateChange=function(){if(!moment(t.searchParams.toDateRange,"YYYY-MM-DD 00:00:00",true).isValid()){t.searchParams.toDateRangeIsInvalid=true}else{t.searchParams.toDateRangeIsInvalid=false}if(!t.searchParams.toDateRangeIsInvalid&&g(t.searchParams.toDateRange).isBefore(t.maxHistoricMomentTest)){t.searchAlerts.warning("Der Zeitraum wurde angepasst, da die Buchungen maximal 90 Tage rÃŒckwirkend angezeigt werden kÃ¶nnen.","invalid");t.searchParams.toDateRange=g().format("YYYY-MM-DD 00:00:00")}};t.searchMovements=function(){t.alerts.clean();a.info("Searching movements: ",t.searchParams);t.loadingMovements=true;u(t.currentAccount.accountKey).then(function(e){while(t.movementsList.length>0){t.movementsList.pop()}while(t.movementsListTemp.length>0){t.movementsListTemp.pop()}angular.forEach(e,function(e){if((g(e.valueDate).isBefore(t.searchParams.toDateRange)||g(e.valueDate).isSame(t.searchParams.toDateRange))&&(g(e.valueDate).isAfter(t.searchParams.fromDateRange)||g(e.valueDate).isSame(t.searchParams.fromDateRange))){t.movementsList.push(e)}});if(t.movementsList.length){t.movementsListTemp=f("filter")(t.movementsList,{currency:t.overviewAccountsCurrencies[t.currentOverviewAccount.cashAccountNum]})}if(t.movementsListTemp.length){t.pagination.init(t.movementsListTemp,5,true)}else{t.alerts.info("FÃŒr den ausgewÃ€hlten Zeitraum liegen keine Kontobuchungen vor.")}}).catch(function(e){t.alerts.danger(e.message)}).finally(function(){t.loadingMovements=false})};t.order=function(e,a){t.pagination.filter(e,a)};t.resetDateRange=function(){t.searchAlerts.clean();t.searchParams.fromDateRange="";t.searchParams.toDateRange="";t.searchParams.fromDateRangeIsInvalid=false;t.searchParams.toDateRangeIsInvalid=false;$("#fromDateRange").val("");$("#fromDateRange").datepicker("option","minDate",t.maxHistoricMoment.toDate());$("#fromDateRange").datepicker("option","maxDate",t.datePickerConfig.maxDate);$("#toDateRange").val("");$("#toDateRange").datepicker("option","minDate",t.maxHistoricMoment.toDate());$("#toDateRange").datepicker("option","maxDate",t.datePickerConfig.maxDate)};t.onCsv=function(){var e=A();e.data.unshift(["Valuta","Transaktion","Verwendungszweck","Betrag"]);return e};t.onPdf=function(){return A()};function A(){var a=[];angular.forEach(t.pagination.filtered,function(e){a.push([f("brsFilterDate")(e.valueDate,"dd.MM.yyyy"),e.debitCredit,e.operationLabel,f("brsFormatCurrency")(e.netAmount,2,e.currency)])});return{data:a,subTitle:""}}e.$on("accounts:changeCurrent",function(e,a){t.init()});e.$on("accounts:getList",function(e,a){t.init()});e.$on("auth:logout",function(e,a){t.showContent=false;t.currentOverviewAccount.cashAccountNum=false;while(t.movementsList.length>0){t.movementsList.pop()}while(t.movementsListTemp.length>0){t.movementsListTemp.pop()}})}]); "use strict";var m=angular.module("bank-accounts",["brs-api-client","auth-user","brs-ui-spinner","brs-ui-datepicker","brs-ui-grid"]);m.value("bankAccountsList",[]);m.value("bankAccountsCurrentAccount",{});m.value("bankAccountsCurrentAccountOverview",{});m.value("bankAccountsDefaultAccountKey",{accountKey:""});m.value("bankAccountsExternalAccount",{});m.value("bankAccountsCurrentAccountMovements",[]);m.service("bankAccountsGetAccountsList",["brsApiClient","$q","$rootScope","bankAccountsList","bankAccountsCurrentAccount","bankAccountsDefaultAccountKey",function(c,e,u,o,a,r){var i;return function(n){var t=e.defer();if(o.length==0||n){if(i){return i}else{i=t.promise}u.mainLoading+=1;c.get("Bank_Account","getAccountsList").then(function(n){angular.extend(o,n.accountsList);o.sort(function(n,t){return n["accountNumber"]>t["accountNumber"]?1:-1});r.accountKey=n.defaultAccountKey;if(!r.accountKey){angular.extend(a,o[0]);r.accountKey=o[0].accountKey}else{angular.forEach(o,function(n){if(n.accountKey==r.accountKey){angular.extend(a,n)}})}t.resolve({accountsList:o,currentAccount:a,defaultAccountKey:r});u.$broadcast("accounts:getList",{accountsList:o,currentAccount:a})}).catch(function(n){t.reject(n)}).finally(function(){u.mainLoading-=1;i=false})}else{t.resolve({accountsList:o,currentAccount:a})}return t.promise}}]);m.service("bankAccountsChangeCurrentAccount",["$q","$rootScope","bankAccountsList","bankAccountsCurrentAccount","bankAccountsGetAccountsList","bankAccountsCurrentAccountOverview",function(t,u,o,a,r,i){var s;return function(c,n){var e=t.defer();if(c==a.accountKey){return}if(o.length==0||n){if(s){return s}else{s=e.promise}u.mainLoading+=1;r(n).then(function(n){angular.forEach(o,function(n){if(n.accountKey==c){angular.extend(a,n);for(var t in i){delete i[t]}u.$broadcast("accounts:changeCurrent",a);e.resolve(a)}})}).catch(function(n){e.reject(n)}).finally(function(){u.mainLoading-=1;s=false})}else{angular.forEach(o,function(n){if(n.accountKey==c){angular.extend(a,n);for(var t in i){delete i[t]}u.$broadcast("accounts:changeCurrent",a)}});e.resolve(a)}return e.promise}}]);m.run(["$rootScope","bankAccountsGetAccountsList","bankAccountsList","bankAccountsCurrentAccount","bankAccountsGetClearingOrCfdAccountsOverview","bankAccountsGetDepotOverview","bankAccountsCurrentAccountOverview","bankAccountsDefaultAccountKey","bankAccountsGetExternalAccount","bankAccountsExternalAccount","bankAccountsCurrentAccountMovements","brsUiGridDesktop","$q",function(u,c,e,o,a,r,i,s,l,f,A,d,g){u.$on("auth:login:refresh",function(n,t){c(true).then(function(n){l(n.currentAccount.accountKey).then(function(n){angular.extend(f,n)})})});u.$on("auth:logout",function(n,t){while(e.length>0){e.pop()}while(A.length>0){A.pop()}for(var c in o){delete o[c]}for(var c in i){delete i[c]}s.accountKey="";for(var c in f){delete f[c]}});u.$on("accounts:getList",function(n,t){a(t.currentAccount.accountKey).then(function(n){angular.extend(i,n)});r(t.currentAccount.accountKey).then(function(n){angular.extend(i,n)});l(t.currentAccount.accountKey);u.mainLoading+=1;d.load().finally(function(){u.mainLoading-=1})});u.$on("accounts:changeCurrent",function(n,t){a(t.accountKey).then(function(n){angular.extend(i,n)});r(t.accountKey).then(function(n){angular.extend(i,n)});l(o.accountKey)});u.$on("accounts:update",function(n,t){var c=a(t.accountKey).then(function(n){angular.extend(i,n)});var e=r(t.accountKey).then(function(n){angular.extend(i,n)});g.all([c,e]).finally(function(){u.$broadcast("accounts:update:end")})})}]);m.filter("pricingLabelFormat",["$filter",function(t){return function(n){if(t("limitTo")(n,3)=="NN-"){return t("limitTo")(n,-(n.length-3))}else{return n}}}]); "use strict";var m=angular.module("bank-activation",["brs-api-client","brs-routes","customer-experience","brs-validation","brs-ui-popover","trading-realtime","auth-user"]);m.controller("BankActivationController",["$scope","brsUiModal","BankActivationService","activationModal","authUser",function(e,n,t,i,a){e.openModal=function(){t.isAccountEnabled().then(function(e){if(!a.isPcc()&&!e){i()}})}}]);m.controller("BankActivationModalController",["$scope","$modalInstance","BrsUiAlert","BankActivationService","brsUiModalScroller","brsUiModal","brsAppVersion",function(t,e,n,i,a,r,o){t.alerts=new n;t.loaded=false;t.loading=false;t.brsUiModalScrollerApi=new a;i.isAccountEnabled().then(function(e){if(i.isInited()){t.loaded=true;t.goToStep(1)}else{t.registerService(i.init()).finally(function(e){t.loaded=true;t.goToStep(1)})}});t.close=function(){e.close()};t.registerService=function(n){t.loading=true;return n.then(function(e){t.loading=false;return e}).catch(function(e){t.alerts.danger(e.message,e.code);t.loading=false;return n})};t.goToStep=function(e){t.step=e;t.include=o.getUrl("/app/bank-activation/templates/step"+e+".html");t.brsUiModalScrollerApi.scrollTo("top");t.alerts.clear()};t.openRealtimeConditionsModal=function(){var e=r.open(r.getConfig("draggable","lg",{templateUrl:o.getUrl("/app/trading-realtime/templates/modal-realtime-conditions.html"),controller:"ModalTradingRealtimeConditionsController"}))}}]);m.controller("BankActivationIncomeController",["$scope","BankActivationService","brsValidationRealtimeErrorHandler","$q","tinMaxLength",function(a,r,e,o,n){a.incomePerYear=r.getIncomePerYearOptions();a.incomeTotal=r.getIncomeTotalOptions();a.incomeTotalToSpend=r.getIncomeTotalToSpendOptions();a.country=r.getCountry();a.taxIdentificationNumber=r.getTaxIdentificationNumber();a.tinMaxLength=n;if(a.country=="Deutschland"){a.hasTin=!!a.taxIdentificationNumber;a.tinMaxLength=11}a.income={};a.income.allocation="50";a.income.fiscalDomicil="Deutschland";a.phonePassword=r.getPhonePassword();a.salutation=r.getSalutation();a.name=r.getName();a.tinPattern="^(?!0)[0-9]{11}";a.isValidTIN=function(e){return new RegExp(a.tinPattern).test(e)};a.onSubmit=function(){if(a.bankActivationIncomeForm.$invalid){a.$broadcast("show-messages");return}var e=r.setPhonePassword(a.phonePassword);var n=r.setFinancialData(a.income);var t=[e,n];if(a.country=="Deutschland"&&!a.hasTin){var i=r.setFiscality(a.taxIdentificationNumber);t.push(i)}a.registerService(o.all(t)).then(function(){a.goToStep(2)}).catch(function(e){if(e.code==90104){a.hasTin=false}})}}]);m.controller("BankActivationTradingController",["$scope","BankActivationService","customerExperienceSetTradingExperiences","customerExperienceTradingExperienceSections",function(n,e,t,i){n.experienceSections=i;n.tradingExperiences={A1:{active:true},B:{active:true},F1:{active:true},isOAOP:true};n.regex=/^\d{1,3}$/;n.tradesReset=function(e){if(!n.tradingExperiences[e].active){n.tradingExperiences[e].trades=""}if(_.contains(["Z4","Z5","T","EUREX","CFD"],e)){if(angular.isDefined(n.tradingExperiences.Z4)&&!n.tradingExperiences.Z4.active&&angular.isDefined(n.tradingExperiences.Z5)&&!n.tradingExperiences.Z5.active&&angular.isDefined(n.tradingExperiences.T)&&!n.tradingExperiences.T.active&&angular.isDefined(n.tradingExperiences.EUREX)&&!n.tradingExperiences.EUREX.active&&angular.isDefined(n.tradingExperiences.CFD)&&!n.tradingExperiences.CFD.active){n.tradingExperiences.era_confirm=false}}};n.onSubmit=function(){if(n.bankActivationTradingForm.$invalid){n.$broadcast("show-messages");return}e.setActivationTradingExperiences(n.tradingExperiences);n.goToStep(3)}}]);m.controller("BankActivationRecapController",["$scope","authLoginPerformLogout","BankActivationService","customerExperienceTradingExperienceSections","authUser","changePasswordModal","customerExperienceGetDocuments","customerExperienceSetTradingExperiences","informationSheetUrl",function(i,e,n,t,a,r,o,c,s){var l=["Z4","Z5","T","EUREX","CFD"];var d=n.getFinancialData();var u={};i.tradingExperiences=n.getActivationTradingExperiences();i.experienceSections=t;i.incomes={incomePerYear:g(n.getIncomePerYearOptions(),d.incomePerYear),incomeTotal:g(n.getIncomeTotalOptions(),d.incomeTotal),incomeTotalToSpend:g(n.getIncomeTotalToSpendOptions(),d.incomeTotalToSpend)};i.phonePassword=n.getPhonePassword();i.taxIdentificationNumber=n.getTaxIdentificationNumber();i.recapTradingExperiences=[];i.showConfirmation=false;i.documents=null;i.documentAsBase64="";i.hasWarnings=false;i.informationSheetUrl=s;i.showDynamicLink=false;Object.defineProperty(i,"isOneOfExperience03Checked",{get:function(){var n=false;l.forEach(function(e){if(i.tradingExperiences[e]&&i.tradingExperiences[e].active){n=true}});return n}});angular.forEach(t,function(e){angular.forEach(e.items,function(t){angular.forEach(i.tradingExperiences,function(e,n){if(n==t.name&&e.active){u={};u.name=t.name;u.label=t.label;u.trades=angular.isDefined(e.trades)?e.trades:"";i.recapTradingExperiences.push(u)}})})});if(i.isOneOfExperience03Checked&&!i.tradingExperiences.era_confirm){i.$parent.registerService(o()).then(function(e){i.documents=e.documents;i.showConfirmation=i.documents.resultCode===1||i.documents.resultCode===2;i.showDynamicLink=i.documents.resultCode===1})}i.onSubmit=function(){n.setActivationTradingExperiences(i.tradingExperiences);var e=angular.extend(i.tradingExperiences);i.registerService(c(e)).then(function(e){if(e.warning&&e.warning!=""){i.alerts.warning(e.warning);n.setActivationTradingExperiences(e.tradingExperiences);i.hasWarnings=true}else{i.enableAccount()}})};i.enableAccount=function(){i.$parent.registerService(n.enableAccount()).then(function(){a.setActivated();i.close();if(a.passwordMustBeChanged()){r()}})};i.logout=function(){e().catch(function(){$log.warn("Couldn't logout (maybe not access to the web anymore), so logout locally.");a.reset();$rootScope.$broadcast("auth:logout",a);$rootScope.displayUserConnected=false;$location.path("/login-public").search(getParams)})};function g(e,n){var t=e.length;for(var i=0;i<t;i++){if(e[i].incomeCode==n){return e[i].incomeRangeLabel}}return""}i.downloadDocument=function(){var e=p(i.documents.file.replace(/[^\x20-\x7E]/gim,""),"application/pdf");saveAs(e,i.documents.fileName)};function p(e,n,t){n=n||"";t=t||512;var i=atob(e);var a=[];for(var r=0;r<i.length;r+=t){var o=i.slice(r,r+t);var c=new Array(o.length);for(var s=0;s<o.length;s++){c[s]=o.charCodeAt(s)}var l=new Uint8Array(c);a.push(l)}return new Blob(a,{type:n})}}]); "use strict";(function(){var n=angular.module("bank-activation");n.service("BankActivationService",["brsApiClient","customerDetailsGetPersonalData","customerExperienceGetTradingExperiences","$q",function(o,r,a,c){var s={},u={},t="",l="",m="",f="",i=undefined,e={},d="";this.init=function(){var n=o.get("Customer_Options","getIncomeThresholdsOptions").then(function(n){u.incomePerYear=n.incomeThresholdsOptions.incomePerYear;u.incomeTotal=n.incomeThresholdsOptions.incomeTotal;u.incomeTotalToSpend=n.incomeThresholdsOptions.incomeTotalToSpend});var e=r(false).then(function(n){l=n.salutation;m=n.name;s.incomePerYear=n.incomePerYear;s.incomeTotal=n.incomeTotal;s.incomeTotalToSpend=n.incomeTotalToSpend});var t=a(false).then(function(n){f=n.tradingExperiences});var i=o.get("Customer_Details","getCountryAndFiscality").then(function(n){d=n.country;u.taxIdentificationNumber=n.taxIdentificationNumber});return c.all([n,e,t,i])};this.isInited=function(){return typeof u.incomeTotal!=="undefined"};this.setPhonePassword=function(e){return o.get("Customer_Security","changePhonePassword",{newPhonePassword:e,newPhonePasswordIteration:e}).then(function(n){t=e})};this.setFinancialData=function(n){return o.get("Customer_Details","setFinancialData",{incomePerYear:n.incomePerYear,incomeTotal:n.incomeTotal,incomeTotalToSpend:n.incomeTotalToSpend}).then(function(){s=angular.copy(n)})};this.setFiscality=function(n){return o.get("Customer_Details","setFiscality",{taxIdentificationNumber:n}).then(function(){u.taxIdentificationNumber=angular.copy(n)})};this.isAccountEnabled=function(){var e=c.defer();if(angular.isUndefined(i)===false){e.resolve(i);return e.promise}o.get("Customer_Account","isAccountEnabled").then(function(n){i=n.depotEnabled;e.resolve(i)}).catch(function(n){e.reject(n)});return e.promise};this.enableAccount=function(){return o.get("Customer_Account","enableAccount")};this.getPhonePassword=function(){return t};this.getFinancialData=function(){return angular.copy(s)};this.getIncomePerYearOptions=function(){return u.incomePerYear};this.getIncomeTotalOptions=function(){return u.incomeTotal};this.getIncomeTotalToSpendOptions=function(){return u.incomeTotalToSpend};this.getSalutation=function(){return l};this.getName=function(){return m};this.getTradingExperiences=function(){return f};this.setActivationTradingExperiences=function(n){e=n};this.getActivationTradingExperiences=function(){return e};this.getCountry=function(){return d};this.getTaxIdentificationNumber=function(){return u.taxIdentificationNumber}}]);n.service("activationModal",["brsUiModal","brsAppVersion",function(e,t){var i=false;return function(){if(!i){i=true;var n=e.open(e.getConfig("draggable","lg",{templateUrl:t.getUrl("/app/bank-activation/templates/modal.html"),controller:"BankActivationModalController",resolve:{}}));n.result.then(function(){i=false})}}}])})(); "use strict";var m=angular.module("bank-cash-adjust",["brs-api-client","auth-user","bank-accounts","brs-format","brs-ui-spinner","brs-validation","brs-ui-form","brs-ui-popover"]);m.controller("BankCashAdjustBlockController",["$scope","brsUiModal","brsAppVersion",function(s,n,e){s.$on("openModalCashAdjust",function(a,t){s.open()});s.open=function(a){var t=n.open(n.getConfig("draggable",a,{templateUrl:e.getUrl("/app/bank-cash-adjust/templates/modal.html"),controller:"ModalCashAdjustController"}))}}]);m.controller("ModalCashAdjustController",["$rootScope","$scope","brsApiClient","$modalInstance","BrsUiAlert","authUser","bankAccountsList","bankAccountsCurrentAccount","bankCashAdjustPerform",function(t,s,a,n,e,c,o,u,r){s.alerts=new e;s.authUser=c;s.loading=false;s.showSuccess=false;s.accountsList=o;s.currentAccount=u;s.cashAdjustData={accountKey:s.currentAccount.accountKey,amount:0,side:"",caption:"CASH ADJUST ONVISTA BANK"};s.result={};s.send=function(){if(s.cashAdjustData.accountKey&&s.cashAdjustData.amount>0&&s.cashAdjustData.side&&s.cashAdjustData.caption){s.loading=true;r(s.cashAdjustData).then(function(a){angular.extend(s.result,a);t.$broadcast("accounts:update",s.currentAccount);t.$on("accounts:update:end",function(a){s.showSuccess=true;s.reset();s.loading=false})}).catch(function(a){if(angular.isUndefined(a.message)||a.message==""){a.message="Kann nicht ausgefÃŒhrt werden die Cash-Adjustment."}s.loading=false;s.alerts.danger(a.message)})}else{s.alerts.warning("All fields are required.")}};s.reset=function(){s.cashAdjustData.accountKey=s.currentAccount.accountKey;s.cashAdjustData.amount=0;s.cashAdjustData.side="";s.cashAdjustData.caption="CASH ADJUST ONVISTA BANK"};s.cancel=function(){n.dismiss("cancel")}}]); "use strict";var m=angular.module("bank-cash-adjust");m.service("bankCashAdjustPerform",["brsApiClient","$q",function(r,s){var t;return function(e){var n=s.defer();if(!e.accountKey||!e.amount||!e.side||!e.caption){n.reject({message:"Fehler beim Cash-Adjustment abzubrechen."});return n.promise}if(t){return t}else{t=n.promise}r.get("Bank_CashAdjust","perform",e).then(function(e){if(e.success){n.resolve(e)}else{n.reject({message:"Kann nicht ausgefÃŒhrt werden die Cash-Adjustment."})}}).catch(function(e){n.reject(e)}).finally(function(){t=false});return n.promise}}]); "use strict";var m=angular.module("bank-cash-transfer");m.service("bankCashTransfersCancelCashTransfer",["brsApiClient","$q","bankCashTransfersList",function(r,a,t){var c;return function(e,s){var n=a.defer();if(!e||!s){n.reject({message:"Fehler beim Ã?berweisung abzubrechen."});return n.promise}if(c){return c}else{c=n.promise}r.get("Bank_CashTransfer","cancel",{accountKey:e,transferId:s}).then(function(r){if(r.success&&r.transferId==s){angular.forEach(t,function(e){if(r.transferId==e.transferId){e.status="Storniert";e.isCancellable=false;e.date=r.cancellationDate}});n.resolve({success:r.success})}else{n.reject({message:"Fehler beim Ã?berweisung abzubrechen."})}}).catch(function(e){n.reject(e)}).finally(function(){c=false});return n.promise}}]); "use strict";var m=angular.module("bank-cash-transfer");m.controller("ModalCashTransferCreateController",["$scope","$modalInstance","$log","bankAccountsList","bankAccountsExternalAccount","bankAccountsCurrentAccount","bankCashTransfersCreateCashTransfer","BrsUiAlert","bankAccountsGetExternalAccount",function(a,e,n,c,t,r,o,s,u){n=n.getInstance("ModalCashTransferCreateController");a.loading=true;a.accountsList=c;a.externalAccount=t;a.currentAccount=r;a.alerts=new s;a.selectedFromAccount=r;a.newCashTransferData={fromAccountKey:"",amount:0,reason:""};a.$on("accounts:changeCurrent",function(n,e){a.externalAccount={}});a.changeFromAccount=function(){a.externalAccount={};angular.forEach(a.accountsList,function(n){if(n.accountKey==a.newCashTransferData.fromAccountKey){a.loading=true;u(n.accountKey).then(function(n){angular.extend(a.externalAccount,n)}).catch(function(n){a.alerts.danger(n.message)}).finally(function(){a.loading=false});a.selectedFromAccount=n}})};if(!a.currentAccount.isCFDAccount){a.newCashTransferData.fromAccountKey=a.currentAccount.accountKey;a.changeFromAccount()}a.createCashTransfer=function(){n.info("Creating cash transfer");a.loading=true;o(a.newCashTransferData).then(function(n){a.newCashTransferData={fromAccountKey:"",amount:"",reason:""};e.close()}).catch(function(n){if(angular.isUndefined(n.message)||n.message==""){n.message="Kann nicht ausgefÃŒhrt werden Bargeld Ã?berweisung."}a.alerts.danger(n.message);a.loading=false})};a.close=function(){e.dismiss()}}]); "use strict";var m=angular.module("bank-cash-transfer");m.service("bankCashTransfersCreateCashTransfer",["brsApiClient","$q",function(s,n){var a;return function(e){var r=n.defer();if(!e.fromAccountKey||!e.amount||!e.reason){r.reject({message:"Fehler beim Ã?berweisung abzubrechen."});return r.promise}if(a){return a}else{a=r.promise}s.get("Bank_CashTransfer","perform",e).then(function(e){if(e.success){r.resolve({success:e.success})}else{r.reject({message:"Kann nicht ausgefÃŒhrt werden die Ã?berweisung."})}}).catch(function(e){r.reject(e)}).finally(function(){a=false});return r.promise}}]); "use strict";var m=angular.module("bank-cash-transfer");m.service("bankCashTransfersGetAllCashTransfers",["brsApiClient","$q","$rootScope","bankCashTransfersList",function(n,s,a,t){var i;return function(e){var r=s.defer();if(!e){r.reject({message:"Fehler beim Abrufen von Ã?berweisung."});return r.promise}if(i){return i}else{i=r.promise}a.spinner+=1;while(t.length>0){t.pop()}n.get("Bank_CashTransfer","getCashTransfers",{accountKey:e}).then(function(e){angular.forEach(e.cashTransfers,function(e){t.push(e)},t);r.resolve(t)}).catch(function(e){r.reject(e)}).finally(function(){a.spinner-=1;i=false});return r.promise}}]); "use strict";var m=angular.module("bank-cash-transfer",["brs-api-client","auth-user","bank-accounts","brs-format","brs-ui-spinner","brs-validation","brs-ui-form","brs-ui-popover","customer-details"]);m.value("bankCashTransfersList",[]);m.controller("BankCashTransferBlockController",["$scope","$rootScope","$log","$q","bankAccountsGetAccountsList","bankAccountsList","bankAccountsCurrentAccount","bankCashTransfersGetAllCashTransfers","bankCashTransfersList","bankCashTransfersCancelCashTransfer","BrsUiAlert","brsUiModal","BrsUiPagination","authUser","brsAppVersion","bankAccountsGetExternalAccount","brsApiClient",function(s,e,n,t,a,r,i,c,o,f,l,u,h,g,C,T,d){n=n.getInstance("BankCashTransferBlockController");s.authUser=g;s.isBlockLoading=false;s.showContent=false;s.cancelCashTransferLoading=false;s.cashTransfersList=o;s.accountsList=r;s.currentAccount=i;s.alerts=new l;s.pagination=new h;s.collapsedStatus=[];s.activTransfer=0;s.canCreateNewCashTransfer=s.activTransfer>0?false:true;s.activeCancelButton=true;s.isDeactivated=false;s.isRefreshed=false;s.checkCanCreateTransfer=function(){s.activTransfer=0;angular.forEach(s.cashTransfersList,function(e){s.collapsedStatus[e.transferId]=true;if(e.status=="Vermittelt"||e.status=="Neu"){s.activTransfer+=1}});s.canCreateNewCashTransfer=s.activTransfer>0?false:true;if(!s.canCreateNewCashTransfer){s.alerts.info("Es liegt bereits ein Ã?berweisungsauftrag fÃŒr das gewÃ€hlte Konto vor.","canCreateNewCashTransfer")}else{s.alerts.removeAlertsByUniquName("canCreateNewCashTransfer")}};s.order=function(e,n){s.pagination.filter(e,n)};s.getCashAllTransfers=function(){a(false).then(function(e){while(s.cashTransfersList.length>0){s.cashTransfersList.pop()}if(!s.currentAccount.isCFDAccount){var n=T(e.currentAccount.accountKey).then(function(e){s.externalAccount=e}).catch(function(e){s.alerts.danger(e.message);s.canCreateNewCashTransfer=false});var a=c(e.currentAccount.accountKey).then(function(e){s.checkCanCreateTransfer();if(!e.length){s.alerts.info("Es liegen keine Ã?berweisungen vor.");s.showContent=false;s.pagination.init(s.cashTransfersList,5,true)}else{s.pagination.init(s.cashTransfersList,5,true);s.order("date",true);s.showContent=true}}).catch(function(e){s.showContent=false;s.pagination.init(s.cashTransfersList,5,true);if(e.code==10200){s.alerts.info("Es liegen keine Ã?berweisungen vor.");s.activTransfer=0;s.canCreateNewCashTransfer=s.activTransfer>0?false:true}else{s.alerts.danger(e.message);s.canCreateNewCashTransfer=false}});t.all([n,a]).finally(function(){s.isBlockLoading=false})}else{s.isBlockLoading=false;s.showContent=false;s.alerts.info("Die Leistungsbilanz kann nicht Ã?berweisung.")}}).catch(function(e){s.isBlockLoading=false;s.alerts.danger(e.message)})};s.init=function(){s.alerts.clear();s.isBlockLoading=true;d.get("Common_Utils","getAdminConfigValue",{configKey:"DEACTIVATE_MODULE_UBERWEISUNG",configNamespace:"BANK"}).then(function(e){s.isDeactivated=false;if(e.configValue){s.isDeactivated=true;s.isRefreshed=false}return d.get("Common_Utils","getAdminConfigValue",{configKey:"DEACTIVATE_MODULES_AUTOLOAD",configNamespace:"BANK"})}).then(function(e){s.isRefreshed=!s.isDeactivated&&(s.isRefreshed||!e.configValue);if(s.isRefreshed&&s.authUser.isLogged()){s.getCashAllTransfers()}}).catch(function(e){s.alerts.danger(e.message)}).finally(function(){s.isBlockLoading=false})};s.openCreateCashTransferModal=function(){var e=u.open(u.getConfig("draggable","lg",{templateUrl:C.getUrl("/app/bank-cash-transfer/templates/modal-cash-transfer-create.html"),controller:"ModalCashTransferCreateController"}));e.result.then(function(){s.refresh()})};s.cancelCashTransfer=function(e){n.info("Cancelling cash transfer "+e);s.cancelCashTransferLoading=true;f(s.currentAccount.accountKey,e).catch(function(e){s.alerts.danger(e.message)}).then(function(){s.checkCanCreateTransfer()}).finally(function(){s.cancelCashTransferLoading=false;s.collapsedStatus[e]=true;s.activeCancelButton=true})};s.refresh=function(){n.info("Refresh cash transfer list.");s.isRefreshed=true;s.init()};e.$on("accounts:changeCurrent",function(e,n){s.refresh()});e.$on("auth:logout",function(e,n){s.showContent=false});s.init()}]);m.run(["$rootScope","bankCashTransfersList",function(e,a){e.$on("auth:logout",function(e,n){while(a.length>0){a.pop()}})}]); "use strict";var m=angular.module("bank-konto-derivate");m.controller("BankKontoDerivateBlockController",["$log","$filter","$rootScope","$scope","bankAccountsGetAccountsList","bankAccountsList","bankAccountsCurrentAccount","BrsUiAlert","BrsUiPagination","SNAPSHOT_LINK","bankKontoGetFullDerivativePositionsIntraday",function(t,r,e,i,n,a,o,s,c,u,m){t=t.getInstance("BankKontoDerivateBlockController");i.authUser=authUser;i.isBlockLoading=false;i.title="Offene Positionen Derivate";i.pagination=new c;i.itemsPerPage=5;i.snapshotLink=u;i.positions=[];i.currency="EUR";i.alerts=new s;i.csvDisabled=true;i.init=function(){d()};i.refreshBlockContent=function(){d()};i.order=function(t,e){i.pagination.filter(t,e)};i.onCsv=function(){var t=l();t.data.unshift(["Anzahl Kontrakte","Schlusstag","Name","Eurex-KÃŒrzel","Produkt","Typ","Version","KontraktgrÃ¶Ã?e","Settlement","Settlement Currency","Datum","Zeit","Akt. Kurs","Alt. Kurs Currency","Boerse","Kaufkurs","Kaufkurs Currency","Kaufwert","Kaufwert Currency","Gesamtperformance","Gesamtperformance Currency","Tagesperformance","Tagesperformance Currency","%","Wert","Wert Currency","Aktueller Wert","Aktueller Wert Currency"]);return t};i.onPdf=function(){return l()};function l(){var n=[];angular.forEach(i.pagination.filtered,function(t){if(t.instruments&&t.instruments[0]){var e=t.instruments[0]}if(e){n.push([r("brsFormatQuantity")(t.intradayQuantity),r("brsFilterDate")(t.date,"dd.MM.yyyy")||"n.v.",e.label,e.code2,e.instrumentType,t.contractType?t.contractType:"n.v.",t.version||"n.v.",t.contractSize?t.contractSize:"n.v.",r("brsFormatNumber")(t.settlement,2),e.currency,r("brsFilterDate")(e.tradeDate,"dd.MM.yyyy"),r("brsFilterDate")(e.tradeDate,"HH:mm:ss"),r("brsFormatNumber")(e.last,4),e.currency,e.exchangeLabel,t.transactionPrice?r("brsFormatNumber")(t.transactionPrice,2):t.averagePrice?r("brsFormatNumber")(t.averagePrice,2):"n.v.","EUR",t.transactionPrice?r("brsFormatNumber")(t.transactionPrice*t.intradayQuantity*t.contractSize,2):t.averagePrice?r("brsFormatNumber")(t.averagePrice*t.intradayQuantity*t.contractSize,2):"n.v.","EUR",r("brsFormatNumber")(t.profitLoss,2),"EUR",r("brsFormatNumber")(e.variation_value,4),e.currency,r("brsFormatCurrency")(e.variation*100,2,"%"),t.intradayQuantity!=t.quantity?"n.v.":r("brsFormatNumber")(t.netValue,2),t.intradayQuantity!=t.quantity?"n.v.":"EUR",r("brsFormatNumber")(e.last*t.intradayQuantity*t.contractSize,2),e.currency])}else{n.push([r("brsFormatQuantity")(t.intradayQuantity),r("brsFilterDate")(t.date,"dd.MM.yyyy")||"n.v.","n.v.","n.v.","n.v.",t.contractType?t.contractType:"n.v.",t.version||"n.v.",t.contractSize?t.contractSize:"n.v.",r("brsFormatNumber")(t.settlement,2),"n.v.","n.v.","n.v.","n.v.","n.v.","n.v.",t.transactionPrice?r("brsFormatNumber")(t.transactionPrice,2):t.averagePrice?r("brsFormatNumber")(t.averagePrice,2):"n.v.","EUR",t.transactionPrice?r("brsFormatNumber")(t.transactionPrice*t.intradayQuantity*t.contractSize,2):t.averagePrice?r("brsFormatNumber")(t.averagePrice*t.intradayQuantity*t.contractSize,2):"n.v.","EUR",r("brsFormatNumber")(t.profitLoss,2),"EUR","n.v.","n.v.","n.v.",t.intradayQuantity!=t.quantity?"n.v.":r("brsFormatNumber")(t.netValue,2),t.intradayQuantity!=t.quantity?"n.v.":"EUR","n.v.",""])}});return{data:n,subTitle:""}}function d(){i.isBlockLoading=true;n().then(function(t){i.accountsList=a;i.currentAccount=o;f()}).catch(function(t){i.isBlockLoading=false}).finally(function(){})}function f(){i.isBlockLoading=true;m(i.currentAccount.accountKey,i.currency).then(function(t){i.positions=t.fullDerivativeIntradayPositions;if(i.positions.length){if(angular.isDefined(i.positions[0].instruments)){i.csvDisabled=false}i.pagination.init(i.positions,i.itemsPerPage,true)}i.totals=t.totals;i.isBlockLoading=false}).catch(function(t){i.alerts.danger(t.message)})}e.$on("accounts:changeCurrent",function(t,e){i.currentAccount=e;f()});i.$on("trading-order:on-trade",function(t,e){if(e.isDerivate){f()}});i.$on("trading-order-strategy:on-confirm",function(){f()});i.init()}]);m.controller("BankKontoDerivateBlockElementController",["$log","$scope","tradingWatchlistUpdateMemo","tradingWatchlistDeleteMemo","customerPulls","customerPullsGetPullsQuoteByMne","bankKontoDerivateGetOpenPositionDetails","authUser",function(e,n,r,i,t,a,o,s){e=e.getInstance("BankKontoDerivateBlockElementController");n.derivateTrading={};n.derivateTrading.show=false;n.derivateTrading.side="S";n.isElementLoading=false;n.instrument=n.position.instruments?n.position.instruments[0]:false;if(n.instrument){n.instrument.variation_value=n.instrument.variation*n.instrument.previousClose}n.getRealtimeQuote=function(){t.askConfirmation(n.instrument,false).then(function(){n.isElementLoading=true;a(n.instrument.exchangeId,n.instrument.code2,n.instrument.symbol).then(function(t){angular.extend(n.instrument,t.quote[0]);n.instrument.variation_value=n.instrument.variation*n.instrument.previousClose}).finally(function(t){n.isElementLoading=false})})};n.displayPerform=function(t){n.derivateTrading.show=true;e.debug("side",t);n.derivateTrading.side=t;e.debug("$scope.derivateTrading.side",n.derivateTrading.side)};n.memoConfig={editing:false,hasMemo:false,memo:"",newMemo:"",colspan:10,feature:"account",featureId:n.currentAccount.accountKey,wkn:n.instrument.code2};if(n.position.memo!=null){n.memoConfig.hasMemo=n.position.memo.length>0;n.memoConfig.memo=n.position.memo;n.memoConfig.newMemo=n.memoConfig.memo}n.edit=function(t){n.editing=t};n.saveMemo=function(){c(n.instrument.symbol,n.newMemo)};n.deleteMemo=function(){u(n.instrument.symbol)};n.cancel=function(){n.editing=false;n.newMemo=n.memo};function c(t,e){r(t,e).then(function(t){n.instrument.memo=e;n.hasMemo=n.instrument.memo.length>0;n.memo=n.instrument.memo;n.newMemo=n.memo;n.editing=false}).catch(function(t){n.alerts.danger(t.message)})}function u(t){n.editing=false;i(t).then(function(t){n.instrument.memo="";n.hasMemo=n.instrument.memo.length>0;n.memo=n.instrument.memo;n.newMemo=n.memo}).catch(function(t){n.alerts.danger(t.message)})}n.showDetails=false;n.details=[];n.displayDetails=function(){if(!n.showDetails&&n.details.length<=1){n.getDetails()}n.showDetails=!n.showDetails};n.getDetails=function(){n.isDetailsLoading=true;o(n.currentAccount.accountKey,n.currency,n.instrument.code2).then(function(t){n.details=t.positionDetails;e.debug("bankKontoDerivateGetOpenPositionDetails : $scope.details.length ",n.details.length)}).catch(function(t){n.alerts.danger(t.message)}).finally(function(){n.isDetailsLoading=false})};if(s.isPcc()&&n.position.atosDetails){n.atosDetailsConfig={opened:false,colspan:10,derivative:true}}}]); "use strict";var m=angular.module("bank-konto-derivate");m.service("bankKontoDerivateGetOpenPositions",["brsApiClient","$q",function(r,o){var a;return function(e,t,n){var i=o.defer();if(!e){return i.promise}if(a){return a}else{a=i.promise}r.get("Trading_Derivative","getDerivativeOpenPositions",{accountKey:e,currency:t,consolidated:1,withMemos:1}).then(function(e){delete e["_meta"];i.resolve(e)}).catch(function(e){i.reject(e)}).finally(function(){a=false});return i.promise}}]);m.service("bankKontoGetDerivativePositionsIntraday",["brsApiClient","$q",function(n,i){var r;return function(e){var t=i.defer();if(!e){return t.promise}if(r){return r}else{r=t.promise}n.get("Trading_Derivative","getDerivativePositionsIntraday",{accountKey:e,futures:1,options:1}).then(function(e){delete e["_meta"];t.resolve(e)}).catch(function(e){t.reject(e)}).finally(function(){r=false});return t.promise}}]);m.service("bankKontoGetFullDerivativePositionsIntraday",["brsApiClient","$q",function(i,r){var o;return function(e,t){var n=r.defer();if(!e){return n.promise}if(o){return o}else{o=n.promise}i.get("Trading_Derivative","getFullDerivativePositionsIntraday",{accountKey:e,currency:t,consolidated:1,withMemos:1}).then(function(e){delete e["_meta"];n.resolve(e)}).catch(function(e){n.reject(e)}).finally(function(){o=false});return n.promise}}]);m.service("bankKontoDerivateGetOpenPositionDetails",["brsApiClient","$q",function(r,o){var a;return function(e,t,n){var i=o.defer();if(!e){return i.promise}if(a){return a}else{a=i.promise}r.get("Trading_Derivative","getDerivativeOpenPositionDetails",{accountKey:e,currency:t,code:n}).then(function(e){delete e["_meta"];i.resolve(e)}).catch(function(e){i.reject(e)}).finally(function(){a=false});return i.promise}}]); "use strict";var m=angular.module("bank-konto-derivate",["brs-api-client","brs-ui-atos-details","auth-user"]);m.value("bankKontoDerivateOpenPositions",[]);m.controller("BankKontoDerivateController",function(){});m.directive("bankKontoDerivateElement",["brsAppVersion",function(e){return{restrict:"A",replace:true,templateUrl:e.getUrl("/app/bank-konto-derivate/templates/element.html")}}]);m.directive("bankKontoDerivateElementMemo",["brsAppVersion",function(e){return{restrict:"A",replace:true,templateUrl:e.getUrl("/app/bank-konto-derivate/templates/memo.html")}}]); "use strict";var m=angular.module("bank-konto");m.controller("BankKontoController",["$scope",function(e){}]);m.controller("BankKontoBlockController",["$rootScope","$scope","$filter","$log","brsApiClient","authUser","bankAccountsGetAccountsList","bankAccountsList","bankAccountsCurrentAccount","bankKontoGetPositions","BrsUiPagination","SNAPSHOT_LINK","BrsUiAlert",function(e,r,o,n,t,a,s,i,u,l,c,m,f){n=n.getInstance("BankKontoBlockController");var g=o("orderBy");r.blockTitle="DepotÃŒbersicht Wertpapiere";r.isBlockLoading=true;r.authUser=a;r.pagination=new c;r.itemsPerPage=10;r.snapshotLink=m;r.predicate="instrument.label";r.reverse=false;r.alerts=new f;r.isDeactivated=false;r.isRefreshed=false;r.init=function(){r.isBlockLoading=true;t.get("Common_Utils","getAdminConfigValue",{configKey:"DEACTIVATE_MODULE_DEPOTUBERSICHT_WERTPAPIERE",configNamespace:"BANK"}).then(function(e){r.isDeactivated=false;if(e.configValue){r.isDeactivated=true;r.isRefreshed=false}return t.get("Common_Utils","getAdminConfigValue",{configKey:"DEACTIVATE_MODULES_AUTOLOAD",configNamespace:"BANK"})}).then(function(e){r.isRefreshed=!r.isDeactivated&&(r.isRefreshed||!e.configValue);if(r.isRefreshed&&r.authUser.isLogged()){b()}}).catch(function(e){r.alerts.danger(e.message)}).finally(function(){r.isBlockLoading=false})};r.close=function(){};r.refresh=function(){r.isRefreshed=true;r.init()};r.sortOptions=[{name:"Sortierung nach...",sortName:"quantity",reverse:true},{name:"Nominal / StÃŒck aufsteigend",sortName:"quantity",reverse:true},{name:"Nominal / StÃŒck absteigend",sortName:"quantity",reverse:false},{name:"Name aufsteigend",sortName:"instrument.label",reverse:true},{name:"Name absteigend",sortName:"instrument.label",reverse:false},{name:"Gesamtperformance (abs / rel) aufsteigend",sortName:"performancePercentage",reverse:true},{name:"Gesamtperformance (abs / rel) absteigend",sortName:"performancePercentage",reverse:false},{name:"Tagesperformance (abs / rel) aufsteigend",sortName:"dailyPerformancePx",reverse:true},{name:"Tagesperformance (abs / rel) absteigend",sortName:"dailyPerformancePx",reverse:false},{name:"Kaufkurs * aufsteigend",sortName:"buyingValue",reverse:true},{name:"Kaufkurs * absteigend",sortName:"buyingValue",reverse:false},{name:"Kaufwert aufsteigend",sortName:"totalValue",reverse:true},{name:"Kaufwert absteigend",sortName:"totalValue",reverse:false},{name:"Wert aufsteigend",sortName:"actualValue",reverse:true},{name:"Wert absteigend",sortName:"actualValue",reverse:false}];r.tradingOrderSortBy=r.sortOptions[0];r.onSortChangeMobile=function(e){r.order(e.sortName,e.reverse)};r.order=function(e,n){r.pagination.filter(e,n)};r.onCsv=function(){var e=d();e.data.unshift(["Bestand","Name","ISIN","WKN","Typ","Datum","Zeit","Akt. Geldkurs","Akt. Geldkurs Currency","Boerse","Kaufkurs","Kaufkurs Currency","Kaufwert","Kaufwert Currency","Gesamtperformance","Gesamtperformance Currency","%","Tagesperformance","Tagesperformance Currency","%","Aktueller Wert","Aktueller Wert Currency","Wert","Wert Currency"]);return e};r.onPdf=function(){return d()};function d(){var t=[];angular.forEach(r.pagination.filtered,function(e){var n=e.instrument;if(n){t.push([o("brsFormatQuantity")(e.quantity),n.label,n.isin||"n.v.",n.wkn&&n.wkn.length>0?n.wkn:"n.v.",e.type,o("brsFilterDate")(n.tradeDate,"dd.MM.yyyy")||"n.v.",o("brsFilterDate")(n.tradeDate,"HH:mm:ss"),o("brsFormatNumber")(n.last,4),e.isPourcentage?"%":n.currency,n.exchangeLabel||"n.v.",o("brsFormatNumber")(e.buyingValue,4),n.isPourcentage?"%":n.currency,o("brsFormatNumber")(e.totalValue,2),"EUR",o("brsFormatNumber")(e.totalPerformance,2),"EUR",o("brsFormatCurrency")(e.performancePercentage,2,"%"),o("brsFormatNumber")(n.variation*n.previousClose,4),n.currency,o("brsFormatCurrency")(n.variation*100,2,"%"),o("brsFormatNumber")(e.actualValue,2),"EUR",o("brsFormatNumber")(n.last/n.factor*e.quantity,2),n.currency])}else{t.push([o("brsFormatQuantity")(e.quantity),"","n.v.","n.v.",e.type,"n.v.","n.v.","n.v.","n.v.","n.v.",o("brsFormatNumber")(e.buyingValue,4),"n.v.",o("brsFormatNumber")(e.totalValue,2),"EUR",o("brsFormatNumber")(e.totalPerformance,2),"EUR",o("brsFormatCurrency")(e.performancePercentage,2,"%"),"n.v.","n.v.","n.v.",o("brsFormatNumber")(e.actualValue,2),"EUR","n.v.","n.v."])}});t.push(new Array(24).map(function(){return""}));t.push(["","","","","","","","","GESAMTSUMME","",o("brsFormatNumber")(r.portfolio.total.buyValue,2),"EUR","","",o("brsFormatNumber")(r.portfolio.total.totalPerformance,2),"EUR",o("brsFormatCurrency")(r.portfolio.total.performancePercentage,3,"%"),o("brsFormatNumber")(r.portfolio.total.totalDailyPerformance,2),"EUR",o("brsFormatCurrency")(r.portfolio.total.totalDailyPerformancePx,3,"%"),o("brsFormatNumber")(r.portfolio.total.actualValue,2),"EUR","",""]);return{data:t,subTitle:""}}function b(){r.isBlockLoading=true;r.alerts.clean();s().then(function(e){r.accountsList=i;r.currentAccount=u;p()}).catch(function(e){r.alerts.danger(e.message);r.isBlockLoading=false}).finally(function(){})}function p(){r.isBlockLoading=true;r.alerts.clean();l(r.currentAccount.accountKey).then(function(e){n.debug("requestPositions",e);r.portfolio=e.portfolio;n.debug("requestPositions",r.portfolio);r.pagination.init(r.portfolio.positions,r.itemsPerPage,true);r.order(r.predicate,r.reverse)}).catch(function(e){r.alerts.danger(e.message)}).finally(function(){r.isBlockLoading=false})}e.$on("accounts:changeCurrent",function(e,n){r.currentAccount=n;p()});r.$on("trading-order:on-trade",function(e,n){if(!n.isDerivate){p()}});r.init()}]);m.controller("BankKontoBlockElementController",["$scope","$log","tradingOrderPerformObject","tradingOrderGetOrdersDetails","customerPulls","customerPullsGetPullsQuote","customerPullsGetOrderBook","tradingWatchlistGetInstrumentExchanges","bankKontoGetInstrument","brsUiModal","brsAppVersion","bankKontoGetPositionOrders","authUser","brsUiGridDesktop",function(t,r,n,e,o,a,s,i,u,l,c,m,f,g){r=r.getInstance("BankKontoBlockElementController");t.isElementLoading=false;t.isOrdersLoading=false;t.displayGotoTradingBlock={show:false};t.goToTradingBlock=g.goToTradingBlock;t.hasOTC=false;t.instrument=t.position.instrument;t.instrument.variation_value=t.instrument.variation*t.instrument.previousClose;t.instrument.co=[];t.memoConfig={editing:false,hasMemo:false,memo:"",newMemo:"",colspan:10,feature:"account",featureId:t.currentAccount.accountKey,wkn:t.position.instrument.isin+"."+t.position.instrument.country};if(t.position.memo!=null){t.memoConfig.hasMemo=t.position.memo.length>0;t.memoConfig.memo=t.position.memo;t.memoConfig.newMemo=t.memoConfig.memo}t.displayPerform=function(e){if(typeof t.position.symbol==="undefined"||!t.position.symbol){t.displayGotoTradingBlock.show=true;t.displayGotoTradingBlock.side=e;t.displayGotoTradingBlock.action=function(){g.goToTradingBlock(t.position.isin,t.position.wkn,e)}}else{if(t.performObject===undefined){t.performObject=new n;t.performObject.show=false}if(t.performObject.show===true){t.performObject.side=e}else{t.performObject.resetFrom({side:e,symbol:t.instrument.symbol,show:true,enable:{exchangeList:true},instrument:t.instrument})}}};t.getRealtimeQuote=function(){o.askConfirmation(t.instrument,false).then(function(){t.isElementLoading=true;a(t.instrument.exchangeId,t.instrument.isin,t.instrument.symbol).then(function(e){angular.extend(t.instrument,e.quote[0]);t.instrument.variation_value=t.instrument.variation*t.instrument.previousClose}).finally(function(e){t.isElementLoading=false})})};t.hasLevel2=false;t.showLevel2=false;t.isXetra=function(){t.hasLevel2=t.instrument.exchangeId==4920};t.isXetra();t.displayLevel2=function(){r.debug("displayLevel2");r.debug("displayLevel2: co",t.instrument.co);r.debug("displayLevel2: showLevel2",t.showLevel2);if(!t.showLevel2&&t.instrument.co&&t.instrument.co.length<=1){t.loadOrderBook()}if(t.instrument.co.length>1){t.showLevel2=!t.showLevel2}};t.loadOrderBook=function(){r.debug("showOrderBook");o.askConfirmation(t.instrument,true).then(function(){t.isLoadingOrderBook=true;s(t.instrument.exchangeId,t.instrument.isin).then(function(e){t.instrument.co=e.co;t.showLevel2=true}).finally(function(){t.isLoadingOrderBook=false})})};t.OrdersMax=6;t.params={accountKey:t.currentAccount.accountKey,isinOrWkn:t.instrument.wkn,status:1,entireList:true};t.showOrders=false;t.orders=[];t.displayOrders=function(){if(!t.showOrders&&t.orders.length<=1){t.getOrders()}t.showOrders=!t.showOrders};t.getOrders=function(){t.isOrdersLoading=true;m(t.currentAccount.accountKey,t.position.wkn,t.position.isin).then(function(e){t.orders=e.ordersDetails;r.debug("tradingOrderGetOrdersDetails : $scope.orders.length ",t.orders.length);if(t.orders.length>t.OrdersMax){t.orders=t.orders.slice(0,t.OrdersMax)}}).catch(function(e){t.alerts.danger(e.message)}).finally(function(){t.isOrdersLoading=false})};t.period="3M";t.exchangesList=[];t.newExchange={symbol:t.instrument.symbol};t.canDisplayExchangesList=false;t.getExchangesForInstrument=function(){if(t.instrument.symbol.length>0){d(t.instrument.symbol)}};t.changeExchange=function(){r.debug("changeExchange",t.newExchange.symbol);b(t.newExchange.symbol)};function d(n){var e=(t.instrument.isin||t.instrument.wkn||"")+"."+(t.instrument["code_oms"]||"")+"."+(t.instrument.currency||"");i(n,e).then(function(e){t.exchangesList=e.marketExchanges;if(e.issuersExchanges&&e.issuersExchanges.length>0){t.hasOTC=true}else{t.hasOTC=false}r.debug("requestExchanges symbol",n);r.debug("requestExchanges hasOTC",t.hasOTC)}).catch(function(e){t.alerts.danger(e.message)})}function b(e){t.isElementLoading=true;t.alerts.clean();u(e,true).then(function(e){angular.extend(t.instrument,e);t.alerts.success("Exchange changed");t.isXetra()}).catch(function(e){t.alerts.danger(e.message)}).finally(function(){t.isElementLoading=false})}t.openSavingsPlanDetails=function(e){r.debug("openSavingsPlanDetails : savingsPlanId ",e);t.disableButtons=true;var n=l.open(l.getConfig("small","md",{templateUrl:c.getUrl("/app/trading-savingsplan/templates/modal-savingsplan-details.html"),controller:"ModalSavingsPlanDetailsController",resolve:{savingsPlanId:function(){return e}}}));n.result.finally(function(){t.disableButtons=false})};if(f.isPcc()&&t.position.atosDetails){t.atosDetailsConfig={opened:false,colspan:10}}r.debug("$scope.position.blockedPositions.length ",t.position.blockedPositions.length);d(t.instrument.symbol)}]); "use strict";var m=angular.module("bank-konto",[]);m.directive("bankKontoPosition",["brsAppVersion",function(e){return{restrict:"A",templateUrl:e.getUrl("/app/bank-konto/templates/element.html")}}]);m.directive("bankKontoSecurityType",["$log","bankKontoCategories",function(i,o){i=i.getInstance("bankKontoSecurityType");return{restrict:"E",template:"<span class='{{res.class}}'>{{res.label}}</span>",scope:{security:"=security",position:"=position"},link:function(t,e,n){if(t.security!=undefined){angular.forEach(o,function(e){i.debug("category.key : ",e.key);i.debug("security.categoryLabel : ",t.security.categoryLabel);if(angular.isDefined(t.position)){i.debug("position.type : ",t.position.type);if(e.key==t.position.type){t.res={class:e.class,label:e.label}}}})}}}}]); "use strict";var m=angular.module("bank-konto");m.service("bankKontoGetPositions",["brsApiClient","$q",function(t,r){var i;return function(e){var n=r.defer();if(!e){return n.promise}if(i){return i}else{i=n.promise}t.get("Trading_Position","getPositions",{accountKey:e,withMemos:1}).then(function(e){delete e["_meta"];n.resolve(e)}).catch(function(e){n.reject(e)}).finally(function(){i=false});return n.promise}}]);m.service("bankKontoGetInstrument",["brsApiClient","$q","$rootScope",function(r,i,o){var s;return function(e,n){var t=i.defer();if(s){return s}else{s=t.promise}o.spinner+=1;r.get("Feed_Instrument","getQuote",{symbol:e,co:n}).then(function(e){t.resolve(e.quote)}).catch(function(e){t.reject(e)}).finally(function(){o.spinner-=1;s=false});return t.promise}}]);m.service("bankKontoGetQuotesByExchange",["brsApiClient","$q","$rootScope",function(r,i,o){var s;return function(e,n){var t=i.defer();if(s){return s}else{s=t.promise}o.spinner+=1;r.get("Feed_Instrument","getQuotesByExchange",{exchange:e,isin:n}).then(function(e){t.resolve(e)}).catch(function(e){t.reject(e)}).finally(function(){o.spinner-=1;s=false});return t.promise}}]);m.service("bankKontoGetPositionOrders",["brsApiClient","$q",function(i,o){var s;return function(e,n,t){var r=o.defer();if(!e){return r.promise}if(s){return s}else{s=r.promise}i.get("Trading_Position","getPositionsOrders",{accountKey:e,wkn:n,isin:t}).then(function(e){delete e["_meta"];r.resolve(e)}).catch(function(e){r.reject(e)}).finally(function(){s=false});return r.promise}}]); "use strict";var m=angular.module("bank-konto",["brs-api-client","brs-ui-atos-details","auth-user","ui-memo","ui-graph","trading-savingsplan"]);m.value("bankKontoCategories",[{key:"Aktie",label:"Aktie",class:"type-aktie"},{key:"Anleihe",label:"Anleihe",class:"type-anleihe"},{key:"Fonds",label:"Fonds",class:"type-fonds"},{key:"ETF",label:"ETF",class:"type-etf"},{key:"KNO",label:"Optionsscheine",class:"type-option"},{key:"Zertifikat",label:"Zertifikat",class:"type-zertifikat"},{key:"OS",label:"Optionsscheine",class:"type-option"}]);m.filter("bankKontoTotalValue",["$filter",function(e){return function(e){var t="";t=e.instrument.last*e.quantity;if(e.isPourcentage){t=t/100}return t}}]);m.filter("bankKontoDailyPerformance",["$filter",function(e){return function(e){var t="";t=(e.instrument.last-e.instrument.previousClose)*e.quantity;if(e.isPourcentage){t=t/100}return t}}]); "use strict";(function(){var e=angular.module("bank-subscribe",["brs-api-client","brs-routes","brs-validation","brs-date","brs-filter-text","brs-app","brs-ui-modal"]);var r="/prospect/";e.constant("BANK_SUBSCRIBE_ROUTES",{ROOT:r,PERSONAL_INFOS:r+"step1",PERSONAL_CO_INFOS:r+"step1.2",EXTERNAL_ACCOUNT:r+"step2",RECAP:r+"step3",THANK_YOU_PAGE:r+"thank-you-page",CONFIRMED_MAIL_PAGE:r+"confirmation-page",EXPIRED_MAIL_PAGE:r+"confirmation-expired",ERROR_PAGE:r+"error"});e.constant("postcodeLength",{DE:5,AT:4});e.controller("BankSubscribeController",["$scope","$rootScope","brsRouteParams","BankSubscribeProspectService","$location","BANK_SUBSCRIBE_ROUTES","$anchorScroll","$cookieStore","$q","brsAnalytics","brsAppConfig","brsAppVersion",function(o,s,i,u,a,c,r,p,e,l,t,f){var d=c.PERSONAL_INFOS;var n=p.get("prospectStep")==="end"&&i().step!=="final"&&i().step!=="final-mail";o.loaded=false;o.error=null;o.step=i().step;o.isMobile=t.isMobile();o.partnerMode=t.isPartnerMode();o.step12TemplateUrl=f.getUrl("/app/bank-subscribe/templates/step1.html");o.registerService=function(e){o.error=null;e.catch(function(e){o.error=e;a.hash("bank-subscribe");r();a.hash("")});return e};var b=u.init();var y=u.loadProspect(n);o.registerService(e.all([b,y])).finally(function(){g()});function g(){o.loaded=true;var e=i();switch(e.step){case"thank-you-page":p.put("prospectStep","end");case"step3":if(u.getAccount()===null){a.path(d);return}case"step2":if(u.getUser()===null){a.path(d);return}break;case"step1":case"step1.2":p.remove("prospectStep");p.remove("prospectCaseId");break;case"confirmEmailProspect":s.hideNavigationBar=true;var r=e.k;u.checkEmailValidity(r).then(function(e){if(!e){a.path(c.ERROR_PAGE)}else{s.isPaperless=e.isPaperless;s.caseId=e.caseId;if(e.mailIsValid){a.path(c.CONFIRMED_MAIL_PAGE)}else{a.path(c.EXPIRED_MAIL_PAGE)}}}).catch(function(e){console.error(e);a.path(c.ERROR_PAGE)});return;break;case"confirmation-page":case"confirmation-expired":case"error":s.hideNavigationBar=true;break;default:a.path(d);return}o.include=f.getUrl("app/bank-subscribe/templates/"+e.step+".html");try{var t=l.getTracker("UA-8097622-3");t.setCustomVar(1,"Landingpage",u.getTrackingName(),2);var n=c.ROOT+e.step+"?";angular.forEach(e,function(e,r){if(r!="step"){n+=r+"="+e+"&"}});n=n.substring(0,n.length-1);t.trackPageview(n)}catch(e){}}}]);e.controller("BankSubscribeUserController",["$scope","$timeout","brsApiClient","BankSubscribeProspectService","$location","BANK_SUBSCRIBE_ROUTES","brsDateMonthArray","brsValidationRealtimeErrorHandler","brsRouteParams","$moment","postcodeLength",function(i,o,e,t,n,s,r,u,a,c,p){var l=new u(i,"subscriptionForm","hasError");i.userType=a().step==="step1"?"user":"coUser";i.users={user:t.getUser()||{},coUser:t.getCoUser()||{}};i.users[i.userType].differingAddress=i.users[i.userType].differingStreet?true:false;i.users.user.isCoUser=false;i.users.coUser.isCoUser=true;i.users[i.userType].citySelected=undefined;i.users[i.userType].cfdAccount=t.getIncc()==="Aktion_CFD"?"1":"0";i.users[i.userType].eurexAccount="0";if(!i.users[i.userType].country){i.users[i.userType].country="DE"}if(!i.users[i.userType].differingCountry){i.users[i.userType].differingCountry="DE"}if(i.userType==="coUser"){i.users[i.userType].country=i.users.user.country;if(i.users.user.familyStatus&&i.users.user.familyStatus.trim()==="verheiratet mit 2. Antragsteller"){i.users.coUser.familyStatus="verheiratet mit 1. Antragsteller"}else{i.users.coUser.familyStatus="unbekannt"}}i.emailRepeat=i.users[i.userType].email;i.showCountryTextField=i.users[i.userType].country==="AT";i.showDifferingCountryTextField=i.users[i.userType].differingCountry==="AT";i.isSubmitting=false;i.generalError=false;i.titles=t.getTitles();i.countries=t.getCountries();i.nationalityCountries=t.getNationalityCountries();i.occupationalCategory=t.getOccupationalCategory();i.depotName=t.getDepotName();i.cities=[];i.year=[];i.days=[];i.salutations=["Herr","Frau"];i.occupationalSubCategory={};i.months=r;i.postcodeLength=p;var f=(new Date).getFullYear();for(var d=f-100;d<=f-18;d++){i.year.unshift(d.toString())}for(d=1;d<32;d++){var b=d<10?"0"+d:""+d;i.days.push({key:b,value:d.toString()})}i.$watch("users[userType].occupationalCategory",function(t,n){if(t===undefined){return}e.get("Customer_options","getOccupationalSubCategoriesOptions",{categoryCode:t}).then(function(e){i.occupationalSubCategory=e.occupationalSubCategories;if(t===n){var r=i.users[i.userType].businessBranch;i.users[i.userType].businessBranch="";o(function(){i.users[i.userType].businessBranch=r})}else if(i.occupationalSubCategory.length===1){i.users[i.userType].businessBranch=i.occupationalSubCategory[0].occupationalSubCategoryCode}else{i.users[i.userType].businessBranch=""}})});i.$watch("users[userType].postcode",function(e,r){if(i.users[i.userType].country&&i.users[i.userType].country==="DE"){m(e,r)}});i.$watch("users[userType].differingPostcode",function(e,r){if(i.users[i.userType].differingCountry&&i.users[i.userType].differingCountry==="DE"){m(e,r,true)}});var y={cityProperty:"city",citiesProperty:"cities",citySelectedProperty:"citySelected",countryProperty:"country",subscriptionPostCodeProperty:"subscriptionFPostcode",federalStateProperty:"federalState"};var g={cityProperty:"differingCity",citiesProperty:"differingCities",citySelectedProperty:"differingCitySelected",countryProperty:"differingCountry",subscriptionPostCodeProperty:"differingSubscriptionDPostcode",federalStateProperty:"differingFederalState"};function m(t,n,o){var s=o?g:y;i[s["citiesProperty"]]=[];if(i.users[i.userType][s["citySelected"]]!==undefined){i.users[i.userType][s["citySelectedProperty"]]=undefined;i.onSelectCity(undefined,o)}if(t===undefined){return}e.get("Customer_options","getCitiesByPostCode",{postCode:t}).then(function(e){i[s["citiesProperty"]]=e.cities;if(t!==n&&i[s["citiesProperty"]].length===1){i.users[i.userType][s["citySelectedProperty"]]="0";i.onSelectCity("0",o)}else{for(var r=0;r<i.cities.length;r++){if(i.users[i.userType][s["cityProperty"]]===i[s["citiesProperty"]][r].cityName){i.users[i.userType][s["citySelectedProperty"]]=r.toString();i.onSelectCity(r,o);break}}}i.subscriptionForm[s["subscriptionPostCodeProperty"]].$setValidity("invalid",true)}).catch(function(e){if(e.code===100010){i.subscriptionForm[s["subscriptionPostCodeProperty"]].$setValidity("invalid",false)}i.onSelectCity(undefined,o)})}i.onSelectCountry=function(e,r){if(r){i.showDifferingCountryTextField=e!=="DE";i.users[i.userType][g["cityProperty"]]=undefined}else{i.showCountryTextField=e!=="DE";i.users[i.userType][y["cityProperty"]]=undefined;i.users[i.userType].cfdAccount=0;i.users[i.userType].eurexAccount=0;if(e!=="DE"){if(i.users[i.userType].typeOfDepot==="multi"){i.cfdEurexNotice="Aus geschÃ€ftspolitischen GrÃŒnden kÃ¶nnen wir Eurex-Konten aktuell nur fÃŒr in Deutschland wohnhafte Personen erÃ¶ffnen"}else{i.cfdEurexNotice="Aus geschÃ€ftspolitischen GrÃŒnden kÃ¶nnen wir CFD-Konten oder Eurex-Konten aktuell nur fÃŒr in Deutschland wohnhafte Personen erÃ¶ffnen"}}else{if(i.users[i.userType].typeOfDepot==="multi"){i.cfdEurexNotice="Aktivieren Sie gegebenenfalls die Option Eurex-Kontos"}else{i.cfdEurexNotice="Aktivieren Sie gegebenenfalls die Option CFD-Kontos oder Eurex-Kontos"}}}};i.onSelectCity=function(e,r){var t=r?g:y;if(e===undefined||e===""){i.users[i.userType][t["cityProperty"]]=undefined;i.users[i.userType][t["federalStateProperty"]]=undefined}else{var n=i[t["citiesProperty"]][e];i.users[i.userType][t["cityProperty"]]=n.cityName;i.users[i.userType][t["federalStateProperty"]]=n.cityFederalStateName}};i.checkBirthDate=function(){i.isMinor=false};i.checkEmail=function(){if(i.emailRepeat!==i.users[i.userType].email){i.subscriptionForm["subscriptionFEmailRepeat"].$setValidity("isValid",false)}else{i.subscriptionForm["subscriptionFEmailRepeat"].$setValidity("isValid",true)}};i.onSubmit=function(){if(i.subscriptionForm.$invalid){l.forceErrorValidation(true);return}var e=i.users[i.userType].dateOfBirthYear+"-"+i.users[i.userType].dateOfBirthMonth+"-"+i.users[i.userType].dateOfBirthDay;if(c().diff(e,"years")<18){i.isMinor=true;return}i.isSubmitting=true;i.users[i.userType].businessBranchLabel="";for(var r=0;r<i.occupationalSubCategory.length;r++){if(i.occupationalSubCategory[r].occupationalSubCategoryCode===i.users[i.userType].businessBranch){i.users[i.userType].businessBranchLabel=i.occupationalSubCategory[r].occupationalSubCategoryLabelDecoded}}if(i.users[i.userType].differingAddress===false){delete i.users[i.userType].differingCountry;delete i.users[i.userType].differingStreet;delete i.users[i.userType].differingCity;delete i.users[i.userType].differingFederalState;delete i.users[i.userType].differingPostcode;delete i.users[i.userType].differingHouseNumber;delete i.users[i.userType].differingCitySelected}i.$parent.registerService(t.setUser(i.users[i.userType])).then(function(){l.forceErrorValidation(false);i.subscriptionForm.$setPristine();if(i.userType==="user"&&i.users["user"].typeOfDepot==="multi"){n.path(s.PERSONAL_CO_INFOS)}else{n.path(s.EXTERNAL_ACCOUNT)}}).finally(function(){i.isSubmitting=false})};i.goBack=function(){n.path(s.PERSONAL_INFOS)}}]);e.controller("BankSubscribeAccountController",["$scope","brsApiClient","$location","BankSubscribeProspectService","BANK_SUBSCRIBE_ROUTES","brsValidationRealtimeErrorHandler","brsAppConfig",function(t,n,e,r,o,s,i){var u=new s(t,"subscriptionAccountForm","hasError");var a=r.getUser();var c=r.getCoUser();t.user=a;t.hideAccountNumber=a.country==="AT";t.ibanMaxLength=a.country==="AT"?20:22;t.bankAccountMaxLength=a.country==="AT"?11:10;t.type=a.typeOfDepot;t.converterError=false;t.showValidationMessages=false;t.account=r.getAccount()||{};t.converter={};if(t.account.accountNumber&&t.account.bankNumber){t.converter.number=t.account.accountNumber;t.converter.bankNumber=t.account.bankNumber}t.holders=[a.forename+" "+a.surname];if(a.typeOfDepot==="multi"){t.holders.push(c.forename+" "+c.surname);t.holders.push(a.forename+" "+a.surname+" und "+c.forename+" "+c.surname)}else{t.account.accountHolder=a.forename+" "+a.surname}if(a.country==="AT"){t.account.crs=1}t.getIbanInfo=function(e){t.account.bic="";t.account.bankName="";if(e===undefined||!(e.length===t.ibanMaxLength)||!t.subscriptionAccountForm.subscriptionAccountFIban.$valid&&(t.subscriptionAccountForm.subscriptionAccountFIban.$error.length||t.subscriptionAccountForm.subscriptionAccountFIban.$error.deIban)){return}n.get("Bank_Iban","getFullInfosFromIban",{iban:e}).then(function(e){t.account.bic=e.bicNumber;t.account.bankName=e.bankName;t.account.accountNumber=e.accountNumber;t.account.bankNumber=e.bankNumber;t.subscriptionAccountForm.subscriptionAccountFIban.$setValidity("ibanNotFound",true)}).catch(function(e){if(e.code===50501){t.subscriptionAccountForm.subscriptionAccountFIban.$setValidity("ibanNotFound",false)}t.account.bic=undefined;t.account.bankName=undefined;t.account.accountNumber=undefined;t.account.bankNumber=undefined})};t.$watch("account.iban",function(e,r){if(t.user.country!=="AT"){t.getIbanInfo(e)}});t.convertToIban=function(e,r){n.get("Bank_Iban","getIbanAndBic",{accountNumber:e,bankNumber:r}).then(function(e){t.account.iban=e.iban;t.converterError=false}).catch(function(e){t.converterError=true})};t.goBack=function(){r.saveAccount(t.account);if(t.type==="multi"){e.path(o.PERSONAL_CO_INFOS)}else{e.path(o.PERSONAL_INFOS)}};t.onSubmit=function(){if(t.subscriptionAccountForm.$invalid){u.forceErrorValidation(true);return}t.account.country=t.user.country;if(t.user.country==="AT"&&t.converter){t.account.accountNumber=t.converter.number;t.account.bankNumber=t.converter.bankNumber}t.isSubmitting=true;t.$parent.registerService(r.setAccount(t.account)).then(function(){e.path(o.RECAP)}).finally(function(){t.isSubmitting=false})};t.getPdfUrl=function(){if(i.isPartnerMode()){return"https://dokumente.finanzen-broker.net/f020.1-preis-leistungsverzeichnis-finanzen.net-brokerage-depot.pdf"}return"https://www.onvista-bank.de/files/dokumente/formulare/formularcenter/020.1-5EUR-festpreis-preis-leistungsverzeichnis.pdf"}}]);e.controller("BankSubscribeRecapController",["$scope","$rootScope","$location","BankSubscribeProspectService","BANK_SUBSCRIBE_ROUTES","brsValidationRealtimeErrorHandler","brsAppConfig",function(r,t,n,o,s,e,i){var u=new e(r,"finalSubscriptionForm","hasError");r.user=o.getUser();r.coUser=o.getCoUser();r.account=o.getAccount();r.depotName=o.getDepotName();r.paperless=r.user.typeOfDepot!=="multi"&&r.user.country==="DE"&&(r.user.differingCountry===undefined||r.user.differingCountry===""||r.user.differingCountry==="DE")&&r.user.nationality==="DE"&&r.account.crs==0;r.countries=o.getCountries();angular.forEach(r.countries,function(e){if(r.user.countryOfBirth==e.countryIsoCode){r.user.countryOfBirthName=e.countryName}if(r.coUser&&r.coUser.countryOfBirth==e.countryIsoCode){r.coUser.countryOfBirthName=e.countryName}if(r.user.nationality==e.countryIsoCode){r.user.nationalityName=e.countryName}if(r.coUser&&r.coUser.nationality==e.countryIsoCode){r.coUser.nationalityName=e.countryName}});r.user.occupationalCategory=a(r.user.occupationalCategory);if(r.user.typeOfDepot==="multi"){r.coUser.occupationalCategory=a(r.coUser.occupationalCategory)}r.onSubmit=function(e){if(r.finalSubscriptionForm.$invalid){u.forceErrorValidation(true);return}r.isSubmitting=true;r.$parent.registerService(o.finish(e,r.paperless)).then(function(e){if(!e){n.path(s.ERROR_PAGE)}else{t.caseId1=e.caseId1;t.caseId2=e.caseId2;n.path(s.THANK_YOU_PAGE)}}).finally(function(){r.isSubmitting=false})};function a(e){var r=o.getOccupationalCategory();for(var t=0;t<r.length;t++){if(r[t].occupationalCategoryCode==e){return r[t].occupationalCategoryLabelDecoded}}return""}r.goBack=function(){n.path(s.EXTERNAL_ACCOUNT)}}]);e.controller("BankSubscribeThankYouController",["$scope","$rootScope","$window","BankSubscribeProspectService","brsUiModal","brsAppVersion","$cookieStore","BRS_API_ENDPOINT","$templateRequest","brsAppConfig",function(r,e,t,n,o,s,i,u,a,c){r.user=n.getUser();r.coUser=n.getCoUser();r.account=n.getAccount();r.paperless=r.user.typeOfDepot!=="multi"&&r.user.country==="DE"&&(r.user.differingCountry===undefined||r.user.differingCountry===""||r.user.differingCountry==="DE")&&r.user.nationality==="DE"&&r.account.crs==0;r.crmId=n.getCrmId();var p=n.getUrlSource();dataLayer.push({order_id:r.crmId});dataLayer.push({event:"order_id_is_set"});if(p!==""){a(p).then(function(e){$("body").append(e.replace(/\%id\%/g,r.crmId))})}}]);e.controller("BankSubscribeConfirmationController",["$scope","$rootScope","brsRouteParams","$window","BankSubscribeProspectService","brsUiModal","brsAppVersion","$cookieStore","BRS_API_ENDPOINT","$templateRequest","brsAppConfig",function(r,t,e,n,o,s,i,u,a,c,p){if(t.isPaperless===undefined||t.caseId===undefined){var l=e();var f=l.k;o.getPaperlessInfoForUser(f).then(function(e){t.isPaperless=e.isPaperless;t.caseId=e.caseId})}r.onSubmit=function(){r.isSubmitting=true;var e=window.BRS_CONFIG.POSTIDENT_URL+"?vorgangsnummer="+t.caseId;n.open(e,"_blank")}}]);e.controller("BankSubscribeConfirmationExpiredController",["$scope","$rootScope","$window","BankSubscribeProspectService","brsUiModal","brsAppVersion","$cookieStore","BRS_API_ENDPOINT","$templateRequest","brsAppConfig",function(e,r,t,n,o,s,i,u,a,c){e.partnerMode=c.isPartnerMode()}]);e.controller("BankSubscribeErrorController",["$scope","$rootScope","$window","BankSubscribeProspectService","brsUiModal","brsAppVersion","$cookieStore","BRS_API_ENDPOINT","$templateRequest","brsAppConfig",function(e,r,t,n,o,s,i,u,a,c){e.partnerMode=c.isPartnerMode()}]);e.controller("BankSubscribeFinalController",["$scope","$rootScope","$window","BankSubscribeProspectService","brsUiModal","brsAppVersion","$cookieStore","BRS_API_ENDPOINT","$templateRequest","brsAppConfig",function(r,t,n,e,o,s,i,u,a,c){r.user=e.getUser();r.coUser=e.getCoUser();r.account=e.getAccount();r.crmId=e.getCrmId();r.sendToCrm=true;r.isGerman=r.user.country!=="AT";if(!c.isMobile()){var p=document.createElement("iframe");document.body.appendChild(p);p.style.display="none"}if(c.isPartnerMode()){r.url={depot:"https://dokumente.finanzen-broker.net/f031-depot-uebertrag.pdf",exemption_order:"https://dokumente.finanzen-broker.net/f032-freistellungsauftrag.pdf"}}else{r.url={depot:"https://www.onvista-bank.de/files/dokumente/formulare/formularcenter/031-depot-uebertrag.pdf",exemption_order:"https://www.onvista-bank.de/files/dokumente/formulare/formularcenter/032-freistellungsauftrag.pdf"}}var l=e.getUrlSource();dataLayer.push({order_id:r.crmId});dataLayer.push({event:"order_id_is_set"});if(l!==""){a(l).then(function(e){$("body").append(e.replace(/\%id\%/g,r.crmId))})}r.disableSendToCrm=function(){r.sendToCrm=false};if(!t.caseId1){t.caseId1=i.get("prospectCaseId")}else{i.put("prospectCaseId",t.caseId1)}r.onSubmit=function(){r.isSubmitting=true;var e=window.BRS_CONFIG.POSTIDENT_URL+"?vorgangsnummer="+t.caseId1;n.open(e,"_blank")};var f=Math.round(Math.random()*1e10)}]);e.controller("BankSubscribeFinalMailController",["$scope","$window","BankSubscribeProspectService","$cookieStore","BRS_API_ENDPOINT","$templateRequest","brsAppConfig",function(r,e,t,n,o,s,i){r.user=t.getUser();r.coUser=t.getCoUser();r.crmId=t.getCrmId();r.isGerman=r.user.country!=="AT";if(i.isPartnerMode()){r.url={depot:"https://dokumente.finanzen-broker.net/f031-depot-uebertrag.pdf",exemption_order:"https://dokumente.finanzen-broker.net/f032-freistellungsauftrag.pdf"}}else{r.url={depot:"https://www.onvista-bank.de/files/dokumente/formulare/formularcenter/031-depot-uebertrag.pdf",exemption_order:"https://www.onvista-bank.de/files/dokumente/formulare/formularcenter/032-freistellungsauftrag.pdf"}}var u=t.getUrlSource();dataLayer.push({order_id:r.crmId});dataLayer.push({event:"order_id_is_set"});if(u!==""){s(u).then(function(e){$("body").append(e.replace(/\%id\%/g,r.crmId))})}var a=Math.round(Math.random()*1e10)}])})(); "use strict";var m=angular.module("bank-subscribe");m.directive("brsBankSubscribeUserInfos",["brsAppVersion",function(r){return{restrict:"E",replace:true,templateUrl:r.getUrl("app/bank-subscribe/templates/user-infos.html"),scope:{user:"=brsAttrUser",type:"=brsAttrType"}}}]);m.directive("brsBankSubscribeNoUsaCountries",function(){function s(r){var t=["AS","GU","MP","PR","UM","US","VI"];for(var e=0;e<t.length;e++){if(r===t[e]){return true}}return false}return{require:"ngModel",link:function(r,t,e,n){n.$parsers.push(function(r){var t=!s(r);n.$setValidity("isUsaCountry",t);return t?r:undefined});n.$formatters.unshift(function(r){n.$setValidity("isUsaCountry",!s(r));return r})}}});m.directive("bankSubscribeTooltip",["$timeout","brsAppVersion",function(r,t){return{restrict:"AE",templateUrl:t.getUrl("app/bank-subscribe/templates/tooltip.html"),transclude:true,link:function(r,t,e){e.$addClass("infoLayer");t.ovbInfoLayer()}}}]);m.directive("bankSubscribeIsUsAccount",function(){return{restrict:"A",require:"ngModel",link:function(r,t,e,n){function s(r){if(r==="ja"){n.$setValidity("isUsAccount",false);return r}n.$setValidity("isUsAccount",true);return r}n.$parsers.unshift(s);n.$formatters.unshift(s)}}}); "use strict";(function(){var e=angular.module("bank-subscribe");e.service("BankSubscribeProspectService",["brsApiClient","$cookieStore","$filter","$q","$log","brsRouteParams","brsAppVersion","brsAppConfig",function(o,c,t,a,e,s,r,i){e=e.getInstance("BankSubscribeProspectService");var n={Fondsdepot_FreeBuy_Cash:{label:"Fondsdepot",name:"Fondsdepot"},Aktion_FreeBuy_Cash:{label:"FreeBuy Cash",name:"FreeBuy Cash"},Aktion_CFD:{label:"FreeBuy Cash",name:"CFD"},Aktion_FreeBuy_Cash_Festpreis:{label:"FreeBuy Cash Festpreis",name:"FreeBuy Cash Festpreis"},Aktion_Jubilaeum:{label:"Jubilaeumsangebot",name:"Jubilaeum"},marktindex:{label:"marktindex",name:"marktindex"},Aktion_5EURFestpreis:{label:"5EUR-Festpreis",name:"5EUR-Festpreis"},Aktion_PremiumPlusPartner:{label:"5EUR-Festpreis",name:"Premium Plus Partner"},Aktion_EuroAkademie:{name:"FreeBuy Cash",label:"FreeBuy Cash"},Aktion_FinanzenBroker:{name:"Finanzen Broker",label:"finanzen.net Brokerage"},Aktion_5EURFestpreis_Zinsen:{name:"5EUR-Festpreis",label:"5EUR-Festpreis"},Aktion_FreeBuy_Festpreis_Zinsen:{name:"FreeBuy Cash Festpreis",label:"FreeBuy Cash Festpreis"},Aktion_FinanzenBrokerTraderfox:{name:"Finanzen Broker",label:"finanzen.net Brokerage"},Aktion_FinanzenBroker_AT:{name:"Finanzen Broker",label:"finanzen.net Brokerage"},Aktion_FinanzenBrokerBild:{name:"Finanzen Broker",label:"finanzen.net Brokerage"},Aktion_1EURFestpreis:{label:"5EUR-Festpreis",name:"1EUR-Festpreis"},Aktion_1EURFestpreis_FinanzenBroker:{label:"finanzen.net Brokerage",name:"1EUR-Finanzen-Broker.net"}},u={},l={user:null,coUser:null,account:null,id:null,incc:"",uatcct:"",crmId:"",coCrmId:"",existingContact:false},p={countries:[],occupationalCategory:[],titles:[]};this.checkEmailValidity=function(e){var t=o.get("Bank_Prospect","checkEmailDoubleOptin",{userKey:e}).then(function(e){return e}).catch(function(e){console.error(e);return false});return t};this.getPaperlessInfoForUser=function(e){var t=o.get("Bank_Prospect","getPaperlessInfoForUser",{userKey:e}).then(function(e){return e}).catch(function(e){console.error(e);return false});return t};this.loadProspect=function(e){if(l.id!==null&&!e){var t=a.defer();t.resolve(true);return t.promise}l.id=c.get("prospectId");var n;if(l.id===undefined||e){n=o.get("Bank_Prospect","start").then(function(e){l.id=e.prospectId;c.put("prospectId",l.id);l.user=null;l.coUser=null;l.account=null})}else{n=o.get("Bank_Prospect","getProspect",{prospectId:l.id}).then(function(e){l.user=e.prospect.user;l.coUser=e.prospect.coUser;l.account=e.prospect.account;l.crmId=e.prospect.crmId;if(l.account!==null){l.account.isUsAccount=false;l.account.chk=true;l.account.chk2=true}})}var r=s(),i=o.get("Bank_Prospect","setAffiliateData",{incc:r.incc||"",uacct:r.uacct||"",uacctNumber:r.pr||""}).then(function(e){l.uacct=e.uacct;l.incc=e.incc});return a.all([n,i])};this.init=function(){if(p.countries.length>0&&p.occupationalCategory.length>0&&p.titles.length>0){var e=a.defer();e.resolve(true);return e.promise}var t=o.get("Customer_options","getUniqCountries").then(function(e){p.countries=e.countries});var n=o.get("Customer_options","getOccupationalCategoriesOptions").then(function(e){p.occupationalCategory=e.occupationalCategories});var r=o.get("Customer_options","getTitleOptions").then(function(e){p.titles=e.titleOptions});return a.all(t,n,r)};this.setUser=function(n){var e=angular.copy(n);e.title=t("capitalize")(e.title);e.prospectId=l.id;e.isMobile=i.isMobile();return o.get("Bank_Prospect","setUser",e).then(function(e){var t=n.isCoUser?"coUser":"user";l[t]=angular.copy(n);if(t=="user"){l.crmId=e.crmId}l.coCrmId=e.coCrmId;l.existingContact=e.existingContact;c.put("existingContact",l.existingContact)})};this.setAccount=function(e){var t=angular.copy(e);t.prospectId=l.id;t.partnerCode=i.isPartnerMode()?"1":0;t.existingContact=c.get("existingContact");t.crmProspectId=l.crmId;if(l.coUser&&angular.isDefined(l.coCrmId)){t.multi=true;t.crmCoProspectId=l.coCrmId}else{t.multi=false}return o.get("Bank_Prospect","setExternalAccount",t).then(function(){l.account=angular.copy(e)})};this.saveAccount=function(e){l.account=e};this.getDepotName=function(){if(n[l.incc]===undefined){return""}return n[l.incc].label};this.getTrackingName=function(){if(n[l.incc]===undefined){return""}return n[l.incc].name};this.finish=function(e,t){var n=c.get("existingContact");return o.get("Bank_Prospect","finish",{prospectId:l.id,attachment:e,existingContact:n,paperless:t,incc:l.incc,isPartnerMode:i.isPartnerMode()})};this.sendMail=function(e){return o.get("Bank_Prospect","sendMail",{prospectId:l.id,option:e})};this.getCountries=function(){return p.countries};this.getNationalityCountries=function(){var t=["DE","AT","FR","HU","IE","LU"];var n=[];p.countries.forEach(function(e){if(t.indexOf(e.countryIsoCode)>-1){n.push(e)}});return n};this.getOccupationalCategory=function(){return p.occupationalCategory};this.getTitles=function(){return p.titles};this.getUser=function(){return angular.copy(l.user)};this.getCoUser=function(){return angular.copy(l.coUser)};this.getAccount=function(){return angular.copy(l.account)};this.getIncc=function(){return l.incc};this.getCrmId=function(){return l.crmId};this.debug=function(){e.log(l);e.log(p)};this.getUrlSource=function(){var n="";if(l.uacct!==undefined&&l.uacct!==""){angular.forEach(u,function(e,t){if(l.uacct.toLowerCase()===t.toLowerCase()&&n===""){n=r.getUrl("/app/bank-subscribe/templates/tracking/"+e+".html")}})}return n}}])})(); "use strict";var m=angular.module("brs-api-client",[]);m.provider("brsApiClient",function(){var $log,$rootScope,$q,$timeout,$http,PROFILER;var SPECIAL_CHARS_REGEXP=/([\:\-\_]+(.))/g;function camelCase(e){return e.replace(SPECIAL_CHARS_REGEXP,function(e,r,o,t){return t?o.toUpperCase():o})}function BrsApiService(e,r,o){this.domain=e;this.name=r;this.parameters=o||{}}function BrsApiClient(e,r,o){this.apiKey=e;this.apiEndpoint=r;this.wbsToQueue=o}BrsApiClient.prototype={pollingQueue:[],service:function(domain,service,params){var s,constructor,name=camelCase("Service_"+domain+"_"+service);if(!BrsApiService[name]){eval("constructor = BrsApiService."+name+" = function "+name+"() { BrsApiService.apply(this, arguments); }");constructor.prototype=BrsApiService.prototype}else{constructor=BrsApiService[name]}s=new constructor(domain,service,params);s.deferred=$q.defer();return s},get:function(e,r,o){var r,t,i=this,n=window.BRS_CONFIG.USE_SERVICE_QUEUE!=undefined?window.BRS_CONFIG.USE_SERVICE_QUEUE:false;if(_.contains(this.wbsToQueue,e+"."+r)){n=true}if(!n&&angular.isDefined($rootScope.isMobile)&&$rootScope.isMobile){n=true}r=this.service(e,r,o);t=r.deferred;if(n){if(!this.pollingQueue.length){i.timer=$timeout(function(){var e=i.pollingQueue;i.pollingQueue=[];i.query(e)},25)}if(this.pollingQueue.length==25){$timeout.cancel(i.timer);i.query(i.pollingQueue);i.pollingQueue=[]}else{this.pollingQueue.push(r)}}else{this.pollingQueue.push(r);i.query(i.pollingQueue);i.pollingQueue=[]}return t.promise},query:function(r){var o={},t=[],e,i=0,n=$q.defer(),s=this;o.hash={timestamp:Math.floor((new Date).getTime()/1e3),nonce:"92f4fc28c06101778253aacf1df29e80",device:navigator.userAgent,os:navigator.platform,udid:1,key:this.apiKey,signature:"ODlhOGE1MDA5NzMyNWE4ZDhhODhhNmQ3NTM4NDAxYWMwNTg1M2M5Nw=="};o.action={};r.forEach(function(e,r){if(e.isSent){throw new Error(0,"[BRS-API] Service Object allready sent, you should clone it or provide a new one",{requestObj:request})}else{e.isSent=true}t.push("s"+r+"="+encodeURIComponent(e.domain+"."+e.name));o.action["s"+r]={domain:e.domain,service:e.name,params:e.parameters}});$log.debug("request POST "+this.apiEndpoint);$log.debug.apply(console,r.map(function(e){return[e.domain+"."+e.name,e.parameters]}));$http({method:"POST",url:this.apiEndpoint+"?"+t.join("&"),data:Object.toQueryString(o),withCredentials:true,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(e){s.logDebugProfile(e);s.parseReponse(n,r,e)}).catch(function(e){s.logDebugProfile(e);$log.error("error",e);r.forEach(function(e){e.error={code:1,message:"request queue failed"}})}).finally(function(){r.forEach(function(e){e.error?e.deferred.reject(e):e.deferred.resolve(e)})});r.forEach(function(e){e.deferred.notify({status:"run"})});return n.promise},logDebugProfile:function(e){if(e){$log.log(e.headers("X-Debug-Link"))}},parseReponse:function(e,i,r){var n=r.data,o,t;if(!n||!n["s0"]||n.error){if(n.error){if(n.error.code==111008){$rootScope.$broadcast("strongAuthTokenAltered");return}if(n.error.code==1002){$rootScope.$broadcast("sessionAlteredOrLogoutElsewhere");return}t={code:n.error.code,message:"Response queue error : "+n.error.message,response:r}}else{t={code:1,message:"Response queue error",response:r}}}if(t){e.reject(t);i.forEach(function(e){e.deferred.reject(t)});return}var s=false;Object.keys(n).forEach(function(e,r){var o=i[r],t=n[e];if(o.domain==="Session_Auth"&&o.name==="logout"){s=true}if(!o){$log.error("Invalid service key "+e+" for services",i);return}else if(t.error){$log.error("error "+o.domain+"."+o.name,t.error);o.error=t.error;o.data=false;o.deferred.reject(o.error)}else if(t.result){$log.debug("success "+o.domain+"."+o.name,t);o.deferred.notify({status:"data",data:t.result});o.data=t.result;o.error=false;o.deferred.resolve(o.data)}else{$log.error("Invalid data "+e+" ");o.deferred.reject({code:2,message:"Service has not been populated"})}});if(!s){$rootScope.$broadcast("brsCallSuccess",i)}e.resolve(i)}};this.$get=["BRS_API_ENDPOINT","BRS_API_KEY","WBS_TO_QUEUE","$injector",function(e,r,o,t){var i;$log=t.get("$log");$rootScope=t.get("$rootScope");$q=t.get("$q");$timeout=t.get("$timeout");$http=t.get("$http");PROFILER=t.get("PROFILER");$log=$log.getInstance("brsApiClient");if(this.api){return this.api}this.api=i=new BrsApiClient(r,e,o);return this.api}];Object.toQueryString=function(e,i){var n=[];angular.forEach(e,function(e,r){var o;if(i){r=i+"["+r+"]"}switch(typeof e){case"object":o=Object.toQueryString(e,r);break;case"array":var t={};e.forEach(function(e,r){t[r]=e});o=Object.toQueryString(t,r);break;default:o=r+"="+encodeURIComponent(e)}if(e!=null){n.push(o)}});return n.join("&")}}); var m=angular.module("brs-streaming-client",["brs-api-client","auth-login","auth-user"]);m.provider("brsStreamingClient",function(){this.$get=function(){return{start:function(n,e,t){$.feedStreaming({login:e,password:t,uri:n})},stop:function(){$.feedStreaming("stop")},isRunning:function(){$.feedStreaming("connected")},register:function(n){$.feedStreaming("register",n)}}}});m.run(["$rootScope","brsStreamingClient","authUser",function(n,e,t){}]); "use strict";var m=angular.module("brs-app",[]);m.controller("BrsAppController",["$scope","brsAppAlerts",function(r,l){r.alerts=l}]); "use strict";var m=angular.module("brs-app");m.service("brsAppAlerts",["BrsUiAlert",function(r){return new r}]); "use strict";var m=angular.module("brs-app-version",[]);m.provider("brsAppVersion",["BRS_MOBILE_TEMPLATE_WHITELIST","brsAppConfigProvider",function(s,t){var n="?v="+window.BRS_APP_VERSION;var e=function(i){var e=t.isMobile()?"mobile/":"";var r=s.indexOf(i)>-1;if(t.isMobile()&&r){i=[i.slice(0,i.indexOf("templates/")+10),e,i.slice(i.indexOf("templates/")+10)].join("")}return i+n};this.$get=["brsAppConfig",function(i){return{stamp:n,isMobile:i.isMobile(),getUrl:e}}];this.stamp=n;this.getUrl=e}]); "use strict";var m=angular.module("brs-app");m.provider("brsAppConfig",[function(){var r=window.BRS_CONFIG;var t=function(){return this.raw.PARTNER_MODE};var i=function(){return this.raw.IS_MOBILE};var n=function(){return this.raw.POSTIDENT_URL};this.$get=function(){return{raw:r,isPartnerMode:t,isMobile:i}};this.raw=r;this.isPartnerMode=t;this.isMobile=i;this.postIdentUrl=n}]); "use strict";var m=angular.module("brs-browser-detect",[]);m.directive("brsBrowserDetect",["$rootScope",function(a){return{restrict:"A",link:function(e,i,r){var f=navigator.userAgent||navigator.vendor||window.opera,n=navigator.platform,o="",s="";if(f.indexOf("Firefox/3")!=-1){o="ff3"}else if(f.indexOf("Firefox")!=-1){o="ff"}else if(f.indexOf("rv:11.0")!=-1){o="ie11"}else if(f.indexOf("MSIE 10.0")!=-1){o="ie10"}else if(f.indexOf("MSIE 9.0")!=-1){o="ie9"}else if(f.indexOf("MSIE 8.0")!=-1){o="ie8"}else if(f.indexOf("Opera")!=-1){o="opera"}else if(f.indexOf("Chrome")!=-1||f.indexOf("CriOS")!=-1){o="chrome"}else if(f.indexOf("Safari")!=-1){o="safari"}else{o="unknown-client"}$("body").addClass(o);a.browser=o;a.os=n;a.isMobile=/iPhone|iPod|iPad|Silk|Android|BlackBerry|Opera Mini|IEMobile/.test(f)}}}]); "use strict";var m=angular.module("brs-compile",[]);m.service("brsCompile",["$templateRequest","$compile","$log","brsAppVersion",function(e,n,i,o){this.template=function(r,t){return e(o.getUrl(t)).then(function(t){var e=n(t);return e(r)}).catch(function(t){i.error(t)})};this.html=function(t,e){var r=n(e);return r(t)}}]); "use strict";var m=angular.module("brs-confirm",["brs-ui-modal"]);m.service("brsConfirm",["brsUiModal","brsAppVersion",function(s,a){return function(r,e,n,t){return s.open(s.getConfig("draggable","lg",{templateUrl:a.getUrl("/app/brs-confirm/templates/confirm.html"),controller:["$scope","$modalInstance","params",o],resolve:{params:function(){return{title:r,message:e,confirmText:n||"Andauern",cancelText:t||"Abbrechen"}}}})).result;function o(r,e,n){r.params=n;r.cancel=function(){e.dismiss("refused")};r.confirm=function(){e.close("understood")}}}}]);m.service("brsAlert",["brsUiModal","brsAppVersion",function(o,s){return function(r,e,n){return o.open(o.getConfig("draggable","md",{templateUrl:s.getUrl("/app/brs-confirm/templates/confirm.html"),controller:["$scope","$modalInstance","params",t],resolve:{params:function(){return{title:r,message:e,confirmText:n||"Ok"}}}})).result;function t(r,e,n){r.params=n;r.confirm=function(){e.close("understood")}}}}]); "use strict";var m=angular.module("brs-date",[]);m.constant("brsDateMonthArray",[{key:"01",value:"Januar"},{key:"02",value:"Februar"},{key:"03",value:"MÃ€rz"},{key:"04",value:"April"},{key:"05",value:"Mai"},{key:"06",value:"Juni"},{key:"07",value:"Juli"},{key:"08",value:"August"},{key:"09",value:"September"},{key:"10",value:"Oktober"},{key:"11",value:"November"},{key:"12",value:"Dezember"}]); "use strict";var m=angular.module("brs-date",[]);m.service("brsDate",["$filter","$moment",function(r,a){this.formatToString=function(e,t){if(t===true){return r("date")(e,"yyyy-MM-dd HH:mm:ss")}return r("date")(e,"yyyy-MM-dd")+" 00:00:00"};this.addOpenDays=function(e,t){e=a(e);while(t>0){e=e.add(1,"days");if(e.isoWeekday()!==6&&e.isoWeekday()!==7){t-=1}}return e.toDate()}}]); "use strict";var m=angular.module("brs-filter-date",[]);m.filter("brsFilterDate",["$filter",function(a){return function(e,r){var t=r?r:"dd.MM.yy";if(e=="0000-00-00 00:00:00"){e="-"}else if(e==undefined||e==""){return e}else if(e instanceof Date){return a("date")(e,t)}else{var n=new Date(e.replace(/-/g,"/"));return a("date")(n,t)}return e}}]); "use strict";var m=angular.module("brs-filter-text",[]);m.filter("capitalize",function(){return function(r){if(r===null||r===undefined){return""}r=r.toLowerCase();return r.substring(0,1).toUpperCase()+r.substring(1)}});m.filter("ellipsis",function(){return function(r,e){if(r.length>e){return r.substr(0,e)+"..."}return r}});m.filter("nl2br",function(){return function(r){if(angular.isDefined(r)){return r.replace(/\n/g,"<br/>")}else{return""}}});m.filter("br2nl",function(){return function(r){if(angular.isDefined(r)){return r.replace(/<br.*?>/g,"\n")}else{return""}}});m.filter("br2space",function(){return function(r){if(angular.isDefined(r)){return r.replace(/<br\/>|<br \/>|<br>/g," ")}else{return""}}});m.filter("htmlTags2space",function(){return function(r){if(angular.isDefined(r)){return r.replace(/<[^>]+>/gm," ")}else{return""}}});m.filter("stripTags",function(){return function(r,n){if(angular.isDefined(r)){n=(((n||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var e=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,t=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return r.replace(t,"").replace(e,function(r,e){return n.indexOf("<"+e.toLowerCase()+">")>-1?r:""})}else{return""}}}); "use strict";var m=angular.module("brs-filter-object-length",[]);m.filter("brsFilterObjectLength",function(){return function(e){if(angular.isObject(e)){return Object.keys(e).length}else{return false}}}); "use strict";var m=angular.module("brs-format");m.directive("brsFormatDate",["$filter",function(u){return{restrict:"A",require:"ngModel",link:function(r,t,e,n){n.$formatters.push(function(r){return u("date")(r,e.brsFormatDate)});n.$parsers.push(function(){})}}}]); "use strict";var m=angular.module("brs-format",[]);m.filter("brsFormatCurrency",["$filter",function(c){return function(r,e,i,n){if(angular.isUndefined(i)||i==null){i="EUR"}if(angular.isUndefined(n)){n="-"}if(i=="EUR"){i="â?¬"}else if(i=="USD"){i="$"}else if(i=="PCT"){i="%"}if(angular.isUndefined(e)||e<2){e=2}if(e==4&&i!="$"){e=3}var t="";if(angular.isDefined(r)&&r!=null&&!isNaN(r)){t=c("currency")(r,i,e);if(t.split(",")[1].replace(/^\s+|\s+$/g,"").split(/\s+/)[0].length>2&&t.split(",")[1].replace(/^\s+|\s+$/g,"").split(/\s+/)[0].slice(-1)=="0"){var a=t.split(","),l=a[1].replace(/^\s+|\s+$/g,"").split(/\s+/),f=l[1],s=l[0],u=a[0];if(s.slice(-1)=="0"){s=s.substr(0,s.length-1)}t=u+","+s+" "+f}}if(t==""){t=n}return t}}]);m.filter("brsFormatNumber",["$filter",function(l){return function(r,e,i){i=angular.isDefined(i)?i:true;if(angular.isUndefined(e)){e=3}var n=l("number")(r,e);if(n==""||n===undefined){return"-"}if(i){return n}var t=n.split(",");var a=t[1].replace(/0*$/g,"");n=t[0];if(a.length>0){n+=","+a}return n}}]);m.filter("brsFormatQuantity",["$filter",function(e){return function(r){return e("brsFormatNumber")(r,4,false)}}]);m.filter("brsFormatIban",function(){return function(r,e){var i=/[^a-zA-Z0-9]/g,n=/(.{4})(?!$)/g,t="";e=angular.isDefined(e)?e:" ";t=r.replace(i,"").toUpperCase();return t.replace(n,"$1"+e)}}); "use strict";var m=angular.module("brs-growl",[]);m.service("brsGrowl",function(){this.fire=function(a,e){var l=['<div data-growl="container" class="alert ','" role="alert" style="max-width: 300px;"','><button type="button" class="close" data-growl="dismiss"><span aria-hidden="true">Ã?</span><span class="sr-only">SchlieÃ?en</span></button>','<span data-growl="icon"></span><span data-growl="title"></span><br><span data-growl="message"></span>','<a href="#" data-growl="url"></a></div>'],t={},n={icon_type:"class",type:"info",allow_dismiss:true,mouse_over:"pause",placement:{from:"bottom",align:"right"},template:l[0]+l[1]+l[2]+l[3]+l[4]};angular.extend(t,a);angular.extend(n,e);if(angular.isDefined(t.onclick)&&t.onclick!==""){n.template=l[0]+l[1]+l[2]+'<div class="growlClickAction" onclick="'+t.onclick+'">'+l[3]+"</div>"+l[4];delete t["onclick"]}return $.growl(t,n)}}); "use strict";var m=angular.module("brs-route-params");m.value("getParamToExcludeForRedirect",["showLoginForm"]);m.service("brsGetQueryBuilder",["$filter",function(r){return function(e){var t="";if(angular.isDefined(e)&&angular.isObject(e)&&!angular.isArray(e)&&r("brsFilterObjectLength")(e)>0){t="?";angular.forEach(e,function(e,r){if(t.length>1){t+="&"}t+=r+"="+e})}return t}}]);m.service("brsGetQueryRedirect",["getParamToExcludeForRedirect","brsGetQueryBuilder","$filter","brsRouteParams",function(t,i,n,a){return function(e){var r=a();if(angular.isDefined(r)&&angular.isObject(r)&&!angular.isArray(r)&&n("brsFilterObjectLength")(r)>0){r=_.omit(r,t);if(n("brsFilterObjectLength")(r)>0){if(e){return i(r)}else{return r}}else{return{}}}else{return{}}}}]);m.service("brsRouteParams",["$location","$routeParams",function(r,t){return function(){var e={};if(!r.$$html5){e=window.location.search;if(angular.isDefined(e)&&e.length){if(angular.isDefined(e.split("?")[1])){e=e.split("?")[1].split("&").map(function(e){if(e){return e=e.split("="),this[e[0]]=e[1],this}}.bind({}))[0]}else{e={}}}else{e={}}angular.extend(e,t)}else{e=t}return e}}]); "use strict";(function(){var r=angular.module("brs-routes",[]);r.directive("brsHref",["$injector",function(s){return{link:function(r,e,t,n){var i=t.brsHref.split(".");if(i.length===0){return}var u=s.get(i[0]);for(var f=1;f<i.length;f++){u=u[i[f]]}t.$set("href","/#"+u)}}}])})(); var m=angular.module("brs-ui-alert");m.directive("brsUiAlert",["brsAppVersion",function(e){return{restrict:"E",templateUrl:e.getUrl("/app/brs-ui-alert/templates/alerts-list.html"),scope:{alertList:"=alertList",onClose:"&"},compile:function(e,t){if(t.alertListDisableClose===undefined){e.children().attr("data-close","onClose({ 'name' : alert.uniquName }); alertList.removeAlertByIndex($index)")}}}}]); var m=angular.module("brs-ui-alert",[]);m.factory("BrsUiAlert",["$sce",function(i){function t(){}t.prototype=Object.create(Array.prototype);t.prototype.addAlert=function(t,e,r){var n=e&&e.trim()||"Ein Fehler ist aufgetreten. Bitte versuchen Sie es spÃ€ter noch einmal.";if(!angular.isUndefined(r)){for(var s=0;s<this.length;s++){if(this[s].uniquName===r&&this[s].type===t){this[s].message=i.trustAsHtml(n);return this[s]}}}var o={type:t,message:i.trustAsHtml(n),uniquName:r};this.push(o);return o};t.prototype.danger=function(t,e){return this.addAlert("danger",t,e)};t.prototype.info=function(t,e){return this.addAlert("info",t,e)};t.prototype.warning=function(t,e){return this.addAlert("warning",t,e)};t.prototype.success=function(t,e){return this.addAlert("success",t,e)};t.prototype.clean=function(){while(this.length>0){this.pop()}};t.prototype.clear=function(){this.clean()};t.prototype.getAlerts=function(){return this};t.prototype.removeAlertByIndex=function(t){this.splice(t,1)};t.prototype.removeAlert=function(t){for(var e=0;e<this.length;e++){if(this[e]===t){this.removeAlertByIndex(e);break}}};t.prototype.removeAlertsByType=function(t){for(var e=this.length-1;e>=0;e--){if(this[e].type===t){this.splice(e,1)}}};t.prototype.removeAlertsByUniquName=function(t){for(var e=this.length-1;e>=0;e--){if(this[e].uniquName===t){this.splice(e,1)}}};t.prototype.hasAlertsByType=function(t){for(var e=0;e<this.length;e++){if(this[e].type===t){return true}}return false};t.prototype.hasDangerAlerts=function(){return this.hasAlertsByType("danger")};t.prototype.hasWarningAlerts=function(){return this.hasAlertsByType("warning")};t.prototype.hasSuccessAlerts=function(){return this.hasAlertsByType("success")};t.prototype.hasInfoAlerts=function(){return this.hasAlertsByType("info")};t.prototype.removeDangerAlerts=function(){this.removeAlertsByType("danger")};t.prototype.removeWarningAlerts=function(){this.removeAlertsByType("warning")};t.prototype.removeSuccessAlerts=function(){this.removeAlertsByType("success")};t.prototype.removeInfoAlerts=function(){this.removeAlertsByType("info")};return t}]); "use strict";var m=angular.module("brs-ui-atos-details",[]);m.directive("brsUiAtosDetails",["brsAppVersion","$sce","$timeout","$filter",function(s,i,a,n){return{restrict:"A",scope:{config:"=uiConfig",details:"=brsUiAtosDetails"},templateUrl:function(t,e){return s.getUrl("/app/brs-ui-atos-details/templates/atos-details.html")},link:function(t,e,s){t.instantPosTitle=t.config.derivative?"Derivative Instant Position (derivativeListInstantPos Response)":"Instant Position (listInstantPos Response)";t.assetTitle=t.config.derivative?"Derivative Asset (accountDerAssets Response)":"Asset (accountAssets Response)";if(angular.isDefined(t.details.listInstantPosRequest)&&t.details.listInstantPosRequest.length!=0){t.details.listInstantPosRequest=i.trustAsHtml(t.details.listInstantPosRequest.toString())}if(angular.isDefined(t.details.accountAssetsRequest)&&t.details.accountAssetsRequest.length!=0){t.details.accountAssetsRequest=i.trustAsHtml(t.details.accountAssetsRequest.toString())}a(function(){e.find("code").each(function(){$(this).text(n("formatXmlFilter")($(this).text()))})})}}}]);m.service("brsUiAtosDetailsModal",["brsUiModal","brsAppVersion",function(s,i){var a=false;return function(t){if(!a){a=true;var e=s.open(s.getConfig("draggable","lg",{templateUrl:i.getUrl("/app/brs-ui-atos-details/templates/atos-details-modal.html"),controller:"ModalAtosDetailsController",resolve:{params:function(){return{atosDetails:t}}}}));e.result.then(function(){a=false}).catch(function(){a=false})}}}]);m.controller("ModalAtosDetailsController",["$scope","$modalInstance","$sce","$timeout","params",function(t,e,s,i,a){t.details=a.atosDetails;t.cancel=function(){e.dismiss("cancel")}}]);m.directive("brsUiAtosDetailsFormatXml",["brsAppVersion","$sce","$timeout","$filter",function(s,i,a,n){return{restrict:"A",scope:{details:"="},templateUrl:function(t,e){return s.getUrl("/app/brs-ui-atos-details/templates/atos-details-modal-element.html")},link:function(t,e,s){if(angular.isDefined(t.details)&&t.details.length!=0){t.details=i.trustAsHtml(t.details.toString())}a(function(){e.find("code").each(function(){$(this).text(n("formatXmlFilter")($(this).text()))})})}}}]);m.filter("formatXmlFilter",function(){return function(t){var n="";var e=/(>)(<)(\/*)/g;t=t.replace(e,"$1\r\n$2$3");var l=0;jQuery.each(t.split("\r\n"),function(t,e){var s=0;if(e.match(/.+<\/\w[^>]*>$/)){s=0}else if(e.match(/^<\/\w/)){if(l!=0){l-=1}}else if(e.match(/^<\w[^>]*[^\/]>.*$/)){s=1}else{s=0}var i="";for(var a=0;a<l;a++){i+="    "}n+=i+e+"\r\n";l+=s});return n}}); "use strict";var m=angular.module("brs-ui-datepicker",[]);m.directive("brsUiDatepicker",["$filter","$timeout","$moment",function(o,u,d){return{restrict:"A",require:"ngModel",link:function(t,i,e,r){var n={dateFormat:"yy-mm-dd 00:00:00",dayNamesMin:["So","Mo","Di","Mi","Do","Fr","Sa"],dayNames:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],monthNames:["JANUAR","FEBRUAR","MÃ?RZ","APRIL","MAI","JUNI","JULI","AUGUST","SEPTEMBER","OKTOBER","NOVEMBER","DEZEMBER"],showWeek:true,onSelect:function(e){t.$apply(function(){r.$setViewValue(e)});$(this).blur()},beforeShow:function(e,t){setTimeout(function(){$(t.dpDiv).css("z-index",1e4)},0)}};if(t[e.brsUiDatepicker]){t[e.brsUiDatepicker]()}if(angular.isDefined(e.brsUiDatepickerConfig)){angular.extend(n,t[e.brsUiDatepickerConfig])}else{angular.extend(n,t.datePickerConfig)}var a=n.dateFormat.replace(/M/,"MMM").replace(/m/g,"M").replace(/y/g,"yy");r.$formatters.push(function(e){if(e==="9999-12-31 00:00:00")return e;var t=d(e);if(t.isValid()){return o("date")(t.format(),a)}if(e==""){return e}return undefined});r.$parsers.push(function(e){if(/^(\d\d\.){2}(\d\d){2}/.test(e)){var t=e.split(".");e=t[2]+"-"+t[1]+"-"+t[0];return o("date")(e,"yyyy-MM-dd 00:00:00")}if(e==""){return e}return undefined});if(n.showOn=="button"){e.$observe("disabled",function(e){u(function(){i.datepicker("option","disabled",e);i.next("button").attr("disabled",e)},0,false)})}$(function(){i.datepicker(n)})}}}]); "use strict";var m=angular.module("brs-ui-dropdown",[]);m.directive("stayOpen",function(){return{restrict:"A",link:function(n,t,i){t.on("click",function(n){n.stopPropagation()})}}}); "use strict";var m=angular.module("brs-ui-form");m.directive("brsFormTextNumber",function(){return{restrict:"A",require:"ngModel",link:function(e,n,t,r){r.$parsers.push(function(e){if(e!==null&&e!==undefined){return e.replace(/,/g,".")}return e})}}});m.directive("brsFormTextNumberValidator",function(){return{restrict:"A",require:"ngModel",link:function(e,n,t,r){var i=1e6,u=1;if(t.min!=undefined&&t.min!=""){u=parseFloat(t.min)}if(t.max!=undefined&&t.max!=""){i=parseFloat(t.max)}t.$observe("min",function(e){u=parseFloat(e)});t.$observe("max",function(e){i=parseFloat(e)});r.$parsers.push(function(e){if(parseFloat(e)>i){r.$setValidity("max",false)}else{r.$setValidity("max",true)}if(parseFloat(e)<u){r.$setValidity("min",false)}else{r.$setValidity("min",true)}return e});r.$formatters.unshift(function(e){if(parseFloat(e)>i){r.$setValidity("max",false)}else{r.$setValidity("max",true)}if(parseFloat(e)<u){r.$setValidity("min",false)}else{r.$setValidity("min",true)}return e})}}});m.directive("brsTextNumberFloat",function(){return{restrict:"A",require:"ngModel",link:function(e,n,t,r){var i=/^\d+([\.\,]\d+)?$/;r.$parsers.push(function(e){if(e!==null&&e!==undefined&&i.test(e)){return parseFloat(e.replace(/,/g,"."))}return undefined})}}});m.directive("brsRegexInput",function(){return{require:"ngModel",link:function(e,n,u,a){var s=n[0];a.$parsers.push(function(e){var t=new RegExp(u.ngPattern);var n=e.split("").reduce(function(e,n){if(!t.test(n)){return e}else{return e+n}},"");if(n===e){return e}var r=s.selectionStart;var i=s.selectionEnd+n.length-e.length;a.$setViewValue(n);a.$render();s.setSelectionRange(r,i);return n})}}});m.directive("phoneInput",function(){return{require:"ngModel",link:function(e,n,t,u){var a=n[0];function s(e){return e&&e.replace(/[^\d]/g,"")}u.$parsers.push(function(e){var n=s(e),t=typeof n==="undefined"||n.length===0;u.$setValidity("required",t);if(n===e){return e}var r=a.selectionStart;var i=a.selectionEnd+n.length-e.length;u.$setViewValue(n);u.$render();a.setSelectionRange(r,i);return n})}}});m.directive("ibanInput",function(){return{require:"ngModel",link:function(s,e,n,l){var o=e[0],f=s.ibanMaxLength;function c(e){return e&&e.toUpperCase().replace(/[^A-Z\d]/g,"")}function t(e){var n=c(e);var t=typeof n==="undefined"||n.length===0||n.length===f||n.length>f;l.$setValidity("length",t);if(s.user.country&&s.user.country==="DE"||!s.user.country){var r=n&&n.length>=2&&n.substring(0,2)==="DE";l.$setValidity("deIban",r)}if(s.user.country&&s.user.country==="AT"){var i=n&&n.length>=2&&n.substring(0,2)==="AT";l.$setValidity("atIban",i)}if(n===e){if(angular.isDefined(s.getIbanInfo)&&angular.isFunction(s.getIbanInfo)){if(s.user.country!=="AT"){s.getIbanInfo(e)}}return e}var u=o.selectionStart;var a=o.selectionEnd+n.length-e.length;l.$setViewValue(n);l.$render();o.setSelectionRange(u,a);if(angular.isDefined(s.getIbanInfo)&&angular.isFunction(s.getIbanInfo)){if(s.user.country!=="AT"){s.getIbanInfo(n)}}return n}l.$parsers.push(t);l.$formatters.unshift(t)}}}); "use strict";var m=angular.module("brs-ui-form");m.directive("brsUiFormInputValidation",["$timeout",function(l){var u=function(e,s,r,a){var t=a==="blur"?true:r.dirty;if(!r.show){e.$removeClass("has-error");e.$removeClass("has-success");return}if(s.$valid){e.$removeClass("has-error");if(r.showSuccess){e.$addClass("has-success","has-error")}}else{if(s.$invalid&&(r.force||t)){e.$updateClass("has-error","has-success")}else{e.$removeClass("has-error");e.$removeClass("has-success")}}};return{restrict:"A",require:"^form",link:function(e,s,r,a){var t=s[0].querySelector("[name]");var n=angular.element(t);var i=n.attr("name");var o={force:false,show:true,showSuccess:angular.isUndefined(r.showSuccess)?false:true};if(r.brsUiFormInputValidation!==""){e.$watch(r.brsUiFormInputValidation,function(e,s){if(e!==s){o.show=e;u(r,a[i],o,"show-hide")}})}e.$on("show-messages",function(e){o.force=true;u(r,a[i],o,"force-print")});if(n[0].tagName=="SELECT"||n[0].type=="checkbox"){n.bind("change",function(){l(function(){u(r,a[i],o,"blur")})})}else{n.bind("blur",function(){u(r,a[i],o,"blur")});if(!angular.isUndefined(r.showValidationIcon)){r.$addClass("input-with-icon");n.after('<span class="input-icon"></span>')}}}}}]);m.directive("brsFloat",function(){return{require:"ngModel",link:function(e,s,r,a){var t=10,n=2,i=false;if(r.brsFloatLength!=undefined&&r.brsFloatLength>0){t=parseInt(r.brsFloatLength)}if(r.brsFloatDecimals!=undefined&&r.brsFloatDecimals>0){n=parseInt(r.brsFloatDecimals)}i=new RegExp("^\\d+((\\.|\\,)\\d{"+n+"})?$");a.$parsers.unshift(function(e){if(e.length>t){a.$setValidity("maxlength",false);return undefined}else{a.$setValidity("maxlength",true)}if(i.test(e)){a.$setValidity("float",true);return parseFloat(e.replace(",","."))}else{a.$setValidity("float",false);return undefined}})}}}); "use strict";var m=angular.module("brs-ui-form",[]);m.directive("brsUiSelect",["$timeout","brsCompile","$rootScope",function(r,a,f){return{restrict:"A",scope:true,require:"?ngModel",link:function(n,i,e,t){var s=undefined;if(e.brsUiSelectOptions){s=n.$eval(e.brsUiSelectOptions)}if(!angular.isUndefined(e.showLoadingSpinner)){var o=i.parent().attr("class").split(" ");n.classNameToAdd="";for(var l=0;l<o.length;l++){if(o[l].indexOf("custom-select")!=-1){n.classNameToAdd=o[l];break}}n.$watch(e.showLoadingSpinner,function(e,t){if(e!=undefined){n.showLoadingSpinner=e}});a.template(n,"/app/brs-ui-form/templates/select-loading.html").then(function(e){i.parent().parent().append(e)})}s=s||{autoWidth:false,showFirstOption:true};i.selectBoxIt(s);n.$watch(e.ngDisabled,function(e,t){r(function(){i.selectBoxIt("refresh");if(f.isMobile&&e==true){i.selectBoxIt("enable");r(function(){i.selectBoxIt("disable")},300,false)}else if(f.isMobile&&!e){i.selectBoxIt("enable")}},0,false)});if(t!==undefined&&t!==null){t.$formatters.push(function(e){r(function(){i.selectBoxIt("refresh")},0,false);return e})}n.$watchCollection(e.brsUiSelect,function(e){if(e!==undefined){r(function(){i.selectBoxIt("refresh")},0,false)}});if(e.brsUiSelectDefaultOption!=undefined&&e.brsUiSelectDefaultOption){r(function(){i.selectBoxIt("refresh")},0,false)}}}}]); "use strict";var m=angular.module("brs-ui-form",[]);m.directive("brsUiFocus",[function(){return{restrict:"A",link:function(r,i,u){$(i).focus()}}}]); "use strict";var m=angular.module("brs-ui-form",[]);m.directive("brsUiFocusOn",[function(){return function(n,i,o){n.$on("focusOn",function(n,u){if(u===o.brsUiFocusOn){i[0].focus()}})}}]); (function(){"use strict";angular.module("brs-ui-form").directive("placeholder",["$timeout",function(d){return function(e,s,t){var i={cssClass:"placeholder",excludedAttrs:["placeholder","name","id","ng-model","type"]},n=t.placeholder,l=t.type==="password",a="placeholder"in document.createElement("input")&&"placeholder"in document.createElement("textarea"),c,r,o,u;if(a)return;o=function(){var n={};$.each(t.$attr,function(e,s){if(!~$.inArray(s,i.excludedAttrs)){n[s]=t[s]}});return n};var f=function(){return $("<input>",$.extend(o(),{type:"text",value:n})).addClass(i.cssClass).bind("focus",function(){r()}).insertBefore(s)};if(l){u=f();c=function(){if(!s.val()){u.show();s.hide()}};r=function(){if(u.is(":visible")){u.hide();s.show().focus()}}}else{c=function(){if(!s.val()){s.val(n);d(function(){s.addClass(i.cssClass)},0)}};r=function(){if(s.hasClass(i.cssClass)){s.val("").select();s.removeClass(i.cssClass)}}}s.on("focus",r).on("blur",c);d(function(){s.trigger("blur")},0);e.$watch(t.ngModel,function(e){if(e==""){if(!s.is(":focus")){s.trigger("blur")}}else{if(s.hasClass(i.cssClass)){s.removeClass(i.cssClass)}}})}}])})(); "use strict";var m=angular.module("brs-ui-grid-block");m.service("brsUiGridBlock",function(){this.retrieveBlockName=function(r){var i=r.closest(".box-body").attr("id");i=i.replace("brs-ui-grid-block-","");return i}}); "use strict";var m=angular.module("brs-ui-grid-block",[]);m.directive("brsUiGridBlock",["$log","$timeout","bankAccountsCurrentAccount","brsPrint","brsAppVersion","authUser","$window","$moment","brsAppConfig",function(i,r,u,s,e,l,n,c,d){i=i.getInstance("brsUiGridBlock");return{restrict:"EA",transclude:true,require:"^brsUiGridItem",templateUrl:e.getUrl("/app/brs-ui-grid-block/templates/block.html"),scope:{onRefresh:"&",onClose:"&",onMessage:"&",onPrint:"&",onCsv:"&",onPdf:"&",disableExport:"="},link:function(o,n,e,t,a){o.blockTitle=e.blockTitle;o.show={refresh:e.onRefresh!==undefined,print:e.onPrint!==undefined,csv:e.onCsv!==undefined,pdf:e.onPdf!==undefined};o.allow={cfd:angular.isUndefined(e.allowCfd)?false:true};o.remove=function(){t.removeBlock();o.onClose()};o.getBlockLabel=function(){return t.getBlockLabel()};o.getBlockName=function(){return t.getBlockName()};o.doPrint=function(){s.block(o.getBlockName())};o.exportCsv=function(){var e=o.onCsv();var n=e.data;if(angular.isArray(n)){var t=o.getBlockLabel()+(e.subTitle?" - "+e.subTitle:"")+"\n";t+="Shortcode;"+u.accountNumber+"\n";t+="User;"+l.d.login+"\n";t+="Datum;"+c().format("DD.MM.YY HH:mm:ss")+"\n";t+="\n";angular.forEach(n,function(e){t+=e.join(";")+"\n"});var a={"\\Ã?":"ss","\\Ã©":"e","\\Ãš":"e","\\Ã?":"oe","\\Ã¶":"oe","\\Ã?":"ae","\\Ã€":"ae","\\Ã?":"ue","\\ÃŒ":"ue","\\â?¬":"EUR","\\$":"USD","\\u00A0":" "};angular.forEach(a,function(e,n){t=t.replace(new RegExp(n,"gi"),e)});saveTextAs(t,o.getBlockLabel().replace(/ /g,"_")+c().format("_DDMMYY_HHmm")+".csv","UTF-8")}};o.exportPdf=function(){var e=o.onPdf();var n=e.data;if(!angular.isArray(n)||n.length<=0){return false}if(angular.isArray(n)){var t="";angular.forEach(n,function(e,n){if(n>=1){t+="\n"}t+=e.join(";")});var a=angular.element('<form action="/services/api/pdf-generation.phtml?name='+o.getBlockName()+'" method="POST" id="brs-ui-grid-block-pdf">'+'<input type="hidden" name="data"></input>'+'<input type="hidden" name="subTitle"></input>'+'<input type="hidden" name="p"></input>'+'<input type="hidden" name="accountKey" value="'+u.accountKey+'"></input>'+"</form>");a.find('input[name="data"]').val(t);a.find('input[name="p"]').val(d.isPartnerMode());a.find('input[name="subTitle"]').val(e.subTitle||"");$("body").append(a);a.submit();a.remove()}};o.account=u;o.$on("brs-ui-grid-desktop:"+t.getBlockName(),function(e,n){i.info("The block "+t.getBlockName()+" receive the message: "+n);o.onMessage({message:n})});if(angular.isDefined(t.getBlockMessage())){r(function(){o.onMessage({message:t.getBlockMessage()})})}a(o.$parent,function(e){n.find(".brs-ui-grid-block-content").append(e)})}}}]); "use strict";var m=angular.module("brs-ui-grid-gridster",[]);m.directive("brsUiGridGridster",["brsUiGridDesktop","$rootScope","brsAppVersion","brsAppConfig",function(t,i,e,n){return{restrict:"E",templateUrl:e.getUrl("/app/brs-ui-grid-gridster/templates/gridster.html"),controller:["$scope",function(e){var r=n.isMobile();e.gridsterOpts={columns:3,margins:[8,8],outerMargin:false,minColumn:3,pushing:true,floating:true,rowHeight:42,isMobile:r,mobileModeEnabled:r,draggable:{enabled:true,handle:".btn-icon.btn-move",stop:function(){t.saveCurrentDesktop()}},resizable:{enabled:false,handles:"n, e, s, w, se, sw"}};e.customItems=t.getAllBlocks();e.rootScope=i}]}}]);m.directive("brsUiGridGridsterItem",["$timeout",function(o){return{restrict:"A",link:function(r,e,t){var i=null;r.$watch(n,function(e,r){if(e!==undefined){if(i===null){i=o(s,100)}}});function n(){return e.height()}function s(){var e=Math.floor((n()+12)/42)+1;r.item.sizeY=e;i=null}}}}]); "use strict";var m=angular.module("brs-ui-grid-send-to",["brs-ui-grid"]);m.value("brsUiGridDefaultSendToBlocks",[]);m.directive("brsUiGridSendTo",["brsUiGridDesktop","brsUiGridBlockConfig","brsUiGridDefaultSendToBlocks","$filter","$parse","brsAppVersion",function(i,o,a,f,c,e){return{restrict:"A",scope:true,require:"^brsUiGridItem",templateUrl:e.getUrl("/app/brs-ui-grid-send-to/templates/send-to-link.html"),link:function(l,e,t,r){l.filteredBlocks=[];l.params=["isin","wkn","mne","exchange"];var s=r.getBlockName();l.$watchCollection(n,function(e){if(e!==undefined){var i=angular.copy(a);l.filteredBlocks=[];angular.forEach(e,function(r){var n=false,a;if(r.config.name===s){return}angular.forEach(r.config.parameters,function(e){if(!angular.isUndefined(t[e])&&!n){l.filteredBlocks.push({name:r.config.name,label:r.config.label});n=true;a=i.indexOf(r.config.name);if(a!==-1){i.splice(a,1)}}})});angular.forEach(i,function(e){var r=o.get(e);var n=false;if(r.name===s){return}angular.forEach(r.parameters,function(e){if(!angular.isUndefined(t[e])&&!n){l.filteredBlocks.push({name:r.name,label:r.label});n=true}})});l.filteredBlocks=f("orderBy")(l.filteredBlocks,"+label")}});function n(){return i.getAllBlocks()}l.sendTo=function(e){var r=o.get(e);var n={};for(var a=0;a<l.params.length;a++){if(t[l.params[a]]!==undefined){n[l.params[a]]=c(t[l.params[a]])(l)}}i.sendMessage(e,n)}}}}]); "use strict";var m=angular.module("brs-ui-grid");m.value("brsUiGridDesktopDefault",[]);m.value("brsUiGridDesktopUrlConversion",{});m.value("brsUiGridDesktopUrlParams",[]);m.value("brsUiGridDesktopMobileWhitelist",["financial-overview","trading-order","trading-order-book","bank-konto","trading-watchlist"]);m.service("brsUiGridDesktop",["$log","$timeout","$cookieStore","$rootScope","$filter","brsUiGrid","customerDesktopGetAll","customerDesktopSet","brsAppAlerts","brsUiGridDesktopDefault","brsUiGridDesktopUrlConversion","brsUiGridDesktopUrlParams","brsRouteParams","brsAppConfig","brsUiGridDesktopMobileWhitelist","$location","$anchorScroll",function(t,n,l,r,i,e,s,o,a,u,c,d,f,k,h,g,p){t=t.getInstance("brsUiGridDesktop");var b=this,v=-1,D=null,m=new e,B=null;this.getDesktopNumber=function(){return v};this.setDesktop=function(e){if(D===null||v>=D.length){return false}v=e;m.clear();a.clean();if(k.isMobile()){if(D[e].length===0){this.addBlock("financial-overview")}}for(var t=0;t<D[e].length;t++){var r=D[e][t];m.addBlock(r.name,r.row,r.col)}l.put("OVBDesktopNumber",e)};this.saveCurrentDesktop=function(){if(v===-1||v>=D.length){return false}if(B!==null){n.cancel(B);B=null}B=n(function(){var e=m.formatToWbsArray();e=i("orderBy")(e,"row");D[v]=e;o(e,v).then(function(){t.info("The desktop has been correctly saved.")})},500,false)};this.load=function(){var o=this;return s().then(function(e){D=e;var t=true,r=f().block;for(var i=0;i<D.length;i++){if(D[i].length>0){t=false;break}}if(t){D[0]=angular.copy(u);o.setDesktop(0);o.saveCurrentDesktop()}else{if(k.isMobile()){l.put("OVBDesktopNumber",4)}var s=l.get("OVBDesktopNumber");o.setDesktop(s===undefined?0:s)}if(r!==undefined&&c[r]!==undefined){n(function(){var s={},e=f();angular.forEach(e,function(e,t){var r=t.toLowerCase();for(var i=0;i<d.length;i++){if(d[i]===r){s[r]=e}}});o.sendMessage(c[r],s)})}})};this.reset=function(){var e=-1;var t=[];m.clear()};this.removeBlock=function(e){m.removeBlock(e);this.saveCurrentDesktop();if(this.getAllBlocks().length<=5){a.removeWarningAlerts()}};this.addBlock=function(e){var t;if(h.indexOf(e)==-1&&this.getDesktopNumber()==4){t="Das HinzufÃŒgen dieses Moduls ist auf dem Desktop Mobil nicht mÃ¶glich."}else{t=m.addBlock(e,0,0)}if(t===null){this.saveCurrentDesktop()}else{a.danger(t,"brsuiGridDesktop")}return t};this.addExtraBlock=function(e,t,r){var i=m.addExtraBlock(e,t,r);if(i===null){this.saveCurrentDesktop()}else{a.danger(i,"brsuiGridDesktop")}if(this.getAllBlocks().length>5){a.warning("Es befinden sich bereits fÃŒnf FunktionalitÃ€ten in diesem Desktop. Die aktuell aufgerufene FunktionalitÃ€t wird daher nicht gespeichert und steht beim nÃ€chsten Aufruf dieses Desktops nicht zur VerfÃŒgung.","bbrsuiGridDesktop")}return i};this.sendMessage=function(e,t){if(!m.blockExists(e)){this.addExtraBlock(e,true,t)}else{m.setMessageFor(e,t);r.$broadcast("brs-ui-grid-desktop:"+e,t)}};this.moveBlock=function(e,t,r){this.saveCurrentDesktop()};this.getAllBlocks=function(){return m.getAllBlocks()};this.clear=function(){m.clear();this.saveCurrentDesktop()};this.goToTradingBlock=function(e,t,r){if(!m.blockExists("trading-order")){b.scrollToLocation("ng-app");b.addBlock("trading-order")}b.sendMessage("trading-order",{isin:e,wkn:t,side:r});b.scrollToLocation("brs-ui-grid-block-trading-order")};this.scrollToLocation=function(e){var t=g.hash();g.hash(e);if(k.isMobile()){p.yOffset=150}p();g.hash(t)}}]); "use strict";var m=angular.module("brs-ui-grid");m.directive("brsUiGrid",["brsUiGridDesktop","$rootScope",function(r,i){return{restrict:"A",link:function(i,e,t){i.$on("auth:logout",function(){r.reset()})}}}]);m.directive("brsUiGridItem",["$templateRequest","$compile","$timeout","$rootScope","brsUiGridDesktop",function(e,l,i,t,r){return{restrict:"A",scope:{item:"=brsUiGridItem"},controller:["$scope","brsUiGridDesktop",function(i,e){this.removeBlock=function(){e.removeBlock(i.item.config.name)};this.getBlockName=function(){return i.item.config.name};this.getBlockLabel=function(){return i.item.config.label};this.getBlockMessage=function(){return i.item.message}}],link:function(o,c,i){var s=o.item.config;e(o.item.config.templateUrl).then(function(i){var e=s.controllerAs?" as "+s.controllerAs:"";var t='<div ng-controller="'+s.controller+""+e+'">'+i+"</div>";var r=l(t);var n=r(o);c.html(n)})}}}]);m.directive("brsUiGridLink",["brsUiGridDesktop","brsAppConfig",function(r,n){return{restrict:"A",link:function(e,i,t){i.bind("click",function(i){if(!angular.isUndefined(t.isExtra)){r.addExtraBlock(t.block,t.isExtra)}else{if(n.isMobile()){r.scrollToLocation("ng-app")}r.addBlock(t.block)}e.$apply()})}}}]);m.directive("brsUiGridLinkMessage",["brsUiGridDesktop",function(n){return{restrict:"A",link:function(t,i,r){i.bind("click",function(i){var e=t.$eval(r.linkParams);n.sendMessage(r.href,e);t.$apply()})}}}]); "use strict";var m=angular.module("brs-ui-grid",["customer-desktop"]);m.factory("brsUiGrid",["$log","brsUiGridBlockConfig","brsAppConfig",function(r,o,l){r=r.getInstance("brsUiGrid");function e(){this.blocks=[]}function a(e,n){if(e.row<n.row)return-1;else if(e.row>n.row)return 1;else return 0}e.prototype={addBlock:function(e,n,i,t){var s=o.get(e);n=angular.isUndefined(n)?0:n;i=angular.isUndefined(i)?0:i;if(s===null||s===undefined){return"Error, there is no config for the block: "+e}else if(this.blockExists(e)){return"Die gewÃ€hlte Funktion ist in diesem Desktop bereits geÃ¶ffnet."}else if(this.length()>=5){return"Mit Ã?ffnen dieses Moduls ÃŒberschreiten Sie die max. Anzahl von 5 Modulen in diesem Desktop. SchlieÃ?en Sie ein geÃ¶ffnetes Modul ÃŒber das Icon rechts in der ModulÃŒberschrift (drei horizontale Balken). Jetzt kÃ¶nnen Sie das neue Modul Ã¶ffnen. Wenn Sie mehr als 5 Module Ã¶ffnen mÃ¶chten, kÃ¶nnen Sie unter â??Desktopâ?? weitere Desktops auswÃ€hlen."}else{r.info("The block "+e+" has been correcty added at location: "+n+"/"+i);if(l.isMobile()){s.sizeX=3}this.blocks.unshift({sizeX:s.sizeX,sizeY:1,row:n,extra:"false",col:i,config:s,message:t});this.blocks.sort(a);return null}},addExtraBlock:function(e,n,i){var t=o.get(e),n=angular.isUndefined(n)?true:n;if(t===null||t===undefined){return"Error, there is no config for the block: "+e}else if(this.blockExists(e)){return"Die gewÃ€hlte Funktion ist in diesem Desktop bereits geÃ¶ffnet."}else if(n&&this.blocks.length<5){return this.addBlock(e,0,0,i)}else{r.info("The extra block "+e+" has been correcty added at location: "+0+"/"+0);this.blocks.push({sizeX:t.sizeX,sizeY:1,row:0,extra:n?"smart":"true",col:0,config:t,message:i})}return null},removeBlock:function(e){for(var n=0;n<this.blocks.length;n++){if(this.blocks[n].config.name===e){this.blocks.splice(n,1);break}}if(this.blocks.length<5){for(var n=0;n<this.blocks.length;n++){if(this.blocks[n].extra==="smart"){this.blocks[n].extra="false"}}}},getAllBlocks:function(){return this.blocks},clear:function(){while(this.blocks.length>0){this.blocks.pop()}},blockExists:function(e){for(var n=0;n<this.blocks.length;n++){if(this.blocks[n].config.name===e){return true}}return false},setMessageFor:function(e,n){for(var i=0;i<this.blocks.length;i++){if(this.blocks[i].config.name===e){this.blocks[i].message=n}}},formatToWbsArray:function(){var e=[];for(var n=0;n<this.blocks.length;n++){if(this.blocks[n].extra==="false"){e.push({name:this.blocks[n].config.name,row:this.blocks[n].row,col:this.blocks[n].col})}}return e},length:function(){var e=0;for(var n=0;n<this.blocks.length;n++){if(this.blocks[n].extra!=="true"){e++}}return e}};return e}]);m.service("brsUiGridBlockConfig",["$log","brsAppVersion",function(n,i){n=n.getInstance("brsUiGridBlockConfig");var t={};this.add=function(e){if(angular.isArray(e)){angular.forEach(e,function(e){t[e.name]=e;s(e)})}else if(angular.isObject(e)){t[e.name]=e;s(e)}n.warn(t)};this.get=function(e){return angular.copy(t[e])};function s(e){if(angular.isUndefined(e.templateUrl)){e.templateurl=i.getUrl("/app/"+e.name+"/templates/block.html")}if(angular.isUndefined(e.parameters)){e.parameters=[]}}}]); "use strict";var m=angular.module("brs-ui-highlight",[]);m.directive("brsUiHighlight",function(){return{restrict:"A",link:function(g,t,r){if(angular.isDefined(r.brsUiHighlight)&&r.brsUiHighlight!=""){g.$watch(r.brsUiHighlight,function(i,r){if(i){t.addClass("blinkBackground")}else{t.removeClass("blinkBackground");g.resetHighlight()}});t.on("click",function(i){if(g[r.brsUiHighlight]){t.removeClass("blinkBackground");g.resetHighlight()}})}}}}); "use strict";var m=angular.module("brs-ui-modal-scroller");m.factory("brsUiModalScroller",function(){var r=function(){this.direction=undefined};r.prototype={scrollTo:function(r){this.direction=r}};return r}); "use strict";var m=angular.module("brs-ui-modal-scroller",[]);m.directive("brsUiModalScroller",function(){return{restrict:"A",scope:{disableScrolling:"="},link:function(l,r,e){var o=e.brsUiModalScroller,t=l.disableScrolling,s={sm:203,md:262,lg:400,lgx:480},a={setHeight:s[o],theme:"light",autoDraggerLength:false,mouseWheel:{enable:true,deltaFactor:"auto",preventDefault:false},scrollButtons:{enable:false}};if(o=="lgx"||o=="lg"){a.mouseWheel["disableOver"]=["a"];a["advanced"]={autoScrollOnFocus:"input,span,button"}}if(!t){r.addClass("custom-scroller scroller-"+o);r.mCustomScrollbar(a);if(e.brsUiModalScrollerApi){l.$watch(e.brsUiModalScrollerApi,function(l,e){if(l!==e){r.mCustomScrollbar("scrollTo",l.direction);l.direction=undefined}},true)}$("<div class='fadeout'></div>").insertAfter(".mCustomScrollBox")}}}}); "use strict";var m=angular.module("brs-ui-modal",[]);m.service("brsUiModal",["$rootScope","$modal","$templateCache","$modalStack",function(a,e,l,t){var n=['<div tabindex="-1" role="dialog" class="',"\" ng-class=\"{in: animate, 'print-hidden': true}\" ng-style=\"{'z-index': 1050 + index*10, display: 'block'}\" ng-click=\"close($event)\" aria-hidden=\"true\">\n    <div class=\"modal-dialog\" ng-class=\"{'modal-sm': size == 'sm', 'modal-md': size == 'md', 'modal-lg': size == 'lg'}\">\n        <div modal-content class=\"",'" ng-transclude></div>\n    </div>\n</div>'],s=["modal","fade"],d=["modal-content"];e.getTemplate=function(a){var e="/app/brs-ui-modal/templates/modal-template"+window.BRS_APP_VERSION+".html";switch(a){case"draggable":s.push("draggable-modal");d.push("draggable-content");break;case"message":s.push();d.push("modal-md");break;case"small":s.push();d.push("small-content");break}l.put(e,n[0]+s.join(" ")+n[1]+d.join(" ")+n[2]);return e};e.getConfig=function(a,e,l){return angular.extend({windowTemplateUrl:this.getTemplate(a),backdrop:"static",size:e,keyboard:false},l)};a.$on("auth:logout",function(a){t.dismissAll("logout")});return e}]); "use strict";var m=angular.module("brs-ui-pagination");m.directive("brsUiPagination",["brsAppVersion",function(a){return{restrict:"E",templateUrl:a.getUrl("/app/brs-ui-pagination/templates/pagination-controls.html"),scope:{paginationData:"=paginationData"}}}]); "use strict";var m=angular.module("brs-ui-pagination",[]);m.factory("BrsUiPagination",["$filter","$log","$rootScope","brsAppConfig",function(i,t,e,s){t=t.getInstance("BrsUiPagination");function a(){}a.prototype=Object.create(Array.prototype);a.prototype.init=function(t,e,i){this.data=t;this.dataLength=this.data.length;this.itemsPerPage=e;this.displayShowAllButton=i;this.numberOfPages=e>0?Math.ceil(this.data.length/e):1;this.currentPage=1;this.from=0;this.offset=this.itemsPerPage;this.lastFilter={};this.filter();this.showAllState=false;this.isPartnerMode=s.isPartnerMode()};a.prototype.showAll=function(){this.from=0;this.offset=this.dataLength;this.currentPage=1;this.showAllState=true;this.filter();e.$broadcast("pagination:showAll:on",this)};a.prototype.showAllRevert=function(){this.from=0;this.offset=this.itemsPerPage;this.currentPage=1;this.showAllState=false;this.filter();e.$broadcast("pagination:showAll:off",this)};a.prototype.next=function(){if(this.from==0&&this.offset==this.dataLength){this.offset=this.itemsPerPage}this.from=this.offset;this.offset=this.offset+this.itemsPerPage<=this.dataLength?this.offset+this.itemsPerPage:this.dataLength;this.currentPage=parseInt(this.currentPage)+1;this.filter();e.$broadcast("pagination:changePage",this)};a.prototype.previous=function(){this.from=this.from-this.itemsPerPage>=0?this.from-this.itemsPerPage:0;this.offset=this.from+this.itemsPerPage<=this.dataLength?this.from+this.itemsPerPage:this.dataLength;this.currentPage=parseInt(this.currentPage)-1;this.filter();e.$broadcast("pagination:changePage",this)};a.prototype.changePage=function(){if(this.currentPage>this.numberOfPages||this.currentPage<=0){this.currentPage=1}this.from=this.itemsPerPage*(this.currentPage-1)>=0&&this.itemsPerPage*(this.currentPage-1)<this.dataLength?this.itemsPerPage*(this.currentPage-1):0;this.offset=this.itemsPerPage*this.currentPage<=this.dataLength&&this.itemsPerPage*this.currentPage>=0?this.itemsPerPage*this.currentPage:this.dataLength;this.filter();e.$broadcast("pagination:changePage",this)};a.prototype.filter=function(t,e){if(t===undefined){t=this.lastFilter.field;e=this.lastFilter.side}if(t!==undefined&&e!==undefined){this.data=i("orderBy")(this.data,t,e)}this.lastFilter.field=t;this.lastFilter.side=e;this.filtered=this.data.slice(this.from,this.offset)};return a}]); "use strict";var m=angular.module("brs-ui-popover",[]);m.directive("brsUiPopover",["brsCompile","$log",function(t,i){i=i.getInstance("brsUiPopover");return{restrict:"A",link:function(o,n,e){var s={};if(e.brsUiPopoverClass){s.template='<div class="popover '+e.brsUiPopoverClass+'"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>'}o.crossing=0;if(angular.isDefined(e.brsUiNextContent)){i.debug("brsUiNextContent defined");s.content=function(){i.debug("brsUiNextContent crossing",o.crossing);o.crossing=o.crossing+1;if(o.crossing<1){o.crossing=o.crossing+1;return t.html(o,$(this).next(".custom-content").html())}else{if(angular.isDefined(e.brsUiNextContentCompileOnce)){return $(this).next(".custom-content").html()}else{return t.html(o,$(this).next(".custom-content").html())}}}}if(e.brsUiPopover!==""){o.$watch(e.brsUiPopover,function(o,e){if(o!=e&&!o){n.popover(s).on("shown.bs.popover",function(){var e=$(this);$(".popover-custom").find(".btn-close").click(function(o){e.popover("hide")})})}else{n.popover("destroy")}})}else{n.popover(s).on("shown.bs.popover",function(){var e=$(this);$(".popover-custom").find(".btn-close").click(function(o){e.popover("hide")})})}o.$on("$destroy",function(){n.popover("destroy")})}}}]); "use strict";var m=angular.module("brs-ui-progressbar",[]);m.directive("brsUiProgressbar",["$rootScope","brsAppVersion",function(o,r){return{restrict:"E",templateUrl:r.getUrl("/app/brs-ui-progressbar/templates/progressbar.html"),scope:{loading:"=brsUiProgressbarShow"},link:function(r,e,s){if(o.browser=="ie9"){var i=function(){$(e[0].querySelector("#loading")).css("width","2%");$(e[0].querySelector("#loading")).animate({width:"90%"},15e3,function(){i()})};i()}}}}]); "use strict";var m=angular.module("brs-ui-scope-debug",[]);m.directive("brsUiScopeDebug",["brsAppVersion",function(e){return{restrict:"E",templateUrl:e.getUrl("/app/brs-ui-scope-debug/templates/scope-debug.html"),scope:{data:"=debugData",dataMultiple:"=debugDataMultiple"}}}]);m.directive("devOnly",["PROFILER",function(i){return{restrict:"A",link:function(e,t,r){if(!i){t.remove()}}}}]); "use strict";var m=angular.module("brs-ui-search",["brs-date","brs-ui-datepicker"]);m.directive("brsUiSearchDateIsin",["brsAppVersion",function(e){return{restrict:"AE",templateUrl:e.getUrl("/app/brs-ui-search/templates/date-isin-search-xl.html"),scope:{onSearch:"&",search:"=searchModel"},controller:["$scope","customerDetailsGetLastConnectionInfo",function(e,r){e.datePickerConfig={showOn:"button",dateFormat:"dd.mm.yy"};e.doSearch=function(){e.onSearch({searchParams:e.search.getParams()})}}],link:function(e,r,t){e.textLabel=t.searchTextLabel}}}]); "use strict";var m=angular.module("brs-ui-search");m.service("brsUiSearchDateIsin",["brsDate","customerDetailsGetLastConnectionInfo",function(n,a){function t(t){var e=this;this.defaultRange=t|10;this.lastConnection=n.formatToString(new Date);this.reset();a(false).then(function(t){e.lastConnection=t.lastConnectionDate})}t.prototype={reset:function(){var t=new Date;t.setDate(t.getDate()-this.defaultRange);this.from=n.formatToString(t);this.to=n.formatToString(new Date);this.interval="";this.type="range";this.text="";this.disabled=false},computeDateRange:function(){var t={};var e=parseInt(this.interval);if(this.type==="interval"){if(e>0){t.from=new Date;t.from.setDate(t.from.getDate()-e);t.from=n.formatToString(t.from)}else{t.from=this.lastConnection}t.to=n.formatToString(new Date)}else{t.from=this.from;t.to=this.to}return t},getParams:function(){var t=this.computeDateRange();t.isinOrWkn=this.text;t.text=this.text;return t}};return t}]); "use strict";var m=angular.module("brs-ui-sort",[]);m.directive("brsUiSort",["brsAppVersion",function(e){return{templateUrl:e.getUrl("/app/brs-ui-sort/templates/sort.html"),restrict:"AE",require:"^brsUiSortList",transclude:true,scope:true,link:function(t,e,s,r){t.sort=undefined;t.reverse=!angular.isUndefined(s.reverse)?true:false;t.doSort=function(e){if(e!==undefined&&e===t.sort)return;if(t.sort===undefined){t.sort=e?e:"+"}else{t.sort=e?e:t.sort==="+"?"-":"+"}r.setOrder(t.sort,s.sortName,t.reverse)};t.$watch(o,function(e,r){if(e!==r){if(s.sortName!==e.name){t.sort=undefined}else{t.sort=e.order}}});if(s.sortDefault!==undefined){var n=s.sortDefault===""?"+":s.sortDefault;t.sort=n;r.setDefaultOrder(n,s.sortName,t.reverse)}function o(){return r.getOrderBy()}}}}]);m.directive("brsUiSortList",function(){return{restrict:"A",scope:{onSortChange:"&"},controller:["$scope",function(s){var e=this;this.setOrder=function(e,r,t){s.orderBy={name:r,order:e,reverse:t};s.onSortChange({$orderBy:e+r,$orderName:r,$order:e,$reverse:t})};this.getOrderBy=function(){return s.orderBy};this.setDefaultOrder=function(e,r,t){s.defaultOrder={name:r,order:e,reverse:t};this.setOrder(e,r,t)};s.$on("brs-ui-sort:reset",function(){if(s.defaultOrder){e.setOrder(s.defaultOrder.order,s.defaultOrder.name,s.defaultOrder.reverse)}else{e.setOrder(undefined,undefined,undefined)}})}]}}); "use strict";var m=angular.module("brs-ui-spinner",[]);m.directive("brsUiSpinner",["$rootScope","brsAppVersion",function(s,n){return{restrict:"E",template:'<div class="loading-wrapper" ng-class="small ? \'small\' : \'\'" ng-show="loading"><div class="loading-inner" ng-class="small ? \'small\' : \'\'"><div class="loading" ng-class="small ? \'small\' : \'\'"></div></div></div>',scope:{loading:"=brsUiSpinnerShow"},link:function(n,i,e){if(angular.isUndefined(e.brsUiSpinnerSmall)){n.small=false}else{n.small=true}if(s.browser=="ie9"){var a=function(){$(i[0].querySelector(".loading")).animateRotate(360,700,"linear",function(){a()})};a()}}}}]);m.run(function(){$.fn.animateRotate=function(e,n,i,a){var s=$.speed(n,i,a),l=s.step;return this.each(function(n,i){s.step=function(n){$.style(i,"transform","rotate("+n+"deg)");if(l)return l.apply(this,arguments)};$({deg:0}).animate({deg:e},s)})}}); "use strict";var m=angular.module("brs-ui-toggle",[]);m.directive("brsUiToggleButton",["$log","$timeout",function(r,e){return{restrict:"A",link:function(s,t,a){e(function(){var i=undefined,e=undefined,n=0,l="icon-top",o="icon-bottom";if(a.brsUiToggleButton){e=a.brsUiToggleButton}i=$("#"+e);if(angular.isDefined(a.animate)){n=400}if(angular.isDefined(a.brsIconOpen)){l=a.brsIconOpen}if(angular.isDefined(a.brsIconClosed)){o=a.brsIconClosed}if(i.length){t.click(function(e){e.preventDefault();if(i.is(":hidden")){if(n){i.slideDown(400)}else{i.slideDown(0)}t.toggleClass(l);t.toggleClass(o);if(s[a.openCallback]){s[a.openCallback]()}}else{if(n){i.slideUp(400)}else{i.slideUp(0)}t.toggleClass(l);t.toggleClass(o);if(s[a.closeCallback]){s[a.closeCallback]()}}})}else{r.warn("The target element '"+e+"' doesn't exist or is not unique.")}})}}}]); "use strict";var m=angular.module("brs-ui-tooltip",[]);m.directive("customTooltip",function(){return{restrict:"A",link:function(t,i,o){if(o.customTooltip!==""){t.$watch(o.customTooltip,function(t,o){if(t!=o&&!t){i.tooltip()}else{i.tooltip("destroy")}})}else{i.tooltip()}}}}); "use strict";var m=angular.module("brs-uniquid");m.directive("brsUniquId",["brsUniquId",function(n){return{restrict:"EA",link:function(r,u,i){r.uniquId=n()},scope:true}}]);m.directive("brsUniquIdFormGroup",["brsUniquId",function(n){return{restrict:"EA",compile:function(r,u){return{pre:function(r,u,i){r.uniquId=n();u.find("label").attr("for",r.uniquId);u.find("input, textarea, select").attr("id",r.uniquId)}}},scope:true}}]); "use strict";var m=angular.module("brs-uniquid",[]);m.service("brsUniquId",function(){var e=-1;return function(){var r=(new Date).getTime();e++;return"UI"+r+e}}); "use strict";var m=angular.module("brs-validation",[]);m.directive("brsValidationLength",function(){return{require:"ngModel",link:function(e,n,r,t){var i=parseInt(r.brsValidationLength);t.$parsers.push(function(e){var n=typeof e==="undefined"||e.length===0||e.length===i;t.$setValidity("length",n);return n?e:""});t.$formatters.unshift(function(e){t.$setValidity("length",typeof e==="undefined"||e.length===0||e.length===i);return e})}}});m.directive("brsValidationMin",function(){return{require:"ngModel",link:function(e,n,r,t){var i=parseInt(r.brsValidationMin);var a=/^[0-9]*$/;t.$parsers.push(function(e){var n=typeof e==="undefined"||e.length===0||a.test(e)&&parseInt(e,"10")>=i;t.$setValidity("brsValidationMin",n);return n?e:""});t.$formatters.unshift(function(e){t.$setValidity("brsValidationMin",typeof e==="undefined"||e.length===0||a.test(e)&&parseInt(e,"10")>=i);return e})}}});m.directive("showErrors",function(){return{restrict:"A",require:"^form",link:function(e,n,r,t){var i=n[0].querySelector("[name]");var a=angular.element(i);var s=a.attr("name");if(r.showErrors!==""){e.$watch(r.showErrors,function(e,n){if(e!==n){if(!e){r.$removeClass("has-error")}if(e&&t[s].$dirty&&t[s].$invalid){r.$addClass("has-error")}}})}if(a[0].tagName=="SELECT"||a[0].type=="checkbox"){a.bind("change",function(){n.closest('[class^="form-group"]').toggleClass("has-error",t[s].$invalid)})}else{a.bind("blur",function(){if(t[s].$invalid){r.$addClass("has-error")}else{r.$removeClass("has-error")}})}}}});m.directive("checkMultiple",function(){return{restrict:"A",require:"ngModel",link:function(e,n,r,t){var i=parseInt(r.checkMultiple);var a=/^[0-9]*$/;t.$parsers.push(function(e){var n=typeof e==="undefined"||e==null||e.length===0||a.test(e)&&parseInt(e,"10")%i==0;t.$setValidity("multiple",n);return n?e:undefined});t.$formatters.unshift(function(e){t.$setValidity("multiple",typeof e==="undefined"||e==null||e.length===0||a.test(e)&&parseInt(e,"10")%i==0);return e})}}});m.directive("valueCheck",function(){return{restrict:"A",require:["ngModel","^form"],link:function(e,n,r,t){if(!t)return;var i=r.valueCheck,a=t[0],s=t[1];a.$setValidity("valuematch",false);a.$parsers.unshift(function(e){if(e!=""&&s[i].$viewValue!=""&&e==s[i].$viewValue){a.$setValidity("valuematch",true);return e}else{a.$setValidity("valuematch",false);return e}})}}});m.directive("brsDisabled",function(){return{restrict:"A",link:function(e,n,r){e.$watch(r.brsDisabled,function(e){if(e){r.$addClass("disabled");r.$set("disabled","disabled")}else{r.$removeClass("disabled");n.removeAttr("disabled")}})}}});m.directive("brsActionOnEnterKeyup",["$log",function(t){t=t.getInstance("brsActionOnEnterKeyup");return{restrict:"A",link:function(e,n,r){if(r.brsActionOnEnterKeyup){n.on("keyup",function(e){if(e.keyCode===13&&!$("#"+r.brsActionOnEnterKeyup).hasClass("disabled")){$("#"+r.brsActionOnEnterKeyup).click()}})}else{t.warn("To use the brs-action-on-enter-keyup directive, you have to provide the id of the button that fire your form action.")}}}}]);m.directive("brsValidationInput",function(){return{restrict:"A",require:"^form",link:function(e,n,r,t){var i=n[0].querySelector("[name]");var a=angular.element(i);var s=a.attr("name");e.$watch(u,function(e,n){if(angular.isDefined(s)){if(angular.isDefined(r.validateWithoutDirty)){if(t[s].$invalid){r.$addClass("has-error")}else{r.$removeClass("has-error")}}else{if(t[s].$dirty&&t[s].$invalid){r.$addClass("has-error")}else{r.$removeClass("has-error")}}}});function u(){if(angular.isDefined(s)){return t[s].$valid}else{return undefined}}}}});m.directive("brsValidationInteger",function(){return{require:"ngModel",link:function(e,n,r,t){var i=/^[0-9]*$/;var a=true;t.$parsers.push(function(e){var n=s(e);return n?e:""});t.$formatters.unshift(function(e){s(e);return e});r.$observe("brsValidationIntegerEnable",function(e){a=e!=="false";s(t.$modelValue);t.$validate()});function s(e){var n=a==false||e===null||e===undefined||e.length===0||i.test(e);t.$setValidity("brsValidationInteger",n);return n}}}});m.directive("ngFocus",function(){var i="ng-focused";return{restrict:"A",require:"ngModel",link:function(n,r,e,t){t.$focused=false;r.bind("focus",function(e){r.addClass(i);n.$apply(function(){t.$focused=true})}).bind("blur",function(e){r.removeClass(i);n.$apply(function(){t.$focused=false})})}}}); "use strict";var m=angular.module("brs-validation");m.factory("brsValidationRealtimeErrorHandler",function(){function t(r,i,n){var t=this;var a=r.$watch(i,function(r){if(!angular.isUndefined(r)){t.formRef=r;a()}});if(!angular.isUndefined(n))this.bindHasErrorFunction(r,n);this.formRef={};this.forceValidation=false}t.prototype.hasError=function(r,i){var n=this.formRef[r];if(angular.isUndefined(n))return false;var t=!n.$pristine||this.forceValidation;if(!angular.isUndefined(i)){var a=i.length;var o=false;for(var e=0;e<a;e++){o=o||n.$error[i[e]]}return t&&o}return t&&n.$invalid};t.prototype.forceErrorValidation=function(r){this.forceValidation=r};t.prototype.bindHasErrorFunction=function(r,i){var n=i?i:"hasError";r[n]=t.prototype.hasError.bind(this)};t.prototype.getForceErrorValidation=function(){return this.forceValidation};return t}); "use strict";var m=angular.module("customer-credit-information");m.controller("CustomerCreditInformationController",["$scope",function(t){}]);m.controller("CustomerCreditInformationBlockController",["$rootScope","$scope","authUser","bankAccountsGetAccountsList","bankAccountsList","bankAccountsCurrentAccount","customerCreditInformation","brsAppVersion",function(t,n,e,o,r,i,a,c){n.blockTitle="Kreditinformationen";n.isBlockLoading=true;n.authUser=e;n.hasNoCredit=false;n.hasIntradayCredit=false;n.hasWertpapierCredit=false;n.hasBothCredit=false;n.creditInfo=false;n.templates=[{name:"none",url:c.getUrl("/app/customer-credit-information/templates/none.html")},{name:"intraday.html",url:c.getUrl("/app/customer-credit-information/templates/intraday.html")},{name:"wertapaier.html",url:c.getUrl("/app/customer-credit-information/templates/wertpapier.html")},{name:"both.html",url:c.getUrl("/app/customer-credit-information/templates/both.html")}];n.template=n.templates[0];n.init=function(){l()};n.close=function(){};n.refreshBlockContent=function(){l()};function l(){n.isBlockLoading=true;o().then(function(t){n.accountsList=r;n.currentAccount=i;s()}).catch(function(t){n.isBlockLoading=false}).finally(function(){})}function s(){a(n.currentAccount.accountKey).then(function(t){n.creditInfo=t;if(n.creditInfo&&(n.creditInfo.creditLimit||n.creditInfo.intradayCredit)){if(n.creditInfo.creditLimit&&n.creditInfo.intradayCredit){n.template=n.templates[3]}else{if(n.creditInfo.intradayCredit){n.template=n.templates[1]}else{n.template=n.templates[2]}}}else{n.template=n.templates[0]}}).catch(function(t){}).finally(function(){n.isBlockLoading=false})}t.$on("accounts:changeCurrent",function(t,e){n.currentAccount=e;s()});n.init()}]); "use strict";var m=angular.module("customer-credit-information");m.service("customerCreditInformation",["brsApiClient","$q",function(t,n){var i;return function(e){var r=n.defer();if(!e){return r.promise}if(i){return i}else{i=r.promise}t.get("Bank_Overview","getCreditInfos",{accountKey:e}).then(function(e){delete e["_meta"];r.resolve(e.creditInfos)}).catch(function(e){r.reject(e)}).finally(function(){i=false});return r.promise}}]); "use strict";var m=angular.module("customer-credit-information",["brs-api-client","auth-user","brs-ui-popover"]); "use strict";var m=angular.module("customer-desktop",[]);m.service("customerDesktopGetAll",["brsApiClient",function(e){return function(){return e.get("Customer_Desktop","getAll").then(function(e){return angular.fromJson(e.desktop)})}}]);m.service("customerDesktopSet",["brsApiClient",function(s){return function(e,t){return s.get("Customer_Desktop","set",{number:t,desktop:angular.toJson(e).replace(/"/g,";")})}}]);m.service("customerDesktopGetLastClosedBlocks",["brsApiClient",function(e){return function(){return e.get("Customer_Desktop","getLastClosedBlocks").then(function(e){return e.blocks})}}]);m.service("customerDesktopAddLastClosedBlocks",["brsApiClient",function(t){return function(e){return t.get("Customer_Desktop","addLastClosedBlocks",{blocksNames:e.join(";")})}}]); "use strict";var m=angular.module("customer-details");m.service("changePasswordModal",["brsUiModal","brsAppVersion",function(o,n){var r=false;return function(e){if(!r){r=true;var a=o.open(o.getConfig("draggable",e,{templateUrl:n.getUrl("/app/customer-details/templates/modal-change-login-password.html"),controller:"ModalChangeLoginPasswordController"}));a.result.then(function(){r=false}).catch(function(){r=false})}}}]);m.controller("ChangLoginPasswordBlockController",["$scope","changePasswordModal",function(o,a){o.$on("openModalChangeLoginPassword",function(e,a){o.open()});o.open=function(e){a()}}]);m.controller("ModalChangeLoginPasswordController",["$scope","brsApiClient","$modalInstance","SecureMatrixFactory","BrsUiAlert","authUser","brsAppVersion","$timeout","brsUiModalScroller",function(o,a,n,r,e,s,i,t,d){o.secureMatrixTemplateUrl=i.getUrl("/app/secure-matrix/templates/secure-matrix.html");o.passwordMustBeChanged=false;o.authUser=s;if(s.passwordMustBeChanged()){o.passwordMustBeChanged=true}o.login=s.d.login;o.alerts=new e;o.brsUiModalScrollerApi=new d;o.lockForm=false;o.changeLoginPasswordData={oldLoginPassword:"",newLoginPassword:[],fakeNewLoginPassword:[""],newLoginPasswordIteration:[],fakeNewLoginPasswordIteration:[""]};o.keypadError=false;o.initKeypads=function(){o.newPwdSecureMatrix=new r;var e=o.newPwdSecureMatrix.initMatrix("login_pad_new",o.changeLoginPasswordData.newLoginPassword,o.changeLoginPasswordData.fakeNewLoginPassword,"fakeNewLoginPassword",true);e.then(function(){o.newPwdSecureMatrix.visible=true;o.displayToggleKeyboardLinks=false;o.resetPwd()}).catch(function(e){o.alerts.info("Die virtuelle Sicherheitstastatur konnte leider nicht geladen werden. Bitte geben Sie Ihr Passwort ÃŒber die normale Tastatur ein.","secureMatrixError");o.newPwdSecureMatrix.visible=false;o.displayToggleKeyboardLinks=false;o.keypadError=true;o.resetPwd()});o.confirmNewPwdSecureMatrix=new r;var a=o.confirmNewPwdSecureMatrix.initMatrix("login_pad_confirm",o.changeLoginPasswordData.newLoginPasswordIteration,o.changeLoginPasswordData.fakeNewLoginPasswordIteration,"fakeNewLoginPasswordIteration",true);a.then(function(){o.confirmNewPwdSecureMatrix.visible=false;o.displayToggleKeyboardLinks=false;o.resetPwd()}).catch(function(e){o.alerts.info("Die virtuelle Sicherheitstastatur konnte leider nicht geladen werden. Bitte geben Sie Ihr Passwort ÃŒber die normale Tastatur ein.","secureMatrixError");o.confirmNewPwdSecureMatrix.visible=false;o.displayToggleKeyboardLinks=false;o.keypadError=true;o.resetPwd()})};o.initKeypads();o.resetPwd=function(){o.changeLoginPasswordData.oldLoginPassword="";if(angular.isDefined(o.changeLoginPasswordData.fakeNewLoginPassword[0])){o.changeLoginPasswordData.fakeNewLoginPassword[0]=o.changeLoginPasswordData.fakeNewLoginPassword[0].slice(0,-o.changeLoginPasswordData.fakeNewLoginPassword[0].length)}if(angular.isDefined(o.changeLoginPasswordData.fakeNewLoginPasswordIteration[0])){o.changeLoginPasswordData.fakeNewLoginPasswordIteration[0]=o.changeLoginPasswordData.fakeNewLoginPasswordIteration[0].slice(0,-o.changeLoginPasswordData.fakeNewLoginPasswordIteration[0].length)}while(o.changeLoginPasswordData.newLoginPassword.length>0){o.changeLoginPasswordData.newLoginPassword.pop()}while(o.changeLoginPasswordData.newLoginPasswordIteration.length>0){o.changeLoginPasswordData.newLoginPasswordIteration.pop()}};o.changeLoginPassword=function(){o.brsUiModalScrollerApi.scrollTo("top");o.lockForm=true;var e={};e.newLoginPassword=o.changeLoginPasswordData.newLoginPassword.join("|");e.newLoginPasswordIteration=o.changeLoginPasswordData.newLoginPasswordIteration.join("|");e.fakeNewLoginPassword=o.changeLoginPasswordData.fakeNewLoginPassword[0];e.fakeNewLoginPasswordIteration=o.changeLoginPasswordData.fakeNewLoginPasswordIteration[0];e.newLoginPasswordToken=o.newPwdSecureMatrix.token;e.newLoginPasswordIterationToken=o.confirmNewPwdSecureMatrix.token;e.oldLoginPassword=o.changeLoginPasswordData.oldLoginPassword;if(o.passwordMustBeChanged==true&&s.passwordMustBeChanged()){e.activation=true}a.get("Customer_Security","changeLoginPassword",e).then(function(){s.setPasswordMustBeChanged();o.alerts.info("Vielen Dank fÃŒr die Ã?nderung Ihres Login-Passwortes. Beim nÃ€chsten Login ist dieses sofort gÃŒltig.");n.close()}).catch(function(e){if(e.code===100007){o.alerts.danger("Ihr eingegebenes Passwort und die Wiederholung sind nicht identisch. Bitte ÃŒberprÃŒfen Sie Ihre Eingabe.")}else{o.alerts.danger(e.message)}}).finally(function(){t(function(){o.brsUiModalScrollerApi.scrollTo("top");o.resetPwd();o.lockForm=false;$("#oldLoginPassword").focus()})})};o.cancel=function(){n.dismiss("cancel")}}]); "use strict";var m=angular.module("customer-details");m.controller("ChangeNoticeDisplaySettingsBlockController",["$scope","brsUiModal","brsAppVersion",function(n,o,a){n.$on("openModalChangeNoticeDisplaySettings",function(e,t){n.open()});n.open=function(e){var t=o.open(o.getConfig("draggable",e,{templateUrl:a.getUrl("/app/customer-details/templates/modal-change-notice-display-settings.html"),controller:"ModalChangeNoticeDisplaySettingsController"}))}}]);m.controller("ModalChangeNoticeDisplaySettingsController",["$scope","$modalInstance","customerDetailsGetNoticeDisplaySettings","customerDetailsSetNoticeDisplaySettings","BrsUiAlert","authUser",function(t,e,n,o,a,i){t.authUser=i;t.loading=true;t.alerts=new a;t.noticeDisplaySettingsToChange={};n(false).then(function(e){t.noticeDisplaySettingsToChange=angular.extend(e)}).catch(function(e){t.alerts.danger(e.message)}).finally(function(){t.loading=false});t.setNoticeDisplaySettings=function(){t.loading=true;o(t.noticeDisplaySettingsToChange).then(function(){e.close()}).catch(function(e){t.alerts.danger(e.message)}).finally(function(){t.loading=false})};t.cancel=function(){e.dismiss("cancel")}}]); "use strict";var m=angular.module("customer-details");m.controller("ChangePhonePasswordBlockController",["$scope","brsUiModal","brsAppVersion",function(o,a,r){o.$on("openModalChangePhonePassword",function(e,n){o.open()});o.open=function(e){var n=a.open(a.getConfig("draggable",e,{templateUrl:r.getUrl("/app/customer-details/templates/modal-change-phone-password.html"),controller:"ModalChangePhonePasswordController"}))}}]);m.controller("ModalChangePhonePasswordController",["$scope","brsApiClient","$modalInstance","BrsUiAlert","authUser",function(n,e,o,a,r){n.alerts=new a;n.changePhonePasswordData={newPhonePassword:"",newPhonePasswordIteration:""};n.lockForm=false;n.authUser=r;n.changePhonePassword=function(){if(n.changePhonePasswordData.newPhonePassword===n.changePhonePasswordData.newPhonePasswordIteration){n.lockForm=true;e.get("Customer_Security","changePhonePassword",n.changePhonePasswordData).then(function(){n.alerts.info("Vielen Dank fÃŒr die Ã?nderung Ihres Telefonkennwortes. Wir haben es in unseren Systemen gespeichert und Sie kÃ¶nnen es ab sofort verwenden.")}).catch(function(e){n.alerts.danger(e.message)}).finally(function(){n.changePhonePasswordData.newPhonePassword="";n.changePhonePasswordData.newPhonePasswordIteration="";n.lockForm=false})}else{n.alerts.danger("Sie haben unterschiedliche TelefonkennwÃ¶rter eingegeben.")}};n.cancel=function(){o.dismiss("cancel")}}]);m.directive("disableCutCopyPaste",function(){return{restrict:"A",link:function(e,n,o){n.bind("cut",function(e){e.preventDefault()});n.bind("copy",function(e){e.preventDefault()});n.bind("paste",function(e){e.preventDefault()})}}}); "use strict";var m=angular.module("customer-details");m.service("customerDetailsGetCitiesInfo",["brsApiClient","$q","customerDetailsCitiesInfo",function(e,r,n){var u,c;return function(t){var i=r.defer(),s=false,o=[];if(t!=""){angular.forEach(n,function(e){if(e.cityPostCode==t){s=true}},s)}if(!s&&t){if(u){if(t==c){return u}}else{u=i.promise;c=t}e.get("Customer_Options","getCitiesByPostCode",{postCode:t}).then(function(e){angular.forEach(e.cities,function(e){n.push(e)},n);i.resolve(e.cities)}).catch(function(e){i.reject(e)}).finally(function(){u=false;c=""})}else if(t){angular.forEach(n,function(e){if(e.cityPostCode==t){o.push(e)}},o);i.resolve(o)}else{i.reject({message:"Die Postleitzahl ist ungÃŒltig."})}return i.promise}}]); "use strict";var m=angular.module("customer-details");m.service("customerDetailsGetCountries",["brsApiClient","$q","$rootScope","customerDetailsCountries",function(r,n,s,i){var o;return function(e){var t=n.defer();if(i.length==0||e){if(o){return o}else{o=t.promise}s.spinner+=1;r.get("Customer_Options","getCountries").then(function(e){angular.extend(i,e.countries);t.resolve(i)}).catch(function(e){t.reject(e)}).finally(function(){s.spinner-=1;o=false})}else{t.resolve(i)}return t.promise}}]); "use strict";var m=angular.module("customer-details");m.service("customerDetailsGetIncomeThresholdsOptions",["brsApiClient","$q","$rootScope","customerDetailsIncomeThresholdsOptions",function(n,s,t,r){var i;return function(e){var o=s.defer();if(!r.incomePerYear||e){if(i){return i}else{i=o.promise}t.spinner+=1;n.get("Customer_Options","getIncomeThresholdsOptions").then(function(e){delete e.incomeThresholdsOptions.incomePerYear[""];delete e.incomeThresholdsOptions.incomeTotal[""];delete e.incomeThresholdsOptions.incomeTotalToSpend[""];angular.extend(r,e.incomeThresholdsOptions);o.resolve(r)}).catch(function(e){o.reject(e)}).finally(function(){t.spinner-=1;i=false})}else{o.resolve(r)}return o.promise}}]); "use strict";var m=angular.module("customer-details");m.service("customerDetailsGetLastConnectionInfo",["brsApiClient","$q","$rootScope","customerDetailsLastConnectionInfo","$filter",function(t,r,o,s,i){var c;return function(e){var n=r.defer();if(i("brsFilterObjectLength")(s)==0||e){if(c){return c}else{c=n.promise}o.spinner+=1;t.get("Customer_Details","getCustomerLastConnectionInfo").then(function(e){angular.extend(s,e.lastConnectionInfo);n.resolve(s)}).catch(function(e){n.reject(e)}).finally(function(){o.spinner-=1;c=false})}else{n.resolve(s)}return n.promise}}]); "use strict";var m=angular.module("customer-details");m.service("customerDetailsGetMaritalStatusOptions",["brsApiClient","$q","$rootScope","customerDetailsMaritalStatusOptions",function(r,n,s,i){var a;return function(t){var e=n.defer();if(i.length==0||t){if(a){return a}else{a=e.promise}s.spinner+=1;r.get("Customer_Options","getMaritalStatusOptions").then(function(t){angular.extend(i,t.maritalStatusOptions);e.resolve(i)}).catch(function(t){e.reject(t)}).finally(function(){s.spinner-=1;a=false})}else{e.resolve(i)}return e.promise}}]); "use strict";var m=angular.module("customer-details");m.service("customerDetailsGetNoticeDisplaySettings",["brsApiClient","$q","$rootScope","customerDetailsNoticeDisplaySettings","tradingKidWarningModal",function(i,n,s,r,a){var o;return function(e){var t=n.defer();if(r.messageOtc==undefined||e){if(o){return o}else{o=t.promise}s.spinner+=1;i.get("Customer_Security","getNoticeDisplaySettings").then(function(e){angular.extend(r,e.noticeDisplaySettings);t.resolve(r);if(e.noticeDisplaySettings.kidWarning){a("lg")}}).catch(function(e){t.reject(e)}).finally(function(){s.spinner-=1;o=false})}else{t.resolve(r)}return t.promise}}]); "use strict";var m=angular.module("customer-details");m.service("customerDetailsGetOccupationalCategoriesOptions",["brsApiClient","$q","$rootScope","customerDetailsOccupationalCategoriesOptions",function(n,i,r,o){var s;return function(e){var t=i.defer();if(o.length==0||e){if(s){return s}else{s=t.promise}r.spinner+=1;n.get("Customer_Options","getOccupationalCategoriesOptions").then(function(e){angular.extend(o,e.occupationalCategories);t.resolve(o)}).catch(function(e){t.reject(e)}).finally(function(){r.spinner-=1;s=false})}else{t.resolve(o)}return t.promise}}]); "use strict";var m=angular.module("customer-details");m.service("customerDetailsGetPersonalData",["brsApiClient","$q","$rootScope","customerDetailsPersonalData","authUser","customerMasterDataModal","brsAppConfig",function(t,o,n,r,s,i,a){var l;return function(a){var e=o.defer();if(!r.personalDataUpdate||a){if(l){return l}else{l=e.promise}n.spinner+=1;t.get("Customer_Details","getPersonalData").then(function(a){if(a.personalData.incomePerYear==-1){a.personalData.incomePerYear=6}if(a.personalData.incomeTotal==-1){a.personalData.incomeTotal=6}if(a.personalData.incomeTotalToSpend==-1){a.personalData.incomeTotalToSpend=6}if(a.personalData.occupationalCategory==-1){a.personalData.occupationalCategory=undefined}if(a.personalData.occupation=="Unbekannt"){a.personalData.occupation=undefined}angular.extend(r,a.personalData);e.resolve(r);s.setHasToPassKyc(a.personalData.hasToPassMandatoryDataCheck);if(a.personalData.hasToPassMandatoryDataCheck){i()}}).catch(function(a){e.reject(a)}).finally(function(){n.spinner-=1;l=false})}else{e.resolve(r)}return e.promise}}]); "use strict";var m=angular.module("customer-details");m.service("customerDetailsGetTitleOptions",["brsApiClient","$q","$rootScope","customerDetailsTitleOptions",function(n,i,r,s){var o;return function(e){var t=i.defer();if(s.length==0||e){if(o){return o}else{o=t.promise}r.spinner+=1;n.get("Customer_Options","getTitleOptions").then(function(e){angular.extend(s,e.titleOptions);t.resolve(s)}).catch(function(e){t.reject(e)}).finally(function(){r.spinner-=1;o=false})}else{t.resolve(s)}return t.promise}}]); "use strict";var m=angular.module("customer-details");m.service("customerDetailsSetDefaultAccount",["brsApiClient","$q","bankAccountsDefaultAccountKey",function(e,u,n){var r;return function(t){var c=u.defer();if(r){return r}else{r=c.promise}if(n.accountKey==t){c.resolve(true);r=false}else{e.get("Customer_Details","setCustomerDefaultAccount",{accountKey:t}).then(function(e){if(e.success){n.accountKey=t;c.resolve(true)}}).catch(function(e){c.reject(e)}).finally(function(){r=false})}return c.promise}}]); "use strict";var m=angular.module("customer-details");m.service("customerDetailsSetNoticeDisplaySettings",["brsApiClient","$q","$rootScope","customerDetailsNoticeDisplaySettings",function(i,n,r,s){var o;return function(e){var t=n.defer();if(o){return o}else{o=t.promise}r.spinner+=1;i.get("Customer_Security","setNoticeDisplaySettings",e).then(function(e){angular.extend(s,e.noticeDisplaySettings);t.resolve(s)}).catch(function(e){t.reject(e)}).finally(function(){r.spinner-=1;o=false});return t.promise}}]); "use strict";var m=angular.module("customer-details");m.service("customerDetailsSetPersonalData",["brsApiClient","$q","$rootScope","customerDetailsPersonalData",function(r,n,a,s){var i;return function(e){var t=n.defer();if(i){return i}else{i=t.promise}a.spinner+=1;if(e.title==null){e.title=""}r.get("Customer_Details","setPersonalData",e).then(function(e){angular.extend(s,e.personalData);t.resolve(s)}).catch(function(e){t.reject(e)}).finally(function(){a.spinner-=1;i=false});return t.promise}}]); "use strict";var m=angular.module("customer-details",["brs-api-client","auth-user","customer-experience","secure-matrix","brs-ui-modal","brs-ui-spinner","brs-ui-modal-scroller","brs-validation","brs-ui-form","customer-master-data","trading-kid-warning"]);m.value("customerDetailsPersonalData",{});m.value("customerDetailsNoticeDisplaySettings",{});m.value("customerDetailsTitleOptions",[]);m.value("customerDetailsOccupationalCategoriesOptions",[]);m.value("customerDetailsCitiesInfo",[]);m.value("customerDetailsCountries",[]);m.value("customerDetailsIncomeThresholdsOptions",{});m.value("customerDetailsMaritalStatusOptions",[]);m.value("customerDetailsLastConnectionInfo",{});m.run(["$rootScope","customerDetailsGetPersonalData","customerDetailsPersonalData","customerDetailsGetLastConnectionInfo","customerDetailsNoticeDisplaySettings","customerDetailsLastConnectionInfo","customerDetailsGetNoticeDisplaySettings",function(e,s,a,o,i,r,l){e.$on("auth:login:refresh",function(e,t){s();o();l()});e.$on("auth:logout",function(e,t){for(var s in a){delete a[s]}for(var s in i){delete i[s]}for(var s in r){delete r[s]}})}]); "use strict";var m=angular.module("customer-details");m.controller("LoginInformationsBlockController",["$rootScope","$scope","authUser","customerDetailsGetLastConnectionInfo","customerDetailsLastConnectionInfo","bankAccountsList","bankAccountsCurrentAccount","bankAccountsDefaultAccountKey","customerDetailsSetDefaultAccount","BrsUiAlert","authOAuthHasValidAccessToken","$q","authOAuthRevokeToken",function(n,t,c,o,a,u,s,l,i,e,f,r,g){t.alerts=new e;t.alertsAccessTokens=new e;t.loading=false;t.showContent=0;t.lockForm=false;t.login=false;t.init=function(){t.loading=true;t.alerts.clean();t.alertsAccessTokens.clean();t.login=c.d.login;t.currentAccount=s;t.accountsList=u;t.defaultAccountKey=l.accountKey;t.defaultAccountKeyChange={accountKey:t.defaultAccountKey};var n=o(false).then(function(n){t.lastConnectionInfo=a;t.showContent=1}).catch(function(n){t.alerts.danger(n.message)});var e=f().then(function(n){t.hasValidAccessToken=n});r.all([n,e]).finally(function(){t.loading=false})};t.saveDefaultAccount=function(){if(t.defaultAccountKeyChange.accountKey!=t.defaultAccountKey){var e="";t.lockForm=true;t.loading=true;i(t.defaultAccountKeyChange.accountKey).then(function(n){t.defaultAccountKey=l.accountKey;angular.forEach(u,function(n){if(n.accountKey==l.accountKey){e=n.accountNumber+" "+n.name}});t.alerts.info("Vielen Dank. Beim nÃ€chsten Login ist das Depot "+e+" ausgewÃ€hlt.")}).catch(function(n){t.alerts.danger(n.message)}).finally(function(){t.loading=false;t.lockForm=false})}};n.$on("auth:login:refresh",function(n,e){t.init()});t.revokeAccessTokens=function(){t.alertsAccessTokens.clean();t.loading=true;g().then(function(){t.alertsAccessTokens.danger("Die VerknÃŒpfung wurde erfolgreich gelÃ¶scht.");t.hasValidAccessToken=false}).catch(function(){}).finally(function(){t.loading=false})};n.$on("auth:logout",function(n,e){t.showContent=false;t.defaultAccountKey="";t.defaultAccountKeyChange.accountKey=""});if(c.isLogged()){t.init()}}]); "use strict";var m=angular.module("customer-details",["brs-validation","brs-ui-popover","brs-filter-object-length","auth-oauth"]);m.constant("tinMaxLength",255);m.service("personalDataModal",["brsUiModal","brsAppVersion",function(s,n){var t=false;return function(e){if(!t){t=true;var a=s.open(s.getConfig("draggable",e,{templateUrl:n.getUrl("/app/customer-details/templates/modal-personal-data.html"),controller:["$scope","$modalInstance",function(e,a){e.modalInstance=a}]}));a.result.then(function(){t=false}).catch(function(){t=false})}}}]);m.controller("PersonalDataBlockController",["$scope","personalDataModal",function(s,a){s.$on("openModalPersonalData",function(e,a){s.open("lg")});s.open=function(e){a()}}]);m.controller("ModalPersonalDataController",["$scope","brsApiClient","customerDetailsGetPersonalData","customerDetailsGetTitleOptions","customerDetailsGetOccupationalCategoriesOptions","customerDetailsGetCountries","customerDetailsGetIncomeThresholdsOptions","customerDetailsGetMaritalStatusOptions","customerDetailsGetCitiesInfo","customerDetailsSetPersonalData","BrsUiAlert","$timeout","authUser","brsAlert","$filter","tinMaxLength","brsAppConfig",function(r,a,e,s,n,t,d,i,o,l,f,u,c,g,C,m,p){r.blocking=false;r.authUser=c;if(c.hasToPassKyc()){r.blocking=true}r.isMobile=p.isMobile();r.occupationalSubCategories=[];r.cities=[];r.differingAddressCities=[];r.loading=1;r.loadingTitle=false;r.loadingCountries=false;r.loadingCities=false;r.loadingDifferingAddressCities=false;r.loadingOccupationalCategories=false;r.loadingIncomeThresholds=false;r.loadingMaritalStatusOptions=false;r.loadingOccupationalSubCategories=false;r.alerts=new f;r.address={country:"",differingAddressCountry:"",deutschland:{postCode:"",city:"",differingAddressStreet:"",differingAddressHouseNumber:"",differingAddressPostCode:"",differingAddressCity:""},international:{postCode:"",city:"",differingAddressStreet:"",differingAddressHouseNumber:"",differingAddressPostCode:"",differingAddressCity:""}};r.differingAddressPostCodeLastCommittedValue="";r.postCodeLastCommittedValue="";r.tinMinLength=11;r.tinMaxLength=m;r.phonePattern="^0[0-9]+$";r.isValidPhone=function(e){return new RegExp(r.phonePattern).test(e)};e(false).then(function(e){r.personalDataToChange=angular.copy(e);h();r.baseData=angular.copy(e);r.address.country=e.country;r.address.differingAddressCountry=e.differingAddressCountry;if(e.country=="Deutschland"){r.hasTin=!!r.personalDataToChange.taxIdentificationNumber;r.tinMaxLength=11;r.address.deutschland.postCode=e.postCode;r.address.deutschland.city=e.city;r.address.deutschland.federalState=e.federalState}else{r.tinMinLength=0;r.address.international.postCode=e.postCode;r.address.international.city=e.city}if(e.differingAddressCountry=="Deutschland"){r.address.deutschland.differingAddressStreet=e.differingAddressStreet;r.address.deutschland.differingAddressHouseNumber=e.differingAddressHouseNumber;r.address.deutschland.differingAddressPostCode=e.differingAddressPostCode;r.address.deutschland.differingAddressCity=e.differingAddressCity}else{r.address.international.differingAddressStreet=e.differingAddressStreet;r.address.international.differingAddressHouseNumber=e.differingAddressHouseNumber;r.address.international.differingAddressPostCode=e.differingAddressPostCode;r.address.international.differingAddressCity=e.differingAddressCity}r.onOccupationalCategoryChange(r.personalDataToChange.occupationalCategory);if(e.country=="Deutschland"){r.onPostCodeChange(r.address.deutschland.postCode,false);r.onCityChange(r.address.deutschland.city)}if(e.differingAddressCountry=="Deutschland"){r.onPostCodeChange(r.address.deutschland.differingAddressPostCode,true);r.onCityChange(r.address.deutschland.differingAddressCity,true)}}).catch(function(e){r.alerts.danger(e.message)}).finally(function(){r.loading-=1});r.loading+=1;r.loadingTitle=true;s(false).then(function(e){r.titleOptions=e}).catch(function(e){r.alerts.danger(e.message)}).finally(function(){r.loading-=1;u(function(){r.loadingTitle=false},1e3)});r.loading+=1;r.loadingOccupationalCategories=true;n(false).then(function(e){r.occupationalCategories=e}).catch(function(e){r.alerts.danger(e.message)}).finally(function(){r.loading-=1;u(function(){r.loadingOccupationalCategories=false},1e3)});r.loading+=1;r.loadingCountries=true;t(false).then(function(e){r.countries=e}).catch(function(e){r.alerts.danger(e.message)}).finally(function(){r.loading-=1;u(function(){r.loadingCountries=false},1e3)});r.loading+=1;r.loadingIncomeThresholds=true;d(false).then(function(e){r.incomeThresholdsOptions=e;h()}).catch(function(e){r.alerts.danger(e.message)}).finally(function(){r.loading-=1;u(function(){r.loadingIncomeThresholds=false},1e3)});r.loading+=1;r.loadingMaritalStatusOptions=true;i(false).then(function(e){r.maritalStatusOptions=e}).catch(function(e){r.alerts.danger(e.message)}).finally(function(){r.loading-=1;u(function(){r.loadingMaritalStatusOptions=false},1e3)});r.resetValidity=function(e,a){r.personalDataForm[e].$setValidity(a,true)};r.onOccupationalCategoryChange=function(e){if(e==undefined){r.occupationalSubCategories=[];r.personalDataToChange.occupation=undefined;angular.element(angular.element.find("select[name='occupation']")).closest('[class^="form-group"]').addClass("has-error");return}r.loadingOccupationalSubCategories=true;var s="";if(angular.isDefined(r.personalDataToChange.occupation)){s=r.personalDataToChange.occupation;r.personalDataToChange.occupation=""}a.get("Customer_Options","getOccupationalSubCategoriesOptions",{categoryCode:e}).then(function(e){r.occupationalSubCategories=e.occupationalSubCategories;if(e.occupationalSubCategories.length==1){s=e.occupationalSubCategories[0].occupationalSubCategoryCode}var a=_.find(r.occupationalSubCategories,function(e){var a=e.occupationalSubCategoryCode.toLowerCase()===s.toLowerCase();if(a){s=e.occupationalSubCategoryCode}return a});if(!a){s=""}}).catch(function(e){r.error=e}).finally(function(){r.personalDataToChange.occupation=s;u(function(){r.loadingOccupationalSubCategories=false},1e3)})};r.onPostCodeChange=function(e,s){if(r.address.country=="Deutschland"||s&&r.address.differingAddressCountry=="Deutschland"){if(s){if(r.differingAddressPostCodeLastCommittedValue==e){return}r.differingAddressPostCodeLastCommittedValue=e;r.loadingDifferingAddressCities=true}else{if(r.postCodeLastCommittedValue==e){return}r.postCodeLastCommittedValue=e;r.loadingCities=true}if(e!=undefined&&e.length==5){if(s){var n="";if(angular.isDefined(r.address.deutschland.differingAddressCity)){n=r.address.deutschland.differingAddressCity;r.address.deutschland.differingAddressCity=""}}else{var t="";if(angular.isDefined(r.address.deutschland.city)){t=r.address.deutschland.city;r.address.deutschland.city=""}}o(e).then(function(e){if(s){angular.element(angular.element.find("select[name='differingAddressPostCode']")).closest('[class^="form-group"]').removeClass("has-error");if(r.personalDataForm.differingAddressPostCode){r.personalDataForm.differingAddressPostCode.$setValidity("postCodeInvalid",true)}r.differingAddressCities=e;var a=false;angular.forEach(r.differingAddressCities,function(e){if(e.cityName==n){a=true}});if(!a&&C("brsFilterObjectLength")(r.differingAddressCities)==1){a=true;n=r.differingAddressCities[0]["cityName"]}if(a){angular.element(angular.element.find("select[name='differingAddressCity']")).closest('[class^="form-group"]').removeClass("has-error")}else{if(r.personalDataForm.differingAddressCity){r.personalDataForm.differingAddressCity.$setValidity("differingAddressCityInValid",true)}angular.element(angular.element.find("select[name='differingAddressCity']")).closest('[class^="form-group"]').addClass("has-error")}}else{angular.element(angular.element.find("select[name='postCode']")).closest('[class^="form-group"]').removeClass("has-error");if(r.personalDataForm.postCode){r.personalDataForm.postCode.$setValidity("postCode",true)}r.cities=e;var a=false;angular.forEach(r.cities,function(e){if(e.cityName==t){a=true}});if(!a&&C("brsFilterObjectLength")(r.cities)==1){a=true;t=r.cities[0]["cityName"]}if(a){angular.element(angular.element.find("select[name='city']")).closest('[class^="form-group"]').removeClass("has-error")}else{if(r.personalDataForm.city){r.personalDataForm.city.$setValidity("cityInvalid",true)}angular.element(angular.element.find("select[name='city']")).closest('[class^="form-group"]').addClass("has-error");r.address.deutschland.federalState="";angular.element(angular.element.find("input[name='federalState']")).closest('[class^="form-group"]').addClass("has-error")}}}).catch(function(e){if(s){r.differingAddressCities=[];angular.element(angular.element.find("input[name='differingAddressPostCode']")).closest('[class^="form-group"]').addClass("has-error");angular.element(angular.element.find("select[name='differingAddressCity']")).closest('[class^="form-group"]').addClass("has-error");if(r.personalDataForm.differingAddressPostCode){r.personalDataForm.differingAddressPostCode.$setValidity("postCodeInvalid",false)}}else{r.cities=[];r.address.deutschland.federalState="";angular.element(angular.element.find("input[name='postCode']")).closest('[class^="form-group"]').addClass("has-error");angular.element(angular.element.find("select[name='city']")).closest('[class^="form-group"]').addClass("has-error");angular.element(angular.element.find("input[name='federalState']")).closest('[class^="form-group"]').addClass("has-error");if(r.personalDataForm.postCode){r.personalDataForm.postCode.$setValidity("postCodeInvalid",true)}}u(function(){if(s){r.loadingDifferingAddressCities=true}else{r.loadingCities=true}},1e3)}).finally(function(){u(function(){if(s){r.address.deutschland.differingAddressCity=n;r.onCityChange(r.address.deutschland.differingAddressCity,true);r.loadingDifferingAddressCities=false}else{r.address.deutschland.city=t;r.onCityChange(r.address.deutschland.city);r.loadingCities=false}},1e3)})}else{if(s){r.differingAddressCities=[];angular.element(angular.element.find("select[name='differingAddressPostCode']")).closest('[class^="form-group"]').addClass("has-error");angular.element(angular.element.find("select[name='differingAddressCity']")).closest('[class^="form-group"]').addClass("has-error");if(r.personalDataForm.differingAddressPostCode){r.personalDataForm.differingAddressPostCode.$setValidity("postCodeInvalid",false)}}else{r.cities=[];r.address.deutschland.federalState=undefined;angular.element(angular.element.find("input[name='postCode']")).closest('[class^="form-group"]').addClass("has-error");angular.element(angular.element.find("select[name='city']")).closest('[class^="form-group"]').addClass("has-error");angular.element(angular.element.find("input[name='federalState']")).closest('[class^="form-group"]').addClass("has-error");if(r.personalDataForm.postCode){r.personalDataForm.postCode.$setValidity("postCodeInvalid",false)}}u(function(){if(s){r.loadingDifferingAddressCities=false}else{r.loadingCities=false}r.address.deutschland.federalState=undefined},1e3)}}};r.onCityChange=function(a,e){if(!e){if(a!=undefined){angular.forEach(r.cities,function(e){if(e.cityName==a&&r.personalDataForm.city){r.personalDataForm.city.$setValidity("cityValid",true);r.address.deutschland.federalState=e.cityFederalStateName;angular.element(angular.element.find("input[name='federalState']")).closest('[class^="form-group"]').removeClass("has-error");angular.element(angular.element.find("input[name='city']")).closest('[class^="form-group"]').removeClass("has-error")}})}else{r.address.deutschland.federalState=undefined;if(r.personalDataForm.city){r.personalDataForm.city.$setValidity("cityInvalid",true)}angular.element(angular.element.find("input[name='federalState']")).closest('[class^="form-group"]').addClass("has-error");angular.element(angular.element.find("input[name='city']")).closest('[class^="form-group"]').addClass("has-error")}}else{if(a!=undefined){angular.forEach(r.differingAddressCities,function(e){if(e.cityName==a&&r.personalDataForm.differingAddressCity){r.personalDataForm.differingAddressCity.$setValidity("cityValid",true);angular.element(angular.element.find("input[name='differingAddressCity']")).closest('[class^="form-group"]').removeClass("has-error")}})}else{r.address.deutschland.differingAddressCity=undefined;r.personalDataForm.differingAddressCity.$setValidity("cityValid",false);angular.element(angular.element.find("input[name='differingAddressCity']")).closest('[class^="form-group"]').addClass("has-error")}}};r.changePersonnalData=function(){r.alerts.clean();r.loading=true;r.personalDataToChange.country=r.address.country;r.personalDataToChange.differingAddressCountry=r.address.differingAddressCountry;if(r.personalDataToChange.country=="Deutschland"){r.personalDataToChange.postCode=r.address.deutschland.postCode;r.personalDataToChange.city=r.address.deutschland.city;r.personalDataToChange.federalState=r.address.deutschland.federalState}else{r.personalDataToChange.postCode=r.address.international.postCode;r.personalDataToChange.city=r.address.international.city}if(r.personalDataToChange.differingAddressCountry=="Deutschland"){r.personalDataToChange.differingAddressStreet=r.address.deutschland.differingAddressStreet;r.personalDataToChange.differingAddressHouseNumber=r.address.deutschland.differingAddressHouseNumber;r.personalDataToChange.differingAddressPostCode=r.address.deutschland.differingAddressPostCode;r.personalDataToChange.differingAddressCity=r.address.deutschland.differingAddressCity}else{r.personalDataToChange.differingAddressStreet=r.address.international.differingAddressStreet;r.personalDataToChange.differingAddressHouseNumber=r.address.international.differingAddressHouseNumber;r.personalDataToChange.differingAddressPostCode=r.address.international.differingAddressPostCode;r.personalDataToChange.differingAddressCity=r.address.international.differingAddressCity}angular.forEach(r.countries,function(e){if(r.personalDataToChange.country==e.countryName){r.personalDataToChange.countryIsoCode=e.countryIsoCode}if(r.personalDataToChange.differingAddressCountry==e.countryName){r.personalDataToChange.differingAddressCountryIsoCode=e.countryIsoCode}if(r.personalDataToChange.countryOfBirthIsoCode==e.countryIsoCode){r.personalDataToChange.countryOfBirth=e.countryName}});l(r.personalDataToChange).then(function(){r.modalInstance.close()}).catch(function(e){if(e.code==90103){r.modalInstance.close();g("BestÃ€tigungsmeldung",e.message)}else if(e.code==90104){r.hasTin=false;r.alerts.danger(e.message)}else{r.alerts.danger(e.message)}}).finally(function(){r.loading=false;if(c.hasToPassKyc()){c.setHasToPassKyc(false)}})};r.cancel=function(){r.modalInstance.dismiss("cancel")};r.incomeCodeForSorting=function(e){if(e.incomeCode===6)return-1;return e.incomeCode};function h(){if(r.incomeThresholdsOptions!==undefined&&r.personalDataToChange!==undefined){var e=["incomePerYear","incomeTotal","incomeTotalToSpend"],a,s;for(var n=0;n<e.length;n++){s=r.incomeThresholdsOptions[e[n]];a=false;for(var t=0;t<s.length;t++){if(s[t].incomeCode==r.personalDataToChange[e[n]]){a=true;break}}if(!a){r.personalDataToChange[e[n]]=undefined}}}}}]); "use strict";var m=angular.module("customer-disclaimer",[]);m.service("customerDisclaimer",["brsApiClient","brsUiModal","customerDetailsGetNoticeDisplaySettings","$q","customerDisclaimerNeedDisclaimer","brsAppVersion",function(e,t,n,i,r,s){this.openFundDisclaimer=function(e,n){return r("FND").then(function(){return t.open(t.getConfig("draggable","lg",{templateUrl:s.getUrl("/app/customer-disclaimer/templates/funds.html"),controller:["$scope","$modalInstance","fundsParams","customerDisclaimerReadFund","brsAppConfig",c],resolve:{fundsParams:function(){return{isin:e,cancelable:angular.isUndefined(n)?false:n}}}})).result}).catch(function(e){return i.reject("cancel")})};this.openOtcDisclaimer=function(e){return n().then(function(e){if(e.messageOtc){return t.open(t.getConfig("draggable","lg",{templateUrl:s.getUrl("/app/customer-disclaimer/templates/otc.html"),controller:["$scope","$modalInstance","settings","customerDetailsSetNoticeDisplaySettings",o],resolve:{settings:function(){return angular.copy(e)}}})).result}})};function o(e,n,t,i){e.remind={messageOtc:true};e.cancel=function(){n.dismiss("cancel")};e.ok=function(){t.messageOtc=e.remind.messageOtc;i(t).finally(function(){n.close("understood")})}}function c(e,n,t,i,r){e.fundsParams=t;e.isSubmitting=false;e.showError=false;e.confirmation={code:undefined};e.productUrl="http://fonds.onvista.de/fondsprospekte.html?ISIN=";e.companyName="onvista Finanzportal www.onvista.de";if(r.isPartnerMode()){e.productUrl="http://www.finanzen.net/fonds/prospekte/";e.companyName="finanzen.net Finanzportal www.finanzen.net"}e.cancel=function(){n.dismiss("cancel")};e.doSubmit=function(){if(angular.isUndefined(e.confirmation.code)){e.showError=true;return}e.isSubmitting=true;i(t.isin,e.confirmation.code).then(function(){n.close("understood")}).catch(function(e){n.dismiss(e.message)})}}}]);m.service("customerDisclaimerReadFund",["brsApiClient",function(t){return function(e,n){return t.get("Customer_Disclaimer","readFund",{isin:e,confirmationCode:n})}}]);m.service("customerDisclaimerNeedDisclaimer",["brsApiClient",function(n){return function(e){return n.get("Customer_Disclaimer","needDisclaimer",{type:e})}}]); "use strict";var m=angular.module("customer-experience");m.service("customerExperienceGetDocuments",["brsApiClient","$q","$rootScope",function(e,n,t){var c;return function(){var r=n.defer();if(c){return c}else{c=r.promise}t.spinner+=1;e.get("Customer_Experience","getDocuments").then(function(e){r.resolve(e)}).catch(function(e){r.reject(e)}).finally(function(){t.spinner-=1;c=false});return r.promise}}]); "use strict";var m=angular.module("customer-experience");m.service("customerExperienceGetTradingExperiences",["brsApiClient","$q","customerExperienceTradingExperiences",function(n,i,t){var a;return function(e){var r=i.defer();if(!t.tradingExperiences.A2||e){if(a){return a}else{a=r.promise}n.get("Customer_Experience","getTradingExperiences").then(function(e){angular.extend(t.tradingExperiences,e.tradingExperiences);t.outdatedEra=e.outdatedEra;t.validEra=e.validEra;t.validatedEra=e.validatedEra;r.resolve(t)}).catch(function(e){r.reject(e)}).finally(function(){a=false})}else{r.resolve(t)}return r.promise}}]); "use strict";var m=angular.module("customer-experience");m.service("customerExperienceSetTradingExperiences",["brsApiClient","$q","$rootScope","customerExperienceTradingExperiences",function(e,n,t,c){var s;return function(i){var r=n.defer();if(s){return s}else{s=r.promise}angular.forEach(i,function(e,r){var n=["KM1","KM2","KM3","TM4"];if(r==="era_confirm"||r==="isOAOP"||n.indexOf(r)>-1){i[r]=e===true?1:0}else{i[r].active=e.active===true?1:0}});t.spinner+=1;e.get("Customer_Experience","setTradingExperiences",i).then(function(e){angular.extend(c.tradingExperiences,e.tradingExperiences);r.resolve(e)}).catch(function(e){r.reject(e)}).finally(function(){t.spinner-=1;s=false});return r.promise}}]); "use strict";var m=angular.module("customer-experience");m.service("customerExperienceUpdateEra",["brsApiClient","$q","$rootScope","customerExperienceTradingExperiences",function(e,t,n,i){var c;return function(){var r=t.defer();if(i.outdatedEra){if(c){return c}else{c=r.promise}n.spinner+=1;e.get("Customer_Experience","updateEra").then(function(e){i.outdatedEra=true;r.resolve(i.outdatedEra)}).catch(function(e){r.reject(e)}).finally(function(){n.spinner-=1;c=false})}else{r.reject({message:"Diese Aktion ist nicht erforderlich."})}return r.promise}}]); "use strict";var m=angular.module("customer-experience",["brs-api-client","auth-user","brs-ui-modal-scroller"]);m.value("customerExperienceTradingExperiences",{tradingExperiences:{},outdatedEra:true,validEra:false,validatedEra:false});m.constant("informationSheetUrl","https://www.onvista-bank.de/service/uebersicht/hinweise.html#tab-2230-4");m.constant("customerExperienceTradingExperienceSections",{experience01:{label:"A Nicht komplexe Wertpapiere",disabled:true,items:[{name:"A1",label:"Aktien - GÃ€ngige Indizes (z.B. DJ Euro Stoxx, DAX, MDAX, CAC40, Nikkei, Dow Jones, NASDAQ 100, S&amp;P 500, europÃ€ische Leitzinsen)*"},{name:"B",label:"Fest- bzw. variabel verzinsliche Wertpapiere von Bund, LÃ€ndern, Kommunen, Pfandbriefe, Inhaberschuldverschreibungen, Nullkuponanleihen*"},{name:"F1",label:"Richtlinienkonforme Wertpapierfonds (Investmentfonds in Aktien, Anleihen, Geldmarkttitel)*"}]},experience02:{label:"B Wertpapiere ohne erweiterte RisikoaufklÃ€rung",items:[{name:"A2",label:"Aktien, insoweit diese nicht in gÃ€ngigen Indizes oder in keinem Index enthalten sind*"},{name:"AS",label:"AktienÃ€hnliche Wertpapiere (Bezugsrechte, Teilrechte, Aktien-Sonderformen)*"},{name:"BS",label:"Verzinsliche Namenspapiere, Commercial Paper, zinsÃ€hnliche Wertpapiere und Sonderformen (ABS, CNL, MBS)*"},{name:"Z1",label:"Anlagezertifikate (Basket-, Garantie-, Index- und Outperformance-Zertifikate)*"},{name:"Z2",label:"Bonuszertifikate, Teilschutzzertifikate*"},{name:"Z3",label:"Discountzertifikate, Aktienanleihen*"},{name:"F2",label:"Sonstige Fonds (z.B. Immobilienfonds)*"},{name:"F3",label:"Dach-Hedgefonds*"}]},experience03:{label:"C Wertpapiere mit erweiterter RisikoaufklÃ€rung (TermingeschÃ€fte)",items:[{name:"Z4",label:"Hebelzertifikate (Knock-Out-Produkte mit/ohne Stop Loss), exotische Hebelprodukte*"},{name:"Z5",label:"Sonstige Zertifikate*"},{name:"T",label:"Optionsscheine, Options-/Wandelanleihen mit Optionsschein, (covered) Warrants sowie weitere derivative Produkte*"}]},experience04:{label:"D Wertpapiere mit erweiterter RisikoaufklÃ€rung fÃŒr CFDs und ggf. nachschusspflichtige Produkte",items:[{name:"EUREX",label:"An der Eurex gehandelte Optionen und Futures*"},{name:"CFD",label:"Contract for Difference (CFD)*"}]},experience05:{label:"Kassamarkt Produkte",disabled:true,items:[{name:"KM1",label:"Produktgruppe A einfache Kenntnisse"},{name:"KM2",label:"Produktgruppe B durchschnittliche Kenntnisse"},{name:"KM3",label:"Produktgruppe C ÃŒberdurchschnittliche Kenntnisse"}]},experience06:{label:"TermingeschÃ€fte",disabled:true,items:[{name:"TM4",label:"Produktgruppe D durchschnittliche Kenntnisse bei Produkten mit Nachschusspflicht"}]}});m.run(["$rootScope","customerExperienceTradingExperiences",function(e,t){e.$on("auth:logout",function(e,n){for(var i in t.tradingExperiences){delete t.tradingExperiences[i]}t.outdatedEra=true;t.validEra=false;t.validatedEra=false})}]); "use strict";var m=angular.module("customer-experience");m.controller("TradingExperiencesBlockController",["$scope","brsUiModal","brsAppVersion",function(r,i,a){r.$on("openModalPersonalData",function(e,n){r.open("lg")});r.open=function(e){var n=i.open(i.getConfig("draggable",e,{templateUrl:a.getUrl("/app/customer-experience/templates/modal-trading-experiences.html"),controller:"ModalTradingExperiencesController"}))}}]);m.controller("ModalTradingExperiencesController",["$scope","authUser","$modalInstance","customerExperienceGetTradingExperiences","customerExperienceTradingExperienceSections","customerExperienceUpdateEra","customerExperienceSetTradingExperiences","BrsUiAlert","$window","informationSheetUrl",function(n,e,r,i,a,t,c,s,o,d){n.informationSheetUrl=d;n.experienceSections=a;n.tradingExperiences={};n.authUser=e;n.loading=true;n.alerts=new s;n.regex=/^\d{1,3}$/;i(false).then(function(e){n.tradingExperiences=angular.extend(e.tradingExperiences);n.outdatedEra=angular.copy(e.outdatedEra);n.validEra=angular.copy(e.validEra);n.validatedEra=angular.copy(e.validatedEra);n.tradingExperiences.era_confirm=n.validEra;n.loading=false}).catch(function(e){n.alerts.danger(e.message);n.loading=false});n.confirmEra=function(e){if(e&&n.outdatedEra){n.outdatedEra=!o.confirm('Wir bitten Sie, alle zwei Jahre zu prÃŒfen, ob Sie die erforderlichen Kenntnisse ÃŒber die Risiken im Umgang mit FinanztermingeschÃ€ften besitzen. Bitte bestÃ€tigen Sie uns dies durch einen Klick auf das Feld "OK".  Sollten Sie keine VerlÃ€ngerung wÃŒnschen oder weitere Informationen benÃ¶tigen, klicken Sie auf "Abbrechen". Weitere Informationen finden Sie im Bereich "Verwaltung - PersÃ¶nliche Einstellungen - Erfahrungen - TermingeschÃ€fte".');if(!n.outdatedEra){t().then(function(e){n.outdatedEra=e;n.alerts.success("Ihre VerlÃ€ngerung zu den erforderlichen Kenntnissen ÃŒber die Risiken im Umgang mit FinanztermingeschÃ€ften wurde erfolgreich gespeichert.")}).catch(function(e){n.alerts.danger(e.message)})}}};n.tradesReset=function(e){if(!n.tradingExperiences[e].active){n.tradingExperiences[e].trades=""}if(_.contains(["Z4","Z5","T","EUREX","CFD"],e)){if(!n.tradingExperiences.Z4.active&&!n.tradingExperiences.Z5.active&&!n.tradingExperiences.T.active&&!n.tradingExperiences.EUREX.active&&!n.tradingExperiences.CFD.active){n.tradingExperiences.era_confirm=false}}};n.setTradingExperiences=function(){n.loading=true;c(n.tradingExperiences).then(function(e){if(e.warning&&e.warning!=""){n.alerts.warning(e.warning)}if(n.tradingExperiences.era_confirm){n.tradingExperiences.era_confirm=true}n.alerts.success("Ihre Ã?nderungen wurden erfolgreich gespeichert!")}).catch(function(e){n.alerts.danger(e.message)}).finally(function(){n.loading=false})};n.cancel=function(){r.dismiss("cancel")}}]); "use strict";var m=angular.module("customer-freebuy");m.controller("CustomerFreebuyController",["$scope",function(e){}]);m.controller("CustomerFreebuyBlockController",["$rootScope","$scope","authUser","bankAccountsGetAccountsList","bankAccountsList","bankAccountsCurrentAccount","customerFreebuyGetFreebuyOverview",function(e,n,t,o,c,u,i){n.blockTitle="FreeBuy Statusbericht";n.isBlockLoading=true;n.authUser=t;n.hasFreeBuy=false;n.isCash=true;n.displayHistory=false;n.styleHistory={display:"none"};n.init=function(){r()};n.close=function(){};n.refreshBlockContent=function(){r()};n.toggleHistory=function(){n.displayHistory=!n.displayHistory;if(n.displayHistory){n.styleHistory={display:"table-row"}}else{n.styleHistory={display:"none"}}};function r(){n.isBlockLoading=true;o().then(function(e){n.accountsList=c;n.currentAccount=u;s()}).catch(function(e){n.isBlockLoading=false}).finally(function(){})}function s(){n.isBlockLoading=true;i(n.currentAccount.accountKey).then(function(e){n.freebuy=e;if(n.freebuy){n.hasFreeBuy=true;if(n.freebuy.accountType=="CASH"){n.freebuyTitle="FreeBuy Cash-Statusbericht";n.columnTitle="Durchschnittl. Guthaben";n.column2Title="Geldsaldo (EUR)";n.isCash=true}else{n.freebuyTitle="FreeBuy Trade-Statusbericht";n.columnTitle="Anzahl Transaktionen";n.column2Title="Anz.Transaktionen";n.isCash=false}}}).catch(function(e){}).finally(function(){n.isBlockLoading=false})}e.$on("accounts:changeCurrent",function(e,t){n.currentAccount=t;s()});n.init()}]); "use strict";var m=angular.module("customer-freebuy");m.service("customerFreebuyGetFreebuyOverview",["brsApiClient","$q",function(t,n){var u;return function(e){var r=n.defer();if(!e){return r.promise}if(u){return u}else{u=r.promise}t.get("Bank_Overview","getFreeBuyOverview",{accountKey:e}).then(function(e){delete e["_meta"];r.resolve(e.freebuyOverview)}).catch(function(e){r.reject(e)}).finally(function(){u=false});return r.promise}}]); "use strict";var m=angular.module("customer-freebuy",["brs-api-client","auth-user"]); "use strict";var m=angular.module("customer-margin-details");m.controller("CustomerMarginDetailsController",["$scope",function(n){}]);m.controller("CustomerMarginDetailsBlockController",["$rootScope","$scope","$log","authUser","bankAccountsGetAccountsList","bankAccountsList","bankAccountsCurrentAccount","customerMarginDetailsGetDetails","BrsUiPagination","BrsUiAlert",function(n,e,i,t,o,a,c,r,s,l){i=i.getInstance("CustomerMarginDetailsBlockController");e.blockTitle="Margindetails";e.isBlockLoading=true;e.authUser=t;e.pagination=new s;e.alerts=new l;e.itemsPerPage=10;e.details=[];e.init=function(){i.debug("init");u()};e.close=function(){};e.refreshBlockContent=function(){i.debug("refreshBlockContent");u()};e.clearAlerts=function(){if(e.alerts.length){angular.forEach(e.alerts,function(n){e.alerts.pop()})}};function u(){i.debug("requestAccountList");e.isBlockLoading=true;e.clearAlerts();o().then(function(n){e.accountsList=a;e.currentAccount=c;e.isBlockLoading=false;g()}).catch(function(n){e.isBlockLoading=false;e.alerts.danger(n.message)}).finally(function(){})}function g(){e.details=[];e.alerts.clean();if(!e.isBlockLoading){i.debug("requestMarginDetails");e.isBlockLoading=true;r(e.currentAccount.accountKey).then(function(n){if(n.margin&&n.margin.details.length>0){e.details=n.margin.details;e.totals=n.margin.totals;e.info=n.margin.info;e.pagination.init(e.details,e.itemsPerPage,true)}else{e.alerts.info("Kein Ergebnis. Es gab Overnight keine offenen Derivate-Positionen.")}}).catch(function(n){e.alerts.danger(n.message)}).finally(function(){e.isBlockLoading=false})}}n.$on("accounts:changeCurrent",function(n,t){i.debug("on accounts:changeCurrent");i.debug("on accounts:changeCurrent, currentAccount",t);e.currentAccount=t;g()});e.init()}]); "use strict";var m=angular.module("customer-margin-details");m.service("customerMarginDetailsGetDetails",["brsApiClient","$q",function(t,i){var n;return function(e){var r=i.defer();if(!e){return r.promise}if(n){return n}else{n=r.promise}t.get("Customer_Margin","getMarginDetails",{accountKey:e}).then(function(e){delete e["_meta"];r.resolve(e)}).catch(function(e){r.reject(e)}).finally(function(){n=false});return r.promise}}]); "use strict";var m=angular.module("customer-margin-details",["brs-api-client","auth-user"]); "use strict";var m=angular.module("customer-portfolio",["brs-api-client"]);m.service("customerPortfolioGetStockAmount",["brsApiClient","bankAccountsCurrentAccount",function(r,e){return function(t,o){var n={accountKey:e.accountKey,wkn:t||"",mne:o||""};return r.get("Customer_Portfolio","getStockAmount",n)}}]); "use strict";var m=angular.module("customer-postbox");m.service("customerPostboxGetUrl",["brsApiClient","$q","$log","$rootScope",function(e,r,o,n){o=o.getInstance("customerPostboxGetUrl");var s;return function(){var t=r.defer();n.spinner+=1;o.debug("customerPostboxGetUrl");e.get("Customer_Postbox","generateUrl",{}).then(function(e){t.resolve(e.url)}).catch(function(e){t.reject(e)}).finally(function(){n.spinner-=1;s=false});return t.promise}}]); "use strict";var m=angular.module("customer-postbox",["brs-api-client","auth-user"]); "use strict";var m=angular.module("customer-pulls");m.service("customerPullsGetOrderBook",["brsApiClient",function(u){return function(e,r){return u.get("Customer_Pulls","getPullsOrderBook",{exchange:e,isin:r})}}]); "use strict";var m=angular.module("customer-pulls");m.service("customerPullsGetPullsQuote",["brsApiClient",function(l){return function(e,t,u,s){return l.get("Customer_Pulls","getPullsQuote",{exchange:e,isin:t,symbol:u||"",comments:s||""})}}]);m.service("customerPullsGetPullsQuoteByMne",["brsApiClient",function(l){return function(e,t,u,s){return l.get("Customer_Pulls","getPullsQuote",{exchange:e,mne:t,symbol:u||"",comments:s||""})}}]); "use strict";var m=angular.module("customer-pulls",["brs-api-client","brs-confirm"]);m.service("customerPulls",["brsConfirm","$q",function(t,i){var s='Mittels Klick auf "Realtimekurs abfragen" erhalten Sie den gewÃŒnschten Realtimekurs und es wird ein Pull von Ihrem Kontingent abgezogen.';var a='Mittels Klick auf "Realtimekurs abfragen" erhalten Sie die gewÃŒnschten Realtimekurse Xetra Level 2 und es werden zwei Pulls von Ihrem Kontingent abgezogen.';var l='Mittels Klick auf "BÃ¶rsenhandel realtime" erhalten Sie die gewÃŒnschten Realtimekurse und es werden Ihnen zwei Pulls von Ihrem Kontingent abgezogen.';this.askConfirmation=function(e,r){var n=i.defer();if(u(e)){n.resolve(true);return n.promise}return t("Realtime Kurse",r?a:s,"Realtimekurs abfragen")};this.askMultipleConfirmation=function(e){var r=0;var n=i.defer();for(var a=0;a<e.length;a++){if(!u(e[a])){r++}}switch(r){case 2:return t("Realtime Kurse",l,"Realtimekurs abfragen");case 1:return t("Realtime Kurse",s,"Realtimekurs abfragen");default:n.resolve(true);return n.promise}};function u(e){return(e.exchangeId!=4901||e.exchangeId==4901&&e.isFrankfurtLocal)&&e.exchangeId!=4920&&e.exchangeId!=4922}}]); "use strict";var m=angular.module("customer-secure-messages",["brs-api-client","auth-user","brs-format","brs-ui-spinner","brs-validation","brs-ui-form","brs-ui-modal","brs-ui-modal-scroller","brs-ui-datepicker","brs-ui-pagination","brs-ui-alert","brs-ui-toggle","brs-filter-text","brs-filter-object-length","brs-print"]);m.value("customerSecureMessagesFoldersList",{0:"inbox",1:"sent",2:"trash",3:"archives"});m.value("customerSecureMessagesCategoriesList",[]);m.value("customerSecureMessagesCategoriesListForDisplay",{});m.value("customerSecureMessagesMessagesHeaderList",[]);m.value("customerSecureMessagesMessagesList",{});m.value("customerSecureMessagesCount",[{totalMessages:undefined,totalUnreadMessages:undefined},{totalMessages:undefined,totalUnreadMessages:undefined},{totalMessages:undefined,totalUnreadMessages:undefined},{totalMessages:undefined,totalUnreadMessages:undefined},{totalMessages:undefined,totalUnreadMessages:undefined}]);m.controller("CustomerSecureMessagesBlockController",["PROFILER","$scope","$rootScope","$log","$filter","BrsUiAlert","brsUiModal","BrsUiPagination","customerSecureMessagesCategoriesList","customerSecureMessagesFoldersList","customerSecureMessagesGetCategoriesList","customerSecureMessagesGetCount","customerSecureMessagesCategoriesListForDisplay","customerSecureMessagesGetMessagesHeaderList","customerSecureMessagesMessagesHeaderList","customerSecureMessagesMessagesList","customerSecureMessagesCount","$moment","$interval","customerSecureMessagesSendMessage","customerSecureMessagesDeleteMessage","customerSecureMessagesArchiveMessage","customerSecureMessagesRestoreMessage","$q",function(e,i,s,a,r,t,n,o,l,g,c,u,d,f,m,M,h,S,D,p,b,L,F,y){a=a.getInstance("CustomerSecureMessagesBlockController");i.loading=false;i.loadingSendMessage=false;i.alerts=new t;i.section="inbox";i.categories=[];i.categoriesForDisplay={};angular.extend(i.categoriesForDisplay,d);i.folders=g;i.foldersByName=_.invert(i.folders);i.messagesList=[];i.messagesListForDisplay={};i.secureMessagesCount=h;i.currentTime=S().format("DD. MMMM YYYY, HH:mm");i.writeMessageData={categoryCode:"",subject:"",message:""};i.inboxDateFilter="";i.sentDateFilter="";i.archivesDateFilter="";i.mifid2DateFilter="";i.inboxDateFilterTo="";i.sentDateFilterTo="";i.archivesDateFilterTo="";i.mifid2DateFilterTo="";i.datePickerConfig={minDate:new Date(2015,0,1),maxDate:new Date,showOn:"both",dateFormat:"dd.mm.yy"};i.inboxPagination=new o;i.sentPagination=new o;i.archivesPagination=new o;i.mifid2Pagination=new o;i.actionButtonsState={disabled:false};D(function(){i.currentTime=S().format("DD. MMMM YYYY, HH:mm")},1e3);i.order=function(e,s,t){i.unselect(false,i[e+"Pagination"]);i[e+"Pagination"].filter(s,t)};i.filter=function(e){var s=function(e,s){s=s.substr(0,10)+"T00:00:00+00:00";return moment(e).isAfter(s)},t=function(e,s){s=moment(s.substr(0,10)+"T00:00:00+00:00").add(1,"day");return moment(e).isBefore(s)},a="",n=i.foldersByName[e];a=r("filter")(i.messagesList,{folder:n});if(i[e+"DateFilter"]!=""&&i[e+"DateFilterTo"]!=""){a=r("filter")(a,{sentOn:i[e+"DateFilter"]},s);a=r("filter")(a,{sentOn:i[e+"DateFilterTo"]},t);i[e+"Pagination"].init(a,5,true)}else{i[e+"Pagination"].init(a,5,true)}i.unselect(false,i[e+"Pagination"]);a=""};i.resetBoxDateFilter=function(){a.info("Reset "+i.section+" date filter.");i[i.section+"DateFilter"]="";i[i.section+"DateFilterTo"]="";i.filter(i.section)};i.changeSection=function(e){i.section=e};i.init=function(){i.loading+=1;while(m.length>0){m.pop()}while(i.messagesList.length>0){i.messagesList.pop()}for(var e in M){delete M[e]}for(var e in i.messagesListForDisplay){delete i.messagesListForDisplay[e]}c().then(function(e){angular.extend(l,e);angular.forEach(e,function(e){if(angular.isUndefined(d[e.code])){d[e.code]=e}},d);angular.extend(i.categoriesForDisplay,d);angular.extend(i.categories,l)}).catch(function(e){i.alerts.clear();i.alerts.danger(e.message,"categoriesListError")}).finally(function(){i.loading-=1});angular.forEach(g,function(e,s){i.loading+=1;u({folder:s}).then(function(e){angular.extend(h[s],e)}).catch(function(e){i.alerts.clear();i.alerts.danger(e.message,"messagesCountError")}).finally(function(){i.loading-=1})});i.loading+=1;f().then(function(e){e=r("orderBy")(e,"sentOn",true);angular.extend(m,e);angular.forEach(e,function(e){if(angular.isUndefined(M[e.messageId])){M[e.messageId]=e}},M);angular.extend(i.messagesList,m);angular.extend(i.messagesListForDisplay,M);i.inboxPagination.init(r("filter")(i.messagesList,{folder:0,categoryCode:"!"+22}),5,true);i.sentPagination.init(r("filter")(i.messagesList,{folder:1}),5,true);i.archivesPagination.init(r("filter")(i.messagesList,{folder:3}),5,true);i.mifid2Pagination.init(r("filter")(i.messagesList,{folder:0,categoryCode:22}),5,true)}).catch(function(e){i.alerts.clear();i.alerts.danger(e.message,"messagesHeaderListError")}).finally(function(){i.loading-=1;i.actionButtonsState.disabled=false})};i.refresh=function(){a.info("Refresh secure messages.");i.alerts.clear();if(i.section=="write"){i.resetWriteMessageForm()}else{i.init()}};i.resetWriteMessageForm=function(){var e=y.defer();a.info("Reset the secure message form");i.writeMessageData={categoryCode:"",subject:"",message:""};e.resolve();return e.promise};i.sendSecureMessage=function(){var s=1,t=g[s];a.info("Send secure message.");i.loadingSendMessage+=1;i.writeMessageData.message=r("stripTags")(i.writeMessageData.message);p(i.writeMessageData).then(function(e){i.loadingSendMessage+=1;if(angular.isDefined(i.writeMessageData.parentMessageId)&&i.writeMessageData.parentMessageId!=""){s=i.messagesListForDisplay[i.writeMessageData.parentMessageId].folder;t=g[s]}f({folder:1}).then(function(e){e=r("orderBy")(e,"sentOn",true);angular.extend(m,e);angular.forEach(e,function(e){if(angular.isUndefined(M[e.messageId])){M[e.messageId]=e}},M);angular.extend(i.messagesList,m);angular.extend(i.messagesListForDisplay,M);i.changeSection(t);i["sentPagination"].init(r("filter")(i.messagesList,{folder:1}),5,true);i.resetWriteMessageForm()}).catch(function(e){i.alerts.danger(e.message,"messagesHeaderListError")}).finally(function(){i.loadingSendMessage-=1})}).catch(function(e){i.alerts.danger(e.message,"sendMessageError")}).finally(function(){i.loadingSendMessage-=1})};i.init();i.selectAll=function(){angular.forEach(i[i.section+"Pagination"].filtered,function(e){e.selected=i[i.section+"SelectAll"]})};i.unselect=function(e,s){i[i.section+"SelectAll"]=false;angular.forEach(s.data,function(e){e.selected=false})};s.$on("pagination:showAll:on",i.unselect);s.$on("pagination:showAll:off",i.unselect);s.$on("pagination:changePage",i.unselect);s.$on("secureMessage:requireRefresh",i.refresh);s.$on("secure-messages:reply",function(e,s){i.resetWriteMessageForm().then(function(){if(angular.isDefined(s)){i.writeMessageData.categoryCode=s.categoryCode;i.writeMessageData.subject="Antwort: "+s.subject;i.writeMessageData.message="\n\n----------\n"+$("<div/>").html(r("stripTags")(r("br2nl")(s.message.toString()))).text();i.writeMessageData.parentMessageId=s.messageId}i.changeSection("write")})});i.deleteSelected=function(){var s=[],t=i.section;angular.forEach(i[i.section+"Pagination"].data,function(e){if(e.selected===true){s.push(e.messageId)}});if(s.length){i.loading+=1;i.actionButtonsState.disabled=true;a.info("Delete these messages: ",s);b(s).then(function(e){i.unselect(false,i[t+"Pagination"]);i.refresh()}).catch(function(e){i.alerts.danger(e.message,"deleteSelectedMessagesError")}).finally(function(){i.loading-=1;i.actionButtonsState.disabled=false})}};i.archiveSelected=function(){var s=[],t=i.section;angular.forEach(i[i.section+"Pagination"].data,function(e){if(e.selected===true){s.push(e.messageId)}});if(s.length){i.loading+=1;i.actionButtonsState.disabled=true;a.info("Archive these messages: ",s);L(s).then(function(e){i.unselect(false,i[t+"Pagination"]);i.refresh()}).catch(function(e){i.alerts.danger(e.message,"archiveSelectedMessagesError")}).finally(function(){i.loading-=1;i.actionButtonsState.disabled=false})}};i.restoreSelected=function(){var s=[],t=i.section;angular.forEach(i[i.section+"Pagination"].data,function(e){if(e.selected===true){s.push(e.messageId)}});if(s.length){i.loading+=1;i.actionButtonsState.disabled=true;a.info("Archive these messages: ",s);F(s).then(function(e){i.unselect(false,i[t+"Pagination"]);i.refresh()}).catch(function(e){i.alerts.danger(e.message,"restoreSelectedMessagesError")}).finally(function(){i.loading-=1;i.actionButtonsState.disabled=false})}}}]);m.run(["$rootScope","$log","customerSecureMessagesCategoriesList","customerSecureMessagesMessagesHeaderList","customerSecureMessagesMessagesList","customerSecureMessagesCategoriesListForDisplay",function(e,s,a,n,i,r){s=s.getInstance("customer-secure-messages:run");e.$on("auth:logout",function(e,s){while(a.length>0){a.pop()}for(var t in r){delete r[t]}while(n.length>0){n.pop()}for(var t in i){delete i[t]}})}]); "use strict";var m=angular.module("customer-secure-messages",[]);m.directive("secureMessageRow",["SecureMessageRow","customerSecureMessagesCategoriesList","customerSecureMessagesCategoriesListForDisplay","customerSecureMessagesFoldersList","$log","$timeout","BrsUiAlert","brsAppVersion",function(a,r,n,o,i,e,c,s){i=i.getInstance("secureMessageRow directive");return{restrict:"E",templateUrl:s.getUrl("/app/customer-secure-messages/templates/secure-message-row.html"),scope:{message:"=message",actionButtonsState:"="},link:function(s,e,t){s.categories=r;s.categoriesForDisplay=n;s.folders=o;s.alerts=new c;s.hideActionButton=false;s.secureMessageRow=new a;s.secureMessageRow.init(s.message);s.showMessageOverview=function(){var e=s.secureMessageRow.message.messageId;if($("#messageOverview"+e).is(":hidden")){i.info("Get the message "+e);s.secureMessageRow.getFullMessage().then(function(e){angular.extend(s.message,e)}).catch(function(e){s.alerts.danger(e.message,"getMessageError")});s.hideActionButton=true}else{i.info("Toggle up the message "+e);s.hideActionButton=false}};s.deleteMessage=function(){s.actionButtonsState.disabled=true;s.secureMessageRow.deleteMessage().catch(function(e){s.alerts.danger(e.message,"deleteMessageError")}).finally(function(){s.actionButtonsState.disabled=false})};s.archiveMessage=function(){s.actionButtonsState.disabled=true;s.secureMessageRow.archiveMessage().catch(function(e){s.alerts.danger(e.message,"archiveMessageError")}).finally(function(){s.actionButtonsState.disabled=false})};s.restoreMessage=function(){s.actionButtonsState.disabled=true;s.secureMessageRow.restoreMessage().catch(function(e){s.alerts.danger(e.message,"restoreMessageError")}).finally(function(){s.actionButtonsState.disabled=false})}}}}]);m.directive("secureMessageRowOverview",["$log","$timeout","BrsUiAlert","brsAppVersion","brsPrint","brsCompile",function(e,s,a,t,r,n){e=e.getInstance("secureMessageRowOverview directive");return{restrict:"E",templateUrl:t.getUrl("/app/customer-secure-messages/templates/secure-message-row-overview.html"),scope:{secureMessageRow:"=secureMessageRow",actionButtonsState:"="},link:function(s,e,t){s.alerts=new a;s.deleteMessage=function(){s.actionButtonsState.disabled=true;s.secureMessageRow.deleteMessage().catch(function(e){s.alerts.danger(e.message,"deleteMessageError")}).finally(function(){s.actionButtonsState.disabled=false})};s.archiveMessage=function(){s.actionButtonsState.disabled=true;s.secureMessageRow.archiveMessage().catch(function(e){s.alerts.danger(e.message,"archiveMessageError")}).finally(function(){s.actionButtonsState.disabled=false})};s.restoreMessage=function(){s.actionButtonsState.disabled=true;s.secureMessageRow.restoreMessage().catch(function(e){s.alerts.danger(e.message,"restoreMessageError")}).finally(function(){s.actionButtonsState.disabled=false})};s.printSecureMessage=function(){s.message=s.secureMessageRow.message;s.forPrint=true;s.subject=s.secureMessageRow.message.subject;if(angular.isDefined(s.message.important)&&s.message.important==true){s.subject+="  !"}n.template(s,"app/customer-secure-messages/templates/modal-read-secure-message.html").then(function(e){r.html(s.subject,e,"md")})}}}}]); "use strict";var m=angular.module("customer-secure-messages",[]);m.factory("SecureMessageRow",["$rootScope","$filter","$log","$q","customerSecureMessagesMessagesHeaderList","customerSecureMessagesMessagesList","customerSecureMessagesGetMessagesHeaderList","customerSecureMessagesGetMessage","customerSecureMessagesDeleteMessage","brsUiModal","customerSecureMessagesArchiveMessage","customerSecureMessagesRestoreMessage","brsAppVersion","BRS_API_ENDPOINT","customerSecureMessagesCount",function(r,e,a,o,s,g,t,i,n,c,l,u,m,f,d){a=a.getInstance("SecureMessageRow factory");function h(){}h.prototype=Object.create(Array.prototype);h.prototype.init=function(e){this.message=e;this.loading=false;this.errors={getFullMessage:false,deleteMessage:false,archiveMessage:false,restoreMessage:false}};h.prototype.getFullMessage=function(){var s=this,t=o.defer(),r=this.message.folder==0?true:false;this.loading=true;i({messageId:this.message.messageId,updateReadFlag:r}).then(function(e){if(r&&s.message.read==false&&e.read==true){d[0].totalUnreadMessages-=1}s.message=e;g[e.messageId]=e;t.resolve(e)}).catch(function(e){s.errors.getFullMessage=true;t.reject(e)}).finally(function(){s.loading=false});return t.promise};h.prototype.deleteMessage=function(){var s=this,t=o.defer();a.info("Delete the message "+this.message.messageId);this.loading=true;n([this.message.messageId]).then(function(e){r.$broadcast("secureMessage:requireRefresh")}).catch(function(e){s.errors.deleteMessage=true;t.reject(e)}).finally(function(){s.loading=false});return t.promise};h.prototype.archiveMessage=function(){var s=this,t=o.defer();a.info("Archive the message "+this.message.messageId);this.loading=true;l([this.message.messageId]).then(function(e){r.$broadcast("secureMessage:requireRefresh")}).catch(function(e){s.errors.archiveMessage=true;t.reject(e)}).finally(function(){s.loading=false});return t.promise};h.prototype.restoreMessage=function(){var s=this,t=o.defer();a.info("Restore the message "+this.message.messageId);this.loading=true;u([this.message.messageId]).then(function(e){r.$broadcast("secureMessage:requireRefresh")}).catch(function(e){s.errors.restoreMessage=true;t.reject(e)}).finally(function(){s.loading=false});return t.promise};h.prototype.openMessageModal=function(){var e=this;return c.open(c.getConfig("draggable","lg",{templateUrl:m.getUrl("app/customer-secure-messages/templates/modal-read-secure-message.html"),controller:["$scope","$modalInstance","params",s],resolve:{params:function(){return{message:e.message,fileUrl:f+e.message.getFileUrl}}}})).result;function s(e,s,t){e.message=t.message;e.fileUrl=t.fileUrl;e.forPrint=false;if(e.message.attachments&&e.message.attachments.length){e.scrollerSize="md"}else{e.scrollerSize="lg"}e.close=function(){s.close("close")};e.reply=function(){a.info("Reply to this message "+e.message.messageId);r.$broadcast("secure-messages:reply",e.message);s.close("close")}}};return h}]); "use strict";var m=angular.module("customer-secure-messages");m.service("customerSecureMessagesGetCount",["brsApiClient","$q","customerSecureMessagesCount",function(s,n,e){var t;return function(e){var r=n.defer();if(t){return t}else{t=r.promise}if(e&&angular.isDefined(e.dateRange)&&e.dateRange==""){r.reject({message:"Das Datumsformat ist nicht korrekt."});return r.promise}if(!e||e&&(angular.isUndefined(e.folder)||angular.isDefined(e.folder)&&(e.folder<0||e.folder>3))){r.reject({message:"Die Anzahl Meldungen kÃ¶nnen nicht fÃŒr dieses Meldungsfenster abgerufen werden."});return r.promise}s.get("Customer_SecureMessage","getSecureMessagesCount",e).then(function(e){r.resolve(e.secureMessagesCount)}).catch(function(e){r.reject(e)}).finally(function(){t=false});return r.promise}}]); "use strict";var m=angular.module("customer-secure-messages");m.service("customerSecureMessagesGetMessage",["brsApiClient","$q","customerSecureMessagesMessagesList","$sce","$log","$filter",function(e,t,g,i,s,u){s=s.getInstance("customerSecureMessagesGetMessage service");var n;return function(s){var a=t.defer();if(angular.isUndefined(s.messageId)||s.messageId==""){a.reject({message:"The message id is missing."});return a.promise}if(n){return n}else{n=a.promise}var r=false;angular.forEach(g,function(e){if(e.messageId==s.messageId&&angular.isDefined(e.message)){r=true;a.resolve(e)}});if(r){n=false;return a.promise}if(angular.isUndefined(s.updateReadFlag)){s.updateReadFlag=true}e.get("Customer_SecureMessage","getSecureMessage",s).then(function(e){e.message.message=i.trustAsHtml(e.message.message);e.message.overview=i.trustAsHtml(u("htmlTags2space")(e.message.overview).replace(/&nbsp;+(?= )/g,"").replace(/ +(?= )/g,""));a.resolve(e.message)}).catch(function(e){a.reject(e)}).finally(function(){n=false});return a.promise}}]); "use strict";var m=angular.module("customer-secure-messages");m.service("customerSecureMessagesGetMessagesHeaderList",["brsApiClient","$q",function(s,t){var n;return function(e){var r=t.defer();if(e&&angular.isDefined(e.dateRange)&&e.dateRange==""){r.reject({message:"Das Datumsformat ist nicht korrekt."});return r.promise}if(e&&angular.isDefined(e.folder)&&(e.folder<0||e.folder>3)){r.reject({message:"Nachrichten kÃ¶nnen nicht fÃŒr dieses Feld abrufen."});return r.promise}if(!e){e={}}if(n){return n}else{n=r.promise}s.get("Customer_SecureMessage","getSecureMessagesList",e).then(function(e){r.resolve(e.secureMessageList)}).catch(function(e){r.reject(e)}).finally(function(){n=false});return r.promise}}]); "use strict";var m=angular.module("customer-secure-messages");m.service("customerSecureMessagesSendMessage",["brsApiClient","$q",function(r,t){var n;return function(e){var s=t.defer();if(!e.categoryCode||!e.subject||!e.message){s.reject({message:"Pflichtparameter fehlen, um Nachricht zu senden."});return s.promise}if(n){return n}else{n=s.promise}r.get("Customer_SecureMessage","sendSecureMessage",e).then(function(e){s.resolve(e.messageIdSent)}).catch(function(e){s.reject(e)}).finally(function(){n=false});return s.promise}}]); "use strict";var m=angular.module("customer-secure-messages");m.service("customerSecureMessagesGetCategoriesList",["brsApiClient","$q","customerSecureMessagesCategoriesList",function(r,t,i){var u;return function(e){var s=t.defer();if(i.length==0||e){if(u){return u}else{u=s.promise}r.get("Customer_SecureMessage","getMessageCategories").then(function(e){s.resolve(e.messageCategories)}).catch(function(e){s.reject(e)}).finally(function(){u=false})}else{s.resolve(i)}return s.promise}}]); "use strict";var m=angular.module("customer-secure-messages");m.service("customerSecureMessagesDeleteMessage",["brsApiClient","$q",function(s,a){var n;return function(e){var r=a.defer();if(angular.isUndefined(e)||!angular.isArray(e)||!angular.isArray(e)&&angular.isObject(e)||e.length==0){r.reject({message:"Die Nachrichten-ID fehlt."});return r.promise}if(n){return n}else{n=r.promise}s.get("Customer_SecureMessage","deleteSecureMessage",{messageIds:e}).then(function(e){r.resolve(e)}).catch(function(e){r.reject(e)}).finally(function(){n=false});return r.promise}}]); "use strict";var m=angular.module("customer-secure-messages");m.service("customerSecureMessagesArchiveMessage",["brsApiClient","$q",function(s,a){var n;return function(e){var r=a.defer();if(angular.isUndefined(e)||!angular.isArray(e)||!angular.isArray(e)&&angular.isObject(e)||e.length==0){r.reject({message:"Die Nachrichten-ID fehlt."});return r.promise}if(n){return n}else{n=r.promise}s.get("Customer_SecureMessage","archiveSecureMessage",{messageIds:e}).then(function(e){r.resolve(e)}).catch(function(e){r.reject(e)}).finally(function(){n=false});return r.promise}}]); "use strict";var m=angular.module("customer-secure-messages");m.service("customerSecureMessagesRestoreMessage",["brsApiClient","$q",function(s,a){var n;return function(e){var r=a.defer();if(angular.isUndefined(e)||!angular.isArray(e)||!angular.isArray(e)&&angular.isObject(e)||e.length==0){r.reject({message:"Die Nachrichten-ID fehlt."});return r.promise}if(n){return n}else{n=r.promise}s.get("Customer_SecureMessage","restoreSecureMessage",{messageIds:e}).then(function(e){r.resolve(e)}).catch(function(e){r.reject(e)}).finally(function(){n=false});return r.promise}}]); "use strict";var m=angular.module("customer-tax-data");m.controller("FsaDeleteModalController",["$scope","CustomerTaxDataControllerGetCountryAndFiscality","CustomerTaxDataControllerDeleteFsa","tinMaxLength","bankAccountsCurrentAccount","authUser","$log","$timeout","authOtpRequestCode","authOtpVerifyCode",function(n,e,t,a,r,o,i,u,s,c){n.hasTin=false;n.otpCodeLength=o.getOtpCodeLength();n.currentYear=(new Date).getFullYear();n.currentAccount=r;n.contactId=o.d.login+", "+n.currentAccount.name;n.country="Deutschland";n.tinMaxLength=11;if(n.user.taxIdentificationNumber===""){e().then(function(e){n.country=e.country;n.user.taxIdentificationNumber=e.taxIdentificationNumber;if(n.country==="Deutschland"&&n.user.taxIdentificationNumber!==""){n.hasTin=true}})}else{n.hasTin=true}n.onSubmit=function(){n.alerts.clear();n.isLoading(true);t(n.user).then(function(e){n.isStateSuccess(true);if(n.fsaStatus==="PENDING"){n.alerts.success("Ihr Freistellungsauftrag wurde erfolgreich gelÃ¶scht und wird Ihnen per Nachricht bestÃ€tigt.")}else{n.alerts.success("Ihr Freistellungsauftrag wurde erfolgreich gelÃ¶scht und wird Ihnen per Nachricht bestÃ€tigt. Sie finden Ihre Angaben/Ã?nderungen am folgenden Handelstag im Bereich â??Verwaltung â?? Steuerdatenâ??.")}}).catch(function(e){n.alerts.danger(e.message)}).finally(function(){n.isLoading(false)})};n.requestCode=function(){i.info("Ask for OTP code.");n.alerts.clean();n.displayFormCode=true;n.loadingRequest=false;s(true).then(function(e){n.loadingRequest=false;n.displayFormCode=true;if(angular.isDefined(e.otpToken)){n.alerts.info(e.otpToken);var t=e.otpToken.split(" ");n.strongAuthCode=parseInt(t[t.length-1],10)}u(function(){n.$broadcast("focusOn","otpCode")})}).catch(function(e){n.alerts.danger(e.message)}).finally(function(){n.loadingRequest=false})};n.verifyCode=function(e){i.info("Verify the OTP code.");n.alerts.clear();n.loadingVerify=true;c(e,true).then(function(e){if(e){n.isLoading(true);n.onSubmit()}}).catch(function(e){n.alerts.danger(e.message);n.loadingVerify=false}).finally(function(){n.loadingVerify=false})}}]); "use strict";var m=angular.module("customer-tax-data");m.controller("FsaUpdateModalController",["$scope","CustomerTaxDataControllerGetCountryAndFiscality","CustomerTaxDataControllerUpdateFsa","tinMaxLength","bankAccountsCurrentAccount","authUser","$log","$timeout","authOtpRequestCode","authOtpVerifyCode",function(n,e,t,a,r,u,i,s,o,l){n.hasTin=false;n.otpCodeLength=u.getOtpCodeLength();if(n.fsaStatus==="PENDING"){n.user.startYear=(new Date).getFullYear()+1;n.minimumAmount=1}else{n.minimumAmount=n.fsaToUpdate.exhaustedAllowance||1}if(n.user.endYear===9999){n.user.validityType=0}n.years=[];var c=(new Date).getFullYear();for(var f=c;f<=c+5;f++){n.years.unshift(f)}n.currentAccount=r;n.contactId=u.d.login+", "+n.currentAccount.name;n.country="Deutschland";n.tinMaxLength=11;if(n.user.taxIdentificationNumber===""){e().then(function(e){n.country=e.country;n.user.taxIdentificationNumber=e.taxIdentificationNumber;if(n.country==="Deutschland"&&n.user.taxIdentificationNumber!==""){n.hasTin=true}})}else{n.hasTin=true}n.canSubmit=function(){if(n.fsaStatus==="PENDING"){if(n.user.endYear){return n.user.startYear<=n.user.endYear}else{return true}}else{return true}};n.onSubmit=function(){n.alerts.clear();d();if(n.canSubmit()){n.isLoading(true);t(n.user).then(function(e){n.isStateSuccess(true);if(n.fsaStatus==="PENDING"){n.alerts.success("Ihr Freistellungsauftrag wurde erfolgreich geÃ€ndert und wird Ihnen per Nachricht bestÃ€tigt.")}else{n.alerts.success("Ihr Freistellungsauftrag wurde erfolgreich geÃ€ndert und wird Ihnen per Nachricht bestÃ€tigt. Sie finden Ihre Angaben/Ã?nderungen am folgenden Handelstag im Bereich â??Verwaltung â?? Steuerdatenâ??.")}}).catch(function(e){n.alerts.danger(e.message)}).finally(function(){n.isLoading(false)})}};function d(){if(n.user.validityType===0&&n.user.endYear){delete n.user.endYear}if(n.user.amountType===1){n.user.amount=801}}n.requestCode=function(){i.info("Ask for OTP code.");n.alerts.clean();n.displayFormCode=true;n.loadingRequest=false;o(true).then(function(e){n.loadingRequest=false;n.displayFormCode=true;if(angular.isDefined(e.otpToken)){n.alerts.info(e.otpToken);var t=e.otpToken.split(" ");n.strongAuthCode=parseInt(t[t.length-1],10)}s(function(){n.$broadcast("focusOn","otpCode")})}).catch(function(e){n.alerts.danger(e.message)}).finally(function(){n.loadingRequest=false})};n.verifyCode=function(e){i.info("Verify the OTP code.");n.alerts.clear();n.loadingVerify=true;l(e,true).then(function(e){if(e){n.isLoading(true);n.onSubmit()}}).catch(function(e){n.alerts.danger(e.message);n.loadingVerify=false}).finally(function(){n.loadingVerify=false})}}]); "use strict";var m=angular.module("customer-tax-data");m.controller("FsaCreateModalController",["$scope","CustomerTaxDataControllerGetCountryAndFiscality","CustomerTaxDataControllerCreateFsa","tinMaxLength","bankAccountsCurrentAccount","authUser","$log","$timeout","authOtpRequestCode","authOtpVerifyCode",function(n,e,t,a,r,i,s,u,l,o){n.hasTin=false;n.otpCodeLength=i.getOtpCodeLength();n.years=[];var c=(new Date).getFullYear();if(n.fsaStatus==="PENDING"){c+=1;n.user.startYear=c}for(var f=c;f<=c+5;f++){n.years.unshift(f)}n.currentAccount=r;n.contactId=i.d.login+", "+n.currentAccount.name;n.country="Deutschland";n.tinMaxLength=11;if(n.user.taxIdentificationNumber===""){e().then(function(e){n.country=e.country;n.user.taxIdentificationNumber=e.taxIdentificationNumber;if(n.country==="Deutschland"&&n.user.taxIdentificationNumber!==""){n.hasTin=true}})}else{n.hasTin=true}n.canSubmit=function(){if(n.fsaStatus==="PENDING"&&n.user.validityType===1){if(n.user.startYear>n.user.endYear){n.alerts.danger("Das von Ihnen angegebene Enddatum darf nicht vor dem Startdatum liegen. Bitte ÃŒberprÃŒfen Sie Ihre Eingabe. Sie finden Ihre Angaben/Ã?nderungen am folgenden Handelstag im Bereich â??Verwaltung â?? Steuerdatenâ??.");return false}else{return true}}else{return true}};n.onSubmit=function(){if(n.canSubmit()){n.goToPage({title:"Daten ÃŒberprÃŒfen",include:"/app/customer-tax-data/templates/modal-fsa-create-confirm.html"})}};n.goBack=function(){n.goToPage({title:"Freistellungsauftrag anlegen",include:"/app/customer-tax-data/templates/modal-fsa-create.html"})};n.requestCode=function(){s.info("Ask for OTP code.");n.alerts.clean();n.displayFormCode=false;n.loadingRequest=true;l(true).then(function(e){n.loadingRequest=false;n.displayFormCode=true;if(angular.isDefined(e.otpToken)){n.alerts.info(e.otpToken);var t=e.otpToken.split(" ");n.strongAuthCode=parseInt(t[t.length-1],10)}u(function(){n.$broadcast("focusOn","otpCode")})}).catch(function(e){n.alerts.danger(e.message)}).finally(function(){n.loadingRequest=false})};n.verifyCode=function(e){s.info("Verify the OTP code.");n.alerts.clear();n.loadingVerify=true;o(e,true).then(function(e){if(e){n.isLoading(true);t(n.user).then(function(e){n.changeModalTitle("Neuer Freistellungsauftrag");n.isStateSuccess(true);if(n.fsaStatus==="PENDING"){n.alerts.success("Ihr Freistellungsauftrag wurde erfolgreich angelegt und wird Ihnen per Nachricht bestÃ€tigt.")}else{n.alerts.success('Ihr Freistellungsauftrag wurde erfolgreich geÃ€ndert und wird Ihnen per Nachricht bestÃ€tigt. Sie finden Ihre Angaben/Ã?nderungen am folgenden Handelstag im Bereich â??Verwaltung â?? Steuerdatenâ??.<br><br>Bitte beachten Sie: der Freistellungsauftrag fÃŒr Ehegemeinschaftskonten kann derzeit nur per <a href="https://www.onvista-bank.de/files/dokumente/formulare/formularcenter/032-freistellungsauftrag.pdf" target="_blank">Formular (PDF)</a> angelegt werden.')}}).catch(function(e){if(e.code===100020){n.alerts.danger("Der Freistellungsauftrag ist nur mit deutscher amtlichen Meldeadresse mÃ¶glich.")}else if(e.code===100021){n.alerts.danger("Der Freistellungsauftrag ist ausschlieÃ?lich mit einem Einzeldepot oder Ehegemeinschaftsdepot mÃ¶glich.")}else if(e.code===100022){n.alerts.danger("Ein Freistellungsauftrag kann ausschlieÃ?lich fÃŒr Einzeldepots oder fÃŒr Ehegemeinschaftsdepots angelegt werden.")}else{n.alerts.danger("Eingabe des Freistellungsauftrages nicht mÃ¶glich. Liegt ggfs. eine NV Bescheinigung vor.")}}).finally(function(){n.loadingVerify=false;n.isLoading(false)})}}).catch(function(e){n.alerts.danger(e.message);n.loadingVerify=false}).finally(function(){n.loadingVerify=false})}}]); "use strict";var m=angular.module("customer-tax-data");m.service("fsaModal",["brsApiClient","brsUiModal","brsAppVersion",function(e,s,t){var n=t.getUrl("/app/customer-tax-data/templates/modal-fsa.html");this.openCreateModal=function(e,t){return s.open(s.getConfig("draggable","lg",{templateUrl:n,controller:"FsaModalController",resolve:{fsaList:function(){return e},fsaStatus:function(){return t},fsaToUpdate:function(){return undefined},fsaToDelete:function(){return undefined}}})).result};this.openUpdateModal=function(e,t,a){return s.open(s.getConfig("draggable","lg",{templateUrl:n,controller:"FsaModalController",resolve:{fsaList:function(){return e},fsaStatus:function(){return t},fsaToUpdate:function(){return a},fsaToDelete:function(){return undefined}}})).result};this.openDeleteModal=function(e,t,a){return s.open(s.getConfig("draggable","lg",{templateUrl:n,controller:"FsaModalController",resolve:{fsaList:function(){return e},fsaStatus:function(){return t},fsaToUpdate:function(){return undefined},fsaToDelete:function(){return a}}})).result}}]);m.controller("FsaModalController",["$modalInstance","$scope","fsaList","fsaStatus","fsaToUpdate","fsaToDelete","BrsUiAlert","brsAppVersion",function(e,s,t,a,n,r,l,i){s.$modalInstance=e;s.loading=false;s.alerts=new l;if(n){s.title="Freistellungsauftrag Ã€ndern";s.include=i.getUrl("/app/customer-tax-data/templates/modal-fsa-update.html");s.fsaToUpdate=n}else if(r){s.title="Freistellungsauftrag widerrufen";s.include=i.getUrl("/app/customer-tax-data/templates/modal-fsa-delete.html");s.fsaToDelete=r}else{s.title="Freistellungsauftrag anlegen";if(authUser.useStrongAuth()){s.include=i.getUrl("/app/customer-tax-data/templates/modal-fsa-create.html")}else{s.alerts.info("Der Freistellungsauftrag kann nicht online erteilt werden, weil Sie nicht fÃŒr das Sicherheitscode-Verfahren freigeschaltet sind. FÃŒr die Aktivierung des SMS-Verfahrens rufen Sie unseren Kundenservice unter 069-7107-530 an.")}}s.fsaList=t;s.fsaStatus=a;s.success=false;if(n){s.user={fsaId:n.associatedFsa.fsaId,amountType:n.associatedFsa.amount===801?1:0,amount:n.associatedFsa.amount,validityType:1,endYear:parseInt(n.associatedFsa.endDate.split("-").shift())};if(n.associatedFsa.startYear)s.user.startYear=parseInt(n.associatedFsa.start.split("-").shift())}else if(r){s.user={fsaId:r.associatedFsa.fsaId,erase:0}}else{s.user={}}s.user.fsaType=0;s.user.taxIdentificationNumber="";s.user.fsaStatus=a;s.goToPage=function(e){s.title=e.title;s.include=i.getUrl(e.include);s.alerts.clear()};s.cancel=function(){if(s.success){s.$modalInstance.close()}else{s.$modalInstance.dismiss({message:"cancel"})}};s.changeModalTitle=function(e){s.title=e};s.hasFsaWithStatus=function(e){var t=[];var a=[];s.fsaList.forEach(function(e){switch(e.status){case 1:t.push(e);break;case 3:a.push(e);break}});switch(e){case"ACTIVE":return t.length>0;case"PENDING":return a.length>0;default:return t.length>0&&a.length>0}};s.isLoading=function(e){s.loading=angular.isUndefined(arguments[0])?s.loading:arguments[0];return s.loading};s.isStateSuccess=function(e){s.success=angular.isUndefined(arguments[0])?s.success:arguments[0];return s.success}}]); "use strict";var m=angular.module("customer-tax-data");m.controller("CustomerTaxDataController",["$scope",function(e){}]);m.controller("CustomerTaxDataBlockController",["$rootScope","$scope","$log","authUser","BrsUiPagination","BrsUiAlert","CustomerTaxDataControllerGetAccounts","CustomerTaxDataControllerChangeTax","bankAccountsGetAccountsList","bankAccountsList","bankAccountsCurrentAccount","$moment","fsaStatus","CustomerTaxDataControllerGetFsaList","fsaModal",function(e,n,t,a,o,c,r,s,i,u,l,f,d,g,h){t=t.getInstance("CustomerTaxDataBlockController");n.isBlockLoading=false;n.authUser=a;n.pagination=new o;n.alerts=new c;n.itemsPerPage=10;n.accounts=[];n.selectedYear=(new Date).getFullYear();n.creating={inProgress:false};n.orderBy={name:"updateDate",reverse:true};n.availableYears=[];for(var m=n.selectedYear;m>=2015;m--){n.availableYears.push(m)}n.totals={requestedAllowance:0,exhaustedAllowance:0,remainingAllowance:0,shareLossPot:0,generalLossPot:0,accruedInterestPot:0,withholdingTaxPot:0};n.section="ACTIVE";n.init=function(){t.debug("init");p()};n.close=function(){};n.refreshBlockContent=function(){t.debug("refreshBlockContent");p()};n.changeTaxPreference=function(){t.debug("changeTaxPreference");D()};n.displayAlerts=function(){};n.changeSelectedYear=function(){p()};n.changeSection=function(e){n.section=e;x()};function x(){n.accountsByStatus=n.accounts.filter(function(e){return d[n.section].indexOf(e.status)!==-1});n.pagination.init(n.accountsByStatus,n.itemsPerPage,true)}function p(){n.isBlockLoading=true;n.alerts.clean();i().then(function(e){n.accountsList=u;n.currentAccount=l;C()}).catch(function(e){n.alerts.danger(e.message);n.isBlockLoading=false}).finally(function(){})}function C(){n.accounts=[];n.alerts.clean();t.debug("requestTaxAccounts");n.isBlockLoading=true;r(n.currentAccount.accountKey,n.selectedYear).then(function(e){n.taxPreference=e.taxPreference;n.taxMax=e.taxMax;n.totals=e.totals;n.stand=f().subtract(1,"days").format("DD.MM.YYYY");n.religion=e.religion;if(e.compensationTax&&e.compensationTax.length>0){n.accounts=e.compensationTax;B()}else{n.alerts.danger("Bei der Abfrage Ihrer Steuerdaten ist ein Fehler aufgetreten. Bitte versuchen Sie es spÃ€ter noch einmal.")}}).catch(function(e){n.alerts.danger(e.message)}).finally(function(){n.isBlockLoading=false})}function B(){g().then(function(e){var a=e.fsaList;n.accounts=n.accounts.map(function(e){for(var t=0;t<a.length;t++){e.isJoint=a[t].fsaType==1;if(a[t].accounts.constructor===Array){for(var n=0;n<a[t].accounts.length;n++){if(a[t].accounts[n].indexOf(e.accountNumber)>-1){if(a[t].status!==3){e.associatedFsa=a[t];e.status=a[t].status;return e}}}}if(a[t].accounts.indexOf(e.accountNumber)>-1){if(a[t].status!==3){e.associatedFsa=a[t];e.status=a[t].status;return e}}}return e});for(var t=0;t<a.length;t++){if(a[t].status===3){n.accounts.push({accountNumber:a[t].accounts,requestedAllowance:a[t].amount,associatedFsa:a[t],end:a[t].endDate?a[t].endDate.substring(0,10):undefined,start:a[t].startDate?a[t].startDate.substring(0,10):undefined,status:a[t].status,isJoint:a[t].fsaType==1})}}x();n.orderBy.name="updateDate";n.orderBy.reverse=true;A();if(n.pagination.filtered.length>0){if(f(n.pagination.filtered[0].updateDate).isValid()){n.stand=f(n.pagination.filtered[0].updateDate).format("DD.MM.YYYY")}}})}function D(){if(!n.isBlockLoading){t.debug("requestChangeTaxPreference");n.isBlockLoading=true;s(n.taxPreference).then(function(e){n.taxPreference=e.taxPreference;n.taxMax=e.taxMax}).catch(function(e){n.alerts.danger(e.message)}).finally(function(){n.isBlockLoading=false})}}e.$on("accounts:changeCurrent",function(e,t){n.currentAccount=t;C()});n.onSortChange=function(e,t){n.orderBy.name=e;n.orderBy.reverse=t;A()};n.openCreateFsaModal=function(e){h.openCreateModal(n.accounts,e).then(function(){n.refreshBlockContent()})};n.openUpdateFsaModal=function(e,t){h.openUpdateModal(n.accounts,e,t).then(function(){n.refreshBlockContent()})};n.openDeleteFsaModal=function(e,t){h.openDeleteModal(n.accounts,e,t).then(function(){n.refreshBlockContent()})};n.hasPendingFsa=function(){var t=[];n.accounts.forEach(function(e){if(e.status===3)t.push(e)});return t.length>0};function A(){n.pagination.filter(n.orderBy.name,n.orderBy.reverse)}n.init()}]);m.controller("CustomerTaxDataBlockElementController",["$scope","CustomerTaxDataControllerEditAccount","CustomerTaxDataControllerDeleteAccount",function(t,n,a){t.isElementLoading=false;t.isEditing=false;t.editToggle=function(){t.isEditing=!t.isEditing};t.cancel=function(){t.isEditing=false};t.deleteAccount=function(){e(t.account.accountNumber)};t.editAccount=function(){o(t.account)};function e(e){a(e).then(function(e){t.refreshBlockContent()}).catch(function(e){}).finally(function(){})}function o(e){n(e,t.selectedYear).then(function(e){t.refreshBlockContent()}).catch(function(e){}).finally(function(){})}}]); "use strict";var m=angular.module("customer-tax-data",[]);m.directive("customerTaxDataAccount",["brsAppVersion",function(t){return{restrict:"A",templateUrl:t.getUrl("/app/customer-tax-data/templates/element.html")}}]);m.directive("customerTaxDataAccountPending",["brsAppVersion",function(t){return{restrict:"A",templateUrl:t.getUrl("/app/customer-tax-data/templates/element-pending.html")}}]);m.directive("customerTaxDataAccountNew",["CustomerTaxDataControllerAddAccount","brsAppVersion",function(r,t){return{restrict:"A",scope:{config:"=customerTaxDataAccountNewConfig",onCreatedAccount:"&",year:"=customerTaxDataYear"},templateUrl:t.getUrl("/app/customer-tax-data/templates/new.html"),controller:["$scope",function(t){}],link:function(e,t,n){e.addExternalAccount=function(){a(e.newAccount)};function a(t){r(t,e.year).then(function(t){e.config.inProgress=false;e.onCreatedAccount()}).catch(function(t){}).finally(function(){})}}}}]); "use strict";var m=angular.module("customer-tax-data");m.service("CustomerTaxDataControllerGetAccounts",["brsApiClient","$q",function(a,o){var i;return function(e,t){var r=o.defer();if(i){return i}else{i=r.promise}if(t===undefined||null){var n=new Date;t=n.getFullYear()}a.get("Customer_CompensationTax","getAllCompensationTax",{accountKey:e,year:t}).then(function(e){delete e["_meta"];r.resolve(e)}).catch(function(e){r.reject(e)}).finally(function(){i=false});return r.promise}}]);m.service("CustomerTaxDataControllerAddAccount",["brsApiClient","$q",function(a,o){var i,u;return function(e,t){var r=o.defer();if(i){return i}else{i=r.promise}if(t===undefined||null){var n=new Date;t=n.getFullYear()}u={accountLabel:e.accountLabel,accountNumber:e.accountNumber,freibetrag:e.requestedAllowance,used_freibetrag:e.exhaustedAllowance,remaining_freibetrag:e.remainingAllowance,stuckzinstopf:e.accruedInterestPot,aktienverlusttopf:e.shareLossPot,allgemeiner_verlusttopf:e.generalLossPot,quellensteuerstopf:e.withholdingTaxPot,kapital:e.kapital,solidaritat:e.solidaritat,kirchen:e.kirchen,start:e.start,end:e.end,year:t};a.get("Customer_CompensationTax","addExternalAccount",u).then(function(e){delete e["_meta"];r.resolve(e)}).catch(function(e){r.reject(e)}).finally(function(){i=false});return r.promise}}]);m.service("CustomerTaxDataControllerEditAccount",["brsApiClient","$q",function(a,o){var i,u;return function(e,t){var r=o.defer();if(i){return i}else{i=r.promise}if(t===undefined||null){var n=new Date;t=n.getFullYear()}u={accountLabel:e.accountLabel,accountNumber:e.accountNumber,freibetrag:e.requestedAllowance,used_freibetrag:e.exhaustedAllowance,remaining_freibetrag:e.remainingAllowance,stuckzinstopf:e.accruedInterestPot,aktienverlusttopf:e.shareLossPot,allgemeiner_verlusttopf:e.generalLossPot,quellensteuerstopf:e.withholdingTaxPot,kapital:e.capital,solidaritat:e.solidarity,kirchen:e.church,start:e.start,end:e.end,year:t};a.get("Customer_CompensationTax","editExternalAccount",u).then(function(e){delete e["_meta"];r.resolve(e)}).catch(function(e){r.reject(e)}).finally(function(){i=false});return r.promise}}]);m.service("CustomerTaxDataControllerDeleteAccount",["brsApiClient","$q",function(r,n){var a;return function(e){var t=n.defer();if(a){return a}else{a=t.promise}r.get("Customer_CompensationTax","deleteExternalAccount",{accountNumber:e}).then(function(e){delete e["_meta"];t.resolve(e)}).catch(function(e){t.reject(e)}).finally(function(){a=false});return t.promise}}]);m.service("CustomerTaxDataControllerChangeTax",["brsApiClient","$q",function(r,n){var a;return function(e){var t=n.defer();if(a){return a}else{a=t.promise}r.get("Customer_CompensationTax","changeTaxPreference",{taxPreference:e}).then(function(e){delete e["_meta"];t.resolve(e)}).catch(function(e){t.reject(e)}).finally(function(){a=false});return t.promise}}]);m.service("CustomerTaxDataControllerGetFsaList",["brsApiClient","$q",function(e,r){var n;return function(){var t=r.defer();if(n){return n}else{n=t.promise}e.get("Customer_CompensationTax","getFsaList").then(function(e){delete e["_meta"];t.resolve(e)}).catch(function(e){t.reject(e)}).finally(function(){n=false});return t.promise}}]);m.service("CustomerTaxDataControllerCreateFsa",["brsApiClient","$q",function(n,a){var o;return function(e){var t=angular.copy(e);var r=a.defer();if(o){return o}else{o=r.promise}n.get("Customer_CompensationTax","createFsa",t).then(function(e){delete e["_meta"];r.resolve(e)}).catch(function(e){r.reject(e)}).finally(function(){o=false});return r.promise}}]);m.service("CustomerTaxDataControllerUpdateFsa",["brsApiClient","$q",function(n,a){var o;return function(e){var t=angular.copy(e);var r=a.defer();if(o){return o}else{o=r.promise}n.get("Customer_CompensationTax","updateFsa",t).then(function(e){delete e["_meta"];r.resolve(e)}).catch(function(e){r.reject(e)}).finally(function(){o=false});return r.promise}}]);m.service("CustomerTaxDataControllerDeleteFsa",["brsApiClient","$q",function(n,a){var o;return function(e){var t=angular.copy(e);var r=a.defer();if(o){return o}else{o=r.promise}n.get("Customer_CompensationTax","deleteFsa",t).then(function(e){delete e["_meta"];r.resolve(e)}).catch(function(e){r.reject(e)}).finally(function(){o=false});return r.promise}}]);m.service("CustomerTaxDataControllerGetCountryAndFiscality",["brsApiClient","$q",function(e,r){var n;return function(){var t=r.defer();if(n){return n}else{n=t.promise}e.get("Customer_Details","getCountryAndFiscality").then(function(e){delete e["_meta"];t.resolve(e)}).catch(function(e){t.reject(e)}).finally(function(){n=false});return t.promise}}]); "use strict";var m=angular.module("customer-tax-data",["brs-api-client","auth-user","auth-otp"]);m.constant("fsaStatus",{OLD:[-1],ACTIVE:[1],PENDING:[3]});m.filter("fsaEndDate",["dateFilter",function(n){return function(t,e){if(t!==undefined){if(t=="31.12.9999"||t.indexOf("9999-12-31")>-1){t="unbefristet"}else{t=n(t,e)}}return t}}]);m.filter("fsaType",function(){return function(t){switch(t){case"INDIVIDUAL":return"Einzel-FSA";default:return""}}}); "use strict";var m=angular.module("customer-messages",["customer-secure-messages"]);m.value("newMessagesDisplayed",[]); "use strict";var m=angular.module("customer-messages");m.directive("customerMessagesCarousel",["$rootScope","authUser","$log","customerMessagesGetMessages","newMessagesDisplayed","$timeout","$interval","brsAppVersion","customerSecureMessagesGetCount","customerSecureMessagesCount","brsGrowl",function(l,u,c,f,g,d,m,n,p,h,M){c=c.getInstance("customerMessagesCarousel");return{restrict:"A",scope:{},templateUrl:function(e,s){return n.getUrl("/app/customer-messages/templates/carousel.html")},controller:["$scope",function(e){}],link:function(s,e,n){s.messages=[];s.initMySlider=function(){if($("#info-slider")){$("#info-slider").carousel({interval:false,pause:true});$("#info-slider .item:first-child").addClass("active");var e=$("#info-slider .item").size();c.debug("size",$("#info-slider .item").size());if(e>1){$("#info-slider .btn-next").show();$("#info-slider .btn-prev").show()}else{$("#info-slider .btn-next").hide();$("#info-slider .btn-prev").hide()}}};s.slideNext=function(){$("#info-slider").carousel("next")};s.slidePrev=function(){$("#info-slider").carousel("prev")};s.loadMessages=function(){i()};function i(){c.debug("requestMessages");s.isCarouselLoading=true;f(10).then(function(e){s.messages=e.archive;s.newMessage=e.newMessage;if(s.newMessage.length>0){s.newMessage.forEach(function(e){if(!a(e)){M.fire({icon:"fa fa-exclamation-triangle",title:" <strong>Mitteilung der onvista bank</strong> ",message:e.message},{delay:5e3});g.push(e)}})}c.debug("$scope.messages",s.messages);d(function(){s.initMySlider()},0,false)}).catch(function(e){}).finally(function(){s.isCarouselLoading=false})}function a(s){var n=false;c.debug("newMessagesDisplayed",g);c.debug("messageDisplayed messageToDisplay",s);g.forEach(function(e){if(e.id==s.id){c.debug("message already displayed");n=true}});return n}var t=false;function r(){var s=h[0].totalUnreadMessages;i();t=true;p({folder:0}).then(function(e){if(angular.isDefined(s)&&s!=e.totalUnreadMessages){l.$broadcast("secureMessage:requireRefresh");M.fire({icon:"fa fa-envelope-o",title:" <strong>Sie haben eine neue Nachricht erhalten</strong>",onclick:"$('#openSecureMessageBlock').click();"})}angular.extend(h[0],e)}).finally(function(){t=false})}r();var o=m(r,9e5);s.$on("$destroy",function(){if(o){m.cancel(o)}});l.$on("brsCallSuccess",function(e,s){if(u.isLogged()&&!t){var n=false;s.forEach(function(e){if(e.name=="setTradingExperiences"){n=true}});c.debug("brsCallSuccess shouldGetMessages ",n);if(n){r()}}})}}}]); "use strict";var m=angular.module("customer-messages");m.service("customerMessagesGetMessages",["brsApiClient","$q",function(r,t){var n,i;return function(e){var s=t.defer();if(n){return n}else{n=s.promise}i=r.service("Customer_Message","getMessages",{nb:e,capped:true,withArchive:true});i.deferred.promise.then(function(e){delete e["_meta"];s.resolve(e.messages)}).catch(function(e){s.reject(e)}).finally(function(){n=false});r.query([i]);return s.promise}}]); "use strict";var m=angular.module("feed-exchange",["brs-api-client"]);m.service("feedExchangeGetBySymbol",["brsApiClient",function(l){return function(e,n,a,s,r,t){n=n===undefined?false:n;a=a===undefined?false:a;s=s===undefined?false:s;r=r===undefined?false:r;var i={symbol:e,withIssuers:n,withDerivative:a,onlyTrading:s,onlySameCurrency:r};if(t){i.atosSymbol=t}var u=false;return l.get("Common_Utils","getAdminConfigValue",{configKey:"DEACTIVATE_FEATURE_QUOTES",configNamespace:"BANK"}).then(function(e){if(e.configValue){u=true}return l.get("Feed_exchange","getBySymbol",i)}).then(function(e){e.isQuotesDeactivated=u;return e})}}]);m.service("feedExchangeGetSortedListBySymbol",["feedExchangeGetBySymbol","$filter",function(s,t){return function(e,n,a){return s(e,true,false,true,n,a).then(function(e){var a=[];var n={Direkthandel:[],Fondshandel:[],"BÃ¶rsenhandel Inland":[],"BÃ¶rsenhandel Ausland":[]};for(var s=0;s<e.marketExchanges.length;s++){var r={isOtc:false};angular.extend(r,e.marketExchanges[s]);if(r.instrument.category==="FND"){r.category="Fondshandel";n["Fondshandel"].push(r)}else if(e.marketExchanges[s].isGermanExchange){r.category="BÃ¶rsenhandel Inland";n["BÃ¶rsenhandel Inland"].push(r)}else{if(r.exchangeLabel!=="Tradegate"){r.category="BÃ¶rsenhandel Ausland";n["BÃ¶rsenhandel Ausland"].push(r)}}}for(var s=0;s<e.issuersExchanges.length;s++){var r=e.issuersExchanges[s];if(r.issuer&&!r.issuer.hasLimit){continue}n["Direkthandel"].push({symbol:r.symbol,exchangeLabel:r.exchangeLabel+" Limit",issuerId:r.issuerId,issuer:r.issuer,isOtc:false,category:"Direkthandel",instrument:r.instrument})}if(!e.isQuotesDeactivated){for(var s=e.issuersExchanges.length;s>0;s--){var r={isOtc:true,category:"Direkthandel"};angular.extend(r,e.issuersExchanges[s-1]);n["Direkthandel"].push(r)}}angular.forEach(n,function(e,n){a.push.apply(a,t("orderBy")(e,"exchangeLabel"))});a.isQuotesDeactivated=!!e.isQuotesDeactivated;return a})}}]); "use strict";var m=angular.module("feed-instrument");m.service("feedInstrumentGetFunds",["brsApiClient",function(n){return function(e){return n.get("Feed_Instrument","getFunds",e)}}]); "use strict";var m=angular.module("feed-instrument");m.service("feedInstrumentSearch",["brsApiClient",function(t){return function(e,r){var n={category:"",fullSearch:false,onlyTrading:false};angular.extend(n,e);if(angular.isDefined(r)&&r&&r!=""){n.ref=r}return t.get("Feed_Instrument","search",n)}}]); "use strict";var m=angular.module("feed-instrument",["brs-api-client"]);m.controller("BlockFeedSearchController",["$scope","brsApiClient","$log",function(t,r,n){n=n.getInstance("BlockFeedSearchController");t.code="";t.search=function(){var e=r.service("Feed_Instrument","search",{code:t.code,category:t.category});t.instruments=[];e.on("success",function(e,r){n.debug(r.data.instruments,e);t.instruments=r.data.instruments;t.error=null;t.$apply()});e.on("error",function(e,r){n.error(r.error,e);t.error=r.error;t.$apply()});r.query([e])};t.hasError=function(){var e=t.feedSeachFrom.code,r=!e.$valid;if(e.$pristine||e.$pristine&&e.$focused||r&&e.$focused){r=false}return r};t.removeBlock=function(){t.$destroy()}}]);m.directive("brsBlockSearch",["brsAppVersion",function(e){return{templateUrl:e.getUrl("/app/feed-instrument/templates/block-search.html")}}]);m.directive("brsInstrument",["brsAppVersion",function(e){return{templateUrl:e.getUrl("/app/feed-instrument/templates/instrument-small.html")}}]); "use strict";var m=angular.module("feed-instrument");m.directive("feedInstrumentSnapshot",[function(){return{template:"<a ng-href='{{ snapshotLink.begin + isin + snapshotLink.end }}' title='{{ title }}' ng-click='openModal($event)' class='btn btn-white btn-xs btn-onvista' target='_blank'><i class='btn-finanzen'><i class='fa fa-circle-o' aria-hidden='true'></i></a>",scope:{isin:"=feedInstrumentSnapshot"},controller:["$scope","brsAppConfig","brsUiModal","brsAppVersion","SNAPSHOT_LINK",function(t,s,i,a,n){t.snapshotLink=n;if(s.isPartnerMode()){t.title="Im finanzen-net-Snapshot ansehen"}else{t.title="Im OnVista-Snapshot ansehen"}t.openModal=function(n){if(s.isPartnerMode()){n.preventDefault()}else{return}var e={isin:t.isin};i.open(i.getConfig("draggable","lg",{templateUrl:a.getUrl("/app/feed-instrument/templates/modal-snapshot.html"),controller:["$scope","$modalInstance","params","SNAPSHOT_LINK",o],resolve:{params:function(){return e}}})).result.then(function(){},function(n){})};function o(n,e,t,s){n.isin=t.isin;n.snapshotLink=s;n.cancel=function(){e.dismiss("cancel")}}}]}}]); "use strict";(function(i){i.module("financial-overview").controller("FinancialOverviewBlockController",["$rootScope","$scope","$log","financialOverviewService","brsUiSearchDateIsin","tradingOrderGetOrdersDetails","bankAccountsCurrentAccount","bankAccountsGetAccountsList","bankAccountsList","bankAccountsCurrentAccountOverview","bankAccountsGetClearingOrCfdAccountsOverview","BrsUiAlert","brsApiClient","authUser",e]);function e(e,t,i,n,s,c,r,o,a,u,f,l,h,v){var A=this;this.log=i.getInstance("FinancialOverviewBlockController");this.scope=t;this.currentAccount=r;this.financialOverviewService=n;this.bankAccountsGetAccountsList=o;this.bankAccountsList=a;this.bankAccountsGetClearingOrCfdAccountsOverview=f;this.bankAccountsCurrentAccountOverview=u;this.tradingOrderGetOrdersDetails=c;this.search=new s;this.brsApiClient=h;this.authUser=v;this.unavailable="The financial overview block is a work in progress.";this.alerts=new l;this.isBlockLoading=0;this.isDeactivated=false;this.isRefreshed=false;this.init();this.scope.$on("accounts:changeCurrent",function(){A.refresh()})}e.prototype.init=function(){var t=this;t.doBeforeRequest();t.brsApiClient.get("Common_Utils","getAdminConfigValue",{configKey:"DEACTIVATE_MODULE_FINANZUBERSICHT",configNamespace:"BANK"}).then(function(e){t.isDeactivated=false;if(e.configValue){t.isDeactivated=true;t.isRefreshed=false}return t.brsApiClient.get("Common_Utils","getAdminConfigValue",{configKey:"DEACTIVATE_MODULES_AUTOLOAD",configNamespace:"BANK"})}).then(function(e){t.isRefreshed=!t.isDeactivated&&(t.isRefreshed||!e.configValue);if(t.isRefreshed&&t.authUser.isLogged()){t.requestPositions();t.getAccountOverview();t.requestLastTransactions()}}).catch(function(e){t.doAfterRequestFail(e)}).finally(function(){t.doAfterRequest()})};e.prototype.refresh=function(){var e=this;e.isRefreshed=true;e.init()};e.prototype.getAccountOverview=function(){var t=this;this.doBeforeRequest();if(this.bankAccountsCurrentAccountOverview.length===0){this.bankAccountsGetClearingOrCfdAccountsOverview(this.currentAccount.accountKey).then(function(e){i.extend(t.bankAccountsCurrentAccountOverview,e);t.accountOverview=t.bankAccountsCurrentAccountOverview}).catch(function(e){t.doAfterRequestFail(e)}).finally(function(){t.doAfterRequest()})}else{t.accountOverview=t.bankAccountsCurrentAccountOverview}};e.prototype.requestPositions=function(){var t=this;this.doBeforeRequest();this.financialOverviewService(this.currentAccount.accountKey).then(function(e){t.log.debug("requestPositions",e);t.financialOverview=e.financialOverview}).catch(function(e){t.doAfterRequestFail(e)}).finally(function(){t.doAfterRequest()})};e.prototype.requestLastTransactions=function(){var t=this;var e=this.search.getParams();i.extend(e,{accountKey:this.currentAccount.accountKey,entireList:true,executionDetails:true});this.tradingOrderGetOrdersDetails(e).then(function(e){t.orderList=e.ordersDetails}).catch(function(e){t.doAfterRequestFail(e)}).finally(function(){t.doAfterRequest();t.search.disabled=false})};e.prototype.doBeforeRequest=function(){this.alerts.clean();this.isBlockLoading++};e.prototype.doAfterRequestSuccess=function(e){};e.prototype.doAfterRequestFail=function(e){this.alerts.danger(e.message)};e.prototype.doAfterRequest=function(){this.isBlockLoading--}})(angular); "use strict";(function(e){e.module("financial-overview").service("financialOverviewService",["brsApiClient","$q",n]);function n(i,r){var t;return function(e){var n=r.defer();if(!e){return n.promise}if(t){return t}else{t=n.promise}i.get("Bank_Overview","getFinancialOverview",{accountKey:e}).then(function(e){delete e["_meta"];n.resolve(e)}).catch(function(e){n.reject(e)}).finally(function(){t=false});return n.promise}}})(angular); "use strict";var m=angular.module("form-center",["brs-ui-modal"]);m.controller("FormCenterController",["$scope","brsUiModal","brsAppVersion",function(e,r,t){e.openFormCenterModal=function(){var e=r.open(r.getConfig("draggable","lg",{templateUrl:t.getUrl("/app/form-center/templates/modal-form-center.html"),controller:"ModalFormCenterController"}))}}]);m.controller("ModalFormCenterController",["$scope","$modalInstance","bankAccountsCurrentAccount","BRS_API_ENDPOINT","brsAppConfig",function(e,r,t,n,o){e.cancel=function(){r.dismiss("cancel")};e.baseUrl=n+"/formular-pdf-generation.phtml?accountKey="+t.accountKey+"&name=";e.isPartnerMode=o.isPartnerMode();if(o.isPartnerMode()){e.url={update_eaccount:"https://www.onvista-bank.de/files/dokumente/formulare/formularcenter/070-aenderung-referenzkonto.pdf",depot:"https://dokumente.finanzen-broker.net/f031-depot-uebertrag.pdf",parrainage:"",depot_attorney:"https://www.onvista-bank.de/files/dokumente/formulare/formularcenter/050-konto-depot-vollmacht.pdf",open_cfd_account:"https://dokumente.finanzen-broker.net/f159-cfd-kontoeroeffnung.pdf",securities_credit_application:"https://www.onvista-bank.de/files/dokumente/formulare/formularcenter/090-wertpapierkredit-einzel-gemeinschaftskonto.pdf",intraday_credit_request:"https://www.onvista-bank.de/files/dokumente/formulare/formularcenter/155-intraday-kreditantrag.pdf",covered_call_writting:"https://www.onvista-bank.de/files/dokumente/formulare/formularcenter/035-covered-call-writing.pdf",exemption_order:"https://dokumente.finanzen-broker.net/f032-freistellungsauftrag.pdf",form_center:"https://www.finanzen-broker.net/formulare.aspx"}}else{e.url={update_eaccount:"https://www.onvista-bank.de/files/dokumente/formulare/formularcenter/070-aenderung-referenzkonto.pdf",depot:"https://www.onvista-bank.de/files/dokumente/formulare/formularcenter/031-depot-uebertrag.pdf",parrainage:"https://www.onvista-bank.de/files/dokumente/formulare/formularcenter/028-freundschaftswerbung.pdf",depot_attorney:"https://www.onvista-bank.de/files/dokumente/formulare/formularcenter/050-konto-depot-vollmacht.pdf",open_cfd_account:"https://www.onvista-bank.de/files/dokumente/formulare/formularcenter/159-cfd-kontoeroeffnung.pdf",securities_credit_application:"https://www.onvista-bank.de/files/dokumente/formulare/formularcenter/090-wertpapierkredit-einzel-gemeinschaftskonto.pdf",intraday_credit_request:"https://www.onvista-bank.de/files/dokumente/formulare/formularcenter/155-intraday-kreditantrag.pdf",covered_call_writting:"https://www.onvista-bank.de/files/dokumente/formulare/formularcenter/035-covered-call-writing.pdf",exemption_order:"https://www.onvista-bank.de/files/dokumente/formulare/formularcenter/032-freistellungsauftrag.pdf",form_center:"https://www.onvista-bank.de/service/uebersicht/formulare.html"}}}]); "use strict";var m=angular.module("navigation",["auth-user"]);m.controller("NavigationBottomNavbarController",["$scope","authUser","brsUiGridDesktop",function(t,e,r){t.authUser=e;t.switchDesktop=function(t){r.setDesktop(t)};t.getCurrentDesktop=function(){return r.getDesktopNumber()};t.clearCurrentDesktop=function(){r.clear()}}]); "use strict";var m=angular.module("navigation-fixed",[]);m.directive("navigationFixed",function(){return{restrict:"A",link:function(i,n){n.fixedsticky()}}}); "use strict";var m=angular.module("navigation",["auth-user"]);m.controller("NavigationMiddleNavbarController",["$scope","authUser","brsAppVersion",function(a,e,t){a.bankAccountsMenuTemplateUrl=t.getUrl("/app/bank-accounts/templates/block-bank-accounts-menu.html");a.authUser=e;a.isCollapsed=true;a.toggleNavbar=function(){a.isCollapsed=!a.isCollapsed}}]); "use strict";var m=angular.module("navigation",["auth-login","auth-user","brs-ui-modal","customer-messages","bank-activation","customer-secure-messages"]);m.controller("NavigationTopNavbarController",["$rootScope","$scope","$log","authUser","authLoginPerformLogout","authUserRefresh","$interval","brsUiModal","$moment","$window","activationModal","customerPostboxGetUrl","brsAppVersion","customerSecureMessagesCount","authLoginPccChangeUser","brsAppConfig",function(e,n,t,a,o,s,r,u,i,l,c,g,m,f,p,d){t=t.getInstance("NavigationTopNavbarController");n.loginPccSwitchTemplateUrl=m.getUrl("/app/auth-login/templates/login-pcc-switch.html");n.cashAdjustLinkPccTemplateUrl=m.getUrl("/app/bank-cash-adjust/templates/menu-item.html");n.authUser=a;n.counterBase=18e5;n.counter=angular.copy(n.counterBase);n.timer=null;n.timeoutToLogout=false;n.secureMessagesCount=f;n.newLogin={userId:"",lockForm:false};n.partnerMode=d.isPartnerMode();if(d.isPartnerMode()){n.trusteerTemplateUrl=m.getUrl("/app/navigation/templates/partner_trusteer.html")}else{n.trusteerTemplateUrl=m.getUrl("/app/navigation/templates/trusteer.html")}n.countdown=function(){n.timer=r(function(){n.counter-=1e3;if(n.counter==0||i().isAfter(n.timeoutToLogout)){t.warn("LOGOUT FROM COUNTDOWN");n.stop();n.logout()}},1e3)};n.stop=function(){if(n.timer){r.cancel(n.timer)}n.timer=null;n.counter=angular.copy(n.counterBase)};n.reset=function(){n.stop();n.timeoutToLogout=i().add(n.counterBase,"ms");t.info("Reset timer to logout, new timeout to logout:",n.timeoutToLogout.format("dddd, MMMM Do YYYY, h:mm:ss a"));n.countdown()};n.logout=function(){o().catch(function(){t.warn("Couldn't logout (maybe not access to the web anymore), so logout locally.");a.reset();e.$broadcast("auth:logout",a);e.displayUserConnected=false;l.location.replace("/login")})};n.refreshUser=function(){$("#refreshUserBtn").addClass("fa-spin");s().finally(function(){$("#refreshUserBtn").removeClass("fa-spin")})};n.postbox=function(){var t=window.open("","Postbox");g().then(function(e){n.url=e.replace(new RegExp("(amp;)","g"),"");t.location.href=n.url}).catch(function(e){}).finally(function(){})};e.$on("brsCallSuccess",function(e,t){var o=true;t.forEach(function(e){if(e.name=="getMessages"||e.name=="getSecureMessage"||e.name==="getSecureMessagesList"||e.name==="getSecureMessagesCount"){o=false}});if(n.authUser.isLogged()&&o){n.reset();if(!a.isPcc()&&!a.isActivated()){c()}}});e.$on("auth:logout",function(e,t){n.stop()});e.$on("auth:logout:failed",function(){t.warn("auth:logout:failed Couldn't logout (maybe the network connection isn't active), so logout locally.");a.reset();e.$broadcast("auth:logout",a);e.displayUserConnected=false;l.location.replace("https://www.onvista-bank.de/logout.html")});n.changePccUser=function(){if(angular.isDefined(n.newLogin.userId)&&n.newLogin.userId!=""){n.newLogin.lockForm=true;p(n.newLogin.userId).finally(function(){n.newLogin.userId="";n.newLogin.lockForm=false})}}}]); "use strict";var m=angular.module("navigation",[]);m.controller("FooterController",["$rootScope","$scope","$log","$cookieStore","$window","brsAppConfig",function(o,e,r,t,n,c){r=r.getInstance("FooterController");e.forceDesktop=function(){r.log("forceDesktop");t.put("forceDesktop",true);n.location.reload()};e.isPartnerMode=c.isPartnerMode()}]); "use strict";var m=angular.module("secure-matrix",["brs-api-client"]);m.factory("SecureMatrixFactory",["brsApiClient","$q","BRS_API_ENDPOINT","$timeout","$interval","$moment","$log",function(a,u,t,c,d,l,h){var e=function(){this.password="";this.hiddenPassword=[];this.matrix=false;this.container="";this.fakeInput=false;this.visible=false;this.expired=false;this.counterBase=3e5;this.counter=angular.copy(this.counterBase);this.timer=null;this.timeoutToInvalidMatrix=false;this.token="";this.enterPasswordMessage="Ihr Passwort (Eingabe ÃŒber die Sicherheitstastatur)";this.initMatrix=function(e,i,s,n,t){var r=this,o=u.defer();a.get("Session_Auth","initMatrix",{force:t}).then(function(t){r.matrix=t;r.counterBase=r.matrix.validity;r.counter=angular.copy(r.counterBase);r.container=$("#"+e);r.password=s;r.hiddenPassword=i;r.fakeInput=$("#"+n)[0];r.token=r.matrix.token;o.resolve(true);if(angular.isDefined($("#login"))){c(function(){var t=$("#login");if(t){t.focus()}})}r.countdown=function(){r.timer=d(function(){r.counter-=1e3;if(r.counter==0||l().isAfter(r.timeoutToInvalidMatrix)){h.warn("Matrix invalid");r.stop();r.expired=true}},1e3)};r.stop=function(){if(r.timer){d.cancel(r.timer)}r.timer=null;r.counter=angular.copy(r.counterBase)};r.reset=function(){r.expired=false;r.stop();r.timeoutToInvalidMatrix=l().add(r.counterBase,"ms");h.info("Reset timer to invalidate the matrix, new timeout :",r.timeoutToInvalidMatrix.format("dddd, MMMM Do YYYY, h:mm:ss a"));r.countdown()};r.reset()}).catch(function(t){o.reject(t)});return o.promise};this.typeKey=function(t,e,i){if(angular.isUndefined(this.password[0])){this.password[0]=""}this.password[0]+=".";this.hiddenPassword.push(t)};this.cancelLastTypedKey=function(){this.password[0]=this.password[0].slice(0,-1);this.hiddenPassword.pop()};this.show=function(){this.visible=true;this.enterPasswordMessage="Ihr Passwort (Eingabe ÃŒber die Sicherheitstastatur)"};this.hide=function(){this.visible=false;this.enterPasswordMessage="Ihr Passwort"}};return e}]);m.directive("highlight",["$timeout",function(o){return{restrict:"A",link:function(e,t,i){var s=$("#"+i.mask)[0],n=i.coords.split(","),r=t.closest("map")[0].name;t.on("mousedown",function(t){e[r].typeKey(i.rel,n[0],n[1]);s.style["display"]="block";s.style["position"]="absolute";s.style["left"]=n[0]+"px";s.style["top"]=n[1]+"px";o(function(){s.style["display"]="none"},250,true);e.$apply()})}}}]); "use strict";var m=angular.module("token-api");m.service("tokenApi",[function(){return function(e,n,t){var r=(new Date).getTime();return e+"."+r+"."+n+"."+t}}]); "use strict";var m=angular.module("trading-affectation",["brs-api-client","auth-user","brs-format","brs-ui-spinner","brs-validation","brs-ui-form","brs-ui-modal","brs-ui-modal-scroller","brs-ui-datepicker","brs-ui-alert","brs-filter-object-length","trading-options","trading-mifid","brs-confirm"]);m.controller("TradingAffectationBlockController",["PROFILER","$scope","$rootScope","$log","$filter","BrsUiAlert","brsUiModal","$moment","$interval","tradingOptionsGetTypes","tradingOptionsGetAffectOrderStatus","tradingOptionsGetForcedComments","tradingOptionsGetExchanges","tradingMifid","bankAccountsCurrentAccount","tradingAffectationPostOrder","$timeout","brsConfirm",function(e,a,t,n,f,i,o,r,c,s,d,l,g,u,m,h,p,A){n=n.getInstance("TradingAffectationBlockController");a.loading=false;a.mifid=false;a.mifidMessage=false;a.mifidAction=false;a.alerts=new i;a.authUser=authUser;a.tradingAffectationAffectTypes=[];a.tradingAffectationAffectOrderStatuses=[];a.tradingAffectationForcedComments=[];a.tradingAffectationExchanges=[];a.foreignExchanges=[];a.localExchanges=[];a.sides=[{code:"B",label:"Kauf"},{code:"S",label:"Verkauf"}];a.datePickerConfig={maxDate:r().add(3,"months").toDate(),minDate:0,defaultDate:r().toDate(),showOn:"both",dateFormat:"dd.mm.yy",beforeShowDay:$.datepicker.noWeekends};a.currentAccount=m;a.affectation={affect:false,affectValue:false,comment:false,date:r().format("YYYY-MM-DD 00:00:00"),exchangeId:false,forced:false,freeComment:"",limit:"",product:"",quantity:"",side:false,status:false,stop:"",orderType:false};a.init=function(){if(!a.tradingAffectationAffectTypes.length){a.loading+=1;s().then(function(e){angular.extend(a.tradingAffectationAffectTypes,e)}).catch(function(e){a.alerts.danger(e.message,"typesListError")}).finally(function(){a.loading-=1})}if(!a.tradingAffectationAffectOrderStatuses.length){a.loading+=1;d().then(function(e){angular.extend(a.tradingAffectationAffectOrderStatuses,e)}).catch(function(e){a.alerts.danger(e.message,"orderStatusesError")}).finally(function(){a.loading-=1})}if(!a.tradingAffectationForcedComments.length){a.loading+=1;l().then(function(e){angular.extend(a.tradingAffectationForcedComments,e)}).catch(function(e){a.alerts.danger(e.message,"commentsError")}).finally(function(){a.tradingAffectationForcedComments.push({code:"free",label:"Free comment"});a.loading-=1})}if(!a.tradingAffectationExchanges.length){a.loading+=1;g().then(function(e){angular.extend(a.tradingAffectationExchanges,e);angular.forEach(a.tradingAffectationExchanges,function(e,t){if(e["secIDSrc"]=="ISI"){a.foreignExchanges.push(e["exchangeId"])}else if(e["secIDSrc"]=="WKN"){a.localExchanges.push(e["exchangeId"])}})}).catch(function(e){a.alerts.danger(e.message,"marketsError")}).finally(function(){a.loading-=1})}};a.init();a.perform=function(){var n="",e=false;if(a.affectation.comment=="free"){n=a.affectation.freeComment}else{angular.forEach(a.tradingAffectationForcedComments,function(e,t){if(e.code==a.affectation.comment){n=e.label}})}e={product:a.affectation.product,exchangeId:a.affectation.exchangeId,side:a.affectation.side,quantity:a.affectation.quantity,orderType:a.affectation.orderType,stop:a.affectation.stop,limit:a.affectation.limit,date:moment(a.affectation.date).format("YYYYMMDD"),affect:a.affectation.affect?a.affectation.affectValue:"",forced:a.affectation.forced,comment:n,accountKey:a.currentAccount.accountKey};if(a.mifidAction&&a.mifidAction.length&&a.mifidAction=="force"){e.mifidAction=a.mifidAction}a.loading+=1;h(e).then(function(e){if(e.orderId){var t="The affectation is successfully sent, the reference of the operation is <strong>"+e.orderId+"</strong>";if(e.errors.length){t+="<br><br>But there was some errors:<br><br>"+e.errors}a.alerts.success(t);a.resetAffectationForm()}if(!e.orderId&&e.mifid&&e.mifid.output.length){a.mifid=true;a.mifidMessage=e.mifid.output}if(!e.orderId&&e.errors.length){a.alerts.warning(e.errors)}}).catch(function(e){a.alerts.danger("Error while sending affectation.<br>"+e.message,"marketsError")}).finally(function(){a.loading-=1;a.loadingSendAffectation=false})};a.confirmAffect=function(){return A("Affectation Order","MÃ¶chten Sie diesen Auftrag bestÃ€tigen ?","Senden","Stornieren")};a.sendAffectation=function(){a.confirmAffect().then(function(){a.loadingSendAffectation=true;a.perform()}).catch(function(){a.resetAffectationForm()})};a.resetAffectationForm=function(){a.affectation.affect=false;a.affectation.affectValue=false;a.affectation.comment=false;a.affectation.date=r().format("YYYY-MM-DD 00:00:00");a.affectation.exchangeId=false;a.affectation.forced=false;a.affectation.freeComment="";a.affectation.limit="";a.affectation.product="";a.affectation.quantity="";a.affectation.side=false;a.affectation.status=false;a.affectation.stop="";a.affectation.orderType=false;a.mifid=false;a.mifidMessage=false;a.mifidAction=false;p(function(){$("#affectatinoDate").datepicker("setDate",moment(a.datePickerConfig.defaultDate).format("DD.MM.YYYY"))},0,false)};a.exchangeOrProductChange=function(){if(_.indexOf(a.foreignExchanges,a.affectation.exchangeId)>-1&&(angular.isDefined(a.affectation.product)&&a.affectation.product.length<=6)){a.affectationForm.product.$setValidity("foreignExchanges",false)}else{a.affectationForm.product.$setValidity("foreignExchanges",true)}if(_.indexOf(a.localExchanges,a.affectation.exchangeId)>-1&&(angular.isDefined(a.affectation.product)&&a.affectation.product.length>6)){a.affectationForm.product.$setValidity("localExchanges",false)}else{a.affectationForm.product.$setValidity("localExchanges",true)}};a.refresh=function(){a.loading+=1;a.init();a.currentAccount=m;a.resetAffectationForm();a.loading-=1};a.forceMifid=function(){a.mifidAction="force";a.perform()};t.$on("accounts:changeCurrent",function(e,t){a.refresh()})}]);m.run(["$rootScope","$log","tradingOptionsGetTypes","tradingOptionsGetAffectOrderStatus","tradingOptionsGetForcedComments","tradingOptionsGetExchanges",function(e,t,n,a,f,i){t=t.getInstance("TradingAffectationBlockController:run");e.$on("auth:login:refresh",function(e,t){if(t.isPcc()){n();a();f();i()}})}]); "use strict";var m=angular.module("trading-affectation");m.service("tradingAffectationPostOrder",["brsApiClient","$q",function(n,r){var i;return function(t){var e=r.defer();if(i){return i}else{i=e.promise}n.get("Trading_Affectation","postAffectation",t).then(function(t){e.resolve(t)}).catch(function(t){e.reject(t)}).finally(function(){i=false});return e.promise}}]); "use strict";var m=angular.module("trading-cfd");m.controller("TradingCfdController",["$scope",function(n){}]);m.controller("TradingCfdBlockController",["$scope","$window","authUser","bankAccountsGetAccountsList","bankAccountsList","tradingCfdGetUrl","brsAppConfig","brsAppVersion","brsUiModal",function(o,t,n,c,i,e,a,l,r){o.isBlockLoading=true;o.hasCFDAccount=false;o.isPartnerMode=a.isPartnerMode();o.authUser=n;o.url="";o.hasNoCfdExperience=false;o.init=function(){s()};o.close=function(){};o.getCfdUrl=function(){u()};o.openModal=function(){r.open(r.getConfig("draggable","lg",{templateUrl:l.getUrl("/app/trading-cfd/templates/modal-cfd-handel.html"),controller:["$scope","$modalInstance",f]}))};function s(){o.isBlockLoading=true;c().then(function(n){o.accountsList=i;angular.forEach(o.accountsList,function(n){if(n.isCFDAccount){o.hasCFDAccount=true}})}).catch(function(n){}).finally(function(){o.isBlockLoading=false})}function u(){o.isBlockLoading=true;e().then(function(n){o.url=n;t.open(o.url)}).catch(function(n){if(n.code&&n.code===10108){o.hasNoCfdExperience=true}}).finally(function(){o.isBlockLoading=false})}function f(n,o){n.cancel=function(){o.dismiss("cancel")}}o.init()}]); "use strict";var m=angular.module("trading-cfd");m.service("tradingCfdGetUrl",["brsApiClient","$q","$log","$rootScope","brsAppConfig",function(e,n,t,i,o){t=t.getInstance("tradingCfdGetUrl");var l;return function(){var r=n.defer();if(l){return l}else{l=r.promise}i.spinner+=1;t.debug("tradingCfdGetUrl");e.get("Customer_Cfd","generateUrl",{mobile:o.isMobile()}).then(function(e){r.resolve(e.url)}).catch(function(e){r.reject(e)}).finally(function(){i.spinner-=1;l=false});return r.promise}}]); "use strict";var m=angular.module("trading-cfd",["brs-api-client","auth-user"]); "use strict";var m=angular.module("trading-chart-tool");m.value("tradingChartToolSavedCode",{});m.controller("TradingChartToolBlockController",["$scope","$log","tradingChartToolSearchInstrument","tradingChartToolBuildConfig","tradingWatchlistGetInstrumentHistory","BrsUiAlert","$filter","$q","tradingChartToolSavedCode","brsUiGridDesktop",function(t,r,e,a,i,n,s,o,m,c){r=r.getInstance("TradingChartToolBlockController");t.loading=false;t.alerts=new n;t.graphAlerts=new n;t.code="";t.instrumentDisplayed=null;t.instrumentHistory=null;t.graphDiv="chart-tool-graph";t.graphConfig=null;t.displaySymbolData=false;t.displayGraph=false;t.blinkBenchmarkInstrumentSelect=false;t.displayBenchmarkInstrumentSelect=false;t.formData={period:"1Y",type:"line",benchmark:{choice:"none",index:"",code:"",symbol:"",label:""},mm:{mm1:null,mm2:null,mm3:null},indicators:{bollinger:false,ma:false,sar:false,rsi:false,momentum:false,macd:false,stochfast:false,stochslow:false,volume:false,obv:false,va:false,mm:false},symbol:"",normalize:"linear"};t.indiocators={priceIndicator:"",trendIndicator:"default",oscillator:"default",volumeIndicator:"default"};t.indexes=[{symbol:"5pDAX",label:"DAX 30"},{symbol:"$NDX.X",label:"Nasdaq. Comp."},{symbol:"$INDU",label:"Dow Jones"},{symbol:"$INX",label:"S&amp;P 500"},{symbol:"UKX.L",label:"FTSE 100"},{symbol:"2cSX5E",label:"EuroStoxx 50"},{symbol:"1rPCAC",label:"CAC 40"}];t.init=function(){var e=m[c.getDesktopNumber()];if(angular.isDefined(e)){t.code=e;t.searchInstrument()}};t.onMessage=function(e){t.code=e.isin||e.wkn;t.searchInstrument()};t.refresh=function(){r.info("Refresh chart tool.")};t.changeGraph=function(){l()};t.changeCurrentInstrument=function(){angular.forEach(t.instrumentsList,function(e){if(e.symbol==t.formData.symbol){t.instrumentDisplayed=e;t.instrumentDisplayed.variation_value=t.instrumentDisplayed.variation*t.instrumentDisplayed.previousClose}});if(t.formData.benchmark.choice=="code"){t.checkBenchmarkOnSamePlace().catch(function(){t.graphAlerts.info("Die Benchmark, die Sie verwenden mÃ¶chten, nicht auf dieser Austausch statt, wÃ€hlen Sie bitte eine Benchmark Wechsel Platz im Benchmark Dropdown, Ã€ndern Benchmark oder deaktivieren Benchmark.","benchmarkPlaceDoesntMatch")})}};t.benchmarkChange=function(){if(t.formData.benchmark.choice!="code"){t.formData.benchmark.code="";t.formData.benchmark.symbol="";t.benchmarkInstrumentDisplayed=[];t.benchmarkInstrumentsList=false}if(t.formData.benchmark.choice!="index"){t.formData.benchmark.index=""}else if(t.formData.benchmark.choice=="index"){angular.forEach(t.indexes,function(e){if(e.symbol==t.formData.benchmark.index){t.formData.benchmark.label=e.label}})}if(t.formData.benchmark.choice=="none"){t.formData.benchmark.label=""}};t.benchmarkInstrumentChange=function(){angular.forEach(t.benchmarkInstrumentsList,function(e){if(e.symbol==t.formData.benchmark.symbol){t.formData.benchmark.label=e.label;t.benchmarkInstrumentDisplayed=e}})};t.priceIndicatorChange=function(){t.formData.indicators.bollinger=false;t.formData.indicators.mm=false;t.formData.indicators.sar=false;if(t.indiocators.priceIndicator!="mm"){t.formData.mm.mm1=null;t.formData.mm.mm2=null;t.formData.mm.mm3=null}switch(t.indiocators.priceIndicator){case"bollinger":t.formData.indicators.bollinger=true;break;case"mm":t.formData.indicators.mm=true;break;case"sar":t.formData.indicators.sar=true;break;case"":case"default":case"none":t.indiocators.priceIndicator="";break}};t.trendIndicatorChange=function(){t.formData.indicators.macd=false;t.formData.indicators.momentum=false;switch(t.indiocators.trendIndicator){case"macd":t.formData.indicators.macd=true;break;case"momentum":t.formData.indicators.momentum=true;break;case"":case"default":case"none":t.indiocators.trendIndicator="default";break}};t.oscillatorChange=function(){t.formData.indicators.rsi=false;t.formData.indicators.stochfast=false;t.formData.indicators.stochslow=false;switch(t.indiocators.oscillator){case"rsi":t.formData.indicators.rsi=true;break;case"stochfast":t.formData.indicators.stochfast=true;break;case"stochslow":t.formData.indicators.stochslow=true;break;case"":case"default":case"none":t.indiocators.oscillator="default";break}};t.volumeIndicatorChange=function(){t.formData.indicators.volume=false;t.formData.indicators.obv=false;t.formData.indicators.va=false;switch(t.indiocators.volumeIndicator){case"volume":t.formData.indicators.volume=true;break;case"obv":t.formData.indicators.obv=true;break;case"va":t.formData.indicators.va=true;break;case"":case"default":case"none":t.indiocators.volumeIndicator="default";break}};t.searchInstrument=function(){r.debug("requestSearchInstrument");t.loading+=1;t.displayGraph=false;m[c.getDesktopNumber()]=t.code;e(t.code).then(function(e){t.instrumentsList=s("filter")(e,{co:"!!"});t.instrumentsList=s("orderBy")(t.instrumentsList,"exchangeLabel");t.instrumentDisplayed=s("orderBy")(t.instrumentsList,"tradeDate",true)[0];t.instrumentDisplayed.variation_value=t.instrumentDisplayed.variation*t.instrumentDisplayed.previousClose;t.formData.symbol=t.instrumentDisplayed.symbol;t.displaySymbolData=true;t.loading-=1;l()}).catch(function(e){t.loading-=1;t.alerts.danger("Der Aufruf eines Charts ist nur mittels WKN oder ISIN mÃ¶glich. Bitte ÃŒberprÃŒfen Sie Ihre Eingabe.")})};t.searchBenchmarkInstrument=function(){t.loading+=1;e(t.formData.benchmark.code).then(function(e){t.benchmarkInstrumentsList=s("filter")(e,{co:"!!"});t.benchmarkInstrumentsList=s("orderBy")(t.benchmarkInstrumentsList,"exchangeLabel");if(t.benchmarkInstrumentsList.length){t.checkBenchmarkOnSamePlace().catch(function(){t.graphAlerts.info("Die Benchmark, die Sie verwenden mÃ¶chten, nicht auf dieser Austausch statt, wÃ€hlen Sie bitte eine Benchmark Wechsel Platz im Benchmark Dropdown, Ã€ndern Benchmark oder deaktivieren Benchmark.","benchmarkPlaceDoesntMatch")})}else{t.graphAlerts.danger("Der Aufruf eines Benchmarks ist nur mittels WKN oder ISIN mÃ¶glich. Bitte ÃŒberprÃŒfen Sie Ihre Eingabe.","instrumentNotFound");t.benopen=false;t.blinkBenchmarkInstrumentSelect=true;t.formData.benchmark.choice="";t.formData.benchmark.code="";t.formData.benchmark.symbol="";t.benchmarkInstrumentDisplayed=[];t.benchmarkInstrumentsList=false}t.loading-=1}).catch(function(e){t.loading-=1;if(e.code==30200){t.graphAlerts.danger("Der Aufruf eines Benchmarks ist nur mittels WKN oder ISIN mÃ¶glich. Bitte ÃŒberprÃŒfen Sie Ihre Eingabe.","instrumentNotFound")}else{t.graphAlerts.danger(e.message)}t.benopen=false;t.formData.benchmark.choice="";t.formData.benchmark.code="";t.formData.benchmark.symbol="";t.benchmarkInstrumentDisplayed=[];t.benchmarkInstrumentsList=false})};t.checkBenchmarkOnSamePlace=function(){var e=o.defer();t.benchmarkOnSamePlace=s("filter")(t.benchmarkInstrumentsList,{exchangeLabel:t.instrumentDisplayed.exchangeLabel});if(t.benchmarkOnSamePlace.length){t.benchmarkInstrumentDisplayed=t.benchmarkOnSamePlace[0];t.formData.benchmark.symbol=t.benchmarkInstrumentDisplayed.symbol;t.formData.benchmark.label=t.benchmarkInstrumentDisplayed.label;t.blinkBenchmarkInstrumentSelect=false;t.displayBenchmarkInstrumentSelect=false;e.resolve()}else{t.blinkBenchmarkInstrumentSelect=true;t.displayBenchmarkInstrumentSelect=true;t.benchmarkInstrumentDisplayed="";t.formData.benchmark.symbol="";t.formData.benchmark.label="";t.benopen=false;e.reject()}return e.promise};t.resetHighlight=function(){t.blinkBenchmarkInstrumentSelect=false;t.graphAlerts.removeAlertsByUniquName("benchmarkPlaceDoesntMatch");t.graphAlerts.removeAlertsByUniquName("instrumentNotFound")};function l(){r.debug("requestHistoryInstrument : "+t.formData.symbol+" : "+t.formData.period);t.loading+=1;var a="";angular.forEach(t.formData.indicators,function(e,n){if(e){if(n=="mm"){n="";angular.forEach(t.formData.mm,function(e,a){if(e>0){n+="ma="+e+";"}})}a+=n+";"}});if(a.length&&a.substring(a.length,a.length-1)==";"){a=a.substring(0,a.length-1)}var e="";if(t.formData.benchmark.choice=="index"&&t.formData.benchmark.index!=""){e=t.formData.benchmark.index}else if(t.formData.benchmark.choice=="code"&&t.formData.benchmark.code!=""&&t.formData.benchmark.symbol!=""){e=t.formData.benchmark.symbol}if(e==""&&t.formData.normalize=="prozentual"){e="percentage"}var n=(t.instrumentDisplayed.isin||t.instrumentDisplayed.wkn||"")+"."+(t.instrumentDisplayed["code_oms"]||"")+"."+(t.instrumentDisplayed.currency||"");i(t.formData.symbol,t.formData.period,a,e,n,false).then(function(e){t.instrumentHistory=e;r.debug("requestHistoryInstrument",t.instrumentHistory);t.loading-=1;f()}).catch(function(e){t.loading-=1;t.alerts.danger(e.message)})}function f(){r.debug("requestChartToolBuildConfig");t.loading+=1;t.graphAlerts.clean();if(t.instrumentHistory&&t.instrumentHistory.length>1){a(t.instrumentDisplayed,t.instrumentHistory,t.formData).then(function(e){t.displayGraph=true;t.graphConfig=e;t.loading-=1;setTimeout(function(){h(t.graphDiv,t.graphConfig)},0)}).catch(function(e){t.loading-=1;t.alerts.danger(e.message)})}else{t.loading-=1;t.displayGraph=false;t.graphAlerts.info("Es gibt keine Daten fÃŒr diese Parameter.")}}function h(e,a){var n;r.debug("generateGraph",a);n=AmCharts.makeChart(e,a)}t.init()}]); "use strict";var m=angular.module("trading-chart-tool");m.service("tradingChartToolSearchInstrument",["brsApiClient","$q","$rootScope",function(l,o,t){var s;return function(e){var a=o.defer();if(s){return s}else{s=a.promise}t.spinner+=1;l.get("Feed_Instrument","search",{code:e,fullSearch:true,findBy:"wkn;isin"}).then(function(e){a.resolve(e.instruments)}).catch(function(e){a.reject(e)}).finally(function(){t.spinner-=1;s=false});return a.promise}}]);m.service("tradingChartToolBuildConfig",["$q","brsAppConfig",function(d,h){var c,u;return function(e,a,l){var o=d.defer(),t=false,s=e.currency;if(l.benchmark.choice=="index"||l.benchmark.choice=="code"&&l.benchmark.symbol!=""){t=true}var s=t||l.normalize=="prozentual"?"%":e.currency;if(l.type=="default"){l.type="line"}c=o.promise;u={language:"de",pathToImages:"/libraries/amcharts/images/",fontFamily:"pt_sansregular,Helvetica,Arial,sans-serif",chartCursorSettings:{zoomable:true,cursorColor:h.isPartnerMode()?"#39a513":"#980165",valueBalloonsEnabled:true,categoryBalloonDateFormats:[{period:"YYYY",format:"YYYY"},{period:"MM",format:"MMM, YYYY"},{period:"WW",format:"DD MMM YYYY"},{period:"DD",format:"DD MMM YYYY"}]},categoryAxis:{dateFormats:[{period:"DD",format:"DD MMM"},{period:"WW",format:"DD MMM"},{period:"MM",format:"MMM"},{period:"YYYY",format:"YYYY"}]},chartCursor:{categoryBalloonDateFormat:"DD MMM YYYY",cursorColor:"#980165"},numberFormatter:{precision:2,decimalSeparator:",",thousandsSeparator:" "},dataDateFormat:"YYYY-MM-DD JJ:NN",categoryAxesSettings:{minPeriod:"DD",equalSpacing:true,startOnAxis:true,maxSeries:0,dateFormats:[{period:"DD",format:"DD MMM"},{period:"WW",format:"DD MMM"},{period:"MM",format:"MMM"},{period:"YYYY",format:"YYYY"}]},chartScrollbarSettings:{usePeriod:"DD",enabled:true,graph:"g1",position:"bottom"},panelsSettings:{usePrefixes:false,marginLeft:8,marginRight:8},stockEventsSettings:{balloonColor:"#00519E"},type:"stock",theme:"none",dataSets:[{color:"#00519e",fieldMappings:[{fromField:"open",toField:"open"},{fromField:"high",toField:"high"},{fromField:"low",toField:"low"},{fromField:"close",toField:"close"},{fromField:"volume",toField:"volume"}],dataProvider:a,categoryField:"date"}],panels:[{showCategoryAxis:true,percentHeight:60,valueAxes:[{id:"v1",dashLength:5,unit:" "+s,position:"left",fontSize:8,logarithmic:false}],categoryAxis:{dashLength:5},stockGraphs:[{id:"g1",valueAxis:"v1",valueField:"close",openField:"open",closeField:"close",highField:"high",lowField:"low",type:l.type,fillAlphas:.3,lineThickness:1.5,balloonText:"[[value]] "+s,title:e.label}],numberFormatter:{precision:3,decimalSeparator:",",thousandsSeparator:" "},stockLegend:{periodValueText:"[[value.close]] "+s,valueTextRegular:"[[value]] "+s,markerType:"circle",useGraphSettings:false,fontSize:9,markerSize:9,horizontalGap:0,equalWidths:false,spacing:30,valueAlign:"left"},drawingIconsEnabled:true,eraseAll:true}],periodSelector:false};if(t||l.normalize=="prozentual"){var i="no symbol";if(l.benchmark.choice=="index"){i=l.benchmark.index}else if(l.benchmark.choice=="code"){i=l.benchmark.symbol}if(t){u.dataSets[0].fieldMappings.push({fromField:i,toField:i})}u.panels[0].stockGraphs[0].balloonText="[[value]] %";u.panels[0].stockLegend.periodValueText="[[value.close]] %";u.panels[0].stockLegend.valueTextRegular="[[value]] %";u.panels[0].valueAxes=[{id:"v1",dashLength:5,unit:" %",position:"left",fontSize:8}];if(t){u.panels[0].stockGraphs.push({balloonText:"[[value]] %",type:"line",lineColor:"#980165",lineThickness:1,lineAlpha:1,valueField:i,useDataSetColors:false,title:l.benchmark.label||i})}}if(l.period=="1D"){u.dataSets[0].fieldMappings.push({fromField:"prev",toField:"prev"});u.chartCursorSettings.categoryBalloonDateFormats=[{period:"mm",format:"JJ:NN"},{period:"MM",format:"MMM, YYYY"},{period:"WW",format:"DD MMM YYYY"},{period:"DD",format:"DD MMM YYYY"},{period:"hh",format:"JJ:NN"},{period:"ss",format:"JJ:NN:SS"},{period:"fff",format:"JJ:NN:SS"}];u.categoryAxesSettings={maxSeries:0,minPeriod:"mm",autoGridCount:false,gridCount:6,equalSpacing:true};u.categoryAxis.parseDates=true;u.chartScrollbarSettings={graph:"g1",usePeriod:"10mm",position:"bottom",enabled:true};u.dataDateFormat="YYYY-MM-DD JJ:NN";u.panels[0].stockGraphs[0].balloonText="[[close]] "+s;if(l.benchmark.choice=="none"){u.panels[0].stockGraphs.push({balloonText:false,type:"line",lineColor:"#db4c3c",lineThickness:1,lineAlpha:1,valueField:"prev",useDataSetColors:false,title:"Tag zuvor"})}u.panels[0].stockLegend.valueTextRegular="[[value]] "+s;u.periodSelector={position:"top",periods:[{period:"mm",count:10,label:"10mn"},{period:"mm",count:30,label:"30mn"},{period:"hh",count:1,label:"1h"},{period:"hh",count:2,label:"2h"},{period:"hh",count:6,label:"6h"},{period:"hh",count:12,label:"12h"},{period:"MAX",label:"MAX",selected:true}],inputFieldsEnabled:false,periodsText:""}}if(l.period=="5D"){u.dataSets[0].fieldMappings.push({fromField:"prev",toField:"prev"});u.chartCursorSettings.categoryBalloonDateFormats=[{period:"mm",format:"DD MMM YYYY JJ:NN"},{period:"MM",format:"MMM, YYYY"},{period:"WW",format:"DD MMM YYYY"},{period:"DD",format:"DD MMM YYYY"},{period:"hh",format:"JJ:NN"},{period:"ss",format:"JJ:NN:SS"},{period:"fff",format:"JJ:NN:SS"}];u.categoryAxesSettings={maxSeries:0,minPeriod:"mm",autoGridCount:false,gridCount:15,equalSpacing:true,startOnAxis:true};u.categoryAxis.parseDates=true;u.chartScrollbarSettings={graph:"g1",usePeriod:"hh",position:"bottom",enabled:true};u.dataDateFormat="YYYY-MM-DD JJ:NN";u.panels[0].stockGraphs[0].balloonText="[[value]] "+s;if(!t){u.panels[0].stockGraphs.push({balloonText:false,type:"line",lineColor:"#db4c3c",lineThickness:1,lineAlpha:1,valueField:"prev",useDataSetColors:false,title:"Tag zuvor"})}u.panels[0].stockLegend.valueTextRegular="[[value]] "+s;u.periodSelector={position:"top",periods:[{period:"mm",count:10,label:"10mn"},{period:"mm",count:30,label:"30mn"},{period:"hh",count:1,label:"1h"},{period:"hh",count:2,label:"2h"},{period:"hh",count:6,label:"6h"},{period:"hh",count:12,label:"12h"},{period:"MAX",label:"MAX",selected:true}],inputFieldsEnabled:false,periodsText:""}}if(l.indicators.volume){u.panels.push({showCategoryAxis:true,title:"Volumen",valueAxes:[{dashLength:5,logarithmic:false}],categoryAxis:{dashLength:5},stockGraphs:[{valueField:"volume",type:"column",cornerRadiusTop:0,fillAlphas:.8}],stockLegend:{valueTextRegular:" ",markerType:"none"},numberFormatter:{precision:0,decimalSeparator:",",thousandsSeparator:" "}})}if(l.indicators.bollinger){u.dataSets[0].fieldMappings.push({fromField:"bollinger",toField:"bollinger"},{fromField:"bollingerLow",toField:"bollingerLow"},{fromField:"bollingerHigh",toField:"bollingerHigh"});u.panels[0].stockGraphs.push({balloonText:"[[value]] "+s,type:"line",lineColor:"#db4c3c",lineThickness:1,lineAlpha:1,noStepRisers:true,valueField:"bollinger",useDataSetColors:false,title:"Bollinger"});u.panels[0].stockGraphs.push({balloonText:"[[value]] "+s,type:"line",lineColor:"#4DA74D",lineThickness:1,lineAlpha:1,valueField:"bollingerLow",useDataSetColors:false,title:"Bollinger Low"});u.panels[0].stockGraphs.push({balloonText:"[[value]] "+s,type:"line",lineColor:"#4DA74D",lineThickness:1,lineAlpha:1,valueField:"bollingerHigh",useDataSetColors:false,title:"Bollinger High"})}if(l.indicators.mm){var r=["#f0ad4e","#4DA74D","#980165"];angular.forEach(l.mm,function(e,a){if(e>0){var l=a.split("m");u.dataSets[0].fieldMappings.push({fromField:"ma"+e,toField:"ma"+e});u.panels[0].stockGraphs.push({balloonText:"[[value]] "+s,type:"line",lineColor:r[l],lineThickness:1,lineAlpha:1,valueField:"ma"+e,title:"ma"+e,useDataSetColors:false})}})}if(l.indicators.sar){u.dataSets[0].fieldMappings.push({fromField:"sar",toField:"sar"});u.panels[0].stockGraphs.push({balloonText:"[[value]] "+s,type:"line",lineColor:"#f0ad4e",useDataSetColors:false,title:"SAR",bullet:"circle",bulletColor:"#FFFFFF",bulletBorderAlpha:1,useLineColorForBulletBorder:true,lineAlpha:0,fillAlphas:0,valueField:"sar"})}if(l.type=="line_not_filled"){u.panels[0].stockGraphs[0].type="line";u.panels[0].stockGraphs[0].fillAlphas=0}if(l.type=="ohlc"||l.type=="candlestick"){u.panels[0].stockGraphs[0].balloonText="Ã?ffnungs: <b>[[open]] "+s+"</b><br>Tief: <b>[[low]] "+s+"</b><br>Hoch: <b>[[high]] "+s+"</b><br>Tag SchlieÃ?: <b>[[close]] "+s+"</b>";u.panels[0].stockGraphs[0].negativeBase=0;u.panels[0].stockGraphs[0].useDataSetColors=false;u.panels[0].stockGraphs[0].lineAlpha=1;u.panels[0].stockGraphs[0].bulletColorNegative="#db4c3c";u.panels[0].stockGraphs[0].bulletColorR="#4DA74D";u.panels[0].stockGraphs[0].fillColorsR="#4DA74D";u.panels[0].stockGraphs[0].lineColor="#4DA74D";u.panels[0].stockGraphs[0].lineColorR="#4DA74D";u.panels[0].stockGraphs[0].negativeFillColors="#db4c3c";u.panels[0].stockGraphs[0].negativeLineColor="#db4c3c"}if(l.normalize=="logarithmic"){u.panels[0].valueAxes[0].logarithmic=true}if(l.indicators.macd){u.dataSets[0].fieldMappings.push({fromField:"macd",toField:"macd"},{fromField:"macdSignal",toField:"macdSignal"});if(angular.isDefined(a[0].macdHisto)){u.dataSets[0].fieldMappings.push({fromField:"macdHisto",toField:"macdHisto"})}var n={showCategoryAxis:false,title:"MACD (12,26,9)",valueAxes:[{dashLength:5}],categoryAxis:{dashLength:5},stockGraphs:[{valueField:"macd",type:"line",lineColor:"#888888",useDataSetColors:false,lineThickness:1.5,balloonText:"<b>Macd :</b> [[value]]"},{valueField:"macdSignal",type:"line",lineColor:"#00519e",useDataSetColors:false,lineThickness:1.5,balloonText:"<b>Signal :</b> [[value]]"}],stockLegend:{valueTextRegular:" ",markerType:"none"},numberFormatter:{precision:5,decimalSeparator:",",thousandsSeparator:" "}};if(angular.isDefined(a[0].macdHisto)){n.stockGraphs.push({valueField:"macdHisto",type:"line",lineColor:"#CB4B4B",useDataSetColors:false,lineThickness:1,balloonText:"<b>Histo :</b> [[value]]"})}u.panels.push(n)}if(l.indicators.momentum){u.dataSets[0].fieldMappings.push({fromField:"momentum",toField:"momentum"});u.panels.push({showCategoryAxis:false,title:"Momentum",valueAxes:[{dashLength:5}],categoryAxis:{dashLength:5},stockGraphs:[{valueField:"momentum",type:"line",lineColor:"#4DA74D",useDataSetColors:false,lineThickness:1.5}],stockLegend:{valueTextRegular:" ",markerType:"none"},numberFormatter:{precision:5,decimalSeparator:",",thousandsSeparator:" "}})}if(l.indicators.rsi){u.dataSets[0].fieldMappings.push({fromField:"rsi",toField:"rsi"});u.panels.push({showCategoryAxis:false,title:"RSI",valueAxes:[{dashLength:5}],categoryAxis:{dashLength:5},stockGraphs:[{valueField:"rsi",type:"line",lineColor:"#f0ad4e",useDataSetColors:false,lineThickness:1.5,fillAlphas:.3}],stockLegend:{valueTextRegular:" ",markerType:"none"},numberFormatter:{precision:5,decimalSeparator:",",thousandsSeparator:" "}})}if(l.indicators.stochfast){u.dataSets[0].fieldMappings.push({fromField:"stochFastD",toField:"stochFastD"},{fromField:"stochFastHigh",toField:"stochFastHigh"},{fromField:"stochFastK",toField:"stochFastK"},{fromField:"stochFastLow",toField:"stochFastLow"});var p={percentHeight:35,showCategoryAxis:false,title:"Fast Stochastik (1,1,5)",valueAxes:[{dashLength:5}],categoryAxis:{dashLength:5},stockGraphs:[{valueField:"stochFastK",type:"line",lineColor:"#888888",useDataSetColors:false,lineThickness:1.5,balloonText:"<b>%K:</b> [[value]]"},{valueField:"stochFastD",type:"line",lineColor:"#00519e",useDataSetColors:false,lineThickness:1.5,balloonText:"<b>%D:</b> [[value]]"}],stockLegend:{valueTextRegular:" ",markerType:"none"},numberFormatter:{precision:5,decimalSeparator:",",thousandsSeparator:" "}};if(angular.isDefined(a[0].stochFastHigh)){p.stockGraphs.push({valueField:"stochFastHigh",type:"line",lineColor:"#CB4B4B",useDataSetColors:false,lineThickness:1,showBalloon:false},{valueField:"stochFastLow",type:"line",lineColor:"#CB4B4B",useDataSetColors:false,lineThickness:1,showBalloon:false})}u.panels.push(p)}if(l.indicators.stochslow){u.dataSets[0].fieldMappings.push({fromField:"stochSlowD",toField:"stochSlowD"},{fromField:"stochSlowK",toField:"stochSlowK"});if(angular.isDefined(a[0].stochSlowHigh)){u.dataSets[0].fieldMappings.push({fromField:"stochSlowHigh",toField:"stochSlowHigh"},{fromField:"stochSlowLow",toField:"stochSlowLow"})}var p={showCategoryAxis:false,title:"Slow Stochastik (14,3,5)",valueAxes:[{dashLength:5}],categoryAxis:{dashLength:5},stockGraphs:[{valueField:"stochSlowK",type:"line",lineColor:"#888888",useDataSetColors:false,lineThickness:1.5,balloonText:"<b>%K:</b> [[value]]"},{valueField:"stochSlowD",type:"line",lineColor:"#00519e",useDataSetColors:false,lineThickness:1.5,balloonText:"<b>%D:</b> [[value]]"}],stockLegend:{valueTextRegular:" ",markerType:"none"},numberFormatter:{precision:5,decimalSeparator:",",thousandsSeparator:" "}};if(angular.isDefined(a[0].stochSlowHigh)){p.stockGraphs.push({valueField:"stochSlowHigh",type:"line",lineColor:"#CB4B4B",useDataSetColors:false,lineThickness:1,showBalloon:false},{valueField:"stochSlowLow",type:"line",lineColor:"#CB4B4B",useDataSetColors:false,lineThickness:1,showBalloon:false})}u.panels.push(p)}if(l.indicators.obv){u.dataSets[0].fieldMappings.push({fromField:"obv",toField:"obv"});u.panels.push({showCategoryAxis:false,title:"On Balance Volume",valueAxes:[{dashLength:5}],categoryAxis:{dashLength:5},stockGraphs:[{valueField:"obv",type:"line",lineColor:"#4DA74D",useDataSetColors:false,lineThickness:1.5,fillAlphas:.3,negativeLineColor:"#CB4B4B"}],stockLegend:{valueTextRegular:" ",markerType:"none"},numberFormatter:{precision:2,decimalSeparator:",",thousandsSeparator:" "}})}if(l.indicators.va){u.dataSets[0].fieldMappings.push({fromField:"va",toField:"va"});u.panels.push({showCategoryAxis:false,title:"Volume Accumulation",valueAxes:[{dashLength:5}],categoryAxis:{dashLength:5},stockGraphs:[{valueField:"va",type:"line",lineColor:"#980165",useDataSetColors:false,lineThickness:1.5,fillAlphas:.3}],stockLegend:{valueTextRegular:" ",markerType:"none"},numberFormatter:{precision:2,decimalSeparator:",",thousandsSeparator:" "}})}o.resolve(u);return o.promise}}]); "use strict";var m=angular.module("trading-chart-tool",["brs-api-client","auth-user","feed-instrument"]);m.controller("TradingChartToolController",function(){});AmCharts.translations.de={monthNames:["Januar","Februar","MÃ€rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],shortMonthNames:["Jan","Feb","MÃ€r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],dayNames:["Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag","Sonntag"],shortDayNames:["Mo","Di","Mi","Do","Fr","Sa","So"],zoomOutText:"Alle anzeigen"}; "use strict";var m=angular.module("trading-cost");m.service("tradingCostModalService",["brsUiModal","brsAppVersion",function(n,s){var o=false;return function(e,r){if(!o){o=true;var t=n.open(n.getConfig("draggable",e,{templateUrl:s.getUrl("/app/trading-cost/templates/trading-cost-modal.html"),controller:"TradingCostModalController",resolve:{$modalParameters:function(){return{instrument:r.instrument,issuer:r.issuer,performObject:r.performObject}}}}));t.result.then(function(){o=false}).catch(function(){o=false})}}}]);m.controller("TradingCostModalController",["$scope","brsApiClient","$modalInstance","BrsUiAlert","$modalParameters","checkOrderService","authUser",function(n,e,r,t,s,o,a){n.alerts=new t;n.instrument=s.instrument;n.issuer=s.issuer;n.performObject=s.performObject;n.loading=1;n.feesDetail={};n.order={};n.currentDate=new Date;n.authUser=a;if(n.issuer&&n.issuer.omsId){n.instrument.omsId=n.issuer.omsId;n.instrument.omsStockExchangeId=n.issuer.omsStockExchangeId}if(n.issuer&&n.issuer.name){n.instrument.issuerName=n.issuer.name}if(n.performObject){angular.extend(n.instrument,n.performObject)}o(n.instrument).then(function(e){var r=e.orderEstFeesDetail;var t={};r.forEach(function(e){t[e.feeTyp]={feeAmt:e.feeAmt,feePct:e.feePct}});n.feesDetail=t;n.order=e.order}).catch(function(e){n.alerts.danger(e.message)}).finally(function(){n.loading--});n.close=function(){r.close()}}]); "use strict";var m=angular.module("trading-cost");m.directive("tradingCostButton",["brsAppVersion",function(t){return{restrict:"E",templateUrl:t.getUrl("/app/trading-cost/templates/trading-cost-button.html"),scope:{isDisabled:"=?tradingIsDisabled",instrument:"=tradingInstrument",showHint:"=tradingShowHint",issuer:"=tradingIssuer",performObject:"=tradingPerformObject",quickEntry:"=tradingQuickEntry"},controller:"TradingCostButtonController"}}]);m.controller("TradingCostButtonController",["$scope","tradingCostModalService",function(r,e){r.seeCost=function(){var t={};if(r.performObject){t={quantity:r.performObject.quantity,side:r.performObject.side,type:r.performObject.type,limit:r.performObject.limit,stop:r.performObject.stop,trail:r.performObject.trail,unit:r.performObject.unit,customData:r.performObject.customData,exchangeId:r.performObject.exchangeId,issuerId:r.performObject.issuerId}}if(r.quickEntry){r.instrument.entry=r.quickEntry}e("lg",{instrument:r.instrument,issuer:r.issuer,performObject:t})}}]); "use strict";var m=angular.module("trading-cost");m.service("checkOrderService",["brsApiClient","$q","bankAccountsCurrentAccount",function(u,l,o){var s;return function(e){var t=new Date((new Date).getTime()+24*60*60*1e3);var r=t.getDate();var n=t.getMonth()+1;var a=t.getFullYear();var c={accountKey:o.accountKey,riskMode:"CPT",style:"Simple",state:"check",side:"B",unit:"QTY",quantity:1,validityDate:r+"."+n+"."+a,feesDetail:1};angular.extend(c,e);var i=l.defer();if(s){return s}else{s=i.promise}u.get("Trading_Order","checkOrder",c).then(function(e){delete e["_meta"];i.resolve(e)}).catch(function(e){i.reject(e)}).finally(function(){s=false});return i.promise}}]); "use strict";var m=angular.module("trading-cost",["trading-order"]); "use strict";var m=angular.module("trading-derivative-order-book",["brs-ui-sort","trading-derivative-order-detail"]);m.controller("TradingDerivativeOrderBookController",["$scope","$filter","bankAccountsCurrentAccount","BrsUiPagination","tradingOrderStatus","brsUiSearchDateIsin","tradingDerivativeGetDerivativeOrdersList","brsUiAtosDetailsModal","authUser","brsApiClient","BrsUiAlert",function(t,i,e,r,n,a,s,o,c,d,u){var f;t.search=new a;t.search.isShowHinweis1=true;t.search.isShowHinweis2=false;t.pagination=new r;t.accountCurrency=e.currency;t.authUser=c;t.section="ALL";t.onMessage=function(e){t.search.text=e.mne};t.onCsv=function(){var e=l();e.data.unshift(["Ordererteilung","OrdergÃŒltigkeit","Anzahl Kontrakte","Transaktion","Name","Eurex-KÃŒrzel","Orderstatus","Auftragsart","Voraussichtlich ausmachender Bertrag","Voraussichtlich ausmachender Bertrag Currency"]);return e};t.onPdf=function(){return l()};t.$on("trading-order:on-trade",function(e,r){if(r.isDerivate){t.refresh()}});t.$on("trading-order-strategy:on-confirm",function(){t.refresh()});t.$on("accounts:changeCurrent",function(e,r){t.doSearch()});t.doSearch=function(){m();t.search.disabled=true;var e=t.search.getParams();e.mne=e.text;angular.extend(e,{executionDetails:true});s(e).then(function(e){t.orderList=e.derivativeOrdersList;f=e.atosDetails;t.refreshOrderList()}).finally(function(){t.search.disabled=false})};t.onSortChange=function(e,r){t.orderBy.name=e;t.orderBy.reverse=r;g()};t.refreshOrderList=function(){if(t.section==="ALL"){t.orderListCategory=t.orderList}else{t.orderListCategory=t.orderList.filter(function(e){return n[t.section].indexOf(e.statusCode)!==-1})}h();g()};t.changeSection=function(e){t.section=e;t.refreshOrderList()};function l(){var r=[];var e={ALL:"Alle",OPEN:"Offene Orders",EXECUTED:"AusgefÃŒhrte Orders",REFUSED:"Gestrichene Orders"};angular.forEach(t.pagination.filtered,function(e){if(angular.isUndefined(e.instrument)){e.instrument={currency:undefined}}r.push([i("brsFilterDate")(e.creationDate),i("brsFilterDate")(e.validityDate),i("brsFormatQuantity")(e.quantity),i("tradingOrderSide")(e.side),e.label,e.mne,e.status,i("tradingOrderTypes")(e,e.type,e.instrument.currency),e.executionGrossAmount=="0"?"-":i("brsFormatNumber")(e.executionGrossAmount,4),t.accountCurrency])});return{data:r,subTitle:e[t.section]}}function g(){t.pagination.filter(t.orderBy.name,t.orderBy.reverse)}function h(){t.orderListFiltered=i("filter")(t.orderListCategory,t.filter);t.pagination.init(t.orderListFiltered,5,true)}function m(){t.orderList=[];t.orderListCategory=[];t.orderListFiltered=[];t.filter={};t.orderBy={name:"creationDate",reverse:false}}t.openAtosDetailsModal=function(){o(f)};t.alerts=new u;t.isBlockLoading=true;t.isDeactivated=false;t.isRefreshed=false;t.init=function(){t.isBlockLoading=true;d.get("Common_Utils","getAdminConfigValue",{configKey:"DEACTIVATE_MODULE_ORDERBUCH_DERIVATE",configNamespace:"BANK"}).then(function(e){t.isDeactivated=false;if(e.configValue){t.isDeactivated=true;t.isRefreshed=false}return d.get("Common_Utils","getAdminConfigValue",{configKey:"DEACTIVATE_MODULES_AUTOLOAD",configNamespace:"BANK"})}).then(function(e){t.isBlockLoading=false;t.isRefreshed=!t.isDeactivated&&(t.isRefreshed||!e.configValue);if(t.isRefreshed&&t.authUser.isLogged()){t.doSearch()}}).catch(function(e){t.alerts.danger(e.message)}).finally(function(){t.isBlockLoading=false})};t.refresh=function(){t.isRefreshed=true;t.init()};t.init()}]); "use strict";var m=angular.module("trading-derivative-order-detail",["trading-order-types"]);m.directive("tradingDerivativeOrderDetail",["tradingDerivativeGetOrdersDetails","tradingStrategyCancelStrategy","tradingOrder","tradingOrderCancel","brsUiModal","bankAccountsCurrentAccount","brsAppVersion",function(i,o,l,s,u,c,d){return{restrict:"AE",scope:{quote:"=quote",onDelete:"&",onPerform:"&"},templateUrl:d.getUrl("/app/trading-derivative-order-detail/templates/detail-xs.html"),link:function(t,e,r){t.executionDetails=[];t.showExecutionDetails=false;t.loadExecution=false;t.perform={side:undefined};t.show={update:false};t.loadExecutionDetails=function(){if(t.executionDetails.length!==0){t.showExecutionDetails=!t.showExecutionDetails;return}t.showExecutionDetails=true;t.loadExecution=true;i({orderId:t.quote.reference}).then(function(e){t.executionDetails=e.orderExecutionDetails}).catch(function(e){t.showExecutionDetails=false}).finally(function(){t.loadExecution=false})};t.cancelOrder=function(){l.askCancelConfirmation().then(function(){t.loading=true;n().then(function(){t.onDelete()}).catch(function(){t.loading=false})})};function n(){if(t.quote.isPartOfStrategy){return o(t.quote.strategy.id)}return s({orderId:t.quote.reference,accountKey:c.accountKey})}t.showPerformOrder=function(e){t.perform.side=e};t.isCancelable=function(){return t.quote.isCancelable};t.showDetail=function(){l.openDetailModal(t.quote)};t.showStrategyDetails=function(e){u.open(u.getConfig("draggable","lg",{templateUrl:d.getUrl("/app/trading-derivative-order-detail/templates/modal-strategy.html"),controller:["$scope","$modalInstance","order","authUser","tradingStrategyType","$filter",a],resolve:{order:function(){return t.quote}}}))};function a(e,t,r,n,a,i){var o="Kombination";angular.forEach(a,function(e,t){if(r.strategy.type===e.category&&r.strategy.subType===e.subcategory){o=i("tradingOrderTypesStrategy")(r.strategy.leg,t,r.instrument.currency)}});e.info={userId:n.d.login,instrument:r.instrument,mode:o,validityDate:r.validityDate,orderDate:r.creationDate,orderId:r.strategy.id,quantity:r.quantity,status:r.strategy.statusLabel,side:r.side};e.cancel=function(){t.dismiss("cancel")}}}}}]); "use strict";var m=angular.module("trading-derivative-order",["trading-derivative","brs-compile","trading-strategy","brs-filter-date","trading-mifid"]);m.controller("TradingDerivativeOrderController",["$scope","tradingDerivativeGetQuotesByMne","customerPortfolioGetStockAmount","tradingMifid",function(n,e,t,i){n.form={side:"B",search:"",quantity:""};n.derivative={};n.stock=undefined;n.onMessage=function(e){n.reset();n.form.search=e.mne||"";n.form.side=e.side||"B";n.form.quantity=e.quantity||""};n.search=function(){n.reset();n.loading=true;e(n.form.search).then(function(e){if(e.length>0){i.openModal(e[0].code2,false,false).then(function(){n.derivative.quotes=e;return r(e[0].code2)}).finally(function(){n.loading=false})}else{n.loading=false}}).catch(function(){n.loading=false})};n.reset=function(e){n.derivative={};n.stock=undefined;if(e){n.form.search="";n.form.side="B";n.form.quantity=""}};var r=function(e){return t("",e).then(function(e){n.stock=0;angular.forEach(e.stock,function(e,t){n.stock+=parseInt(e)})})}}]); "use strict";var m=angular.module("trading-derivative-order");m.directive("tradingDerivativeOrderMarketQuote",["customerPulls","brsCompile","customerPullsGetPullsQuoteByMne","bankAccountsCurrentAccount",function(n,o,u,a){return{restrict:"AE",scope:{quote:"=tradingDerivativeOrderMarketQuote",side:"=orderSide",quantity:"=orderQuantity"},link:function(t,r,e){o.template(t,"/app/trading-derivative-order/templates/market-quote-sm.html").then(function(e){r.after(e)});t.currentAccount=a;t.show={perform:"none"};t.disable={realtime:false};t.updateQuote=function(){n.askConfirmation(t.quote,false).then(function(){t.disable.realtime=true;u(t.quote.exchangeId,t.quote.code2,t.quote.symbol).then(function(e){angular.extend(t.quote,e.quote[0])}).finally(function(){t.disable.realtime=false})})};t.$on("accounts:changeCurrent",function(){t.show.perform="none"})}}}]); "use strict";var m=angular.module("trading-derivative-transaction",["brs-ui-search","brs-format","bank-derivative"]);m.controller("TradingDerivativeTransactionController",["$scope","BankDerivativeGetDerivativeMovements","brsUiSearchDateIsin","BrsUiPagination","tradingDerivativeGetDerivativeOrdersList","$filter","brsUiAtosDetailsModal","authUser","brsApiClient","BrsUiAlert",function(t,e,r,n,i,a,s,o,c,u){var f;t.search=new r;t.search.isShowHinweis1=false;t.search.isShowHinweis2=true;t.pagination=new n;t.authUser=o;t.onMessage=function(e){t.search.text=e.mne};t.$on("accounts:changeCurrent",function(e,r){t.refresh()});t.doSearch=function(){g();t.search.disabled=true;var r=t.search.getParams();angular.extend(r,{executionDetails:false,status:1});e().then(function(e){t.orderList=e.derivativeMovements;f=e.atosDetails;t.orderList=t.orderList.filter(function(e){return e.creationDate>=r.from&&e.creationDate<=r.to&&(r.text===""||r.text===e.mne)});t.pagination.init(t.orderList,5,true)}).finally(function(){t.search.disabled=false})};t.onSortChange=function(e,r){t.orderBy.name=e;t.orderBy.reverse=r;l()};t.onCsv=function(){var e=d();e.data.unshift(["Buchungstag","Valuta","Transaktion","Anzahl Kontrakte","KontaktgrÃ¶Ã?e","Name","EUREX-KÃŒrzel","Ausmachender Betrag","Ausmachender Betrag Currency","AusfÃŒhrungskurs","AusfÃŒhrungskurs Currency"]);return e};t.onPdf=function(){return d()};function d(){var r=[];angular.forEach(t.pagination.filtered,function(e){r.push([a("brsFilterDate")(e.creationDate,"dd.MM.yyyy"),a("brsFilterDate")(e.validityDate,"dd.MM.yyyy"),a("tradingOrderSide")(e.side),e.quantity,"10.000",e.contract,e.mne,a("brsFormatNumber")(e.executionNetValue,4),e.currency?e.currency:"EUR",a("brsFormatNumber")(e.executionPrice,4),e.currency?e.currency:"EUR"])});return{data:r,subTitle:""}}function l(){t.pagination.filter(t.orderBy.name,t.orderBy.reverse)}function g(){t.orderList=[];t.orderBy={name:"creationDate",reverse:false}}t.openAtosDetailsModal=function(){s(f)};t.alerts=new u;t.isBlockLoading=true;t.isDeactivated=false;t.isRefreshed=false;t.init=function(){t.isBlockLoading=true;c.get("Common_Utils","getAdminConfigValue",{configKey:"DEACTIVATE_MODULE_TRANSAKTIONSLISTE_DERIVATE",configNamespace:"BANK"}).then(function(e){t.isDeactivated=false;if(e.configValue){t.isDeactivated=true;t.isRefreshed=false}return c.get("Common_Utils","getAdminConfigValue",{configKey:"DEACTIVATE_MODULES_AUTOLOAD",configNamespace:"BANK"})}).then(function(e){t.isBlockLoading=false;t.isRefreshed=!t.isDeactivated&&(t.isRefreshed||!e.configValue);if(t.isRefreshed&&t.authUser.isLogged()){t.doSearch()}}).catch(function(e){t.alerts.danger(e.message)}).finally(function(){t.isBlockLoading=false})};t.refresh=function(){t.isRefreshed=true;t.init()};t.init()}]); "use strict";var m=angular.module("trading-derivative",[]);m.service("tradingDerivativeGetQuotesByMne",["brsApiClient",function(t){return function(e){return t.get("Trading_Derivative","getQuotesByMne",{mne:e}).then(function(e){return e.quotes})}}]);m.service("tradingDerivativeGetDerivativeOrdersList",["brsApiClient","bankAccountsCurrentAccount",function(n,r){return function(e){var t={accountKey:r.accountKey};angular.extend(t,e);return n.get("Trading_Derivative","getDerivativeOrdersList",t).then(function(e){return e})}}]);m.service("tradingDerivativeGetOrdersDetails",["brsApiClient","bankAccountsCurrentAccount",function(n,r){return function(e){var t={accountKey:r.accountKey};angular.extend(t,e);return n.get("Trading_Derivative","getOrderExecutionDetails",t)}}]); "use strict";var m=angular.module("trading-kid");m.service("tradingKidModalService",["brsUiModal","brsAppVersion",function(r,n){var i=false;return function(e,t){if(!i){i=true;var a=r.open(r.getConfig("draggable",e,{templateUrl:n.getUrl("/app/trading-kid/templates/trading-kid-modal.html"),controller:"TradingKidModalController",resolve:{$modalParameters:function(){return{instrument:t.instrument,issuer:t.issuer}}}}));a.result.then(function(){i=false}).catch(function(){i=false})}}}]);m.controller("TradingKidModalController",["$scope","brsApiClient","$modalInstance","BrsUiAlert","$modalParameters","getSecurityDetailService","authUser",function(t,e,a,r,n,i,s){t.alerts=new r;t.instrument=n.instrument;t.issuer=n.issuer;t.loading=1;t.extraData={};t.authUser=s;if(t.issuer&&t.issuer.omsStockExchangeId){t.instrument.omsExchangeId=t.issuer.omsStockExchangeId}i(t.instrument).then(function(e){t.securityDetail=e.securityDetail;if(t.securityDetail.secExtraData&&t.securityDetail.secExtraData.extraData){t.securityDetail.secExtraData.extraData.forEach(function(e){if(e.name==="GV1A1C"){t.extraData[e.name]=e.data}else{if(e.data.indexOf("|")>-1){t.extraData[e.name]=l(e.data)}else if(e.data.indexOf(";")>-1){t.extraData[e.name]=u(e.data)}else if(e.data.indexOf("=")>-1){t.extraData[e.name]=o(e.data)}else{t.extraData[e.name]=e.data}}})}}).catch(function(e){t.alerts.danger(e.message)}).finally(function(){t.loading--});t.close=function(){a.close()};t.isArray=function(e){return Array.isArray(e)};function l(e){if(e.indexOf("|")>-1){var t=e.split("|");return t.map(function(e){return u(e)})}else{return e}}function u(e){if(e.indexOf(";")>-1){var t=e.split(";");return t.map(function(e){return o(e)})}else{return e}}function o(e){if(e.indexOf("=")>-1){var t=e.split("=");var a={};a[t[0]]=t[1];return a}else{return e}}}]); "use strict";var m=angular.module("trading-kid");m.directive("tradingKidButton",["brsAppVersion",function(n){return{restrict:"E",templateUrl:n.getUrl("/app/trading-kid/templates/trading-kid-button.html"),scope:{isDisabled:"=?tradingIsDisabled",instrument:"=tradingInstrument",showHint:"=tradingShowHint",issuer:"=tradingIssuer",omsExchangeId:"=?tradingOmsExchangeId",sid:"=?tradingSid",issuerId:"=?tradingIssuerId",additionalInfos:"=?tradingAdditionalInfos"},controller:"TradingKidButtonController"}}]);m.controller("TradingKidButtonController",["$scope","tradingKidModalService","bankAccountsCurrentAccount",function(n,t,i){n.seeKid=function(){if(n.omsExchangeId){n.instrument.omsExchangeId=n.omsExchangeId}if(n.sid){n.instrument.sid=n.sid;n.instrument.accountKey=i.accountKey}if(n.issuerId){n.instrument.issuerId=n.issuerId}if(n.additionalInfos){angular.extend(n.instrument,n.additionalInfos)}t("lg",{instrument:n.instrument,issuer:n.issuer})}}]); "use strict";var m=angular.module("trading-kid");m.service("getSecurityDetailService",["brsApiClient","$q",function(r,i){var n;return function(e){var t=i.defer();if(n){return n}else{n=t.promise}r.get("Trading_Kid","getSecurityDetail",e).then(function(e){delete e["_meta"];t.resolve(e)}).catch(function(e){t.reject(e)}).finally(function(){n=false});return t.promise}}]); "use strict";var m=angular.module("trading-kid",[]); "use strict";var m=angular.module("trading-kid-warning");m.service("tradingKidWarningModal",["brsUiModal","brsAppVersion",function(a,t){var o=false;return function(n,i){if(!o){o=true;var e=a.open(a.getConfig("draggable",n,{templateUrl:t.getUrl("/app/trading-kid-warning/templates/trading-kid-warning-modal.html"),controller:"TradingKidWarningModalController",resolve:{isReadOnly:function(){return i}}}));e.result.then(function(){o=false}).catch(function(){o=false})}}}]);m.controller("TradingKidWarningOpenModalController",["$scope","tradingKidWarningModal",function(e,a){e.$on("openTradingKidWarningModal",function(n,i){e.open("lg")});e.open=function(n,i){a(n,i)}}]);m.controller("TradingKidWarningModalController",["$scope","$modalInstance","isReadOnly","customerDetailsGetNoticeDisplaySettings","customerDetailsSetNoticeDisplaySettings","BrsUiAlert",function(i,n,e,a,t,o){i.isReadOnly=e;i.loading=true;i.alerts=new o;i.noticeDisplaySettingsToChange={kidWarning:true};i.form={isKidWarningDisabled:false};a().then(function(n){i.noticeDisplaySettingsToChange=angular.extend(n)}).catch(function(n){i.alerts.danger(n.message)}).finally(function(){i.loading=false});i.submit=function(){if(i.noticeDisplaySettingsToChange.kidWarning!==!i.form.isKidWarningDisabled){i.noticeDisplaySettingsToChange.kidWarning=!i.form.isKidWarningDisabled;t(i.noticeDisplaySettingsToChange).catch(function(n){i.alerts.danger(n.message)}).finally(function(){n.close("understood")})}else{n.close()}};i.close=function(){n.close()}}]); "use strict";var m=angular.module("trading-kid-warning",["customer-details"]); "use strict";var m=angular.module("trading-mifid",[]);m.service("tradingMifid",["$rootScope","brsUiModal","bankAccountsCurrentAccount","tradingMifidCheck","$q","brsAppVersion",function(a,r,o,s,f,d){this.openModal=function(e,i,n,t){var c=f.defer();s(e,o.accountKey,i,n,t).then(function(n){if(n.showMifid){u(n,e,i,t).then(function(){c.resolve("mifid-accepted")},function(){c.reject("mifid-refused")})}else{c.resolve("no-mifid")}}).catch(function(n){c.reject(n)});return c.promise};function u(n,e,i,t){var c=r.open(r.getConfig("draggable","lg",{templateUrl:d.getUrl("/app/trading-mifid/templates/mifid.html"),controller:["$scope","$modalInstance","data","isinMneWkn","isSavingsPlan","affectationExchangeId","$sce","tradingMifidSave",l],resolve:{data:function(){return n},isinMneWkn:function(){return e},isSavingsPlan:function(){return i},affectationExchangeId:function(){return t}}}));c.opened.then(function(){a.$broadcast("trading-mifid:mifid-modal:opened",authUser)});return c.result}function l(e,n,i,t,c,a,r,o){e.message=r.trustAsHtml(i.message);e.blocking=i.blocking==true;e.code=i.code;e.cancel=function(){o(t,e.code,c,a,"reject").finally(function(){n.dismiss({message:"cancel"})})};e.ok=function(){o(t,e.code,c,a,"confirm").then(function(){n.close("understood")}).catch(function(n){e.error=n.message})}}}]);m.service("tradingMifidCheck",["brsApiClient",function(a){return function(n,e,i,t,c){return a.get("Trading_mifid","check",{isinMneWkn:n,accountKey:e,isSavingsPlan:i,savingsPlanType:t,affectationExchangeId:c})}}]);m.service("tradingMifidSave",["brsApiClient",function(a){return function(n,e,i,t,c){return a.get("Trading_mifid","save",{isinMneWkn:n,action:c||"confirm",code:e,isSavingsPlan:i,affectationExchangeId:t})}}]); "use strict";var m=angular.module("trading-options");m.service("tradingOptionsGetExchanges",["brsApiClient","$q",function(e,n){var r;return function(){var t=n.defer();if(r){return r}r=t.promise;e.get("Trading_Options","getAffectationMarkets").then(function(e){t.resolve(e.affectationMarkets)}).catch(function(e){t.reject(e);r=undefined});return t.promise}}]); "use strict";var m=angular.module("trading-options");m.service("tradingOptionsGetTypes",["brsApiClient","$q",function(e,n){var r;return function(){var t=n.defer();if(r){return r}r=t.promise;e.get("Trading_Options","getAffectationTypes").then(function(e){t.resolve(e.affectationTypes)}).catch(function(e){t.reject(e);r=undefined});return t.promise}}]); "use strict";var m=angular.module("trading-options",["brs-api-client"]);m.service("tradingOptionsGetAffectOrderStatus",["brsApiClient","$q",function(t,r){var n;return function(){var e=r.defer();if(n){return n}n=e.promise;t.get("Trading_Options","getAffectOrderStatus").then(function(t){e.resolve(t.orderStatus)}).catch(function(t){e.reject(t);n=undefined});return e.promise}}]); "use strict";var m=angular.module("trading-options");m.service("tradingOptionsGetForcedComments",["brsApiClient","$q",function(e,t){var r;return function(){var n=t.defer();if(r){return r}r=n.promise;e.get("Trading_Options","getForcedComments").then(function(e){n.resolve(e.comments)}).catch(function(e){n.reject(e);r=undefined});return n.promise}}]); "use strict";var m=angular.module("trading-order-book",["brs-ui-sort","trading-order-details","trading-order-update","trading-order","ui.bootstrap.datepicker"]);m.controller("TradingOrderBookController",["$scope","$filter","BrsUiPagination","brsUiSearchDateIsin","bankAccountsCurrentAccount","tradingOrderGetOrdersDetails","tradingOrderStatus","brsAppConfig","brsApiClient","authUser","BrsUiAlert",function(t,n,e,r,i,a,s,o,d,u,c){t.search=new r;t.search.isShowHinweis1=true;t.search.isShowHinweis2=false;t.pagination=new e;t.accountCurrency=i.currency;t.authUser=u;t.section="ALL";t.onMessage=function(e){t.search.text=e.isin||e.wkn};t.onCsv=function(){var e=f();e.data.unshift(["Ordererteilung","OrdergÃŒltigkeit","Nominal / StÃŒck","Handelsplatz ","Transaktion","Name","ISIN","WKN","Orderstatus","Auftragsart","Voraussichtlich ausmachender Bertrag","Voraussichtlich ausmachender Bertrag Currency"]);return e};t.onPdf=function(){return f()};t.$on("trading-order:on-trade",function(e,r){if(!r.isDerivate){t.refresh()}});t.$on("accounts:changeCurrent",function(e,r){t.refresh()});t.doSearch=function(){m();t.search.disabled=true;var e=t.search.getParams();angular.extend(e,{accountKey:i.accountKey,entireList:true,executionDetails:true});a(e).then(function(e){t.orderList=e.ordersDetails;t.refreshOrderList()}).catch(function(e){t.error=e.message}).finally(function(){t.search.disabled=false})};t.onSortChange=function(e,r){t.orderBy.name=e;t.orderBy.reverse=r;l()};t.sortOptions=[{name:"Sortierung nach...",sortName:"creationDate",reverse:true},{name:"Ordererteilung aufsteigend",sortName:"creationDate",reverse:true},{name:"Ordererteilung absteigend",sortName:"creationDate",reverse:false},{name:"OrdergÃŒltigkeit aufsteigend",sortName:"validityDate",reverse:true},{name:"OrdergÃŒltigkeit absteigend",sortName:"validityDate",reverse:false},{name:"Transaktion aufsteigend",sortName:"side",reverse:true},{name:"Transaktion absteigend",sortName:"side",reverse:false},{name:"Auftragsart aufsteigend",sortName:"typeLabel",reverse:true},{name:"Auftragsart absteigend",sortName:"typeLabel",reverse:false},{name:"Orderstatus aufsteigend",sortName:"statusLabel",reverse:true},{name:"Orderstatus absteigend",sortName:"statusLabel",reverse:false}];t.tradingOrderSortBy=t.sortOptions[0];t.onSortChangeMobile=function(e){t.orderBy.name=e.sortName;t.orderBy.reverse=e.reverse;l()};t.refreshOrderList=function(){if(t.section==="ALL"){t.orderListCategory=t.orderList}else{t.orderListCategory=t.orderList.filter(function(e){return s[t.section].indexOf(e.statusCode)!==-1})}g();l()};t.onDelete=function(e){t.doSearch()};t.changeSection=function(e){t.section=e;t.refreshOrderList()};function f(){var r=[];var e={ALL:"Alle",OPEN:"Offene Orders",EXECUTED:"AusgefÃŒhrte Orders",REFUSED:"Gestrichene Orders"};angular.forEach(t.pagination.filtered,function(e){r.push([n("brsFilterDate")(e.creationDate),n("brsFilterDate")(e.validityDate),n("brsFormatQuantity")(e.quantity),e.exchangeLabel,n("tradingOrderSide")(e.side),e.instrument?e.instrument.label:"",e.instrument?e.instrument.isin:"",e.instrument?e.instrument.wkn:e.wkn,e.statusLabel,e.type!=="QUO"?n("tradingOrderTypes")(e,e.type,e.currency,true):e.typeLabel,n("brsFormatNumber")(e.grossAmount,4),t.accountCurrency])});return{data:r,subTitle:e[t.section]}}function l(){t.pagination.filter(t.orderBy.name,t.orderBy.reverse)}function g(){t.orderListFiltered=n("filter")(t.orderListCategory,t.filter);t.pagination.init(t.orderListFiltered,5,true)}function m(){if(o.isMobile()){t.section="ALL"}t.orderList=[];t.orderListCategory=[];t.orderListFiltered=[];t.filter={};t.orderBy={name:"creationDate",reverse:true};t.error=undefined}t.alerts=new c;t.isBlockLoading=true;t.isDeactivated=false;t.isRefreshed=false;t.init=function(){t.isBlockLoading=true;d.get("Common_Utils","getAdminConfigValue",{configKey:"DEACTIVATE_MODULE_ORDERBUCH_WERTPAPIERE",configNamespace:"BANK"}).then(function(e){t.isDeactivated=false;if(e.configValue){t.isDeactivated=true;t.isRefreshed=false}return d.get("Common_Utils","getAdminConfigValue",{configKey:"DEACTIVATE_MODULES_AUTOLOAD",configNamespace:"BANK"})}).then(function(e){t.isBlockLoading=false;t.isRefreshed=!t.isDeactivated&&(t.isRefreshed||!e.configValue);if(t.isRefreshed&&t.authUser.isLogged()){t.doSearch()}}).catch(function(e){t.alerts.danger(e.message)}).finally(function(){t.isBlockLoading=false})};t.refresh=function(){t.isRefreshed=true;t.init()};t.init()}]); "use strict";var m=angular.module("trading-order-details",["trading-order-types","trading-order"]);m.directive("tradingOrderDetails",["brsAppVersion",function(e){return{restrict:"A",templateUrl:e.getUrl("/app/trading-order-details/templates/directive.html"),scope:{order:"=tradingOrderDetails",onDelete:"&",onPerform:"&"},controller:["$scope","tradingOrderGetOrderExecutionDetails","tradingOrderPerformObject","bankAccountsCurrentAccount","tradingOrderCancel","tradingOrder","brsUiGridDesktop",function(r,e,t,n,o,i,d){r.executionDetails=undefined;r.showExecutionDetails=false;r.accountCurrency=n.currency;r.displayGotoTradingBlock={show:false};r.goToTradingBlock=d.goToTradingBlock;r.onClose=function(e){r.action="";if(e==="updated"){i.openDetailModal(r.order)}};r.showDetail=function(){i.openDetailModal(r.order)};r.delete=function(){i.askCancelConfirmation().then(function(){o({orderId:r.order.reference,accountKey:n.accountKey}).then(function(){r.onDelete()})})};r.getLinkparams=function(e){return{isin:r.order.instrument.isin,wkn:r.order.instrument.wkn,side:e}};r.loadExecutionDetails=function(){if(r.executionDetails!==undefined){r.showExecutionDetails=!r.showExecutionDetails;return}r.showExecutionDetails=true;r.loadExecution=true;r.executionDetails=[];e({orderId:r.order.reference,accountKey:n.accountKey}).then(function(e){r.executionDetails=e.orderExecutionDetails;r.loadExecution=false;r.showExecutionDetails=true})};r.perform=function(e){if((typeof r.order.instrument==="undefined"||typeof r.order.instrument.symbol==="undefined"||!r.order.instrument.symbol)&&(r.order.isin||r.order.wkn)){r.displayGotoTradingBlock.show=true;r.displayGotoTradingBlock.side=e;r.displayGotoTradingBlock.action=function(){d.goToTradingBlock(r.order.isin,r.order.wkn,e)}}else{if(r.performObject===undefined){r.performObject=new t;r.performObject.show=false}if(r.performObject.show===true){r.performObject.side=e;r.performObject.retrieveAndSetExchangeList()}else{r.performObject.resetFrom({side:e,symbol:r.order.instrument.symbol,show:true,enable:{exchangeList:true},instrument:r.order.instrument})}}}}]}}]); "use strict";var m=angular.module("trading-order-perform",["feed-exchange","trading-options"]);m.directive("tradingOrderPerform",["tradingOptionsGetAffectOrderStatus","tradingOptionsGetForcedComments","$q","brsDate","brsAppVersion","$moment","bankAccountsCurrentAccount",function(s,u,f,m,n,l,g){return{restrict:"EA",scope:{order:"=tradingOrderPerformObject",onPerform:"&"},templateUrl:function(e,r){var t=r.tradingOrderPerform||"sm";return n.getUrl("/app/trading-order-perform/templates/perform-"+t+".html")},controller:["$scope",function(e){e.datePickerConfig={showOn:"button",dateFormat:"dd.mm.yy",minDate:0,defaultDate:0,maxDate:90,beforeShowDay:$.datepicker.noWeekends}}],link:function(n,e,r){n.loading=true;n.perform={currentExchange:undefined};n.affectOrderStatus=[];n.forcedComments=[];n.currentAccount=g;n.accountCurrency=g.currency;var t=[];if(n.order.enable.exchangeList){var i=n.order.retrieveAndSetExchangeList().then(function(){n.perform.currentExchange=undefined});t.push(i);n.$watch("order.side",function(e){n.order.issuerObject.side=n.order.side;if(n.order.isDirectOtc||n.order.issuerId!==""){n.retrieveIssuerQuote()}})}else{var o=n.order.pre().then(function(){if(!n.order.isKag()){n.datePickerConfig.minDate=l(n.order.minValidityDate).toDate();n.datePickerConfig.maxDate=l(n.order.maxValidityDate).toDate()}else{var e=m.addOpenDays(new Date,20);n.datePickerConfig.minDate=e;n.datePickerConfig.maxDate=e;n.order.validityDate=m.formatToString(e)}}).catch(function(e){n.error=e});t.push(o)}if(n.order.canAffect()){var a=s().then(function(e){n.affectOrderStatus=e});t.push(a)}if(n.order.canForce()){var d=u().then(function(e){n.forcedComments=[];angular.forEach(e,function(e){n.forcedComments.push({code:e.label,label:e.label})});n.forcedComments.push({code:"FREE_COMMENT",label:"Free comment"})});t.push(d)}f.all(t).finally(function(){n.loading=false});n.performConfirm=function(){n.order.confirm().then(function(){n.close();n.onPerform()})};n.performCheck=function(){n.order.check().then(function(){n.close();n.onPerform()})};n.close=function(){n.order.show=false};n.perform=function(){if(n.order.isDirectOtc){n.order.issuerObject.perform()}};n.onExchangeChange=function(){var e=n.perform.currentExchange;n.order.type="";n.order.instrument=e.instrument;n.unit="QTY";if(e===undefined){return}n.loading=true;n.order.symbol=e.symbol;n.order.issuerId=e.issuerId;n.order.isDirectOtc=e.isOtc;if(e.issuerId!==""){n.order.issuerObject.resetFrom({issuer:e.issuer,side:n.order.side,quantity:n.order.quantity,instrument:e.instrument})}var r=[];if(n.order.isDirectOtc||n.order.issuerId!==""){r.push(n.retrieveIssuerQuote())}if(!n.order.isDirectOtc){r.push(c())}var t=n.order.checkMifid().then(function(){n.order.checkForDisclaimer().catch(function(){n.order.show=false})},function(){n.order.show=false});r.push(t);f.all(r).finally(function(){n.loading=false})};n.onQuantityChanged=function(){n.order.issuerObject.quantity=n.order.quantity;if(n.order.isDirectOtc||n.order.issuerId!==""){n.retrieveIssuerQuote()}};n.retrieveIssuerQuote=function(){if(n.order.quantity>0){n.loading=true;return n.order.issuerObject.retrieveIssuerQuote().finally(function(){n.loading=false})}var e=f.defer();e.resolve();return e.promise};n.updateWithRealtime=function(){if(n.order.issuerId===""){n.loading=true;n.order.updateWithRealtime().finally(function(){n.loading=false})}else{n.retrieveIssuerQuote()}};function c(){return n.order.pre().then(function(){if(!n.order.isKag()){n.datePickerConfig.minDate=l(n.order.minValidityDate).toDate();n.datePickerConfig.maxDate=l(n.order.maxValidityDate).toDate()}else{n.datePickerConfig.minDate=m.addOpenDays(new Date,20);n.datePickerConfig.maxDate=n.datePickerConfig.minDate}n.order.validityDate=m.formatToString(n.datePickerConfig.minDate)}).catch(function(e){n.error=e})}}}}]); "use strict";var m=angular.module("trading-order-perform");m.service("tradingOrderPerformObject",["authUser","$filter","$q","customerPulls","customerDisclaimer","tradingMifid","customerPullsGetPullsQuote","bankAccountsCurrentAccount","tradingOrder","tradingOrderPerformIssuerObject","tradingOrderPerform","feedExchangeGetSortedListBySymbol","brsDate",function(i,e,s,t,r,n,u,h,o,a,c,m,d){function f(){this.issuerObject=new a;this.reset()}f.prototype={pre:function(){var e=this;return c({state:"pre",side:this.side,symbol:this.symbol,accountKey:h.accountKey,issuerId:this.issuerId,wkn:this.instrument.wkn,isin:this.instrument.isin,userId:i.d.login}).then(function(t){e.possibleTypes=[];angular.forEach(t.order.types,function(t,i){e.possibleTypes.push({code:i,label:t})});e.type=e.possibleTypes[0].code;e.instrument=t.order.instrument;e.minAmount=e.instrument.category==="FND"&&t.order.kag!==null?t.order.kag.minInvestment:0;e.stock=t.order.stocks.total;e.minValidityDate=t.order.minValidityDate;e.maxValidityDate=t.order.maxValidityDate})},perform:function(t){return o.performInModal(this.instrument,{state:t,side:this.side,quantity:this.quantity,symbol:this.symbol,accountKey:h.accountKey,unit:this.unit,validityDate:this.validityDate,type:this.type,stop:this.stop,limit:this.limit,trail:this.trail,issuerId:this.issuerId,forced:this.force,comment:this.comment=="FREE_COMMENT"?this.freeComment:this.comment,orderStatus:this.affect?this.affectValue:"",wkn:this.instrument.wkn,isin:this.instrument.isin,userId:i.d.login})},check:function(){return this.perform("check")},confirm:function(){return this.perform("confirm")},resetOrderTypeParams:function(){this.stop="";this.limit="";this.trail=""},reset:function(){this.enable={exchangelist:true,issuerList:true,quantity:true};this.show=true;this.unit="QTY";this.validityDate=d.formatToString(new Date);this.symbol="";this.side="";this.quantity="";this.issuerId="";this.possibleTypes=[];this.type="";this.stop="";this.limit="";this.trail="";this.force=false;this.comment="";this.freeComment="";this.affect=false;this.affectValue="";this.instrument={};this.issuerObject.reset();this.isDirectOtc=false;this.minAmount=0;this.stock=0;this.disclaimer={kag:false,otc:false,mifid:false};this.exchangeList=[]},resetFrom:function(t){this.reset();angular.extend(this,t)},retrieveAndSetExchangeList:function(){var i=this;var t=this.side==="S";var e=(this.instrument.isin||this.instrument.wkn||"")+"."+(this.instrument["code_oms"]||"")+"."+(this.instrument.currency||"");return m(this.symbol,t,e).then(function(t){i.exchangeList=t})},getAskPrice:function(){if(this.isDirectOtc||this.issuerId!==""){return this.issuerObject.quote.buyPx}if(this.instrument.co&&this.instrument.co.length>0){return this.instrument.co[0].ask}return undefined},getBidPrice:function(){if(this.isDirectOtc||this.issuerId!==""){return this.issuerObject.quote.sellPx}if(this.instrument.co&&this.instrument.co.length>0){return this.instrument.co[0].bid}return undefined},getCurrency:function(){if((this.isDirectOtc||this.issuerId!=="")&&angular.isDefined(this.issuerObject.quote)){return this.issuerObject.quote.ccyID}return this.instrument.currency},getCalculatePrice:function(){var t=this.side==="B"?this.getAskPrice():this.getBidPrice();if(t===undefined||this.quantity===""){return undefined}return this.quantity*t/this.instrument.factor},getCalculatePriceCurrency:function(){return this.instrument.isPourcentage?h.currency:this.getCurrency()},isValid:function(){return this.getGeneralError()===undefined&&this.quantity>0},getGeneralError:function(){if(this.quantity===""||this.quantity==="0"){return undefined}if(this.isKag()&&this.side==="B"){var t=this.unit==="AMT"?this.quantity:this.quantity*this.instrument.last;if(t<this.minAmount){return"Der Ordergegenwert ist kleiner als die Mindestanlage von "+e("brsFormatCurrency")(this.minAmount,4,this.instrument.currency)+". Bitte ÃŒberprÃŒfen Sie Ihre Eingaben."}}if(this.isKag()&&this.side==="S"){if(parseInt(this.quantity)!=NaN&&parseInt(this.quantity)-this.quantity!==0&&this.quantity!=this.stock){if(this.stock-this.quantity==parseInt(this.stock)){return undefined}return"Ein Verkauf von BruchstÃŒcken ist leider nicht mÃ¶glich. Bitte korrigieren Sie Ihre Eingabe."}}return undefined},updateWithRealtime:function(){var i=this;return t.askConfirmation(i.instrument,false).then(function(){return u(i.instrument.exchangeId,i.instrument.isin,i.instrument.symbol).then(function(t){angular.extend(i.instrument,t.quote[0])})})},isKag:function(){return this.instrument&&this.instrument.category==="FND"&&this.issuerId===""},checkForDisclaimer:function(){if(this.isKag()&&!this.disclaimer.kag&&this.side!=="S"){this.disclaimer.kag=true;return r.openFundDisclaimer(this.instrument.isin,false)}if((this.isDirectOtc||this.issuerId!=="")&&!this.disclaimer.otc){this.disclaimer.otc=true;return r.openOtcDisclaimer(this.instrument.isin)}var t=s.defer();t.resolve();return t.promise},checkMifid:function(){if(this.side==="B"&&!this.disclaimer.mifid){this.disclaimer.mifid=true;return n.openModal(this.instrument.isin,false,null,false).catch(function(){return s.reject("")})}var t=s.defer();t.resolve();return t.promise},canForce:function(){return i.d.canForce},canAffect:function(){return i.d.canAffect}};return f}]);m.service("tradingOrderPerformIssuerObject",["tradingOrdergetQuoteForIssuerAndInstrument","tradingOrder",function(t,i){function e(){this.reset()}e.prototype={reset:function(){this.side="B";this.quantity=0;this.issuer="";this.quote={};this.instrument={};this.timer=0},resetFrom:function(t){this.reset();angular.extend(this,t)},retrieveIssuerQuote:function(){var i=this;this.quote={};return t(this.instrument.wkn,this.instrument.isin,this.quantity,this.side,this.issuer.omsId).then(function(t){angular.extend(i.quote,t.issuersQuote[i.issuer.omsId]);i.timer=0;if(i.quote&&(i.quote.buyPx&&i.side=="B"||i.quote.sellPx&&i.side=="S")){i.timer=1e4}})},perform:function(){return i.confirmIssuerQuoteInModal(this.quote,this.issuer,this.instrument,{wkn:this.instrument.wkn,isin:this.instrument.isin,quantity:this.quantity,side:this.side,omsId:this.issuer.omsId,qrID:this.quote.qrID})},hasValidParams:function(){return(this.side==="B"||this.side==="S")&&this.quantity>0&&this.timer>0}};return e}]); "use strict";var m=angular.module("trading-order-types",[]);m.constant("tradingOrderTypesLabel",{LIM:"Limit",STP:"Stop",ATP:"Market",MTL:"Market To Limit",SLM:"Stop Limit",TSO:"Trailing Stop",OCO:"OCO",QUO:"Direkt"});m.constant("tradingOrderTypesCondition",{ATP:[],MTL:[],LIM:["limit"],STP:["stop"],SLM:["stop","limit"],OCO:["stop","limit"],TSO:["trail","stopPct"],QUO:[]});m.constant("tradingOrderTypesConditionLabel",{limit:"Limit",stop:"Stop",trail:"Trailing Stop",stopPct:"Initial Stop"});m.filter("tradingOrderTypes",["$filter",function(s){return function(t,r,i,e){var n=" / ";switch(r){case"ATP":return"Market";case"MTL":return"Market To Limit";case"LIM":return"Limit "+o(t.limit);case"STP":return"Stop "+o(t.stop);case"SLM":return"Stop Limit"+n+"Stop "+o(t.stop)+n+"Limit "+o(t.limit);case"OCO":return"OCO"+n+"Stop "+o(t.stop)+n+"Limit "+o(t.limit);case"TSO":var a=e?"TSL":"Trailing Stop";return a+n+a+" "+t.trail+" %"+n+"Initial Stop "+o(t.stop||t.stopPct);case"QUO":return"Direkt";default:return r}function o(t,r){return s("brsFormatCurrency")(t,4,r||i)}}}]);m.filter("tradingOrderTypesStrategy",["tradingStrategyType","$filter",function(p,l){return function(t,r,i){if(t==undefined||t==null||r==undefined||r==null){return"Kombination"}var e=" / ";var n=p[r]?p[r].label:"Kombination";for(var a=0;a<t.length;a++){var o=t[a];if(o.type==="LIM"){n+=e+"Limit "+s(o.limit)}else if(o.type==="STP"){n+=e+"Stop "+s(o.stop)}}return n;function s(t,r){return l("brsFormatCurrency")(t,4,r||i)}}}]); "use strict";var m=angular.module("trading-order-update",[]);m.directive("tradingOrderUpdate",["tradingOrderUpdate","bankAccountsCurrentAccount","BrsUiAlert","brsAppVersion","customerPulls","customerPullsGetPullsQuote","bankKontoGetInstrument","bankKontoGetQuotesByExchange",function(r,a,o,t,u,i,e,l){return{restrict:"E",scope:{onClose:"&",order:"="},templateUrl:t.getUrl("/app/trading-order-update/templates/update-xl.html"),link:function(n){var t=["limit","stop","trail","stopPct"];n.quantity=n.order.quantity;n.update={};n.alerts=new o;n.currentAccount=a;for(var e=0;e<t.length;e++){n.update[t[e]]=n.order[t[e]]}n.onUpdate=function(){n.loading=true;r({orderId:n.order.reference,limit:n.update.limit||"",stop:n.update.stop||"",trail:n.update.trail||"",accountKey:a.accountKey}).then(function(){angular.extend(n.order,n.update);n.onClose({reason:"updated"})}).catch(function(t){n.alerts.danger(t.message,"serviceError");n.loading=false})};n.updateWithRealtime=function(){var e=n.order;n.loading=true;return u.askConfirmation(e.instrument,false).then(function(){return i(e.exchangeCode,e.isin,e.instrument.symbol).then(function(t){angular.extend(e.instrument,t.quote[0])})}).finally(function(){n.loading=false})};n.getQuote=function(e){n.loading=true;return l(e.exchangeCode,e.isin).then(function(t){angular.extend(e.instrument,t.quotes[0]);n.loading=false}).finally(function(){n.loading=false})};n.getQuote(n.order)}}}]); "use strict";var m=angular.module("trading-order-update");m.service("tradingOrderUpdate",["brsApiClient",function(e){return function(r){return e.get("Trading_order","update",r)}}]); "use strict";var m=angular.module("trading-order");m.constant("tradingOrderStatus",{OPEN:[10,4,8,15,17,19,6,16,17,18,7,22],EXECUTED:[11,1],REFUSED:[2,3,5,12]}); "use strict";var m=angular.module("trading-order",["brs-confirm","customer-disclaimer","trading-mifid","trading-order-types","trading-order-perform","brs-ui-alert","feed-instrument","customer-portfolio","brs-validation","brs-format","brs-ui-form","ui-timer","auth-user","customer-pulls","brs-uniquid"]);m.controller("TradingOrderController",["$scope","customerDisclaimer","customerPulls","customerPullsGetPullsQuote","BrsUiAlert","tradingOrderMarketQuote","tradingMifid","feedInstrumentSearch","tradingOrdergetQuoteTradingStatus","tradingOrderGetIssuerForInstruments","tradingOrdergetQuoteForIssuerAndInstrument","feedInstrumentGetFunds","customerPortfolioGetStockAmount","$q",function(s,e,i,a,n,t,o,r,u,c,l,d,f,m){s.alerts=new n;s.side="B";var g="";s.onMessage=function(e){s.search=e.isin||e.wkn;s.side=e.side||"B";s.quantity="";g=e.exchange||"";s.reset()};s.searchInstrument=function(){s.reset();s.loading=true;if(g!=""){s.selectedExchange=g;g=""}if(s.search&&s.search.length>2){r({code:s.search,fullSearch:true,findBy:"isin;wkn",onlyTrading:true}).then(function(e){s.currentInstrument=e.instruments[0];if(s.currentInstrument.wkn==""){for(var n=0;n<e.instruments.length;n++){if(e.instruments[n].wkn!==""){s.currentInstrument=e.instruments[n];break}}}angular.forEach(e.instruments,function(e,n){if(e.category==="FND"){s.fundQuotes.push(e)}else{s.marketQuotes.push(new t(e))}});v(s.currentInstrument.wkn).then(function(){var e='Ihre Eingabe im Feld "Nominal / StÃŒck" ist grÃ¶Ã?er als Ihr aktueller Bestand ('+s.stock+"). Bitte prÃŒfen Sie Ihre Eingabe.";if(parseFloat(s.quantity)>parseFloat(s.stock)&&s.side==="S"){h();s.alerts.danger(e,"search-alert");return true}var n=k(s.currentInstrument.wkn,s.currentInstrument.isin);var t=d({nameWknIsin:s.currentInstrument.isin,savingsPlanEligible:""}).then(function(e){e.funds.category="FND";s.fundQuotes=e.funds});var r=[n,t];if(s.side==="B"){var u=o.openModal(s.search,false,null,false).catch(function(){h();return m.reject("")});r.push(u)}m.all(r).then(function(){b().then(function(){Q().then(function(){s.mifid=true}).finally(function(){s.loading=false})}).catch(function(){h()})}).catch(function(){s.loading=false})})}).catch(function(e){s.alerts.danger(e.message,"search-alert");s.loading=false})}};s.refreshIssuerQuotes=function(){var e="";for(var n=0;n<s.issuers.length;n++){e+=s.issuers[n]["omsLId"]+";"}if(e==="")return;s.realtimeOtcLoading=true;u("DEACTIVATE_FEATURE_QUOTES","BANK").then(function(e){s.isQuoteTradingDeactivated=e.configValue;var n="Der Quote-Handel mit den Direkthandelspartnern ist vor&uuml;bergehend deaktiviert. Der Limit-Handel und der Handel &uuml;ber die B&ouml;rsen stehen Ihnen zur Verf&uuml;gung.";if(s.isQuoteTradingDeactivated){s.alerts.warning(n)}});return l(s.currentInstrument.wkn,s.currentInstrument.isin,s.quantity,s.side,e).then(function(e){angular.forEach(e.issuersQuote,function(e,n){if(n&&s.issuersQuote[n]){angular.extend(s.issuersQuote[n],e)}});I()}).finally(function(){s.realtimeOtcLoading=false})};s.getCheckedRealtime=function(){var e=[],t={},n=[],r=[];for(var u=0;u<s.marketQuotes.length;u++){if(s.marketQuotes[u].isChecked){e.push(s.marketQuotes[u].quote.exchangeId);r.push(s.marketQuotes[u].quote.symbol);t[s.marketQuotes[u].quote.exchangeId]=s.marketQuotes[u];n.push(s.marketQuotes[u].quote)}}i.askMultipleConfirmation(n).then(function(){angular.forEach(t,function(e){e.loading.quote=true});s.realtimeLoading=true;a(e.join(";"),s.currentInstrument.isin,r.join(";")).then(function(e){for(var n=0;n<e.quote.length;n++){if(t[e.quote[n].exchangeId]!==undefined){angular.extend(t[e.quote[n].exchangeId].quote,e.quote[n])}}}).finally(function(){angular.forEach(t,function(e){e.loading.quote=false});s.realtimeLoading=false})})};s.reset=function(e){h();if(e){s.search="";s.side="B";s.quantity=""}};s.onSideChange=function(){h()};s.getQuoteName=function(e){return e.quote.exchangeLabel};var h=function(){s.currentInstrument={};s.issuers=undefined;s.issuersQuote=undefined;s.marketQuotes=[];s.fundQuotes=[];s.loading=false;s.mifid=false;s.stock=-1;s.loading=false;s.realtimeLoading=false;s.realtimeOtcLoading=false;s.selectedExchange=""};var I=function(){s.bestIssuer=undefined;angular.forEach(s.issuersQuote,function(e,n){if(e.buyPx!="0"&&(s.bestIssuer===undefined||s.side==="B"&&s.issuersQuote[s.bestIssuer].buyPx>e.buyPx||s.side==="S"&&s.issuersQuote[s.bestIssuer].sellPx<e.sellPx)){s.bestIssuer=n}})};var v=function(e){return f(e).then(function(e){s.stock=0;angular.forEach(e.stock,function(e,n){s.stock+=parseInt(e)})})};var k=function(e,n){return c(e,n).then(function(e){var n="";var t=e.issuers;s.issuers=[];for(var r in t){t[r]["omsLId"]=r;s.issuers.push(t[r])}})};var Q=function(){var e="";for(var n=0;n<s.issuers.length;n++){e+=s.issuers[n]["omsLId"]+";"}if(e===""){var t=m.defer();t.resolve();return t.promise}u("DEACTIVATE_FEATURE_QUOTES","BANK").then(function(e){s.isQuoteTradingDeactivated=e.configValue;var n="Der Quote-Handel mit den Direkthandelspartnern ist vor&uuml;bergehend deaktiviert. Der Limit-Handel und der Handel &uuml;ber die B&ouml;rsen stehen Ihnen zur Verf&uuml;gung.";if(s.isQuoteTradingDeactivated){s.alerts.warning(n)}});return l(s.currentInstrument.wkn,s.currentInstrument.isin,s.quantity,s.side,e).then(function(e){s.issuersQuote=e.issuersQuote;I();return e})};var b=function(){return e.openOtcDisclaimer(s.currentInstrument.isin).then(function(){if(s.fundQuotes.length>0){return e.openFundDisclaimer(s.currentInstrument.isin,false)}})};s.reset()}]); "use strict";var m=angular.module("trading-order");m.filter("tradingOrderSide",function(){return function(r){return r==="B"?"Kauf":r==="S"?"Verkauf":""}}); "use strict";var m=angular.module("trading-order");m.directive("tradingOrderFundQuote",["tradingOrderPerformObject","brsAppVersion",function(n,e){return{restrict:"E",templateUrl:e.getUrl("/app/trading-order/templates/fund-quote.html"),scope:{quote:"=tradingOrderFundQuote",side:"=tradingOrderSide",quantity:"=tradingOrderQuantity"},link:function(t,e,r){t.$watchGroup(["side","quantity"],function(e){if(t.performObject!==undefined){t.performObject.side=t.side;t.performObject.quantity=t.quantity}});t.showPerform=function(){if(t.performObject===undefined){t.performObject=new n}t.performObject.resetFrom({side:t.side,symbol:t.quote.symbol,quantity:t.quantity,minAmount:t.quote.minInvestment,instrument:t.quote})}}}}]); "use strict";var m=angular.module("trading-order");m.directive("tradingOrderIssuerQuote",["tradingOrdergetQuoteTradingStatus","tradingOrdergetQuoteForIssuerAndInstrument","tradingOrderPerformObject","tradingOrder","$log","brsAppVersion",function(n,i,u,s,d,e){d=d.getInstance("tradingOrderIssuerQuote");return{restrict:"E",templateUrl:e.getUrl("/app/trading-order/templates/issuer-quote.html"),scope:{quote:"=tradingOrderIssuerQuote",side:"=tradingOrderSide",quantity:"=tradingOrderQuantity",issuer:"=tradingOrderIssuer",instrument:"=tradingOrderInstrument",best:"=tradingOrderBest",isQuoteTradingDeactivated:"=tradingOrderQuoteDeactivated"},link:function(r,e,t){r.timer=0;r.isLoading=false;r.currency="EUR";r.costTransparencyAdditionalParameters={side:r.side,symbol:r.instrument.symbol,quantity:r.quantity,issuerId:r.issuer.omsLId};r.refresh=function(){r.isLoading=true;n("DEACTIVATE_FEATURE_QUOTES","BANK").then(function(e){r.isQuoteTradingDeactivated=e.configValue;var t="Der Quote-Handel mit den Direkthandelspartnern ist vor&uuml;bergehend deaktiviert. Der Limit-Handel und der Handel &uuml;ber die B&ouml;rsen stehen Ihnen zur Verf&uuml;gung.";if(r.isQuoteTradingDeactivated){r.alerts.warning(t)}});i(r.instrument.wkn,r.instrument.isin,r.quantity,r.side,r.issuer.omsId).then(function(e){angular.extend(r.quote,e.issuersQuote[r.issuer.omsId]);r.timer=0;if(r.getPrice()>0){r.timer=1e4}}).finally(function(){r.isLoading=false})};r.performQuoteRequest=function(){s.confirmIssuerQuoteInModal(r.quote,r.issuer,r.instrument,{wkn:r.instrument.wkn,isin:r.instrument.isin,quantity:r.quantity,side:r.side,omsId:r.issuer.omsId,qrID:r.quote.qrID})};r.$watch("side",function(e,t){if(e!==undefined&&e!==t){r.refresh();d.info("refresh issuer quote")}if(r.performObject!==undefined){r.performObject.side=r.side}});r.$watch("quantity",function(e,t){if(e!==undefined&&e!==t){r.refresh();d.info("refresh issuer quote")}if(r.performObject!==undefined){r.performObject.quantity=r.quantity}});r.showPerform=function(){if(r.performObject===undefined){r.performObject=new u}r.performObject.resetFrom({side:r.side,symbol:r.instrument.symbol,quantity:r.quantity,issuerId:r.issuer.omsLId,instrument:r.instrument})};r.getPrice=function(){if(r.quote===undefined){return undefined}var e=r.side==="B"?r.quote.buyPx:r.quote.sellPx;if(e!==undefined&&e!=0&&r.quantity!==undefined){if(r.instrument.isPourcentage){return e*r.quantity/r.instrument.factor}else{return e*r.quantity}}return undefined};if(r.getPrice()>0){r.timer=1e4}if(r.instrument.isPourcentage){r.currency="%"}}}}]); "use strict";var m=angular.module("trading-order");m.directive("tradingOrderMarketQuote",["customerPullsGetPullsQuote","customerPullsGetOrderBook","tradingOrderPerformObject","customerPulls","brsAppVersion","bankAccountsCurrentAccount",function(n,o,i,u,e,a){return{restrict:"E",templateUrl:e.getUrl("/app/trading-order/templates/market-quote.html"),scope:{side:"=tradingOrderSide",quantity:"=tradingOrderQuantity",marketQuote:"=tradingOrderMarketQuote",performOnShow:"&tradingOrderMarketPerform"},link:function(t,e,r){t.showLevel2=false;t.isLoadingOrderBook=false;t.quote=t.marketQuote.quote;t.currentAccount=a;t.getRealtimeQuote=function(){u.askConfirmation(t.quote,false).then(function(){t.marketQuote.loading.quote=true;n(t.quote.exchangeId,t.quote.isin,t.quote.symbol).then(function(e){angular.extend(t.quote,e.quote[0])}).finally(function(e){t.marketQuote.loading.quote=false})})};t.showOrderBook=function(){if(!t.showLevel2&&t.quote.co&&t.quote.co.length<=1){t.loadOrderBook()}t.showLevel2=!t.showLevel2};t.loadOrderBook=function(){u.askConfirmation(t.quote,true).then(function(){t.isLoadingOrderBook=true;o(t.quote.exchangeId,t.quote.isin).then(function(e){t.quote.co=e.co}).finally(function(){t.isLoadingOrderBook=false})})};t.$watchGroup(["side","quantity"],function(e){if(t.performObject!==undefined){t.performObject.side=t.side;t.performObject.quantity=t.quantity}});t.showPerform=function(){if(t.performObject===undefined){t.performObject=new i}t.performObject.resetFrom({side:t.side,symbol:t.quote.symbol,quantity:t.quantity,instrument:t.quote})};if(t.performOnShow()===true){t.showPerform()}t.getCanNotTradeMessage=function(){var e="";switch(t.quote.exchangeId){case"106":e="FÃŒr diesen Handelsplatz sind gegebenenfalls nur telefonische VerkÃ€ufe bestehender Positionen unter 069 / 7107-555 mÃ¶glich.";break;case"205":case"207":case"4402":e="FÃŒr diesen Handelsplatz sind ab dem 15.08.2017 nur telefonische Verkaufsorders unter 069-7107-555 mÃ¶glich. "+"Ab dem 01.09.2017 wird der Telefonhandel an diesem Handelsplatz nicht mehr angeboten.";break;default:e="FÃŒr diesen Handelsplatz sind derzeit nur telefonische Orders unter 069-7107-555 mÃ¶glich.";break}return e}}}}]); "use strict";var m=angular.module("trading-order");m.service("tradingOrderMarketQuote",function(){function t(t){this.loading={quote:false};this.isChecked=t.pulls;this.quote=t}t.prototype={};return t}); "use strict";var m=angular.module("trading-order");m.service("tradingOrderPerform",["tokenApi","brsApiClient","$rootScope","$log","$q",function(u,d,c,l,f){var g;return function(e){var t=l.getInstance("tradingOrderPerform Service");var n=f.defer();if(g){return g}else{g=n.promise}var r={riskMode:"CPT",style:"Simple"};if(e.state==="confirm"){var i="COO";var s=e.userId;var o=e.wkn?e.wkn:e.isin;var a=u(i,s,o);angular.extend(r,{token:a})}angular.extend(r,e);d.get("Trading_order","newperform",r).then(function(r){n.resolve(r);if(e.state==="confirm"){c.$broadcast("trading-order:on-trade",{accountKey:e.accountKey,isDerivate:r.order.instrument.category==="FUT"||r.order.instrument.category==="OPT"});t.info("broadcast on order trade")}}).catch(function(r){if(r.code==50131){n.resolve("DOUBLE_CONFIRM")}else{n.reject(r)}}).finally(function(){g=false});return n.promise}}]);m.service("tradingOrdergetQuoteTradingStatus",["brsApiClient",function(t){return function(r,e){return t.get("Common_Utils","getAdminConfigValue",{configKey:r,configNamespace:e})}}]);m.service("tradingOrdergetQuoteForIssuerAndInstrument",["brsApiClient","bankAccountsCurrentAccount",function(s,o){return function(r,e,t,n,i){return s.get("Trading_order","getQuoteForIssuerAndInstrument",{wkn:r,isin:e,quantity:t,side:n,issuerId:i,accountKey:o.accountKey})}}]);m.service("tradingOrderGetIssuerForInstruments",["brsApiClient",function(t){return function(r,e){return t.get("Trading_order","getissuerForInstrument",{wkn:r,isin:e})}}]);m.service("tradingOrderGetIssuers",["brsApiClient",function(r){return function(){return r.get("Trading_order","getIssuers")}}]);m.service("tradingOrderConfirmQuote",["tokenApi","authUser","brsApiClient","$log","$rootScope","bankAccountsCurrentAccount","$q",function(a,u,d,c,l,f,g){var m;return function(r){var e=c.getInstance("tradingOrderPerform Service");var t=g.defer();if(m){return m}else{m=t.promise}var n="COQ";var i=u.d.login;var s=r.wkn?r.wkn:r.isin;var o=a(n,i,s);angular.extend(r,{token:o});d.get("Trading_order","confirmQuote",r).then(function(r){t.resolve(r);l.$broadcast("trading-order:on-trade",{accountKey:f.accountKey});e.info("broadcast on OTC order trade")}).catch(function(r){if(r.code==50131){t.resolve("DOUBLE_CONFIRM")}else{t.reject(r)}}).finally(function(){m=false});return t.promise}}]);m.service("tradingOrderCancel",["brsApiClient","$log","$rootScope",function(r,n,i){return function(t){return r.get("Trading_order","cancel",t).then(function(r){var e=n.getInstance("tradingOrderCancel Service");i.$broadcast("trading-order:on-cancel",{accountKey:t.accountKey});e.info("Broadcast a cancelation order");return r})}}]);m.service("tradingOrderGetOrdersDetails",["brsApiClient",function(e){return function(r){return e.get("Trading_order","getOrdersDetails",r)}}]);m.service("tradingOrderGetOrderExecutionDetails",["brsApiClient",function(e){return function(r){return e.get("Trading_order","getOrderExecutionDetails",r)}}]);m.service("tradingOrder",["brsApiClient","brsUiModal","tradingOrderPerform","tradingOrderConfirmQuote","brsConfirm","brsAppVersion",function(r,i,e,t,n,s){this.performInModal=function(r,e){return i.open(i.getConfig("draggable","lg",{templateUrl:s.getUrl("/app/trading-order/templates/modal-order-result.html"),controller:["$scope","$modalInstance","order","tradingOrderGetIssuers","tradingOrderPerform","tradingOrder","tradingOrderResult",o],resolve:{order:function(){return{quote:r,params:angular.copy(e)}}}})).result};this.openDetailModal=function(r){return i.open(i.getConfig("draggable","lg",{templateUrl:s.getUrl("/app/trading-order/templates/modal-order-result.html"),controller:["$scope","$modalInstance","order","tradingOrderResult",u],resolve:{order:function(){return r}}})).result};this.confirmIssuerQuoteInModal=function(r,e,t,n){return i.open(i.getConfig("draggable","lg",{templateUrl:s.getUrl("/app/trading-order/templates/modal-order-result.html"),controller:["$scope","$modalInstance","order","tradingOrderConfirmQuote","tradingOrder","tradingOrderResult",a],resolve:{order:function(){return{quote:t,params:angular.copy(n),issuerQuote:r,issuer:e}}}})).result};this.askCancelConfirmation=function(){var r='Bitte bestÃ€tigen Sie die Stornierung mittels Klick auf "stornieren".';return n("Order stornieren",r,"Stornieren","Abbrechen")};function o(e,t,r,n,i,s,o){e.order=r;e.show={spinner:true};e.infos=new o;e.close=function(r){t.close(r)};e.cancel=function(){t.dismiss("cancel")};e.perform=function(r){e.show.spinner=true;e.disabledButton=true;e.order.params.state=r;e.infos.alerts.clear();return i(e.order.params).then(function(r){if(r=="DOUBLE_CONFIRM"){if(e.order.result&&e.order.result.checkOrder){e.order.result.checkOrder=null}}else{e.order.result=r.order}}).catch(function(r){e.order.error=r}).finally(function(){e.show.spinner=false;e.infos.updateWithPerformOrder(e.order);if(e.order.params.issuerId!==""&&e.order.params.issuerId!==undefined&&e.infos.hasError===true){e.show.spinner=true;n().then(function(r){e.infos.exchange=r.issuers[e.order.params.issuerId]+" Limit"}).finally(function(){e.show.spinner=false;e.disabledButton=false})}})};e.perform(e.order.params.state)}function a(e,t,r,n,i,s){e.order=r;e.show={spinner:true};e.infos=new s;e.close=function(r){t.close(r)};e.cancel=function(){t.dismiss("cancel")};e.show.spinner=true;n(e.order.params).then(function(r){e.order.result=r}).catch(function(r){e.order.error=r}).finally(function(){e.show.spinner=false;e.infos.updateWithIssuerConfirmOrder(e.order)})}function u(r,e,t,n){r.order=t;r.show={spinner:false};r.infos=new n;r.infos.updateFromExistingOrder(t);r.close=function(r){e.close(r)};r.cancel=function(){e.dismiss("cancel")}}}]);m.service("tradingOrderResult",["$filter","BrsUiAlert","authUser","bankAccountsCurrentAccount",function(a,r,e,t){function n(){this.detailsMode=false;this.alerts=new r;this.userId=e.d.login;this.orderDate=new Date;this.title="Hinweis";this.accountCurrency=t.currency}n.prototype={updateWithPerformOrder:function(r){var e=r.quote;var t=r.result;var n=r.error;var i=e.isPourcentage?"%":e.currency;r=r.params;this.mode=a("tradingOrderTypes")(r,r.type,i);if(n){this.alerts.danger(n.message)}else{for(var s=0;s<t.messages["warning"].length;s++){this.alerts.warning(t.messages["warning"][s].message)}for(var s=0;s<t.messages["error"].length;s++){this.alerts.danger(t.messages["error"][s].message)}}this.hasError=!angular.isUndefined(n)||t.messages["error"].length>0;this.quantity=r.quantity;this.validityDate=r.validityDate||new Date;this.instrument=e;this.side=r.side;if(!this.hasError){var o=t.checkOrder?"checkOrder":"confirmOrder";this.grossAmount=t[o].grossAmount;this.buyingPower=t[o].buyingPower;this.orderId=o==="confirmOrder"?t[o].orderId:undefined;this.exchange=t.issuer?t.issuer.lName:e.exchangeLabel;if(o==="confirmOrder"){this.status="Offene Order";this.executionPrice=null}}else{this.exchange=e.exchangeLabel}},updateWithIssuerConfirmOrder:function(r){this.exchange=r.issuer.name;this.quantity=r.params.quantity;this.executionPrice=r.issuerQuote[r.params.side==="B"?"buyPx":"sellPx"];this.grossAmount=this.executionPrice*this.quantity/r.quote.factor;this.mode="Direkthandel";this.validityDate=r.params.validityDate||new Date;this.instrument=r.quote;this.side=r.params.side;if(!angular.isUndefined(r.result)){this.orderId=r.result.orderId}this.hasError=!angular.isUndefined(r.error);if(r.error){this.alerts.danger(r.error.code+": "+r.error.message)}if(r.result&&r.result.msg&&r.result.status===0){this.alerts.danger(r.result.msg);this.hasError=true}},updateFromExistingOrder:function(r){var e=r.instrument&&r.instrument.isPourcentage?"%":r.currency;this.title="Order Details";this.exchange=r.exchangeLabel;this.quantity=r.quantity;this.mode=a("tradingOrderTypes")(r,r.type,e);this.orderDate=r.creationDate;this.validityDate=r.validityDate;this.orderId=r.reference;this.detailsMode=true;this.instrument=r.instrument;this.detailPrice=r.executionPrice;if(this.instrument){this.instrument.currency=r.currency}this.status=r.statusLabel;this.side=r.side;this.executionMessages=r.orderMessages.execution}};return n}]); "use strict";var m=angular.module("trading-quick-order");m.controller("TradingQuickOrderBlockController",["$scope","$log","$filter","authUser","tradingQuickOrderTranslation","tradingQuickOrderGetLastEntries","tradingQuickOrderAddEntry","tradingQuickOrderCheckEntry","tradingQuickOrderGetConfig","tradingOrder","tradingQuickOrderSearchInstrument","bankAccountsCurrentAccount","BrsUiAlert","brsUiModal","brsAppVersion",function(u,o,e,n,t,r,a,i,s,l,c,g,d,f,y){o=o.getInstance("TradingQuickOrderBlockController");u.authUser=n;u.isBlockLoading=false;u.displaySelect=false;u.lastEntries=[];u.config=[];u.instrument=null;u.kidInstrument=null;u.alerts=new d;u.init=function(){o.debug("init");u.newEntry="";u.entryValid=false;u.entryselected={value:""};A();k()};u.refresh=function(){o.debug("refresh");u.init()};u.cancel=function(){o.debug("cancel");u.newEntry="";u.liveCheck()};u.fill=function(){o.debug("fill ",u.entryselected);u.newEntry=u.entryselected.value;u.liveCheck()};u.check=function(){o.debug("check");L()};u.liveCheck=function(){o.debug("liveCheck");u.instrument=null;u.kidInstrument=null;u.entryValid=false;u.entryValid=m(u.newEntry)};u.clearAlerts=function(){if(u.alerts.length){angular.forEach(u.alerts,function(e){u.alerts.pop()})}};function m(e){o.debug("isValidEntry");var n=false,t=false,r=false,a=false,i=false,s=false,l=false;o.debug("isValidEntry: ",e);if(e.length<1){return false}u.entryParams=e.split(";");o.debug("isValidEntry: $scope.entryParams.length = ",u.entryParams.length);if(u.entryParams.length<5||u.entryParams.length>7){return false}n=jQuery.inArray(u.entryParams[0],u.config.side)<0;t=jQuery.inArray(u.entryParams[1],u.config.exchangeCode)<0;r=u.entryParams[2].length!=12;a=isNaN(u.entryParams[3]);i=jQuery.inArray(u.entryParams[4],u.config.type)<0;s=u.entryParams[4]!="M"&&(u.entryParams.length<6||u.entryParams[5].length<1);l=u.entryParams[4]=="M"&&u.entryParams.length>5&(isNaN(u.entryParams[5])||u.entryParams[5].length!=6)||u.entryParams[4]!="M"&&u.entryParams.length>6&(isNaN(u.entryParams[6])||u.entryParams[6].length!=6);o.debug("isValidEntry: testSide = ",n);o.debug("isValidEntry: testExchange = ",t);o.debug("isValidEntry: testIsin = ",r);o.debug("isValidEntry: testUnits = ",a);o.debug("isValidEntry: testType = ",i);o.debug("isValidEntry: testAdditional = ",s);o.debug("isValidEntry: testDate = ",l);if(n||t||r||a||i||s||l){return false}if(!n&&u.entryParams[0]==="K"&&!r&&!t){u.kidInstrument={isin:u.entryParams[2],exchangeId:u.config.exchangeMap[u.entryParams[1]]}}return true}function h(e){var n="";var t="";var r=0;for(var a=0;a<=e.length;a++){var i=e.charCodeAt(a);n+=i>57?(i-55).toString():e[a]}for(var a=0;a<=n.length;a++){t+=(parseInt(n[a])*(a%2==(n.length%2!=0?0:1)?2:1)).toString()}for(var a=0;a<=t.length;a++){r+=parseInt(t[a])}return(10-r%10)%10}function b(e){o.debug("isin=",e);var n=/^(BE|BM|FR|BG|VE|DK|HR|DE|JP|HU|HK|JO|BR|XS|FI|GR|IS|RU|LB|PT|NO|TW|UA|TR|LK|LV|LU|TH|NL|PK|PH|RO|EG|PL|AA|CH|CN|CL|EE|CA|IR|IT|ZA|CZ|CY|AR|AU|AT|IN|CS|CR|IE|ID|ES|PE|TN|PA|SG|IL|US|MX|SK|KR|SI|KW|MY|MO|SE|GB|GG|KY|JE|VG|NG|SA|MU)([0-9A-Z]{9})([0-9])$/;var t=n.exec(e);o.debug("match.length=",t.length);o.debug("match=",t);if(t.length!=4){return false}return t[3]==h(t[1]+t[2])}u.openHelpModal=function(){var e=f.open(f.getConfig("draggable","lg",{templateUrl:y.getUrl("/app/trading-quick-order/templates/help.html"),controller:"ModalAboutController"}))};function k(e){o.debug("requestLastEntries");u.isBlockLoading=true;u.lastEntries=[];u.displaySelect=false;u.clearAlerts();r(e).then(function(e){u.lastEntries=e;o.debug("requestLastEntries result:",e);if(u.lastEntries.length>0){u.displaySelect=true}}).catch(function(e){u.alerts.danger(e.message)}).finally(function(){u.isBlockLoading=false})}function E(){u.isBlockLoading=true;u.clearAlerts();a(u.newEntry).then(function(e){u.refresh()}).catch(function(e){u.alerts.danger(e.message)}).finally(function(){u.isBlockLoading=false})}function P(){u.isBlockLoading=true;u.clearAlerts();i(u.newEntry).then(function(e){}).catch(function(e){u.alerts.danger(e.message)}).finally(function(){u.isBlockLoading=false})}function A(){o.debug("requestConfig");u.clearAlerts();u.isBlockLoading=true;s().then(function(e){o.debug("requestConfig: result ",e);u.config=e;o.debug("requestConfig: result ",angular.isArray(e.side))}).catch(function(e){u.alerts.danger(e.message)}).finally(function(){u.isBlockLoading=false})}function p(){o.debug("requestInstrument");u.isBlockLoading=true;u.instrument=null;u.clearAlerts();c(u.entryParams[2]).then(function(e){o.debug("requestInstrument",e);if(e.instruments&&e.instruments.length>0){u.instrument=e.instruments[0];B()}}).catch(function(e){u.alerts.danger(e.message)}).finally(function(){u.isBlockLoading=false})}function L(){o.debug("requestTranslation");u.isBlockLoading=true;u.clearAlerts();t(u.newEntry).then(function(e){o.debug("requestTranslation",e);if(e.translation&&e.translation.instruments&&e.translation.instruments.length>0){o.debug("requestTranslation: translation");B(e.translation)}else{o.debug("requestTranslation: no translation");u.alerts.danger("not valid");u.isBlockLoading=false}o.debug("requestTranslation: end")}).catch(function(e){o.debug("requestTranslation: error");u.alerts.danger(e.message);u.isBlockLoading=false}).finally(function(){o.debug("requestTranslation: finally")})}function B(e){o.debug("perform",e);u.isBlockLoading=true;u.clearAlerts();e.symbol=e.instruments[0].symbol;e.accountKey=g.accountKey;o.debug("perform",e);return l.performInModal(e.instruments[0],e).then(function(e){o.debug("perform",e);o.debug("perform success");E()}).catch(function(e){o.debug("perform error");u.isBlockLoading=false}).finally(function(){})}u.init()}]); "use strict";var m=angular.module("trading-quick-order");m.service("tradingQuickOrderGetLastEntries",["brsApiClient","$q","$rootScope",function(e,n,t){var i;return function(){var r=n.defer();if(i){return i}else{i=r.promise}e.get("Trading_QuickOrder","getLastEntries",{numberOfResults:10}).then(function(e){delete e["_meta"];r.resolve(e.quickorders)}).catch(function(e){r.reject(e)}).finally(function(){t.spinner-=1;i=false});return r.promise}}]);m.service("tradingQuickOrderAddEntry",["brsApiClient","$q","$rootScope",function(n,t,i){var c;return function(e){var r=t.defer();if(c){return c}else{c=r.promise}n.get("Trading_QuickOrder","addEntry",{entry:e}).then(function(e){delete e["_meta"];r.resolve(e)}).catch(function(e){r.reject(e)}).finally(function(){i.spinner-=1;c=false});return r.promise}}]);m.service("tradingQuickOrderCheckEntry",["brsApiClient","$q","$rootScope",function(n,t,i){var c;return function(e){var r=t.defer();if(c){return c}else{c=r.promise}n.get("Trading_QuickOrder","checkEntry",{entry:e}).then(function(e){r.resolve(true)}).catch(function(e){r.reject(e)}).finally(function(){i.spinner-=1;c=false});return r.promise}}]);m.service("tradingQuickOrderGetConfig",["brsApiClient","$q","$rootScope",function(e,n,t){var i;return function(){var r=n.defer();if(i){return i}else{i=r.promise}e.get("Trading_QuickOrder","getConfig",{}).then(function(e){r.resolve(e.config)}).catch(function(e){r.reject(e)}).finally(function(){t.spinner-=1;i=false});return r.promise}}]);m.service("tradingQuickOrderSearchInstrument",["brsApiClient","$q","$rootScope",function(n,t,i){var c;return function(e){var r=t.defer();if(c){return c}else{c=r.promise}i.spinner+=1;n.get("Feed_Instrument","search",{code:e}).then(function(e){r.resolve(e)}).catch(function(e){r.reject(e)}).finally(function(){i.spinner-=1;c=false});return r.promise}}]);m.service("tradingQuickOrderTranslation",["brsApiClient","$q","$rootScope",function(n,t,i){var c;return function(e){var r=t.defer();if(c){return c}else{c=r.promise}i.spinner+=1;n.get("Trading_QuickOrder","translateFormula",{entry:e}).then(function(e){r.resolve(e)}).catch(function(e){r.reject(e)}).finally(function(){i.spinner-=1;c=false});return r.promise}}]); "use strict";var m=angular.module("trading-quick-order",["brs-api-client","auth-user"]);m.value("tradingQuickOrderEntries",[]);m.controller("TradingQuickOrderController",function(){});m.directive("optionsClass",["$parse",function(o){return{require:"select",link:function(n,t,r,i){var a=r.ngOptions.split(" ").pop(),e=o(r.optionsClass);n.$watch(a,function(n){angular.forEach(n,function(n,r){var i=e(n),a=t.find("option[value="+r+"]");angular.forEach(i,function(n,r){if(n){angular.element(a).addClass(r)}})})})}}}]); "use strict";var m=angular.module("trading-realtime-pulls");m.controller("TradingRealtimePullsController",["$scope",function(n){}]);m.controller("TradingRealtimePullsBlockController",["$rootScope","$scope","authUser","tradingRealtimePullsGetPullsCredit","tradingRealtimePullsGetPulls","tradingRealtimePullsCreateCase","BrsUiPagination","BrsUiAlert","bankAccountsGetAccountsList","bankAccountsList","bankAccountsCurrentAccount",function(n,t,e,i,a,l,s,u,r,c,o){t.blockTitle="Realtimekurse";t.isBlockLoading=true;t.authUser=e;t.displaySummary=false;t.displayList=false;t.displayBuyStep1=false;t.displayBuyStep2=false;t.pagination=new s;t.itemsPerPage=10;t.alerts=new u;t.credit=null;t.pulls=null;t.init=function(){d();f()};t.refreshBlockContent=function(){d()};t.back=function(){t.renderSummary()};t.details=function(){y()};t.purchase=function(){t.renderBuyStep1()};t.purchaseConfirm=function(){p()};t.renderSummary=function(){t.displaySummary=true;t.displayList=false;t.displayBuyStep1=false;t.displayBuyStep2=false};t.renderList=function(){t.displaySummary=false;t.displayList=true;t.displayBuyStep1=false;t.displayBuyStep2=false};t.renderBuyStep1=function(){t.displaySummary=false;t.displayList=false;t.displayBuyStep1=true;t.displayBuyStep2=false};t.renderBuyStep2=function(){t.displaySummary=false;t.displayList=false;t.displayBuyStep1=false;t.displayBuyStep2=true};t.order=function(n,e){t.pagination.filter(n,e)};function f(){t.isBlockLoading=true;t.alerts.clean();r().then(function(n){t.accountsList=c;t.currentAccount=o}).catch(function(n){t.alerts.danger(n.message);t.isBlockLoading=false}).finally(function(){})}function d(){t.isBlockLoading=true;i().then(function(n){t.credit=n;t.renderSummary()}).catch(function(n){}).finally(function(){t.isBlockLoading=false})}function y(){t.isBlockLoading=true;a().then(function(n){t.pulls=n;t.pagination.init(t.pulls,t.itemsPerPage,true);t.renderList()}).catch(function(n){}).finally(function(){t.isBlockLoading=false})}function p(){t.isBlockLoading=true;l(t.currentAccount.accountKey).then(function(n){t.credit=t.credit+1e3;t.renderBuyStep2()}).catch(function(n){t.alerts.danger("Der Kauf von Pulls fÃŒr Firmenkonten ist nicht mÃ¶glich.")}).finally(function(){t.isBlockLoading=false})}n.$on("accounts:changeCurrent",function(n,e){t.currentAccount=e;requestPositions()});t.init()}]); "use strict";var m=angular.module("trading-realtime-pulls");m.service("tradingRealtimePullsGetPullsCredit",["brsApiClient","$q",function(e,r){var n;return function(){var t=r.defer();if(n){return n}else{n=t.promise}e.get("Customer_Pulls","getPullsCredit",{}).then(function(e){delete e["_meta"];t.resolve(e.pullsCredit)}).catch(function(e){t.reject(e)}).finally(function(){n=false});return t.promise}}]);m.service("tradingRealtimePullsGetPulls",["brsApiClient","$q",function(e,r){var n;return function(){var t=r.defer();if(n){return n}else{n=t.promise}e.get("Customer_Pulls","getPulls",{}).then(function(e){delete e["_meta"];t.resolve(e.pullsOperations)}).catch(function(e){t.reject(e)}).finally(function(){n=false});return t.promise}}]);m.service("tradingRealtimePullsCreateCase",["brsApiClient","$q",function(r,n){var l;return function(e){var t=n.defer();if(!e){return t.promise}if(l){return l}else{l=t.promise}r.get("Customer_Pulls","createCase",{accountKey:e}).then(function(e){delete e["_meta"];t.resolve(e)}).catch(function(e){t.reject(e)}).finally(function(){l=false});return t.promise}}]); "use strict";var m=angular.module("trading-realtime-pulls",["brs-api-client","auth-user"]); "use strict";var m=angular.module("trading-realtime",[]);m.controller("ModalTradingRealtimeConditionsController",["$scope","$modalInstance",function(n,a){n.cancel=function(){a.dismiss("cancel")}}]); "use strict";var m=angular.module("trading-realtime",["brs-ui-modal"]);m.value("tradingPealtimePullCredit",{realtimePullCredit:0}); "use strict";var m=angular.module("trading-savingsplan");m.service("tradingSavingsPlanCreateModal",["brsApiClient","brsUiModal","brsAppVersion",function(e,n,t){this.openModal=function(e){return n.open(n.getConfig("draggable","lg",{templateUrl:t.getUrl("/app/trading-savingsplan/templates/modal-savingsplan-create.html"),controller:["$modalInstance","$scope","product",function(e,n,t){n.$modalInstance=e;n.product=t}],resolve:{product:function(){return e}}})).result}}]);m.controller("ModalSavingsPlanCreateController",["$scope","brsRouteParams","bankAccountsGetAccountsList","tradingSavingsPlanCreateSavingsPlan","BrsUiAlert","$filter","SNAPSHOT_LINK",function(o,e,n,t,a,r,i){var s=e();o.loading=true;o.snapshotLink=i;o.alerts=new a;o.showContent=false;o.lockForm=false;o.savingsPlanDetails={executionDay:1,frequency:"mnt",endDate:"9999-12-31 00:00:00"};o.maxAmount=o.product.maxAmount;o.accountKey="";o.productInfo={wkn:s.wkn||o.product.wkn||undefined,currency:s.currency||o.product.currency||undefined,symbol:s.symbol||o.product.symbol||undefined};o.datePickerConfig={};switch(o.product.type){case"etf":case"etc":o.product.omsExchangeId="00044";break;case"certificate":o.product.omsExchangeId="10020";break}o.costTransparencyAdditionalParameters={type:"ATP",quantity:1,side:"B",customData:true,exchangeId:o.product.omsExchangeId};angular.extend(o.savingsPlanDetails,o.productInfo);if(!o.productInfo.symbol&&(!o.productInfo.wkn||!o.productInfo.currency)){o.alerts.danger("Fehlender Parameter, um das zugehÃ¶rige Produkt zu finden.");o.loading=false;o.showContent=false}else{n(false).then(function(e){o.savingsPlanDetails.accountKey=e.currentAccount.accountKey;o.loading=false;o.showContent=true}).catch(function(e){o.loading=false;o.alerts.danger(e.message)});o.createSavingsPlan=function(){if(o.createSavingsPlanForm.$valid){o.lockForm=true;o.loading=true;t(o.savingsPlanDetails).then(function(e){o.$modalInstance.close("ok");o.loading=false;o.savingsPlanId=e.savingsPlanId;o.savingsPlanDetails={};o.showContent=false}).catch(function(e){o.loading=false;o.alerts.danger(e.message);o.lockForm=false;if([10001,50414,50409,10100,10102,50410].indexOf(e.code)==-1){o.showContent=false}})}}}o.firstExecutionDates=[];o.initFirstExecutionDates=function(){var e=new Date,n=e.getFullYear(),t=e.getMonth(),a=o.savingsPlanDetails.executionDay,i=6;while(o.firstExecutionDates.length>0){o.firstExecutionDates.pop()}if(e.getDate()>=o.savingsPlanDetails.executionDay){t=parseInt(e.getMonth())+1}else{t=parseInt(e.getMonth())}for(var s=0;s<6;s++){o.firstExecutionDates.push({model:r("date")(new Date(n,t+s,a),"yyyy-MM-dd 00:00:00"),view:r("date")(new Date(n,t+s,a),"dd.MM.yyyy")})}o.savingsPlanDetails.firstExecution=o.firstExecutionDates[0].model};o.initFirstExecutionDates();o.initEndDateDatePicker=function(){var e=new Date,n=o.savingsPlanDetails.frequency=="mnt"?1:3;o.datePickerConfig.minDate=new Date(e.getFullYear(),parseInt(e.getMonth())+n,parseInt(o.savingsPlanDetails.executionDay)+1);o.datePickerConfig.maxDate=null;o.datePickerConfig.showOn="both";o.datePickerConfig.dateFormat="dd.mm.yy";o.datePickerConfig.beforeShowDay=function(e){var n=new Date;n.setHours(0,0,0,0);if(e.getDate()==parseInt(o.savingsPlanDetails.executionDay)+1&&n<e){return[true,""]}return[false,""]};o.datePickerConfig.beforeShow=function(e,n){o.savingsPlanDetails.endDate="9999-12-31 00:00:00";setTimeout(function(){$(n.dpDiv).css("z-index",1e4)},0)}};o.executionDayChange=function(){o.initFirstExecutionDates()};o.frequencyChange=function(){o.initEndDateDatePicker();o.savingsPlanDetails.endDate="9999-12-31 00:00:00";$("#endDate").datepicker("option","minDate",o.datePickerConfig.minDate);$("#endDate").datepicker("option","maxDate",o.datePickerConfig.maxDate)};o.cancel=function(){o.$modalInstance.dismiss({message:"cancel"})}}]); "use strict";var m=angular.module("trading-savingsplan");m.service("tradingSavingsPlanCreateSavingsPlan",["brsApiClient","$q","$rootScope",function(r,a,i){var s;return function(e){var n=a.defer();if(!e||!e.symbol&&(!e.wkn||!e.currency)){n.reject({message:"Fehlende oder ungÃŒltige Parameter."});return n.promise}if(s){return s}else{s=n.promise}i.spinner+=1;r.get("Trading_SavingsPlan","create",e).then(function(e){if(e.success){n.resolve(e)}else{n.reject({message:"Kann nicht gespeichert Sparplan."})}}).catch(function(e){n.reject(e)}).finally(function(){i.spinner-=1;s=false});return n.promise}}]); "use strict";var m=angular.module("trading-savingsplan");m.service("tradingSavingsPlanDeleteSavingsPlan",["brsApiClient","$q","$rootScope",function(s,a,i){var t;return function(e,n){var r=a.defer();if(!e||!n){r.reject({message:"Den Sparplan kann nicht gelÃ¶scht werden."});return r.promise}if(t){return t}else{t=r.promise}i.spinner+=1;s.get("Trading_SavingsPlan","delete",{accountKey:e,savingsPlanId:n}).then(function(e){if(e.success){r.resolve(e.success)}else{r.reject({message:"Den Sparplan kann nicht gelÃ¶scht werden."})}}).catch(function(e){r.reject(e)}).finally(function(){i.spinner-=1;t=false});return r.promise}}]); "use strict";var m=angular.module("trading-savingsplan");m.controller("ModalSavingsPlanDetailsController",["$scope","$modalInstance","bankAccountsGetAccountsList","tradingSavingsPlanGetSavingsPlanDetails","BrsUiAlert","savingsPlanId",function(a,n,e,t,s,l){a.loading=true;a.hideContent=true;a.savingsPlanId=l;a.savingsPlanDetails={};a.accountKey="";a.alerts=new s;e(false).then(function(n){a.accountKey=n.currentAccount.accountKey;t(n.currentAccount.accountKey,[a.savingsPlanId]).then(function(n){a.loading=false;if(n.length&&n[0].sid==a.savingsPlanId){a.savingsPlanDetails=n[0];a.hideContent=false}else{a.hideContent=true;a.alerts.danger("Der angeforderte Sparplan wurde nicht gefunden.")}}).catch(function(n){a.loading=false;a.alerts.danger(n.message)})}).catch(function(n){a.loading=false;a.alerts.danger(n.message)});a.ok=function(){n.close()}}]); "use strict";var m=angular.module("trading-savingsplan");m.service("tradingSavingsPlanGetAllSavingsPlan",["brsApiClient","$q","$rootScope","tradingSavingsPlanList",function(r,i,a,t){var s;return function(n){var e=i.defer();if(!n){e.reject({message:"Fehler beim Abrufen von SparplÃ€nen."});return e.promise}if(s){return s}else{s=e.promise}a.spinner+=1;r.get("Trading_SavingsPlan","retrieveAll",{accountKey:n}).then(function(n){while(t.length>0){t.pop()}angular.forEach(n.savingsPlanList,function(n){t.push(n)},t);e.resolve(t)}).catch(function(n){e.reject(n)}).finally(function(){a.spinner-=1;s=false});return e.promise}}]); "use strict";var m=angular.module("trading-savingsplan");m.service("tradingSavingsPlanGetProduct",["brsApiClient","$q","$rootScope",function(n,t,i){var a;return function(e){var r=t.defer();if(!e||!e.symbol&&(!e.wkn||!e.currency)){r.reject({message:"Fehlender Parameter, um das zugehÃ¶rige Produkt zu finden."});return r.promise}if(a){return a}else{a=r.promise}i.spinner+=1;n.get("Trading_SavingsPlan","getProduct",e).then(function(e){r.resolve(e)}).catch(function(e){r.reject(e)}).finally(function(){i.spinner-=1;a=false});return r.promise}}]); "use strict";var m=angular.module("trading-savingsplan");m.service("tradingSavingsPlanGetProductsList",["brsApiClient","$q","tradingSavingsPlanProductsList","tradingSavingsPlanMaxAmount",function(e,i,a,r){var s;return function(n){var t=i.defer();if(!a.length||n){if(s){return s}else{s=t.promise}while(a.length>0){a.pop()}e.get("Trading_SavingsPlan","getProductsList").then(function(n){angular.extend(a,n.productsList);r=n.savingsPlanMaxAmount;t.resolve(a)}).catch(function(n){t.reject(n)}).finally(function(){s=false})}else{t.resolve(a)}return t.promise}}]); "use strict";var m=angular.module("trading-savingsplan");m.service("tradingSavingsPlanGetSavingsPlanDetails",["brsApiClient","$q","$rootScope",function(r,a,s){var t;return function(e,n){var i=a.defer();if(!e||!n.length){i.reject({message:"Fehler beim Abrufen von SparplÃ€nen."});return i.promise}if(t){return t}else{t=i.promise}s.spinner+=1;r.get("Trading_SavingsPlan","retrieveDetails",{accountKey:e,savingsPlanIdsList:n}).then(function(e){i.resolve(e.savingsPlanListDetails)}).catch(function(e){i.reject(e)}).finally(function(){s.spinner-=1;t=false});return i.promise}}]); "use strict";var m=angular.module("trading-savingsplan");m.controller("TradingSavingsPlanListBlockController",["$scope","$rootScope","$log","$filter","bankAccountsGetAccountsList","bankAccountsCurrentAccount","tradingSavingsPlanGetAllSavingsPlan","tradingSavingsPlanDeleteSavingsPlan","BrsUiAlert","BrsUiPagination","brsUiModal","authUser","brsAppVersion","tradingSavingsPlanStatus",function(t,n,a,e,s,i,l,o,r,g,c,u,f,d){a=a.getInstance("TradingSavingsPlanListBlockController");t.savingsPlanProductListTemplateUrl=f.getUrl("/app/trading-savingsplan/templates/table-savingsplan-products-list.html");t.authUser=u;t.loading=false;t.loadingWithGetParams=false;t.savingsPlanList=[];t.savingsPlanByStatusList=[];t.alerts=new r;t.pagination=new g;t.addingNew=false;t.disableButtons=false;t.section="ACTIVE";t.onMessage=function(n){t.loadingWithGetParams=true;t.isinGet=n.isin||"";t.wknGet=n.wkn||"";if(t.isinGet!=""&&t.wknGet!=""){t.addingNew=true}else{t.loadingWithGetParams=false}};t.getAllSavingsPlan=function(){if(!t.loading){t.loading=true;s(false).then(function(n){t.accountKey=i.accountKey;while(t.savingsPlanList.length>0){t.savingsPlanList.pop()}l(n.currentAccount.accountKey).then(function(n){t.savingsPlanList=n;v();t.loading=false}).catch(function(n){t.loading=false;t.alerts.danger(n.message)})}).catch(function(n){t.loading=false;t.alerts.danger(n.message)})}};t.getAllSavingsPlan();t.order=function(n,a){t.pagination.filter(n,a)};t.refresh=function(){a.info("Refresh savings plan list.");t.addingNew=false;t.getAllSavingsPlan()};t.print=function(){a.info("Print savings plan.")};t.openSavingsPlanDetails=function(n){t.disableButtons=true;var a=c.open(c.getConfig("small","md",{templateUrl:f.getUrl("/app/trading-savingsplan/templates/modal-savingsplan-details.html"),controller:"ModalSavingsPlanDetailsController",resolve:{savingsPlanId:function(){return n}}}));a.result.finally(function(){t.disableButtons=false})};t.deleteSavingsPlan=function(a){t.disableButtons=true;o(t.accountKey,a).then(function(n){t.openDeleteModal(a)}).catch(function(n){t.alerts.danger(n.message)}).finally(function(){t.disableButtons=false})};t.openDeleteModal=function(a){var n=c.open(c.getConfig("small","md",{templateUrl:f.getUrl("/app/trading-savingsplan/templates/modal-savingsplan-delete-confirm.html"),controller:"ModalSavingsPlanDeleteConfirmController",resolve:{savingsPlan:function(){var n=e("filter")(t.savingsPlanList,{sid:a});return n[0]}}}));n.result.then(function(){angular.forEach(t.savingsPlanList,function(n){if(n.sid==a){n.nextExecution="0000-00-00 00:00:00";n.status=-1}})})};n.$on("accounts:changeCurrent",function(n,a){t.refresh()});t.changeSection=function(n){t.section=n;v()};var v=function(){t.savingsPlanByStatusList=t.savingsPlanList.filter(function(n){return d[t.section].indexOf(n.status)!==-1});t.pagination.init(t.savingsPlanByStatusList,5,true)}}]);m.controller("ModalSavingsPlanDeleteConfirmController",["$scope","$modalInstance","savingsPlan",function(n,a,t){n.savingsPlan=t;n.ok=function(){a.close()}}]); "use strict";var m=angular.module("trading-savingsplan");m.controller("TradingSavingsPlanProductsListController",["$rootScope","$scope","$log","$filter","BrsUiPagination","tradingSavingsPlanTypesList","tradingSavingsPlanGetProductsList","tradingSavingsPlanProductsList","tradingMifid","customerDisclaimer","tradingSavingsPlanCreateModal","brsUiModal","tradingSavingsPlanMaxAmount","SNAPSHOT_LINK","brsAppVersion",function(n,s,t,a,e,i,r,l,o,d,c,g,u,f,P){t=t.getInstance("TradingSavingsPlanProductsListController");s.paginationProducts=new e;s.savingsPlanTypesList=i;s.newSavingsPlanType={type:"fund"};s.loading=0;s.mifid=false;s.issuerColumnNames={fund:"Fondsgesellschaft",certificate:"Emittent",etc:"Emittent",etf:"Gesellschaft"};s.snapshotLink=f;s.maxAmount=false;s.disableButtons=false;s.order=function(e,n){s.paginationProducts.filter(e,n)};s.refreshProducts=function(){t.info("Refresh savings plan products list.");s.loading+=1;r(false).then(function(e){s.savingsPlanProductsList=l;if(angular.isDefined(s.isinGet)&&s.isinGet!=""&&angular.isDefined(s.wknGet)&&s.wknGet!=""){s.selectedGetProduct=_.where(s.savingsPlanProductsList,{isin:s.isinGet,wkn:s.wknGet});if(angular.isDefined(s.selectedGetProduct)&&s.selectedGetProduct.length==1){s.newSavingsPlanType.type=s.selectedGetProduct[0].type;s.startNewSavingsPlanProcess(s.selectedGetProduct[0])}else{s.alerts.danger("Das gewÃŒnschte Produkt ISIN "+s.isinGet+" / WKN "+s.wknGet+" kann derzeit nicht als Sparplan angelegt werden. Bitte versuchen Sie es spÃ€ter noch einmal oder wenden Sie sich telefonisch an unseren Kundenservice.");s.$parent.$parent.loadingWithGetParams=false}s.isinGet="";s.wknGet="";n.$on("trading-mifid:mifid-modal:opened",function(){s.$parent.$parent.loadingWithGetParams=false})}else{s.$parent.$parent.loadingWithGetParams=false}s.savingsPlanProductsListTemp=a("filter")(s.savingsPlanProductsList,{type:s.newSavingsPlanType.type});s.paginationProducts.init(s.savingsPlanProductsListTemp,8,true);s.maxAmount=u}).catch(function(e){s.alerts.danger(e.message)}).finally(function(){s.loading-=1})};s.startNewSavingsPlanProcess=function(e){s.disableButtons=true;e.maxAmount=s.maxAmount;t.info("Start new savings plan process with: ",e);var n=o.openModal(e.isin,true,e.type,false).then(function(){if(e.type=="fund"){d.openFundDisclaimer(e.isin,false).then(function(){c.openModal(e).then(function(){s.openAddSavingsPlanSucces()})}).catch(function(e){t.info("Disclaimer modal dismissed.")})}else{c.openModal(e).then(function(){s.openAddSavingsPlanSucces()})}}).catch(function(e){if(angular.isDefined(e.message)&&e.message!="cancel"||e!="mifid-refused"){s.alerts.danger(e.message)}}).finally(function(){s.disableButtons=false})};s.openAddSavingsPlanSucces=function(){var e=g.open(g.getConfig("small","md",{templateUrl:P.getUrl("/app/trading-savingsplan/templates/modal-savingsplan-create-success.html"),controller:"ModalSavingsPlanCreateSuccessController"}));s.$parent.$parent.addingNew=false;s.getAllSavingsPlan()};s.back=function(){s.$parent.$parent.addingNew=false};s.$on("brs-ui-grid-desktop:"+"trading-savingplans",function(e,n){s.filteredSavingsPlanProductsListFromMessage=[];s.selectedProductFromMessage=[];if(angular.isDefined(n.isin)&&n.isin!=""&&(angular.isDefined(n.wkn)&&n.wkn!="")){s.selectedProductFromMessage=a("filter")(s.savingsPlanProductsList,{isin:n.isin,wkn:n.wkn})}if(s.selectedProductFromMessage.length){t.info("Start new savings plan process from message with: ",s.selectedProductFromMessage[0]);s.startNewSavingsPlanProcess(s.selectedProductFromMessage[0])}});s.refreshProducts()}]);m.controller("ModalSavingsPlanCreateSuccessController",["$scope","$modalInstance",function(e,n){e.ok=function(){n.close()}}]); "use strict";var m=angular.module("trading-savingsplan",["brs-api-client","auth-user","bank-accounts","brs-format","brs-ui-modal","brs-ui-spinner","brs-ui-datepicker","brs-ui-pagination"]);m.value("tradingSavingsPlanList",[]);m.value("tradingSavingsPlanProductsList",[]);m.value("tradingSavingsPlanMaxAmount",500);m.value("tradingSavingsPlanTypesList",[{key:"fund",label:"Investmentfonds"},{key:"etf",label:"ETFs"},{key:"certificate",label:"Zertifikate"},{key:"etc",label:"ETCs"}]);m.constant("tradingSavingsPlanStatus",{DELETED:[-1],ACTIVE:[0]});m.run(["$rootScope","$log","tradingSavingsPlanList",function(n,t,e){n.$on("auth:logout",function(n,t){while(e.length>0){e.pop()}})}]);m.filter("savingsPlanStatus",function(){return function(n){var t;switch(n){case-1:t="GelÃ¶scht";break;case 0:t="Aktiv";break;case 1:t="Inaktiv";break;default:t="-"}return t}});m.directive("savingsPlanDate",["$filter",function(s){return{require:"?ngModel",link:function(n,t,e,i,a){if(!i)return;var r=e.savingsPlanDate;i.$formatters.unshift(function(n){if(n=="9999-12-31 00:00:00"){return"unbefristet"}else{return s("date")(n,e.dateFormat)}})}}}]);m.filter("savingsPlanFrequency",function(){return function(n){if(n!=undefined){var t={mnt:"monatlich",vrtl:"vierteljÃ€hrlich"};n=t[n]}else{n="-"}return n}});m.filter("savingsPlanEndDate",["brsFilterDateFilter",function(e){return function(n,t){if(n!=undefined){if(n=="9999-12-31 00:00:00"){n="unbefristet"}else{n=e(n,t)}}return n}}]);m.filter("savingsPlanSuspended",["brsFilterDateFilter",function(e){return function(n){var t="nein";if(n&&n.status==1){if(n.suspendUntil=="0000-00-00 00:00:00"||n.suspendUntil=="9999-12-31 00:00:00"){t="ja, unbefristet"}else{t="ja, bis einschlieÃ?lich "+e(n.suspendUntil,format)}}return t}}]); "use strict";var m=angular.module("trading-search");m.service("tradingSearchDerivativesGetFilteredProducts",["brsApiClient","$q","tradingSearchDerivativesProducts",function(e,i,n){var a;return function(r){var t=i.defer();if(n[r].length==0){if(a){return a}else{a=t.promise}e.get("Trading_Derivative","getFilteredProducts",{type:r}).then(function(e){angular.extend(n[r],e.products);t.resolve(n[r])}).catch(function(e){t.reject(e)}).finally(function(){a=false})}else{t.resolve(n[r])}return t.promise}}]); "use strict";var m=angular.module("trading-search");m.service("tradingSearchDerivativesGetOptionStrike",["brsApiClient","$q","$filter","tradingSearchDerivativesStrikes",function(e,n,a,s){var f;return function(t,r){var i=n.defer();if(s[t]==undefined||a("brsFilterObjectLength")(s[t])!=0||s[t].targetDate==undefined||s[t].targetDate.length==0){if(f){return f}else{f=i.promise}e.get("Trading_Derivative","getOptionStrike",{optionName:t,targetDate:r}).then(function(e){if(s[t]==undefined){s[t]={}}if(s[t].targetDate==undefined){s[t][r]=[]}angular.extend(s[t][r],e.strikes);i.resolve(s[t][r])}).catch(function(e){i.reject(e)}).finally(function(){f=false})}else{i.resolve(s[t][r])}return i.promise}}]); "use strict";var m=angular.module("trading-search");m.service("tradingSearchDerivativesGetQuotes",["brsApiClient","$q",function(n,a){return function(e,t,r,i){var s=a.defer();if((e=="options"||e=="futures")&&t!=""&&r!=""){if(e=="options"&&i==""){s.reject({message:"AusÃŒbungspreis ist Pflichtfelder."})}n.get("Trading_Derivative","getQuotes",{type:e,productName:t,targetDate:r,strike:i}).then(function(e){s.resolve(e.quotes)}).catch(function(e){s.reject(e)})}else{s.reject({message:"Alle Parameter sind Pflichtfelder."})}return s.promise}}]); "use strict";var m=angular.module("trading-search");m.service("tradingSearchDerivativesGetTargetDates",["brsApiClient","$q","$filter","tradingSearchDerivativesTargetDates",function(e,a,i,u){var d;return function(t,r){var n=a.defer();if(u[t]==undefined||i("brsFilterObjectLength")(u[t])!=0||u[t].productName==undefined||u[t].productName.length==0){if(d){return d}else{d=n.promise}e.get("Trading_Derivative","getTargetDate",{type:t,productName:r}).then(function(e){if(u[t]==undefined){u[t]={}}if(u[t].productName==undefined){u[t][r]=[]}angular.extend(u[t][r],e.targetDate);n.resolve(u[t][r])}).catch(function(e){n.reject(e)}).finally(function(){d=false})}else{n.resolve(u[t][r])}return n.promise}}]); "use strict";var m=angular.module("trading-search");m.controller("TradingSearchDerivativesBlockController",["$scope","$log","BrsUiAlert","BrsUiPagination","tradingSearchDerivativesGetFilteredProducts","tradingSearchDerivativesGetTargetDates","tradingSearchDerivativesGetOptionStrike","tradingSearchDerivativesGetQuotes","$filter","$moment",function(a,e,t,s,r,i,n,c,l,o){e=e.getInstance("TradingSearchDerivativesBlockController");a.loading=false;a.loadingProductsList=false;a.loadingTargetDatesList=false;a.loadingStrikesList=false;a.alerts=new t;a.pagination=new s;a.searchParams={type:"",product:"",targetDate:"",strike:""};a.searchResults=[];a.productsList=[];a.targetDatesList=[];a.strikesList=[];a.clearAll=function(e){a.searchParams.product="";a.searchParams.targetDate="";while(a.searchResults.length>0){a.searchResults.pop()}while(a.productsList.length>0){a.productsList.pop()}while(a.targetDatesList.length>0){a.targetDatesList.pop()}if(a.searchParams.type=="options"){a.searchParams.strike="";while(a.strikesList.length>0){a.strikesList.pop()}}return e()};a.clearStep2=function(e){a.searchParams.targetDate="";while(a.searchResults.length>0){a.searchResults.pop()}while(a.targetDatesList.length>0){a.targetDatesList.pop()}if(a.searchParams.type=="options"){a.searchParams.strike="";while(a.strikesList.length>0){a.strikesList.pop()}}return e()};a.clearStep3=function(e){while(a.searchResults.length>0){a.searchResults.pop()}if(a.searchParams.type=="options"){a.searchParams.strike="";while(a.strikesList.length>0){a.strikesList.pop()}}return e()};a.getProducts=function(){a.clearAlerts();a.loadingProductsList+=1;a.clearAll(function(){r(a.searchParams.type).then(function(e){angular.extend(a.productsList,e);a.loadingProductsList-=1}).catch(function(e){a.loadingProductsList-=1;a.alerts.danger(e.message,e.message)})})};a.getTargetDates=function(){a.clearAlerts();a.loadingTargetDatesList+=1;a.clearStep2(function(){i(a.searchParams.type,a.searchParams.product).then(function(e){e=l("filter")(e,function(e){if(o(e).add(1,"month").isAfter()){return true}else{return false}});angular.extend(a.targetDatesList,e);a.loadingTargetDatesList-=1}).catch(function(e){a.loadingTargetDatesList-=1;a.alerts.danger(e.message,e.message)})})};a.step3=function(){a.clearAlerts();a.clearStep3(function(){if(a.searchParams.type=="options"){a.loadingStrikesList+=1;n(a.searchParams.product,a.searchParams.targetDate).then(function(e){angular.extend(a.strikesList,e);a.loadingStrikesList-=1}).catch(function(e){a.loadingStrikesList-=1;a.alerts.danger(e.message,e.message)})}else{a.getQuotes()}})};a.getQuotes=function(){a.clearAlerts();a.loading+=1;c(a.searchParams.type,a.searchParams.product,a.searchParams.targetDate,a.searchParams.strike).then(function(e){angular.extend(a.searchResults,e);a.pagination.init(a.searchResults,6,false);a.order("type",false);a.loading-=1}).catch(function(e){a.loading-=1;a.alerts.danger(e.message,e.message)})};a.refresh=function(){a.clearAll(function(){e.info("Refresh search derivatives.");a.searchParams.type=""})};a.clearAlerts=function(){if(a.alerts.length){angular.forEach(a.alerts,function(e){a.alerts.pop()})}};a.order=function(e,t){a.pagination.filter(e,t)}}]); "use strict";var m=angular.module("trading-search");m.controller("TradingSearchSecuritiesBlockController",["$scope","$log","BrsUiAlert","BrsUiPagination","brsStreamingClient","feedInstrumentSearch","tradingSearchCategories","SNAPSHOT_LINK","$moment","brsUiGridDesktop",function(a,e,s,r,n,t,i,c,l,u){e=e.getInstance("TradingSearchSecuritiesBlockController");a.loading=false;a.alerts=new s;a.pagination=new r;a.searchCategories=i;a.searchResults=[];a.snapshotLink=c;a.searchParams={search:"",category:""};a.queue=[];a.goToTradingBlock=u.goToTradingBlock;a.searchSecurities=function(){if(a.searchParams&&a.searchParams!=undefined&&a.searchParams.search!=undefined&&a.searchParams.search!=""&&a.searchParams.search.length>=3){a.alerts.clean();a.loading+=1;var e=l().valueOf();a.queue.push(e);t({code:a.searchParams.search,category:a.searchParams.category},e).then(function(e){if(a.queue[a.queue.length-1]==e.ref){while(a.searchResults.length>0){a.searchResults.pop()}while(a.queue.length>0){a.queue.pop()}angular.extend(a.searchResults,e.instruments);e.instruments.forEach(function(e){n.register(e)});a.pagination.init(a.searchResults,6,false);a.loading=false}else if(a.queue.length&&(a.queue.indexOf(e.ref)>0&&a.queue.indexOf(e.ref)<a.queue.length-1)){o(e.ref)}else if(a.queue.length&&(a.queue.length>0&&a.queue.indexOf(e.ref)==0)){o(e.ref)}}).catch(function(e){while(a.searchResults.length>0){a.searchResults.pop()}a.loading=false;if(e.code==30200){a.alerts.info(e.message,e.message)}else{a.alerts.danger(e.message,e.message)}})}};var o=function(e){a.queue.splice(a.queue.indexOf(e),1)};a.order=function(e,s){a.pagination.filter(e,s)};a.refresh=function(){e.info("Refresh search securities.");a.alerts.clean();a.loading=false;while(a.searchResults.length>0){a.searchResults.pop()}a.pagination.init(a.searchResults,6,false);a.searchParams={search:"",category:""}}}]);m.directive("securityType",["tradingSearchCategories",function(r){return{restrict:"E",template:"<span class='{{res.class}}'>{{res.label}}</span>",scope:{security:"=security"},link:function(s,e,a){if(s.security!=undefined){angular.forEach(r,function(e){if(e.key==s.security.categoryCode){s.$parent.result.typeSort=e.label;s.res={class:e.class,label:e.label}}})}}}}]); "use strict";var m=angular.module("trading-search",["auth-user","brs-ui-spinner","brs-ui-pagination","feed-instrument"]);m.value("tradingSearchCategories",[{key:"STK",label:"Aktie",class:"type-aktie"},{key:"BND",label:"Anleihe",class:"type-anleihe"},{key:"FND",label:"Fonds",class:"type-fonds"},{key:"ETF",label:"ETF",class:"type-etf"},{key:"WNT",label:"Optionsscheine",class:"type-option"},{key:"DER",label:"Zertifikat",class:"type-zertifikat"}]);m.value("tradingSearchDerivativesProducts",{futures:[],options:[]});m.value("tradingSearchDerivativesTargetDates",{});m.value("tradingSearchDerivativesStrikes",{}); "use strict";var m=angular.module("trading-strategy");m.directive("tradingStrategy",["$q","tradingMifid","tradingStrategy","tradingOrderPerform","bankAccountsCurrentAccount","BrsUiAlert","brsAppVersion",function(o,i,c,s,l,d,e){return{restrict:"AE",templateUrl:e.getUrl("/app/trading-strategy/templates/strategies.html"),scope:{closeCallback:"&onClose",onPerform:"&",symbol:"=",side:"=",quantity:"=",type:"&",mifid:"=",code:"=?",exchangeId:"=?",currency:"=?"},controller:["$scope",function(e){this.getStrategyManager=function(){return e.strategies};this.onPerform=e.onPerform}],link:function(n,e,t){n.loading=true;n.strategies=undefined;n.legSize=t.tradingStrategy||"sm";n.alerts=new d;n.disclaimer={mifid:n.mifid==false};var r=(n.code||"")+"."+(n.exchangeId||"")+"."+(n.currency||"");s({state:"pre",symbol:n.symbol,accountKey:l.accountKey,side:n.side,atosSymbol:r}).then(function(e){a(e.order.instrument.code2).then(function(){n.quote=e.order.instrument;n.strategies=new c(e.order,n.side,n.quantity);if(n.type()==="strategy"){n.strategies.enableStrategy(true)}var r=[];angular.forEach(e.order.types,function(e,t){r.push({name:e,key:t})});n.strategies.setAllowedTypes(r)}).catch(function(){n.closeCallback()}).finally(function(){n.loading=false})}).catch(function(e){n.loading=false;n.alerts.danger(e.message)});n.onCancel=function(){if(n.strategies.back()===false){n.closeCallback()}};n.confirm=function(){n.strategies.confirmInModal().finally(function(){n.closeCallback();n.onPerform()})};n.$watch("side",function(){if(n.strategies!==undefined){n.strategies.updateSide(n.side)}});function a(e){if(n.side==="B"&&!n.disclaimer.mifid){n.disclaimer.mifid=true;return i.openModal(e,false,null,false).catch(function(){return o.reject("")})}var t=o.defer();t.resolve();return t.promise}}}}]);m.directive("tradingStrategyLeg",["authUser","BrsUiAlert","bankAccountsCurrentAccount","tradingOrder","$log","brsAppVersion","$moment","tradingOptionsGetAffectOrderStatus","tradingOptionsGetForcedComments","$q",function(s,l,d,u,t,n,r,f,g,m){t=t.getInstance("tradingStrategyLeg");return{restrict:"AE",templateUrl:function(e,t){var r=t.tradingStrategyLeg||"sm";return n.getUrl("/app/trading-strategy/templates/leg-"+r+".html")},require:"^tradingStrategy",scope:{onCancel:"&",onCreate:"&",order:"=strategyOrder"},controller:["$scope",function(e){e.datePickerConfig={showOn:"button",dateFormat:"dd.mm.yy",minDate:r(e.order.preOrder.minValidityDate).toDate(),maxDate:r(e.order.preOrder.maxValidityDate).toDate(),defaultDate:0,beforeShowDay:$.datepicker.noWeekends};t.debug(e.order.preOrder)}],link:function(n,e,t,a){var r=a.getStrategyManager();n.alerts=new l;n.loading=false;n.affectOrderStatus=[];n.forcedComments=[];n.currentAccount=d;var o=[];n.cancel=function(){n.onCancel()};n.create=function(){n.loading=true;n.alerts.removeDangerAlerts();r.setCurrentLeg().then(function(){r.next()}).catch(function(e){n.alerts.danger(e.message,"tradingDerivativeOrderStrategyLeg")}).finally(function(){n.loading=false})};n.updateWithRealtime=function(){n.loading=true;n.order.doPulls().finally(function(){n.loading=false})};n.$watch("order.strategy.type",function(e,t){if(e!==t){n.order.updateOrderType()}});n.perform=function(e){var t=n.order;var r=(t.quote.isin||t.quote.wkn||"")+"."+(t.quote["code_oms"]||"")+"."+(t.quote.currency||"");u.performInModal(n.order.quote,{state:e,side:t.side,quantity:t.quantity,symbol:t.quote.symbol,accountKey:d.accountKey,unit:"QTY",validityDate:t.validityDate,type:t.type,stop:t.stop||"",limit:t.limit||"",trail:"",issuerId:"",riskMode:"CPTD",forced:t.force,comment:t.comment=="FREE_COMMENT"?t.freeComment:t.comment,orderStatus:t.affect?t.affectValue:"",atosSymbol:r,isin:t.quote.isin,wkn:t.quote.wkn,userId:s.d.login}).then(function(){a.onPerform()},function(e){})};if(n.order.canAffect()){var i=f().then(function(e){n.affectOrderStatus=e});o.push(i)}if(n.order.canForce()){var c=g().then(function(e){angular.forEach(e,function(e){n.forcedComments.push({code:e.label,label:e.label})});n.forcedComments.push({code:"FREE_COMMENT",label:"Free comment"})});o.push(c)}m.all(o).finally(function(){n.loading=false})}}}]); "use strict";var m=angular.module("trading-strategy",[]);m.service("tradingStrategyOrder",["tradingStrategyType","customerPulls","customerPullsGetPullsQuoteByMne","tradingOrder","brsDate","bankAccountsCurrentAccount","tradingStrategySetStrategyLeg","authUser",function(e,t,r,a,i,s,n,u){function c(t,e,r,a){this.strategy={enable:t!==1,type:"next",number:parseInt(t),isEditable:true,id:-666,force:false,allowedTypes:{}};this.validityDate=i.formatToString(new Date);this.type="";this.limit="";this.stop="";this.quote=e?e.instrument:{};this.side=r;this.sideUpdatable=true;this.quantity=a;this.allowedTypes=[];this.preOrder=e;this.affect="";this.affectValue="";this.force="";this.comment="";this.freeComment=""}c.prototype={reset:function(){this.strategy.enable=this.strategy.umber!==1;this.strategy.isEditable=true;this.limit="";this.stop="";this.affect="";this.affectValue="";this.force="";this.comment="";this.freeComment=""},initFrom:function(t){this.reset();this.validityDate=t.validityDate;this.strategy.type=t.strategy.type;this.strategy.id=t.strategy.id;this.quantity=t.quantity;this.quote=t.quote;this.allowedTypes=t.allowedTypes;this.preOrder=t.preOrder},updateOrderType:function(){var t=this.strategy.enable?this.strategy.allowedTypes[this.strategy.type]:this.allowedTypes;if(t.length===1){this.type=t[0].key}else{this.type=""}this.limit="";this.stop=""},isTheLastOne:function(){var t=e[this.strategy.type];return this.strategy.enable===false||t.leg.length===this.strategy.number},setLeg:function(){return n({accountKey:s.accountKey,tmpStrategyId:this.strategy.id,legNum:this.strategy.number,symbol:this.quote.symbol,quantity:this.quantity,type:this.type,limit:this.limit,stop:this.stop,side:this.side,expireDate:this.validityDate})},getTypes:function(){if(this.strategy.enable){return this.strategy.allowedTypes[this.strategy.type]}return this.allowedTypes},doPulls:function(){var e=this;return t.askConfirmation(e.quote,false).then(function(){return r(e.quote.exchangeId,e.quote.code2,e.quote.symbol).then(function(t){angular.extend(e.quote,t.quote[0])})})},canForce:function(){return u.canForce()},canAffect:function(){return u.canAffect()}};return c}]);m.service("tradingStrategy",["brsUiModal","tradingStrategyType","tradingOrderTypesLabel","tradingStrategyOrder","tradingStrategyCreateStrategy","tradingStrategyConfirmStrategy","brsAppVersion",function(e,i,s,a,t,r,n){function u(t,e,r){this.currentStrategy=0;this.complete=false;this.strategies=[new a(1,t,e,r)];this.updateStrategyTypes(this.strategies[0]);this.instrument=t.instrument;this.quantity=r;this.side=e}u.prototype={next:function(){this.currentStrategy+=1;this.strategies[this.currentStrategy-1].strategy.isEditable=false;if(this.strategies[this.currentStrategy-1].isTheLastOne()){this.complete=true}else{if(this.strategies.length<=this.currentStrategy){this.strategies.push(new a(this.currentStrategy+1))}this.strategies[this.currentStrategy].initFrom(this.strategies[0]);this.updateStrategySide(this.strategies[this.currentStrategy]);this.updateStrategyTypes(this.strategies[this.currentStrategy]);this.strategies[this.currentStrategy].updateOrderType()}},back:function(){this.complete=false;if(this.currentStrategy<=0){return false}this.currentStrategy-=1;this.strategies[this.currentStrategy].strategy.isEditable=true;return true},updateStrategySide:function(t){var e=this.strategies[0];switch(t.strategy.type){case"next":t.side=e.side==="B"?"S":"B";break;case"oco":t.side=e.side;t.sideUpdatable=false;break;case"nextoco":t.side=e.side==="B"?"S":"B";t.sideUpdatable=false;break}},updateStrategyTypes:function(a){var t=["next","oco","nextoco"];angular.forEach(t,function(e,t){var r=a.strategy.number-1;a.strategy.allowedTypes[e]=[];angular.forEach(i[e].leg[r],function(t){a.strategy.allowedTypes[e].push({key:t,name:s[t]})})})},updateSide:function(t){if(this.currentStrategy===0){this.strategies[0].side=t}},setCurrentLeg:function(){var e=this.strategies[this.currentStrategy];if(e.strategy.id===-666){return t(e.strategy.type).then(function(t){e.strategy.id=t;return e.setLeg()})}else{return e.setLeg()}},setAllowedTypes:function(t){var e=this.strategies[this.currentStrategy];e.allowedTypes=t},enableStrategy:function(t){this.strategies[this.currentStrategy].strategy.enable=true;this.strategies[this.currentStrategy].updateOrderType()},confirm:function(){return r(this.strategies[0].strategy.id)},confirmInModal:function(){var t=this;return e.open(e.getConfig("draggable","lg",{templateUrl:n.getUrl("/app/trading-strategy/templates/modal-confirm.html"),controller:["$modalInstance","strategy","$scope","authUser","tradingStrategyType",c],resolve:{strategy:function(){return t}}})).result}};function c(t,e,r,a,i){r.confirm={isLoading:true,strategy:e,error:undefined,quantity:e.quantity,side:e.side};var s=e.strategies[0];e.confirm().then(function(t){r.info={userId:a.d.login,instrument:e.instrument,mode:i[s.strategy.type].label,validityDate:s.validityDate,orderDate:new Date,orderId:t.strategy,quantity:s.quantity,side:e.side}}).catch(function(t){r.confirm.error=t.message}).finally(function(){r.confirm.isLoading=false});r.cancel=function(){t.dismiss("cancel")}}return u}]);m.service("tradingStrategyCreateStrategy",["brsApiClient","tradingStrategyType","bankAccountsCurrentAccount",function(e,r,a){return function(t){return e.get("Trading_Strategy","createStrategy",{strategyType:r[t].category,strategySubType:r[t].subcategory,accountKey:a.accountKey}).then(function(t){return t.tmpStrategyId})}}]);m.service("tradingStrategySetStrategyLeg",["brsApiClient","bankAccountsCurrentAccount",function(r,a){return function(t){var e={accountKey:a.accountKey,risk:"CPTD"};angular.extend(e,t);return r.get("Trading_Strategy","setStrategyLeg",e)}}]);m.service("tradingStrategyConfirmStrategy",["brsApiClient","bankAccountsCurrentAccount","$log","$rootScope",function(e,a,i,s){return function(t){var r={accountKey:a.accountKey,tmpStrategyId:t};return e.get("Trading_Strategy","confirmStrategy",r).then(function(t){var e=i.getInstance("tradingStrategyConfirmStrategy Service");s.$broadcast("trading-order-strategy:on-confirm",{accountKey:r.accountKey});e.info("broadcast on strategy confirm");return t})}}]);m.service("tradingStrategyCancelStrategy",["brsApiClient","bankAccountsCurrentAccount","$rootScope","$log",function(e,a,i,s){return function(t){var r={accountKey:a.accountKey,strategyId:t};return e.get("Trading_Strategy","cancelStrategy",r).then(function(t){var e=s.getInstance("tradingStrategyCancelStrategy Service");i.$broadcast("trading-order-strategy:on-cancel",{accountKey:r.accountKey});e.info("broadcast on strategy cancel");return t})}}]); "use strict";var m=angular.module("trading-strategy");m.constant("tradingStrategyType",{oco:{category:"ALTD",subcategory:"2LEG",leg:[["LIM"],["STP"]],label:"OCO"},next:{category:"SEQD",subcategory:"2LEG",leg:[["LIM","STP"],["LIM","STP"]],label:"Next"},nextoco:{category:"MIXD",subcategory:"ETOU",leg:[["LIM","STP"],["LIM"],["STP"]],label:"Next-OCO"}}); "use strict";var m=angular.module("trading-transaction",["brs-ui-search"]);m.controller("TradingTransactionController",["$scope","$filter","tradingOrderStatus","bankAccountsGetTradingMovements","brsUiSearchDateIsin","tradingOrderGetOrdersDetails","bankAccountsCurrentAccount","BrsUiPagination","brsApiClient","authUser","BrsUiAlert",function(t,r,e,n,i,a,s,o,c,u,d){t.orderedOrder=[];t.orders=[];t.search=new i;t.search.isShowHinweis1=false;t.search.isShowHinweis2=true;t.pagination=new o;t.authUser=u;t.orderBy={name:"+creationDate",reverse:false};t.onMessage=function(e){t.search.text=e.isin||e.wkn};t.$on("accounts:changeCurrent",function(e,n){t.refresh()});t.doSearch=function(){var r=t.search.getParams();angular.extend(r,{accountKey:s.accountKey,entireList:true,status:1,executionDetails:false});t.search.disabled=true;t.orderedOrder=[];t.orders=[];n(r).then(function(e){t.orders=e.movements;t.orders=t.orders.filter(function(e){var n=e.instrument||{};return e.creationDate>=r.from&&e.creationDate<=r.to&&(r.text===""||r.text===n.isin||r.text===n.wkn)});t.pagination.init(t.orders,5,true)}).catch(function(e){t.error=e.message}).finally(function(){t.search.disabled=false})};t.onSortChange=function(e,n){t.orderBy.name=e;t.orderBy.reverse=n;f()};function f(){t.pagination.filter(t.orderBy.name,t.orderBy.reverse)}t.onCsv=function(){var e=l();e.data.unshift(["Buchungstag","Valuta","Transaktion","Nominal StÃŒck","Name","WKN/ISIN","Ausmachender Betrag","Ausmachender Betrag Currency","AusfÃŒhrungskurs","AusfÃŒhrungskurs Currency"]);return e};t.onPdf=function(){return l()};function l(){var n=[];angular.forEach(t.pagination.filtered,function(e){n.push([r("brsFilterDate")(e.creationDate,"dd.MM.yyyy"),r("brsFilterDate")(e.validityDate,"dd.MM.yyyy"),e.side,r("brsFormatQuantity")(e.quantity),e.instrument?e.instrument.label:"",e.instrument?e.instrument.wkn+" / "+e.instrument.isin:e.wknisin,r("brsFormatNumber")(e.netAmount,4),e.currency,r("brsFormatNumber")(e.executionPrice,4),e.currency])});return{data:n,subTitle:""}}t.alerts=new d;t.isBlockLoading=true;t.isDeactivated=false;t.isRefreshed=false;t.init=function(){t.isBlockLoading=true;c.get("Common_Utils","getAdminConfigValue",{configKey:"DEACTIVATE_MODULE_TRANSAKTIONSLISTE_WERTPAPIERE",configNamespace:"BANK"}).then(function(e){t.isDeactivated=false;if(e.configValue){t.isDeactivated=true;t.isRefreshed=false}return c.get("Common_Utils","getAdminConfigValue",{configKey:"DEACTIVATE_MODULES_AUTOLOAD",configNamespace:"BANK"})}).then(function(e){t.isBlockLoading=false;t.isRefreshed=!t.isDeactivated&&(t.isRefreshed||!e.configValue);if(t.isRefreshed&&t.authUser.isLogged()){t.doSearch()}}).catch(function(e){t.alerts.danger(e.message)}).finally(function(){t.isBlockLoading=false})};t.refresh=function(){t.isRefreshed=true;t.init()};t.init()}]); "use strict";var m=angular.module("trading-watchlist");m.controller("TradingWatchListBlockController",["$log","$rootScope","$scope","$filter","brsApiClient","authUser","tradingWatchlistSearchInstrument","tradingWatchlistGetLists","tradingWatchlistAddValueToWatchlist","BrsUiPagination","SNAPSHOT_LINK","BrsUiAlert","bankAccountsCurrentAccount",function(t,e,s,n,i,a,r,o,c,l,u,m,f){t=t.getInstance("TradingWatchListBlockController");var d=n("orderBy"),g=1;s.watchlistNumber=g;s.pagination=new l;s.itemsPerPage=10;s.authUser=a;s.currentAccount=f;s.alerts=new m;s.snapshotLink=u;s.predicate="label";s.reverse=false;s.title="Watchliste";s.watched=[];s.hasMessage=false;s.isBlockLoading=false;s.canUseBlock=false;s.isDeactivated=false;s.isRefreshed=false;s.onMessage=function(e){s.code=e.isin||e.wkn};s.onCsv=function(){var e=h();e.data.unshift(["Name","ISIN","WKN","Typ","Datum","Zeit","Akt. Kurs","Akt. Kurs Currency","Boerse","Geldkurs","StÃŒcke","Briefkurs","StÃŒcke","Tagesperformance","Tagesperformance Currency","%"]);return e};s.onPdf=function(){return h()};s.canUseBlock=true;function h(){var t=[];angular.forEach(s.pagination.filtered,function(e){t.push([e.label,e.isin,e.wkn||"n.v.",e.categoryLabel,n("brsFilterDate")(e.tradeDate,"dd.MM.yyyy"),n("brsFilterDate")(e.tradeDate,"HH:mm:ss"),n("brsFormatNumber")(e.last,4),e.currency,e.exchangeLabel,e.co?n("number")(e.co[0].bid,3):"n.v.",e.co?e.co[0].bid_size:"n.v.",e.co?n("number")(e.co[0].ask,3):"n.v.",e.co?e.co[0].ask_size:"n.v.",n("brsFormatNumber")(e.variation*e.previousClose,4),e.currency,n("number")(e.variation*100,2,"%")])});return{data:t,subTitle:""}}s.init=function(){s.isBlockLoading=true;i.get("Common_Utils","getAdminConfigValue",{configKey:"DEACTIVATE_MODULE_WATCHLIST",configNamespace:"BANK"}).then(function(e){s.isDeactivated=false;if(e.configValue){s.isDeactivated=true;s.isRefreshed=false}return i.get("Common_Utils","getAdminConfigValue",{configKey:"DEACTIVATE_MODULES_AUTOLOAD",configNamespace:"BANK"})}).then(function(e){s.isRefreshed=!s.isDeactivated&&(s.isRefreshed||!e.configValue);if(s.isRefreshed&&s.authUser.isLogged()){b(g,true)}}).catch(function(e){s.alerts.danger(e.message)}).finally(function(){s.isBlockLoading=false})};s.addValueToWatchlist=function(){v(s.code)};s.refresh=function(){s.isRefreshed=true;s.init()};s.order=function(e,t){s.pagination.filter(e,t)};function b(n,e){t.debug("requestWatchlist");s.isBlockLoading=true;s.alerts.clean();o(e).then(function(e){s.watched=[];if(e.length>0){for(var t=0;t<e.length;t++){if(e[t].number==n){s.watched=e[t].instruments;s.pagination.init(s.watched,s.itemsPerPage,true);s.order(s.predicate,s.reverse)}}}}).catch(function(e){s.alerts.danger(e.message)}).finally(function(){s.isBlockLoading=false})}function v(e){s.alerts.clean();r(e).then(function(e){L({symbol:e.atosSymbol||e.symbol})}).catch(function(e){s.alerts.danger(e.message)})}function L(e){s.alerts.clean();c(e).then(function(e){b(g,true);s.alerts.success("Das gewÃŒnschte Produkt wurde in der Watchlist gespeichert.");s.code=""}).catch(function(e){s.alerts.danger(e.message)})}s.init()}]);m.controller("TradingWatchListBlockElementController",["$scope","$log","tradingWatchlistRemoveValueFromWatchlist","tradingWatchlistGetInstrumentExchanges","tradingWatchlistReplaceValueInWatchlist","customerPulls","customerPullsGetPullsQuote","customerPullsGetOrderBook","tradingOrderPerformObject","brsUiGridDesktop",function(n,s,t,e,i,a,r,o,c,l){s=s.getInstance("TradingWatchListBlockElementController");n.isElementLoading=false;n.hasOTC=false;n.goToTradingBlock=l.goToTradingBlock;n.removeValueFromWatchlist=function(e){u({symbol:e.atosSymbol||e.symbol})};function u(e){n.alerts.clean();t(e).then(function(e){n.watched.splice(n.watched.indexOf(n.instrument),1);n.pagination.init(n.watched,n.itemsPerPage,true);n.order(n.predicate,n.reverse);n.alerts.success("Die gewÃ€hlte Position wurde erfolgreich aus der Watchlist gelÃ¶scht.")}).catch(function(e){n.alerts.danger(e.message)})}n.instrument.variation_value=n.instrument.variation*n.instrument.previousClose;n.hasLevel2=false;n.showLevel2=false;n.isXetra=function(){n.hasLevel2=n.instrument.exchangeId==4920};n.isXetra();n.displayLevel2=function(){s.debug("displayLevel2");if(!n.showLevel2&&n.instrument.co&&n.instrument.co.length<=1){n.loadOrderBook()}if(n.instrument.co.length>1){n.showLevel2=!n.showLevel2}};n.loadOrderBook=function(){s.debug("showOrderBook");a.askConfirmation(n.instrument,true).then(function(){n.isLoadingOrderBook=true;o(n.instrument.exchangeId,n.instrument.isin).then(function(e){n.instrument.co=e.co;n.showLevel2=true}).finally(function(){n.isLoadingOrderBook=false})})};n.getRealtimeQuote=function(){a.askConfirmation(n.instrument,false).then(function(){n.isElementLoading=true;r(n.instrument.exchangeId,n.instrument.isin,n.instrument.symbol).then(function(e){angular.extend(n.instrument,e.quote[0]);n.instrument.variation_value=n.instrument.variation*n.instrument.previousClose}).finally(function(e){n.isElementLoading=false})})};n.memoConfig={editing:false,hasMemo:false,memo:"",newMemo:"",colspan:7,feature:"watchlist",featureId:n.watchlistNumber,wkn:n.instrument.wkn,isin:n.instrument.isin};if(n.instrument.memo!=null){n.memoConfig.hasMemo=n.instrument.memo.length>0;n.memoConfig.memo=n.instrument.memo;n.memoConfig.newMemo=n.memoConfig.memo}n.displayPerform=function(e){if(n.performObject===undefined){n.performObject=new c;n.performObject.show=false}if(n.performObject.show===true){n.performObject.side=e}else{n.performObject.resetFrom({side:e,symbol:n.instrument.symbol,show:true,enable:{exchangeList:true,issuerList:true},instrument:n.instrument})}};n.period="3M";n.exchangesList=[];n.newExchange={symbol:n.instrument.symbol};n.canDisplayExchangesList=false;n.getExchangesForInstrument=function(){m(n.instrument.isin)};n.changeExchange=function(){f(n.instrument.symbol,n.newExchange.symbol)};function m(t){e(t).then(function(e){n.exchangesList=e.marketExchanges;if(e.issuersExchanges&&e.issuersExchanges.length>0){n.hasOTC=true}else{n.hasOTC=false}s.debug("requestExchanges symbol",t);s.debug("requestExchanges hasOTC",n.hasOTC)}).catch(function(e){n.alerts.danger(e.message)})}function f(e,t){n.isElementLoading=true;n.alerts.clean();i({oldSymbol:e,newSymbol:t}).then(function(e){n.watched[n.watched.indexOf(n.instrument)]=e[0];angular.extend(n.instrument,e[0]);n.order(n.predicate,n.reverse);n.isElementLoading=false;n.isXetra()}).catch(function(e){n.alerts.danger(e.message)})}m(n.instrument.symbol)}]); "use strict";var m=angular.module("trading-watchlist");m.directive("brsWatchlistElement",["brsAppVersion",function(t){return{restrict:"A",replace:true,templateUrl:t.getUrl("/app/trading-watchlist/templates/element.html")}}]);m.directive("brsWatchlistElementSymbol",["brsAppVersion",function(t){return{restrict:"A",replace:true,templateUrl:t.getUrl("/app/trading-watchlist/templates/symbol.html")}}]); "use strict";var m=angular.module("trading-watchlist");m.service("tradingWatchlistGetLists",["brsApiClient","$q","$rootScope","tradingWatchlist",function(n,r,i,s){var o;return function(e){var t=r.defer();if(s.length==0||e){s=[];if(o){return o}else{o=t.promise}i.spinner+=1;n.get("Member_List","getLists",{withInstruments:1,withMemos:1}).then(function(e){angular.extend(s,e.watchlists);t.resolve(s)}).catch(function(e){t.reject(e)}).finally(function(){i.spinner-=1;o=false})}else{t.resolve(s)}return t.promise}}]);m.service("tradingWatchlistGetList",["brsApiClient","$q","$rootScope","tradingWatchlist",function(n,r,i,s){var o;return function(e){var t=r.defer();if(s.length==0||e){s=[];if(o){return o}else{o=t.promise}i.spinner+=1;n.get("Member_List","getLists",{withInstruments:1,withMemos:1}).then(function(e){angular.extend(s,e.watchlists);t.resolve(s)}).catch(function(e){t.reject(e)}).finally(function(){i.spinner-=1;o=false})}else{t.resolve(s)}return t.promise}}]);m.service("tradingWatchlistSearchInstrument",["brsApiClient","$q","$rootScope",function(n,r,i){var s;return function(e){var t=r.defer();if(s){return s}else{s=t.promise}i.spinner+=1;n.get("Feed_Instrument","search",{code:e}).then(function(e){t.resolve(e.instruments[0])}).catch(function(e){t.reject(e)}).finally(function(){i.spinner-=1;s=false});return t.promise}}]);m.service("tradingWatchlistAddValueToWatchlist",["brsApiClient","$q","$rootScope",function(n,r,i){var s;return function(e){var t=r.defer();if(s){return s}else{s=t.promise}i.spinner+=1;e.number=1;n.get("Member_List","add",e).then(function(e){t.resolve(true)}).catch(function(e){t.reject(e)}).finally(function(){i.spinner-=1;s=false});return t.promise}}]);m.service("tradingWatchlistRemoveValueFromWatchlist",["brsApiClient","$q","$rootScope",function(n,r,i){var s;return function(e){var t=r.defer();if(s){return s}else{s=t.promise}i.spinner+=1;e.number=1;n.get("Member_List","remove",e).then(function(e){t.resolve(true)}).catch(function(e){t.reject(e)}).finally(function(){i.spinner-=1;s=false});return t.promise}}]);m.service("tradingWatchlistReplaceValueInWatchlist",["brsApiClient","$q","$rootScope",function(n,r,i){var s;return function(e){var t=r.defer();if(s){return s}else{s=t.promise}i.spinner+=1;e.number=1;n.get("Member_List","replace",e).then(function(e){t.resolve(e.instruments)}).catch(function(e){t.reject(e)}).finally(function(){i.spinner-=1;s=false});return t.promise}}]);m.service("tradingWatchlistUpdateMemo",["brsApiClient","$q","$rootScope",function(r,i,s){var o;return function(e,t){var n=i.defer();if(o){return o}else{o=n.promise}s.spinner+=1;r.get("Member_List","updateMemo",{number:1,symbol:e,memo:t}).then(function(e){n.resolve(true)}).catch(function(e){n.reject(e)}).finally(function(){s.spinner-=1;o=false});return n.promise}}]);m.service("tradingWatchlistDeleteMemo",["brsApiClient","$q","$rootScope",function(n,r,i){var s;return function(e){var t=r.defer();if(s){return s}else{s=t.promise}i.spinner+=1;n.get("Member_List","deleteMemo",{number:1,symbol:e}).then(function(e){t.resolve(true)}).catch(function(e){t.reject(e)}).finally(function(){i.spinner-=1;s=false});return t.promise}}]);m.service("tradingWatchlistGetInstrumentHistory",["brsApiClient","$q","$rootScope",function(c,a,u){var l;return function(e,t,n,r,i){var s=a.defer();u.spinner+=1;var o={period:t,symbol:e,indicators:n,comparer:r};if(i){o.atosSymbol=i}c.get("Feed_Instrument","getHistory",o).then(function(e){s.resolve(e.history)}).catch(function(e){s.reject(e)}).finally(function(){u.spinner-=1;l=false});return s.promise}}]);m.service("tradingWatchlistGetInstrumentExchanges",["brsApiClient","$q","$rootScope",function(i,s,o){var c;return function(e,t){var n=s.defer();o.spinner+=1;var r={symbol:e,withDerivative:false,withIssuers:true};if(t){r.atosSymbol=t}i.get("Feed_Exchange","getBySymbol",r).then(function(e){n.resolve(e)}).catch(function(e){n.reject(e)}).finally(function(){o.spinner-=1;c=false});return n.promise}}]); "use strict";var m=angular.module("trading-watchlist",["brs-api-client","auth-user","ui-memo","ui-graph"]);m.value("tradingWatchlist",[]);m.controller("TradingWatchlistController",function(){});m.run(["$rootScope","tradingWatchlist","$log",function(t,r,i){i=i.getInstance("tradingWatchlist:run");t.$on("auth:logout",function(t,n){i.debug("auth:logout event");for(var a in r){delete r[a]}})}]); "use strict";var m=angular.module("ui-graph");m.service("uiGraphGetInstrumentHistory",["brsApiClient","$q","$rootScope",function(o,s,a){var u;return function(e,r,t){var n=s.defer();a.spinner+=1;var i={symbol:e,period:r,canBeDeactivated:true};if(t){i.atosSymbol=t}o.get("Feed_Instrument","getHistory",i).then(function(e){n.resolve(e.history)}).catch(function(e){n.reject(e)}).finally(function(){a.spinner-=1;u=false});return n.promise}}]); "use strict";var m=angular.module("ui-graph",[]);m.directive("uiGraph",["uiGraphGetInstrumentHistory","$log","brsAppVersion",function(n,o,e){o=o.getInstance("uiGraph");return{restrict:"A",scope:{period:"=uiGraphPeriod",symbol:"=uiGraphSymbol",code:"=?uiGraphCode",exchangeId:"=?uiGraphExchangeId",currency:"=?uiGraphCurrency"},templateUrl:function(r,a){return e.getUrl("/app/ui-graph/templates/graph.html")},controller:["$scope",function(r){}],link:function(i,r,a){i.$watch("symbol",function(r,a){if(a!=r){e(i.symbol,i.period)}});i.data=[];i.isLoading=false;function t(r,a){var e=new AmCharts.AmSerialChart(AmCharts.themes.none);e.dataProvider=r;e.categoryField="date";e.autoMargins=false;e.marginLeft=0;e.marginRight=5;e.marginTop=0;e.marginBottom=0;var i=new AmCharts.AmGraph;i.valueField="close";i.bulletField="bullet";i.showBalloon=false;i.lineColor="#67b7dc";e.addGraph(i);var t=new AmCharts.ValueAxis;t.gridAlpha=0;t.axisAlpha=0;e.addValueAxis(t);var n=e.categoryAxis;n.gridAlpha=0;n.axisAlpha=0;n.startOnAxis=true;e.write(a)}function e(a,r){var e=(i.code||"")+"."+(i.exchangeId||"")+"."+(i.currency||"");o.debug("requestGraph symbol: ",a);o.debug("requestGraph atosSymbol: ",e);o.debug("requestGraph period: ",r);i.isLoading=true;n(a,r,e).then(function(r){t(r,"chartdiv_"+a)}).catch(function(r){}).finally(function(){i.isLoading=false})}e(i.symbol,i.period)}}}]); "use strict";var m=angular.module("ui-memo");m.service("uiMemoAddWatchlistNote",["brsApiClient","$q","$rootScope",function(i,c,u){var s;return function(e,t,n,r){var o=c.defer();if(s){return s}else{s=o.promise}u.spinner+=1;i.get("Customer_Notes","addWatchlistNote",{watchlist:e,wkn:t,isin:n,note:r}).then(function(e){o.resolve(true)}).catch(function(e){o.reject(e)}).finally(function(){u.spinner-=1;s=false});return o.promise}}]);m.service("uiMemoUpdateWatchlistNote",["brsApiClient","$q","$rootScope",function(i,c,u){var s;return function(e,t,n,r){var o=c.defer();if(s){return s}else{s=o.promise}u.spinner+=1;i.get("Customer_Notes","updateWatchlistNote",{watchlist:e,wkn:t,isin:n,note:r}).then(function(e){o.resolve(true)}).catch(function(e){o.reject(e)}).finally(function(){u.spinner-=1;s=false});return o.promise}}]);m.service("uiMemoDeleteWatchlistNote",["brsApiClient","$q","$rootScope",function(i,c,u){var s;return function(e,t,n,r){var o=c.defer();if(s){return s}else{s=o.promise}u.spinner+=1;i.get("Customer_Notes","deleteWatchlistNote",{watchlist:e,wkn:t,isin:n,note:r}).then(function(e){o.resolve(true)}).catch(function(e){o.reject(e)}).finally(function(){u.spinner-=1;s=false});return o.promise}}]);m.service("uiMemoAddAccountNote",["brsApiClient","$q","$rootScope",function(o,i,c){var u;return function(e,t,n){var r=i.defer();if(u){return u}else{u=r.promise}c.spinner+=1;o.get("Customer_Notes","addAccountNote",{accountKey:e,wkn:t,note:n}).then(function(e){r.resolve(true)}).catch(function(e){r.reject(e)}).finally(function(){c.spinner-=1;u=false});return r.promise}}]);m.service("uiMemoUpdateAccountNote",["brsApiClient","$q","$rootScope",function(o,i,c){var u;return function(e,t,n){var r=i.defer();if(u){return u}else{u=r.promise}c.spinner+=1;o.get("Customer_Notes","updateAccountNote",{accountKey:e,wkn:t,note:n}).then(function(e){r.resolve(true)}).catch(function(e){r.reject(e)}).finally(function(){c.spinner-=1;u=false});return r.promise}}]);m.service("uiMemoDeleteAccountNote",["brsApiClient","$q","$rootScope",function(o,i,c){var u;return function(e,t,n){var r=i.defer();if(u){return u}else{u=r.promise}c.spinner+=1;o.get("Customer_Notes","deleteAccountNote",{accountKey:e,wkn:t,note:n}).then(function(e){r.resolve(true)}).catch(function(e){r.reject(e)}).finally(function(){c.spinner-=1;u=false});return r.promise}}]); "use strict";var m=angular.module("ui-memo",[]);m.directive("uiMemo",["$log","uiMemoAddWatchlistNote","uiMemoUpdateWatchlistNote","uiMemoDeleteWatchlistNote","uiMemoAddAccountNote","uiMemoUpdateAccountNote","uiMemoDeleteAccountNote","brsAppVersion",function(m,u,s,l,d,h,r,i){m=m.getInstance("uiMemo");return{restrict:"A",scope:{config:"=uiMemoConfig"},templateUrl:function(n,e){return i.getUrl("/app/ui-memo/templates/memo.html")},controller:["$scope",function(n){}],link:function(t,n,e){e.$addClass("create-notes");t.isLoading=false;t.cancel=function(){t.config.newMemo=t.config.memo;t.config.editing=false};t.saveMemo=function(){if(t.config.feature=="watchlist"){if(t.config.memo.length>0){o(t.config.featureId,t.config.wkn,t.config.isin,t.config.newMemo)}else{i(t.config.featureId,t.config.wkn,t.config.isin,t.config.newMemo)}}else{if(t.config.memo.length>0){g(t.config.featureId,t.config.wkn,t.config.newMemo)}else{f(t.config.featureId,t.config.wkn,t.config.newMemo)}}};t.deleteMemo=function(){if(t.config.feature=="watchlist"){c(t.config.featureId,t.config.wkn,t.config.isin,t.config.newMemo)}else{a(t.config.featureId,t.config.wkn,t.config.newMemo)}};function i(n,e,i,o){m.debug("requestAddWatchlistNote watchlist: ",n);m.debug("requestAddWatchlistNote wkn: ",e);m.debug("requestAddWatchlistNote isin: ",i);m.debug("requestAddWatchlistNote note: ",o);t.isLoading=true;u(n,e,i,o).then(function(n){t.config.memo=o;t.config.hasMemo=t.config.memo.length>0;t.config.editing=false}).catch(function(n){}).finally(function(){t.isLoading=false})}function o(n,e,i,o){t.isLoading=true;s(n,e,i,o).then(function(n){t.config.memo=o;t.config.hasMemo=t.config.memo.length>0;t.config.editing=false}).catch(function(n){}).finally(function(){t.isLoading=false})}function c(n,e,i,o){t.isLoading=true;l(n,e,i,o).then(function(n){t.config.memo="";t.config.hasMemo=t.config.memo.length>0;t.config.newMemo=t.config.memo;t.config.editing=false}).catch(function(n){}).finally(function(){t.isLoading=false})}function f(n,e,i){t.isLoading=true;d(n,e,i).then(function(n){t.config.memo=i;t.config.hasMemo=t.config.memo.length>0;t.config.editing=false}).catch(function(n){}).finally(function(){t.isLoading=false})}function g(n,e,i){t.isLoading=true;h(n,e,i).then(function(n){t.config.memo=i;t.config.hasMemo=t.config.memo.length>0;t.config.editing=false}).catch(function(n){}).finally(function(){t.isLoading=false})}function a(n,e,i){t.isLoading=true;r(n,e,i).then(function(n){t.config.memo="";t.config.hasMemo=t.config.memo.length>0;t.config.newMemo=t.config.memo;t.config.editing=false}).catch(function(n){}).finally(function(){t.isLoading=false})}}}}]); "use strict";var m=angular.module("ui-timer",[]);m.service("uiTimer",["$interval",function(r){var t=function(t){this._timerInterval=t|250;this._functionTab=[];this._stopTimer};t.prototype.addCallback=function(t){this._functionTab.push(t);if(this._functionTab.length===1){var n=this._functionTab;this._stopTimer=r(function(){var t=n.length;var i=[];angular.extend(i,n);for(var e=0;e<t;e++){i[e]()}},this._timerInterval)}};t.prototype.removeCallback=function(t){var i=this._functionTab.length;for(var e=0;e<i;e++){if(t===this._functionTab[e]){this._functionTab.splice(e,1);break}}if(this._functionTab.length===0){r.cancel(this._stopTimer)}};t.prototype.getTimerInterval=function(){return this._timerInterval};return new t(250)}]);m.directive("uiTimerProgressbar",["uiTimer","brsAppVersion",function(s,t){return{restrict:"E",scope:{onTimeout:"&brsAttrOnTimeout",timer:"=brsAttrValue"},templateUrl:t.getUrl("/app/ui-timer/templates/progressbar.html"),link:function(t,i,e){var n,r,a=function(){t.max=t.timer;t.type="success";t.dynamic="100";s.addCallback(o)},o=function(){t.timer-=s.getTimerInterval();t.dynamic=100*t.timer/t.max;if(t.dynamic<25){t.type="danger"}else if(t.dynamic<75){t.type="warning"}else{t.type="success"}if(t.timer<=0){s.removeCallback(o);t.onTimeout();c()}},c=function(){r=t.$watch("timer",function(t){if(t>0){r();a()}})};i.on("$destroy",function(){s.removeCallback(o)});c()}}}]); "use strict";var m=angular.module("brs-analytics",[]);m.service("brsAnalytics",["$location","brsAnalyticsTracker",function(t,e){function i(){this.inited=false;this.trackers={}}i.prototype={init:function(){if(!this.inited){this.inited=true}},getTracker:function(t){if(!this.trackers.length||this.trackers[t]===undefined){this.trackers[t]=new e(t)}return this.trackers[t]}};return new i}]);m.service("brsAnalyticsTracker",["PROFILER",function(t){function e(t){this.name=t;this._gaq=_gaq||[];this._gaq.push([this.name+"._setAccount",t]);this._gaq.push([this.name+"._setDomainName",".onvista-bank.de"]);this._gaq.push(["_gat._anonymizeIp"])}e.prototype={getGaq:function(){return this._gaq},setCustomVar:function(t,e,i,s){this._gaq.push([this.name+"._setCustomVar",t,e,i,s])},forceReferrer:function(t){t=t===undefined?"":t;this._gaq.push([this.name+"._setReferrerOverride",t])},trackPageview:function(t){if(t){this._gaq.push([this.name+"._trackPageview",t])}else{this._gaq.push([this.name+"._trackPageview"])}}};return e}]); "use strict";var m=angular.module("brs-analytics");m.directive("brsAnalytics",["brsAnalytics",function(r){return{restrict:"AE",link:function(i,t,n){r.init()}}}]); "use strict";var m=angular.module("brs-print",[]);m.service("brsPrint",["brsCompile","$rootScope","$timeout","$window","brsUiGridBlockConfig","authUser",function(s,o,p,a,e,b){this.block=function(t){var r="#brs-ui-grid-block-"+t;var i=$(r).clone(true);i.find('*[id^="AmChartsEl-"]').each(function(t,r){$(this).attr("id",$(this).attr("id")+"-print")});i.find('*[clip-path^="url("]').each(function(t,r){$(this).attr("clip-path",$(this).attr("clip-path").substring(0,$(this).attr("clip-path").length-1)+"-print)")});var n=o.$new(true);n.user=b;n.title=e.get(t).label;n.size=12;s.template(n,"app/brs-print/templates/print.html").then(function(t){$("body").append(t);$("body").addClass("brs-print-body");$("#brs-print-container .box-body").append(i.children());p(function(){a.print();$("body").removeClass("brs-print-body");$("#brs-print-container").remove()})})};this.html=function(t,r,i){var n={xl:12,md:8,xs:4};var e=o.$new(true);e.user=b;e.title=t;e.size=n[i||"xl"];s.template(e,"app/brs-print/templates/print.html").then(function(t){$("body").append(t);$("body").addClass("brs-print-body");$("#brs-print-container .box-body").append(r);p(function(){a.print();$("body").removeClass("brs-print-body");$("#brs-print-container").remove()})})}}]); "use strict";var m=angular.module("brs-print");m.directive("brsPrint",["brsPrint",function(e){return{restrict:"A",controller:["$scope","$element","$attrs",function(r,n,i){this.print=function(r){var t=$(n).clone(true).html();e.html(r,t,i.brsPrint)}}]}}]);m.directive("brsPrintAction",function(){return{restrict:"A",require:"^brsPrint",link:function(r,t,n,i){$(t).on("click",function(){i.print(n.brsPrintTitle)});r.$on("$destroy",function(){t.off("click")})}}}); "use strict";var m=angular.module("bank-derivative",[]);m.service("BankDerivativeGetDerivativeMovements",["brsApiClient","bankAccountsCurrentAccount",function(t,n){return function(){var e={accountKey:n.accountKey};return t.get("Bank_Derivative","getDerivativeMovements",e)}}]); "use strict";var m=angular.module("customer-master-data",["brs-api-client","brs-routes","customer-experience","brs-validation","brs-ui-popover","trading-realtime","auth-user","customer-details"]);m.controller("CustomerMasterDataController",["$scope","brsUiModal","CustomerTradingExperienceService","customerMasterDataModal",function(e,r,t,n){e.open=function(){n()}}]);m.controller("CustomerMasterDataModalController",["$scope","$modalInstance","BrsUiAlert","CustomerTradingExperienceService","customerMasterDataService","brsUiModalScroller","brsUiModal","brsAppVersion",function(t,e,r,n,a,s,o,i){t.alerts=new r;t.loaded=false;t.loading=0;t.brsUiModalScrollerApi=new s;t.blocking=false;t.authUser=authUser;if(authUser.hasToPassKyc()){t.blocking=true}t.close=function(){e.close()};t.registerService=function(r){t.loading++;return r.then(function(e){t.loading--;return e}).catch(function(e){t.alerts.danger(e.message,e.code);t.loading--;return r})};t.goToStep=function(e){t.step=e;t.include=i.getUrl("/app/customer-master-data/templates/step"+e+".html");var r=$(".c-customer-master-data");if(r[0]){r[0].scrollTo(0,0)}t.alerts.clear()};t.increaseLoader=function(){t.loading++};t.decreaseLoader=function(){t.loading--};t.setParentScope=function(e,r){t[e]=r};if(a.isInited()){t.loaded=true;t.goToStep(1)}else{t.registerService(a.init()).finally(function(e){t.loaded=true;t.goToStep(1)})}}]);m.controller("CustomerMasterDataFirstRecapController",["$scope","customerMasterDataService","customerDetailsSetPersonalData",function(r,e,t){r.confirm=function(){e.getPersonalData().then(function(e){r.registerService(t(e)).then(function(){r.alerts.success("Ihre Ã?nderungen wurden erfolgreich gespeichert!");r.setParentScope("isDataSubmitted",true)}).finally(function(){if(r.authUser.hasToPassKyc()){r.authUser.setHasToPassKyc(false)}})})};r.onSubmit=function(){r.goToStep(2)}}]);m.controller("CustomerMasterDataPersonalDataController",["$scope",function(e){}]);m.controller("CustomerMasterDataTradingExperiencesController",["$scope",function(e){}]);m.controller("CustomerMasterDataFinalRecapController",["$scope","authLoginPerformLogout","CustomerTradingExperienceService","customerExperienceTradingExperienceSections","authUser","customerDetailsSetPersonalData","customerExperienceSetTradingExperiences","customerDetailsSetAdsPreferences","customerMasterDataService","$q",function(a,e,r,t,n,s,o,i,c,l){a.onSubmit=function(){var e=c.getPersonalData().then(function(e){a.personalDataToChange=e;return e});var r=c.getTradingExperiences().then(function(e){a.tradingExperiencesToChange=e.tradingExperiences;return e});var t=c.getAdsPreferences().then(function(e){a.adsPreferencesToChange=e;return e});l.all([e,r,t]).then(function(e){a.loading=true;var r=s(a.personalDataToChange).then(function(){}).catch(function(e){if(e.code==90103){a.close();brsAlert("BestÃ€tigungsmeldung",e.message)}else if(e.code==90104){a.hasTin=false;a.alerts.danger(e.message)}else{a.alerts.danger(e.message)}}).finally(function(){if(a.authUser.hasToPassKyc()){a.authUser.setHasToPassKyc(false)}});var t=o(a.tradingExperiencesToChange).then(function(e){if(e.warning&&e.warning!=""){a.alerts.warning(e.warning)}if(a.tradingExperiencesToChange.era_confirm){a.tradingExperiencesToChange.era_confirm=true}}).catch(function(e){a.alerts.danger(e.message)});var n=i(a.adsPreferencesToChange).then(function(){}).catch(function(e){a.alerts.danger(e.message)});l.all([r,t,n]).then(function(e){a.alerts.success("Ihre Ã?nderungen wurden erfolgreich gespeichert!");a.setParentScope("isDataSubmitted",true)}).finally(function(){a.loading=false})})}}]); "use strict";(function(){var e=angular.module("customer-master-data");e.service("customerMasterDataModal",["brsUiModal","brsAppVersion",function(t,r){var n=false;return function(){if(!n){n=true;var e=t.open(t.getConfig("draggable","lg",{templateUrl:r.getUrl("/app/customer-master-data/templates/modal.html"),controller:"CustomerMasterDataModalController",resolve:{}}));e.result.then(function(){n=false})}}}]);e.service("customerMasterDataService",["brsApiClient","customerDetailsGetPersonalData","customerExperienceGetTradingExperiences","customerDetailsGetAdsPreferences","$q",function(e,n,s,a,i){var o={};var l={};var c={};this.init=function(){var e=n(false).then(function(e){o=e});var t=s(false).then(function(e){l=e});var r=a(false).then(function(e){c=e});return i.all([e,t,r])};this.isInited=function(){return Object.keys(o).length>0&&Object.keys(l).length>0&&Object.keys(c).length>0};this.setPersonalData=function(e){o=e};this.getPersonalData=function(){var t=i.defer();if(Object.keys(o).length===0){n(false).then(function(e){o=e;t.resolve(o)})}else{t.resolve(o)}return t.promise};this.setTradingExperiences=function(e){l=e};this.getTradingExperiences=function(){var t=i.defer();if(Object.keys(l).length===0){s(false).then(function(e){l=e;t.resolve(l)})}else{t.resolve(l)}return t.promise};this.setAdsPreferences=function(e){c=e};this.getAdsPreferences=function(){var t=i.defer();if(Object.keys(c).length===0){a(false).then(function(e){c=e;t.resolve(c)})}else{t.resolve(c)}return t.promise}}])})(); "use strict";var m=angular.module("customer-master-data");m.controller("CustomerPersonalDataController",["$scope","brsApiClient","customerMasterDataService","customerDetailsGetTitleOptions","customerDetailsGetOccupationalCategoriesOptions","customerDetailsGetCountries","customerDetailsGetIncomeThresholdsOptions","customerDetailsGetMaritalStatusOptions","customerDetailsGetCitiesInfo","customerDetailsSetPersonalData","BrsUiAlert","$timeout","authUser","brsAlert","$filter","tinMaxLength","brsAppConfig",function(r,a,e,s,n,t,d,i,o,l,f,u,c,g,C,m,p){r.blocking=false;r.authUser=c;if(c.hasToPassKyc()){r.blocking=true}r.isMobile=p.isMobile();r.occupationalSubCategories=[];r.cities=[];r.differingAddressCities=[];r.loading=1;r.loadingTitle=false;r.loadingCountries=false;r.loadingCities=false;r.loadingDifferingAddressCities=false;r.loadingOccupationalCategories=false;r.loadingIncomeThresholds=false;r.loadingMaritalStatusOptions=false;r.loadingOccupationalSubCategories=false;r.alerts=new f;r.address={country:"",differingAddressCountry:"",deutschland:{postCode:"",city:"",differingAddressStreet:"",differingAddressHouseNumber:"",differingAddressPostCode:"",differingAddressCity:""},international:{postCode:"",city:"",differingAddressStreet:"",differingAddressHouseNumber:"",differingAddressPostCode:"",differingAddressCity:""}};r.differingAddressPostCodeLastCommittedValue="";r.postCodeLastCommittedValue="";r.tinMinLength=11;r.tinMaxLength=m;r.phonePattern="^0[0-9]+$";r.isValidPhone=function(e){return new RegExp(r.phonePattern).test(e)};r.onLoading();e.getPersonalData().then(function(e){r.personalDataToChange=angular.copy(e);h();r.baseData=angular.copy(e);r.address.country=e.country;r.address.differingAddressCountry=e.differingAddressCountry;if(e.country=="Deutschland"){r.hasTin=!!r.personalDataToChange.taxIdentificationNumber;r.tinMaxLength=11;r.address.deutschland.postCode=e.postCode;r.address.deutschland.city=e.city;r.address.deutschland.federalState=e.federalState}else{r.tinMinLength=0;r.address.international.postCode=e.postCode;r.address.international.city=e.city}if(e.differingAddressCountry=="Deutschland"){r.address.deutschland.differingAddressStreet=e.differingAddressStreet;r.address.deutschland.differingAddressHouseNumber=e.differingAddressHouseNumber;r.address.deutschland.differingAddressPostCode=e.differingAddressPostCode;r.address.deutschland.differingAddressCity=e.differingAddressCity}else{r.address.international.differingAddressStreet=e.differingAddressStreet;r.address.international.differingAddressHouseNumber=e.differingAddressHouseNumber;r.address.international.differingAddressPostCode=e.differingAddressPostCode;r.address.international.differingAddressCity=e.differingAddressCity}r.onOccupationalCategoryChange(r.personalDataToChange.occupationalCategory);if(e.country=="Deutschland"){r.onPostCodeChange(r.address.deutschland.postCode,false);r.onCityChange(r.address.deutschland.city)}if(e.differingAddressCountry=="Deutschland"){r.onPostCodeChange(r.address.deutschland.differingAddressPostCode,true);r.onCityChange(r.address.deutschland.differingAddressCity,true)}}).catch(function(e){r.alerts.danger(e.message)}).finally(function(){r.loading-=1;r.onReady()});r.loading+=1;r.loadingTitle=true;s(false).then(function(e){r.titleOptions=e}).catch(function(e){r.alerts.danger(e.message)}).finally(function(){r.loading-=1;u(function(){r.loadingTitle=false},1e3)});r.loading+=1;r.loadingOccupationalCategories=true;n(false).then(function(e){r.occupationalCategories=e}).catch(function(e){r.alerts.danger(e.message)}).finally(function(){r.loading-=1;u(function(){r.loadingOccupationalCategories=false},1e3)});r.loading+=1;r.loadingCountries=true;t(false).then(function(e){r.countries=e}).catch(function(e){r.alerts.danger(e.message)}).finally(function(){r.loading-=1;u(function(){r.loadingCountries=false},1e3)});r.loading+=1;r.loadingIncomeThresholds=true;d(false).then(function(e){r.incomeThresholdsOptions=e;h()}).catch(function(e){r.alerts.danger(e.message)}).finally(function(){r.loading-=1;u(function(){r.loadingIncomeThresholds=false},1e3)});r.loading+=1;r.loadingMaritalStatusOptions=true;i(false).then(function(e){r.maritalStatusOptions=e}).catch(function(e){r.alerts.danger(e.message)}).finally(function(){r.loading-=1;u(function(){r.loadingMaritalStatusOptions=false},1e3)});r.resetValidity=function(e,a){r.personalDataForm[e].$setValidity(a,true)};r.onOccupationalCategoryChange=function(e){if(e==undefined){r.occupationalSubCategories=[];r.personalDataToChange.occupation=undefined;angular.element(angular.element.find("select[name='occupation']")).closest('[class^="form-group"]').addClass("has-error");return}r.loadingOccupationalSubCategories=true;var s="";if(angular.isDefined(r.personalDataToChange.occupation)){s=r.personalDataToChange.occupation;r.personalDataToChange.occupation=""}a.get("Customer_Options","getOccupationalSubCategoriesOptions",{categoryCode:e}).then(function(e){r.occupationalSubCategories=e.occupationalSubCategories;if(e.occupationalSubCategories.length==1){s=e.occupationalSubCategories[0].occupationalSubCategoryCode}var a=_.find(r.occupationalSubCategories,function(e){var a=e.occupationalSubCategoryCode.toLowerCase()===s.toLowerCase();if(a){s=e.occupationalSubCategoryCode}return a});if(!a){s=""}}).catch(function(e){r.error=e}).finally(function(){r.personalDataToChange.occupation=s;u(function(){r.loadingOccupationalSubCategories=false},1e3)})};r.onPostCodeChange=function(e,s){if(r.address.country=="Deutschland"||s&&r.address.differingAddressCountry=="Deutschland"){if(s){if(r.differingAddressPostCodeLastCommittedValue==e){return}r.differingAddressPostCodeLastCommittedValue=e;r.loadingDifferingAddressCities=true}else{if(r.postCodeLastCommittedValue==e){return}r.postCodeLastCommittedValue=e;r.loadingCities=true}if(e!=undefined&&e.length==5){if(s){var n="";if(angular.isDefined(r.address.deutschland.differingAddressCity)){n=r.address.deutschland.differingAddressCity;r.address.deutschland.differingAddressCity=""}}else{var t="";if(angular.isDefined(r.address.deutschland.city)){t=r.address.deutschland.city;r.address.deutschland.city=""}}o(e).then(function(e){if(s){angular.element(angular.element.find("select[name='differingAddressPostCode']")).closest('[class^="form-group"]').removeClass("has-error");if(r.personalDataForm.differingAddressPostCode){r.personalDataForm.differingAddressPostCode.$setValidity("postCodeInvalid",true)}r.differingAddressCities=e;var a=false;angular.forEach(r.differingAddressCities,function(e){if(e.cityName==n){a=true}});if(!a&&C("brsFilterObjectLength")(r.differingAddressCities)==1){a=true;n=r.differingAddressCities[0]["cityName"]}if(a){angular.element(angular.element.find("select[name='differingAddressCity']")).closest('[class^="form-group"]').removeClass("has-error")}else{if(r.personalDataForm.differingAddressCity){r.personalDataForm.differingAddressCity.$setValidity("differingAddressCityInValid",true)}angular.element(angular.element.find("select[name='differingAddressCity']")).closest('[class^="form-group"]').addClass("has-error")}}else{angular.element(angular.element.find("select[name='postCode']")).closest('[class^="form-group"]').removeClass("has-error");if(r.personalDataForm.postCode){r.personalDataForm.postCode.$setValidity("postCode",true)}r.cities=e;var a=false;angular.forEach(r.cities,function(e){if(e.cityName==t){a=true}});if(!a&&C("brsFilterObjectLength")(r.cities)==1){a=true;t=r.cities[0]["cityName"]}if(a){angular.element(angular.element.find("select[name='city']")).closest('[class^="form-group"]').removeClass("has-error")}else{if(r.personalDataForm.city){r.personalDataForm.city.$setValidity("cityInvalid",true)}angular.element(angular.element.find("select[name='city']")).closest('[class^="form-group"]').addClass("has-error");r.address.deutschland.federalState="";angular.element(angular.element.find("input[name='federalState']")).closest('[class^="form-group"]').addClass("has-error")}}}).catch(function(e){if(s){r.differingAddressCities=[];angular.element(angular.element.find("input[name='differingAddressPostCode']")).closest('[class^="form-group"]').addClass("has-error");angular.element(angular.element.find("select[name='differingAddressCity']")).closest('[class^="form-group"]').addClass("has-error");if(r.personalDataForm.differingAddressPostCode){r.personalDataForm.differingAddressPostCode.$setValidity("postCodeInvalid",false)}}else{r.cities=[];r.address.deutschland.federalState="";angular.element(angular.element.find("input[name='postCode']")).closest('[class^="form-group"]').addClass("has-error");angular.element(angular.element.find("select[name='city']")).closest('[class^="form-group"]').addClass("has-error");angular.element(angular.element.find("input[name='federalState']")).closest('[class^="form-group"]').addClass("has-error");if(r.personalDataForm.postCode){r.personalDataForm.postCode.$setValidity("postCodeInvalid",true)}}u(function(){if(s){r.loadingDifferingAddressCities=true}else{r.loadingCities=true}},1e3)}).finally(function(){u(function(){if(s){r.address.deutschland.differingAddressCity=n;r.onCityChange(r.address.deutschland.differingAddressCity,true);r.loadingDifferingAddressCities=false}else{r.address.deutschland.city=t;r.onCityChange(r.address.deutschland.city);r.loadingCities=false}},1e3)})}else{if(s){r.differingAddressCities=[];angular.element(angular.element.find("select[name='differingAddressPostCode']")).closest('[class^="form-group"]').addClass("has-error");angular.element(angular.element.find("select[name='differingAddressCity']")).closest('[class^="form-group"]').addClass("has-error");if(r.personalDataForm.differingAddressPostCode){r.personalDataForm.differingAddressPostCode.$setValidity("postCodeInvalid",false)}}else{r.cities=[];r.address.deutschland.federalState=undefined;angular.element(angular.element.find("input[name='postCode']")).closest('[class^="form-group"]').addClass("has-error");angular.element(angular.element.find("select[name='city']")).closest('[class^="form-group"]').addClass("has-error");angular.element(angular.element.find("input[name='federalState']")).closest('[class^="form-group"]').addClass("has-error");if(r.personalDataForm.postCode){r.personalDataForm.postCode.$setValidity("postCodeInvalid",false)}}u(function(){if(s){r.loadingDifferingAddressCities=false}else{r.loadingCities=false}r.address.deutschland.federalState=undefined},1e3)}}};r.onCityChange=function(a,e){if(!e){if(a!=undefined){angular.forEach(r.cities,function(e){if(e.cityName==a&&r.personalDataForm.city){r.personalDataForm.city.$setValidity("cityValid",true);r.address.deutschland.federalState=e.cityFederalStateName;angular.element(angular.element.find("input[name='federalState']")).closest('[class^="form-group"]').removeClass("has-error");angular.element(angular.element.find("input[name='city']")).closest('[class^="form-group"]').removeClass("has-error")}})}else{r.address.deutschland.federalState=undefined;if(r.personalDataForm.city){r.personalDataForm.city.$setValidity("cityInvalid",true)}angular.element(angular.element.find("input[name='federalState']")).closest('[class^="form-group"]').addClass("has-error");angular.element(angular.element.find("input[name='city']")).closest('[class^="form-group"]').addClass("has-error")}}else{if(a!=undefined){angular.forEach(r.differingAddressCities,function(e){if(e.cityName==a&&r.personalDataForm.differingAddressCity){r.personalDataForm.differingAddressCity.$setValidity("cityValid",true);angular.element(angular.element.find("input[name='differingAddressCity']")).closest('[class^="form-group"]').removeClass("has-error")}})}else{r.address.deutschland.differingAddressCity=undefined;r.personalDataForm.differingAddressCity.$setValidity("cityValid",false);angular.element(angular.element.find("input[name='differingAddressCity']")).closest('[class^="form-group"]').addClass("has-error")}}};r.changePersonnalData=function(){r.alerts.clean();r.personalDataToChange.country=r.address.country;r.personalDataToChange.differingAddressCountry=r.address.differingAddressCountry;if(r.personalDataToChange.country=="Deutschland"){r.personalDataToChange.postCode=r.address.deutschland.postCode;r.personalDataToChange.city=r.address.deutschland.city;r.personalDataToChange.federalState=r.address.deutschland.federalState}else{r.personalDataToChange.postCode=r.address.international.postCode;r.personalDataToChange.city=r.address.international.city}if(r.personalDataToChange.differingAddressCountry=="Deutschland"){r.personalDataToChange.differingAddressStreet=r.address.deutschland.differingAddressStreet;r.personalDataToChange.differingAddressHouseNumber=r.address.deutschland.differingAddressHouseNumber;r.personalDataToChange.differingAddressPostCode=r.address.deutschland.differingAddressPostCode;r.personalDataToChange.differingAddressCity=r.address.deutschland.differingAddressCity}else{r.personalDataToChange.differingAddressStreet=r.address.international.differingAddressStreet;r.personalDataToChange.differingAddressHouseNumber=r.address.international.differingAddressHouseNumber;r.personalDataToChange.differingAddressPostCode=r.address.international.differingAddressPostCode;r.personalDataToChange.differingAddressCity=r.address.international.differingAddressCity}angular.forEach(r.countries,function(e){if(r.personalDataToChange.country==e.countryName){r.personalDataToChange.countryIsoCode=e.countryIsoCode}if(r.personalDataToChange.differingAddressCountry==e.countryName){r.personalDataToChange.differingAddressCountryIsoCode=e.countryIsoCode}if(r.personalDataToChange.countryOfBirthIsoCode==e.countryIsoCode){r.personalDataToChange.countryOfBirth=e.countryName}});e.setPersonalData(r.personalDataToChange);r.onSubmit()};r.cancel=function(){r.modalInstance.dismiss("cancel")};r.incomeCodeForSorting=function(e){if(e.incomeCode===6)return-1;return e.incomeCode};function h(){if(r.incomeThresholdsOptions!==undefined&&r.personalDataToChange!==undefined){var e=["incomePerYear","incomeTotal","incomeTotalToSpend"],a,s;for(var n=0;n<e.length;n++){s=r.incomeThresholdsOptions[e[n]];a=false;for(var t=0;t<s.length;t++){if(s[t].incomeCode==r.personalDataToChange[e[n]]){a=true;break}}if(!a){r.personalDataToChange[e[n]]=undefined}}}}}]); "use strict";var m=angular.module("customer-master-data");m.directive("personalDataForm",["brsAppVersion",function(e){return{restrict:"E",scope:{isReadOnly:"=",onCancel:"&",onSubmit:"&",onLoading:"&",onReady:"&"},templateUrl:e.getUrl("/app/customer-master-data/templates/personal-data-form.html"),controller:"CustomerPersonalDataController"}}]); "use strict";var m=angular.module("customer-master-data");m.controller("TradingExperiencesController",["$scope","authUser","customerMasterDataService","customerExperienceTradingExperienceSections","customerExperienceUpdateEra","customerExperienceSetTradingExperiences","customerExperienceGetDocuments","BrsUiAlert","$window","informationSheetUrl",function(r,e,n,i,a,t,c,d,s,o){var l=["Z4","Z5","T","EUREX","CFD"];r.informationSheetUrl=o;r.experienceSections=i;r.tradingExperiences={};r.authUser=e;r.loading=true;r.alerts=new d;r.regex=/^\d{1,3}$/;r.showConfirmation=false;r.documents=null;r.documentAsBase64="";r.showDynamicLink=false;Object.defineProperty(r,"isOneOfExperience03Checked",{get:function(){var n=false;l.forEach(function(e){if(r.tradingExperiences[e]&&r.tradingExperiences[e].active){n=true}});return n}});r.onLoading();n.getTradingExperiences().then(function(e){r.tradingExperiences=angular.extend(e.tradingExperiences);r.outdatedEra=angular.copy(e.outdatedEra);r.validEra=angular.copy(e.validEra);r.validatedEra=angular.copy(e.validatedEra);r.tradingExperiences.era_confirm=r.validEra;if(r.canShowEra&&!r.validatedEra&&r.isOneOfExperience03Checked){c().then(function(e){r.documents=e.documents;r.showConfirmation=r.documents.resultCode===1||r.documents.resultCode===2;r.showDynamicLink=r.documents.resultCode===1}).finally(function(){r.onReady();r.loading=false})}else{r.onReady();r.loading=false}}).catch(function(e){r.alerts.danger(e.message);r.onReady();r.loading=false});r.confirmEra=function(e){if(e&&r.outdatedEra){r.outdatedEra=!s.confirm('Wir bitten Sie, alle zwei Jahre zu prÃŒfen, ob Sie die erforderlichen Kenntnisse ÃŒber die Risiken im Umgang mit FinanztermingeschÃ€ften besitzen. Bitte bestÃ€tigen Sie uns dies durch einen Klick auf das Feld "OK".  Sollten Sie keine VerlÃ€ngerung wÃŒnschen oder weitere Informationen benÃ¶tigen, klicken Sie auf "Abbrechen". Weitere Informationen finden Sie im Bereich "Verwaltung - PersÃ¶nliche Einstellungen - Erfahrungen - TermingeschÃ€fte".');if(!r.outdatedEra){a().then(function(e){r.outdatedEra=e;r.alerts.success("Ihre VerlÃ€ngerung zu den erforderlichen Kenntnissen ÃŒber die Risiken im Umgang mit FinanztermingeschÃ€ften wurde erfolgreich gespeichert.")}).catch(function(e){r.alerts.danger(e.message)})}}};r.tradesReset=function(e){if(!r.tradingExperiences[e].active){r.tradingExperiences[e].trades=""}if(_.contains(l,e)){if(!r.tradingExperiences.Z4.active&&!r.tradingExperiences.Z5.active&&!r.tradingExperiences.T.active&&!r.tradingExperiences.EUREX.active&&!r.tradingExperiences.CFD.active){r.tradingExperiences.era_confirm=false}}};r.setTradingExperiences=function(){n.setTradingExperiences({tradingExperiences:r.tradingExperiences,outdatedEra:r.outdatedEra,validEra:r.validEra,validatedEra:r.validatedEra});r.onSubmit()};r.onEraConfirm=function(){n.setTradingExperiences({tradingExperiences:r.tradingExperiences,outdatedEra:r.outdatedEra,validEra:r.validEra,validatedEra:r.validatedEra})};r.downloadDocument=function(){var e=u(r.documents.file.replace(/[^\x20-\x7E]/gim,""),"application/pdf");saveAs(e,r.documents.fileName)};function u(e,n,r){n=n||"";r=r||512;var i=atob(e);var a=[];for(var t=0;t<i.length;t+=r){var c=i.slice(t,t+r);var d=new Array(c.length);for(var s=0;s<c.length;s++){d[s]=c.charCodeAt(s)}var o=new Uint8Array(d);a.push(o)}return new Blob(a,{type:n})}}]); "use strict";var m=angular.module("customer-master-data");m.directive("tradingExperiencesForm",["brsAppVersion",function(e){return{restrict:"E",scope:{isReadOnly:"=",canShowEra:"=",showLastCategories:"=?",onCancel:"&",onSubmit:"&",onLoading:"&",onReady:"&"},templateUrl:e.getUrl("/app/customer-master-data/templates/trading-experiences-form.html"),controller:"TradingExperiencesController"}}]); "use strict";var m=angular.module("customer-master-data");m.service("CustomerTradingExperienceService",["brsApiClient","customerDetailsGetPersonalData","customerExperienceGetTradingExperiences","$q",function(o,r,a,c){var s={},u={},t="",m="",l="",d="",i=undefined,n={},f="";this.init=function(){var e=o.get("Customer_Options","getIncomeThresholdsOptions").then(function(e){u.incomePerYear=e.incomeThresholdsOptions.incomePerYear;u.incomeTotal=e.incomeThresholdsOptions.incomeTotal;u.incomeTotalToSpend=e.incomeThresholdsOptions.incomeTotalToSpend});var n=r(false).then(function(e){m=e.salutation;l=e.name;s.incomePerYear=e.incomePerYear;s.incomeTotal=e.incomeTotal;s.incomeTotalToSpend=e.incomeTotalToSpend});var t=a(false).then(function(e){d=e.tradingExperiences});var i=o.get("Customer_Details","getCountryAndFiscality").then(function(e){f=e.country;u.taxIdentificationNumber=e.taxIdentificationNumber});return c.all([e,n,t,i])};this.isInited=function(){return typeof u.incomeTotal!=="undefined"};this.setPhonePassword=function(n){return o.get("Customer_Security","changePhonePassword",{newPhonePassword:n,newPhonePasswordIteration:n}).then(function(e){t=n})};this.setFinancialData=function(e){return o.get("Customer_Details","setFinancialData",{incomePerYear:e.incomePerYear,incomeTotal:e.incomeTotal,incomeTotalToSpend:e.incomeTotalToSpend}).then(function(){s=angular.copy(e)})};this.setFiscality=function(e){return o.get("Customer_Details","setFiscality",{taxIdentificationNumber:e}).then(function(){u.taxIdentificationNumber=angular.copy(e)})};this.isAccountEnabled=function(){var n=c.defer();if(angular.isUndefined(i)===false){n.resolve(i);return n.promise}o.get("Customer_Account","isAccountEnabled").then(function(e){i=e.depotEnabled;n.resolve(i)}).catch(function(e){n.reject(e)});return n.promise};this.enableAccount=function(){return o.get("Customer_Account","enableAccount")};this.getPhonePassword=function(){return t};this.getFinancialData=function(){return angular.copy(s)};this.getIncomePerYearOptions=function(){return u.incomePerYear};this.getIncomeTotalOptions=function(){return u.incomeTotal};this.getIncomeTotalToSpendOptions=function(){return u.incomeTotalToSpend};this.getSalutation=function(){return m};this.getName=function(){return l};this.getTradingExperiences=function(){return d};this.setActivationTradingExperiences=function(e){n=e};this.getActivationTradingExperiences=function(){return n};this.getCountry=function(){return f};this.getTaxIdentificationNumber=function(){return u.taxIdentificationNumber}}]); "use strict";var m=angular.module("customer-master-data");m.controller("AdsPreferencesController",["$scope","customerMasterDataService","brsAppConfig",function(e,a,r){e.adByEmail=1;e.adByPhone=1;e.thirdPartyDataSharing=1;e.partnerMode=r.isPartnerMode();e.onLoading();a.getAdsPreferences().then(function(a){e.adByEmail=a.adByEmail;e.adByPhone=a.adByPhone;e.thirdPartyDataSharing=a.thirdPartyDataSharing}).catch(function(a){e.alerts.danger(a.message)}).finally(function(){e.loading-=1;e.onReady()});e.setAdsPreferences=function(){a.setAdsPreferences({adByEmail:e.adByEmail||0,adByPhone:e.adByPhone||0,thirdPartyDataSharing:e.thirdPartyDataSharing||0})}}]); "use strict";var m=angular.module("customer-master-data");m.directive("adsPreferencesForm",["brsAppVersion",function(e){return{restrict:"E",scope:{isReadOnly:"=",onCancel:"&",onSubmit:"&",onLoading:"&",onReady:"&"},templateUrl:e.getUrl("/app/customer-master-data/templates/ads-preferences-form.html"),controller:"AdsPreferencesController"}}]); "use strict";var m=angular.module("customer-master-data");m.value("customerDetailsAdsPreferences",{adByEmail:0,adByPhone:0,thirdPartyDataSharing:0});m.service("customerDetailsSetAdsPreferences",["brsApiClient","$q","$rootScope","customerDetailsAdsPreferences",function(s,t,n,a){var i;return function(e){var r=t.defer();if(i){return i}else{i=r.promise}n.spinner+=1;s.get("Customer_Details","setAdsPreferences",e).then(function(e){angular.extend(a,e.adsPreferences);r.resolve(a)}).catch(function(e){r.reject(e)}).finally(function(){n.spinner-=1;i=false});return r.promise}}]);m.service("customerDetailsGetAdsPreferences",["brsApiClient","$q","customerDetailsAdsPreferences",function(s,t,n){var a;return function(e){var r=t.defer();if(!n.adByEmail||e){if(a){return a}else{a=r.promise}s.get("Customer_Details","getAdsPreferences").then(function(e){angular.extend(n,e.adsPreferences);r.resolve(n)}).catch(function(e){r.reject(e)}).finally(function(){a=false})}else{r.resolve(n)}return r.promise}}]);
          1> Submitting login form.
          1> Sending: POST https://webtrading.onvista-bank.de/services/api/?s0=Session_Auth.login
          1> Received: {"s0":{"result":{"user":{"login":"TK489638","managerId":false,"accountActivated":true,"passwordMustBeChanged":null,"canForce":false,"canAffect":false,"canCashAdjust":false},"otpInfo":{"hasPassedOtpRegistration":true,"useStrongAuth":true,"hasToPassOtp":false,"otpCodeLength":6},"_meta":{"requestExecutionTime":0.1746530532836914}}}}
          1> Loading list of accounts.
          1> Sending: POST https://webtrading.onvista-bank.de/services/api/?s0=Bank_Account.getAccountsList
          1> Received: {"s0":{"result":{"accountsList":[{"rib":"00001 00001 00000489638 47","accountKey":"1dbcdc5ba86fb1b377a3e52805d14ed2","accountNumber":"489638","sapCashAccountNumber":"0489638048","iban":"DE95514108000489638048","bic":"BOURDEFFXXX","name":"Tobias Kolb","currency":"EUR","buyPower":950,"creditLimit":0,"currentBalance":0,"pricingLabel":"5EUR-Festpreis","isCFDAccount":false,"isCompanyAccount":false,"amountLimit":10000,"accountType":"ORD"}],"defaultAccountKey":false,"_meta":{"requestExecutionTime":0.09843301773071289}}}}
          1> Getting balance and transactions for Verrechnungskonto...
          1> Getting transactions since 06.11.2019...
          1> Loading transactions.
          1> Sending: POST https://webtrading.onvista-bank.de/services/api/?s0=Bank_Account.getMovements
          1> Received: {"s0":{"result":{"movements":[],"_meta":{"requestExecutionTime":0.023028850555419922}}}}
          1> Logging out.
          1> Sending: POST https://webtrading.onvista-bank.de/services/api/?s0=Session_Auth.logout
          1> Received: {"s0":{"result":{"success":true,"_meta":{"requestExecutionTime":0.03340792655944824}}}}
          1> Received 0 transactions.
